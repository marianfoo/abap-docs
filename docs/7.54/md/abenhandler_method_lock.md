---
title: "FOR LOCK"
description: |
  Syntax METHODS method_name FOR LOCK IMPORTING lock_import_parameter FOR LOCK entity_name. ... CHANGING failed   TYPE DATA reported TYPE DATA. Effect The LOCK implements the handler that locks entities. However, the lock properties(https://help.sap.com/doc/abapdocu_754_index_htm
version: "7.54"
category: "general"
type: "abap-reference"
sourceUrl: "https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenhandler_method_lock.htm"
abapFile: "abenhandler_method_lock.htm"
keywords: ["insert", "update", "loop", "do", "if", "try", "method", "class", "data", "types", "abenhandler", "lock"]
---

* * *

AS ABAP Release 754, ©Copyright 2019 SAP SE. All rights reserved.

[ABAP Keyword Documentation](https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenabap.htm) →  [ABAP − Reference](https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenabap_reference.htm) →  [ABAP RESTful Programming Model](https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenrestful_abap_programming.htm) →  [Behavior Implementations](https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenabap_behavior_implementations.htm) →  [Handler Class](https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenrpm_handler_class.htm) → 

FOR LOCK

Syntax

METHODS method\_name FOR LOCK
    *\[*IMPORTING*\]*
        lock\_import\_parameter FOR LOCK entity\_name.
     ...
    *\[*CHANGING failed   TYPE DATA
              reported TYPE DATA*\]*.

Effect

The LOCK implements the handler that locks entities. However, the [lock properties](https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenbdl_lock.htm) lock master or lock dependent must be specified in the [behavior definition](https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenbehavior_definition_glosry.htm "Glossary Entry") of a [business object](https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenbusiness_object_glosry.htm "Glossary Entry"). The method lock is called automatically before a change operation (for example, update).

The method name method\_name is arbitrary. Using this generalization, it is possible to accommodate multiple LOCK methods in a single [handler class](https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenrpm_handler_class.htm).

entity\_name refers to the name of the entity or the [alias](https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenbdl_alias.htm), if it exists, as defined in the behavior definition.

Input Parameters

The following points apply to the input parameter lock\_import\_parameter:

-   The name of the input parameter can be freely defined.

-   The row type of the input parameter provides the ID fields. This structure contains the fields of the entity that are specified as keys.

-   The [fields](https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abencomponents_derived_types.htm) %CID, %CID\_REF, and %PID generated by ABAP Compiler are not required in the context of locks, since locks are only relevant for instances saved in the database.

Output Parameters

The output parameters failed and reported for errors or messages are added automatically. They can, however, be declared explicitly as [CHANGING](https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenchanging_type_data.htm) parameters in the method signature using the generic type DATA:

CHANGING failed   TYPE DATA
         reported TYPE DATA

The parameters failed and reported don’t have fixed data types and are assigned with derived types from the behavior definition instead. The parameter mapped is part of the method signature, but it is not used in the method.

Remarks

-   The old syntax METHODS lock FOR BEHAVIOR ... is also valid but is no longer recommended.

-   The keyword IMPORTING is not mandatory and can be specified in front of the input parameter.

Example

In the following example, the data from the ABAP flight data reference scenario (or flight data scenario for short) is used. It represents a legacy business logic that can be used to create and edit flight bookings. The root entity Travel represents the business object for managing flight trips. The underlying data model and the behavior of the root entity Travel are described in [ABAP BDL - Example](https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenbdl_example.htm).

The following example shows the definition and implementation of the LOCK method lock\_travel. The implementation of the method includes

-   a loop for all instances of the entity Travel to be locked,

-   calling the function module of the legacy business logic ENQUEUE\_/DMO/ETRAVEL, and

-   message handling for processing instance-specific messages. For the sake of readability, the methods for handling the messages are implemented in the separate class zcl\_messages. The class zcl\_messages is described in [Example - Handling of Messages](https://help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenrpm_handling_messages.htm).

CLASS lcl\_travel\_handler DEFINITION
    INHERITING FROM cl\_abap\_behavior\_handler.
  PRIVATE SECTION.
    METHODS lock\_travel FOR LOCK
      IMPORTING
        it\_travel\_key FOR LOCK travel.
ENDCLASS.

CLASS lcl\_travel\_handler IMPLEMENTATION.
  METHOD lock\_travel.
    LOOP AT it\_travel\_key ASSIGNING FIELD-SYMBOL(<fs\_travel>).
      CALL FUNCTION 'ENQUEUE\_/DMO/ETRAVEL'
        EXPORTING
          travel\_id      = <fs\_travel>-travel\_id
        EXCEPTIONS
          foreign\_lock   = 1
          system\_failure = 2
          OTHERS         = 3.
      ASSERT sy-subrc < 2.
      IF sy-subrc = 1.
        INSERT zcl\_messages=>map\_travel\_message(
           iv\_travel\_id = <fs\_travel>-travel\_id
           is\_message   = VALUE #( msgid = '/DMO/CM\_FLIGHT\_LEGAC'
                                   msgty = 'E'
                                   msgno = '032'
                                   msgv1 = <fs\_travel>-travel\_id
                                   msgv2 = sy-msgv1 ) )
          INTO TABLE reported-travel.
        APPEND VALUE #( travel\_id = <fs\_travel>-travel\_id )
               TO failed-travel.
      ENDIF.
    ENDLOOP.
  ENDMETHOD.
ENDCLASS.