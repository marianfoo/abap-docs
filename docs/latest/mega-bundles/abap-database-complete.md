# ABAP DATABASE - Complete Reference (latest)

**Generated**: 2025-09-01T11:14:57.075Z
**Bundles Combined**: 87
**Category**: database

---



## üîó Complete Source Documentation

**üìñ Official Documentation**: [ABAP Keyword Documentation latest](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/index.htm)
**üè∑Ô∏è Category**: DATABASE
**üîç Search Specific Topics**: Use `abap_search query:"database"` for focused results
**üìÑ Individual Pages**: All source URLs included in each section below

### üéØ Quick Navigation
- **Search for specific statements**: `abap_search query:"SELECT"` or `abap_search query:"LOOP"`
- **Get individual bundles**: Use `abap_get` with specific bundle doc_id
- **Browse by difficulty**: Look for **Difficulty** markers in each section

---

## ABAP - Keyword Documentation / ABAP - Dictionary (DDIC) / DDIC - Database Tables / DDIC - Technical Properties of Database Tables

**Files**: 12 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Dictionary (DDIC) / DDIC - Database Tables / DDIC - Technical Properties of Database Tables

Included pages: 12


### abenddic_database_tables_tech.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_tech.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_tech.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Technical%20Properties%20of%20Database%20Tables%2C%20ABENDDIC_DATABASE_TABLES_TECH%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20
for%20improvement:)

DDIC - Technical Properties of Database Tables

The technical properties of a DDIC database table include the properties that are specific for its structure and properties that are specific for the table itself.

-   [DDIC - Structure-Specific Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_techstruc.htm'\))
-   [DDIC - Table-Specific Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_techspec.htm'\))

Continue
[DDIC - Structure-Specific Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_techstruc.htm'\))
[DDIC - Table-Specific Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_techspec.htm'\))



**üìñ Source**: [abenddic_database_tables_tech.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_tech.htm)

### abenddic_database_tables_techstruc.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_techstruc.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_techstruc.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_tech.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Structure-Specific%20Technical%20Properties%20of%20Database%20Tables%2C%20ABENDDIC_DATABASE_TABLES_TECHSTRUC%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0
A%0D%0A%0D%0ASuggestion%20for%20improvement:)

DDIC - Structure-Specific Technical Properties of Database Tables

The following technical properties are mostly the same as those of a [DDIC structure](javascript:call_link\('abenddic_structures_tech.htm'\)) in ABAP Dictionary:

-   Table fields (columns)
    
    A table field is a component of the structure of the DDIC database table and describes the name, the data type, and any semantic properties of a field of a DDIC database table. A table field is a component of the structured data type of the table and the corresponding [rules](javascript:call_link\('abenddic_structures_tech.htm'\)) apply to the component name and component type, with the following restrictions:
    
    -   The name of a table field cannot be a reserved name. The reserved names that cannot be used are specified in the DDIC database table TRESE. This is also important when using [include structures](javascript:call_link\('abenddic_include_structure.htm'\)).
    -   A table field always has one elementary data type. Reference types, substructures, and table types are not possible. The elementary data type is specified directly for the table field or by using a data element and is always based on a [built-in dictionary type](javascript:call_link\('abenddic_builtin_types.htm'\)). A table field has a platform-dependent type in the physical database table. For each platform, there is a mapping between the elementary types in the ABAP Dictionary and the platform-dependent types. If only [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") is used, this mapping is transparent for ABAP programmers and only the built-in types in the ABAP Dictionary and their ABAP types are relevant for the ABAP program.
    -   Fields with the type CHAR can have a maximum of 1333 characters.
    -   Fields with the type LRAW or LCHR must be at the end of the table. Only one such field is allowed per table. Directly in front of a field with the type LRAW or LCHR, there must be a field with the type INT2 or INT4 that defines the maximum length of the field.
    -   Fields of the obsolete types DF16\_SCL and DF34\_SCL must be followed directly by a field of type INT2 for scaling.
-   Include structures
    
    DDIC structures, but not DDIC database tables or DDIC views, can be included in a DDIC database table as [include structures](javascript:call_link\('abenddic_include_structure.htm'\)). A structure can only be included in a table if its components meet the table field prerequisites above. In particular, an included structure cannot contain any substructures. Any naming conflicts must be bypassed by defining suffixes. As in regular structures, the include can be assigned a group name.
    
    -   When a structure is included, all its fields can be flagged as [key fields](javascript:call_link\('abenddic_database_tables_key.htm'\)). The include structure must then be inserted between the existing key fields or directly after them. The key properties of the individual fields of an included structure do not have any effect. Either all fields are included as key fields or none.
    -   When an include structure is included, the [flag for initial values](javascript:call_link\('abenddic_database_tables_init.htm'\)) can be set for the entire include structure. In this case, the fields in the include structure for which this property is set keep their property, but if this property is not set, it is also not switched on. If the flag for initial values is not set for the included include structure, this property is removed for all its fields.
    
    The fields of an included include structure are still part of the structure. They can only be edited via the structure and any changes made to the structure affect all including database tables. The fields of an included include structure can also be transformed to direct fields of the DDIC database table that are no longer linked with the originally included structure.
    
-   Enhancement category
    
    The same applies to the enhancement category of DDIC database tables as to the [enhancement category of structures](javascript:call_link\('abenddic_structures_enh_cat.htm'\)).
    

The following applies with respect to the number of fields and length of the structure of a DDIC database table:

-   Number of fields
    -   A table in the software component SAP\_BASIS can contain a maximum of 750 fields.
    -   A table in a software component other than SAP\_BASIS can contain 1000 fields if the [storage type](javascript:call_link\('abenddic_database_tables_storage.htm'\)) is Row Store and 1500 fields if the storage type is Column Store.
-   The total of all field lengths is limited. The following applies with respect to the total of the number of bytes of the non-character-like fields and the number of characters of the flat character-like fields:
    
    -   In a table in the software component SAP\_BASIS, the total cannot be greater than 4030.
    -   In the ABAP Dictionary, no limit applies to tables in software components other than SAP\_BASIS. The limit defined in the current database platform applies (in the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") this is 512 KB).
    
    In the case of deep fields such as STRING, RAWSTRING, LRAW, LCHR, and GEOM\_EWKB, only the bytes of the references are counted and not the actual content.
    

Hints

-   A DDIC database table cannot be defined using a nested structure, since nested structures are not possible in every supported database.
-   If the prerequisites above are met, an existing DDIC structure can be transformed to a DDIC database table. Conversely, a DDIC database table can also be transformed to a DDIC structure, whereby the database object is deleted.
-   Renaming of fields that already contain data is not supported. If the name of an existing field is changed in a DDIC database table, an [adjustment](javascript:call_link\('abenddic_database_tables_adj.htm'\)) takes place, where the field with the old name is deleted in the physical database table and a field with the new name is appended. All data in the column with the old name are lost.
-   The limit on the number of fields and the length of the structure for tables in the software component SAP\_BASIS is chosen deliberately so that the requirements of any supported database platform can be met. At SAP, tables can be flagged to allow this limit to be exceeded if extensions are used. When tables flagged in this way are accessed using ABAP SQL, a syntax warning from the [extended program check](javascript:call_link\('abenextended_program_check_glosry.htm'\) "Glossary Entry") occurs. The warning indicates that a platform-independent replacement implementation may be necessary. The class [CL\_ABAP\_DBFEATURES](javascript:call_link\('abencl_abap_dbfeatures.htm'\)) can be used to identify which limit is supported by a particular database system. The limits applied to tables in other software components for [SAP S/4HANA](javascript:call_link\('abensap_s4hana_glosry.htm'\) "Glossary Entry") is defined by the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenddic_database_tables_techstruc.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_techstruc.htm)

### abenddic_database_tables_techspec.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_techspec.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_techspec.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_tech.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Table-Specific%20Technical%20Properties%20of%20Database%20Tables%2C%20ABENDDIC_DATABASE_TABLES_TECHSPEC%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%
0A%0D%0ASuggestion%20for%20improvement:)

DDIC - Table-Specific Technical Properties of Database Tables

The following technical properties are provided specifically for DDIC database tables. They define properties of the physical database table and access via the database interface. Apart from the table category and activation type, these technical settings constitute a standalone object and can be activated and transported separately from the table.

-   [Table category](javascript:call_link\('abenddic_database_tables_tab_cat.htm'\))
-   [Data class](javascript:call_link\('abenddic_database_tables_dat_type.htm'\))
-   [Size category](javascript:call_link\('abenddic_database_tables_siz_cat.htm'\))
-   [Logging](javascript:call_link\('abenddic_database_tables_protocol.htm'\))
-   [Table buffering](javascript:call_link\('abenddic_database_tables_buffer.htm'\))
-   [Storage type](javascript:call_link\('abenddic_database_tables_storage.htm'\))
-   [Load unit](javascript:call_link\('abenddic_database_tables_load_unit.htm'\))
-   [Activation type](javascript:call_link\('abenddic_database_tables_act_type.htm'\))

Hint

Certain combinations of technical properties are not useful. There are [ABAP Test Cockpit (ATC)](javascript:call_link\('abenabap_test_cockpit_glosry.htm'\) "Glossary Entry") tests that report such combinations as errors.

Continue
[DDIC - Table Category of Database Tables](javascript:call_link\('abenddic_database_tables_tab_cat.htm'\))
[DDIC - Data Class of Database Tables](javascript:call_link\('abenddic_database_tables_dat_type.htm'\))
[DDIC - Size Category of Database Tables](javascript:call_link\('abenddic_database_tables_siz_cat.htm'\))
[DDIC - Table Buffering of Database Tables](javascript:call_link\('abenddic_database_tables_buffer.htm'\))
[DDIC - Logging Database Tables](javascript:call_link\('abenddic_database_tables_protocol.htm'\))
[DDIC - Storage Type of Database Tables](javascript:call_link\('abenddic_database_tables_storage.htm'\))
[DDIC - Load Unit of Database Tables](javascript:call_link\('abenddic_database_tables_load_unit.htm'\))
[DDIC - Activation Type of Database Tables](javascript:call_link\('abenddic_database_tables_act_type.htm'\))



**üìñ Source**: [abenddic_database_tables_techspec.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_techspec.htm)

### abenddic_database_tables_tab_cat.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_tab_cat.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_tab_cat.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_tech.htm'\))¬†‚Üí¬† [DDIC - Table-Specific Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_techspec.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Table%20Category%20of%20Database%20Tables%2C%20ABENDDIC_DATABASE_TABLES_TAB_CAT%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for
%20improvement:)

DDIC - Table Category of Database Tables

-   [Transparent Tables](#abenddic-database-tables-tab-cat-1-------global-temporary-tables---@ITOC@@ABENDDIC_DATABASE_TABLES_TAB_CAT_2)

Transparent Tables ¬† 

The default table category is the transparent table. In transparent tables, the database object has the same name and the same columns as the definition in ABAP Dictionary. The fields of transparent tables can be processed not only using [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"), but also using [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") or [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry"). Outside AS ABAP, they can be processed using the programming interface of the database. The latter method is, however, [not recommended](javascript:call_link\('abendatabase_access_recomm.htm'\)).

Global Temporary Tables ¬† 

[Global temporary tables](javascript:call_link\('abenddic_database_tables_gtt.htm'\)) are another category of tables. A global temporary table (GTT) is a special transparent table used exclusively as a repository of temporary data during a [database LUW](javascript:call_link\('abendatabase_luw_glosry.htm'\) "Glossary Entry").

Hint

The ABAP Dictionary [tool](javascript:call_link\('abenddic_tools.htm'\)) of the ABAP Workbench makes it possible to transform DDIC database tables from one category to another. To create a different table category as a transparent table, a transparent table must be created first and then transformed into a different table category. In [Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry"), the table category is defined using the annotation [@AbapCatalog.tableCategory](javascript:call_link\('abenddicddl_define_table_props.htm'\)).



**üìñ Source**: [abenddic_database_tables_tab_cat.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_tab_cat.htm)

### abenddic_database_tables_dat_type.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_dat_type.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_dat_type.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_tech.htm'\))¬†‚Üí¬† [DDIC - Table-Specific Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_techspec.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Data%20Class%20of%20Database%20Tables%2C%20ABENDDIC_DATABASE_TABLES_DAT_TYPE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20
improvement:)

DDIC - Data Class of Database Tables

For the database platform Oracle, the data class determines the physical area (tablespace) of the database in which a DDIC database table is created. For other database platforms, the data class does not have any effect and is ignored. The most important data classes for application data are:

-   APPL0 (master data)
    
    Data that is rarely changed. One example of master data is data in a table of addresses, such as names, postal addresses, and telephone numbers.
    
-   APPL1 (transaction data)
    
    Data that is frequently changed. One example of transaction data is warehouse stock that changes each time an order is placed.
    
-   APPL2 (organizational data)
    
    Customizing data specified when the system is configured and then changed only rarely. One example is the table T005 that contains the country codes.
    
-   USR and USR1 (customer data)
    
    DDIC database tables for customer developments in a separate tablespace.
    

There are further data classes for system tables used internally by runtime frameworks, such as SDIC for ABAP Dictionary tables.



**üìñ Source**: [abenddic_database_tables_dat_type.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_dat_type.htm)

### abenddic_database_tables_siz_cat.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_siz_cat.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_siz_cat.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_tech.htm'\))¬†‚Üí¬† [DDIC - Table-Specific Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_techspec.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Size%20Category%20of%20Database%20Tables%2C%20ABENDDIC_DATABASE_TABLES_SIZ_CAT%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

DDIC - Size Category of Database Tables

The size category affects the size of the initial memory area reserved for the table on the database. Values between 0 and 9 can be specified and intervals of expected rows are assigned to these values. The interval limits assigned to each size category depend on the structure of the DDIC database table. The range can extend from approximately 1000 rows in size category 0 to several million rows in size category 9. If the initial space reserved is exceeded, a new memory area is added implicitly in accordance with the chosen size category.

Hints

-   An appropriate size category should be chosen, to prevent too many small memory areas or a memory area that is too big.
-   In transaction SE11, the [input help](javascript:call_link\('abeninput_help_glosry.htm'\) "Glossary Entry") for Size Category in technical settings shows the interval limits valid for the current DDIC database table.

Example

The following table shows the interval limits assigned to each size category for the DDIC database table SPFLI.

Size Category

Expected Rows

0

0 to 3,600

1

3,600 to 14,000

2

14,000 to 58,000

3

58,000 to 230,000

4

230,000 to 930,000

5

930,000 to 1,800,000

6

1,800,000 to 3,700,000

7

3,700,000 to 7,400,000

8

7,400,000 to 14,000,000

9

14,000,000 to 590,000,000



**üìñ Source**: [abenddic_database_tables_siz_cat.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_siz_cat.htm)

### abenddic_database_tables_buffer.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_buffer.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_buffer.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_tech.htm'\))¬†‚Üí¬† [DDIC - Table-Specific Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_techspec.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Table%20Buffering%20of%20Database%20Tables%2C%20ABENDDIC_DATABASE_TABLES_BUFFER%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for
%20improvement:)

DDIC - Table Buffering of Database Tables

It is possible to define whether and how [table buffering](javascript:call_link\('abentable_buffering_glosry.htm'\) "Glossary Entry") of a DDIC database table is allowed in the [table buffer](javascript:call_link\('abentable_buffer_glosry.htm'\) "Glossary Entry") of an AS instance.

-   [Buffering Permission](#abenddic-database-tables-buffer-1-------buffering-type---@ITOC@@ABENDDIC_DATABASE_TABLES_BUFFER_2)

The table buffer is managed by the [database interface](javascript:call_link\('abendatabase_interface_glosry.htm'\) "Glossary Entry"). When tables with active buffering are accessed using [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") or from classic [dynpros](javascript:call_link\('abendynpro_glosry.htm'\) "Glossary Entry"), the table buffer is used implicitly.

Buffering Permission ¬† 

Table buffering can be configured for a DDIC database table as follows:

-   Buffering not allowed
    
    The table is not buffered. The database interface always passes the accesses to the DDIC database table and the current data is used directly. This setting also specifies that table buffering should not be activated for this table in any other systems due to the way the table is used.
    
-   Buffering allowed, but switched off
    
    The table is not buffered when delivered. This setting indicates, however, that buffering is possible in principle and can be activated in other systems depending on how the table is used.
    
-   Buffering switched on
    
    The table is buffered. The database interface redirects any reads to the [table buffer](javascript:call_link\('abentable_buffer_glosry.htm'\) "Glossary Entry") in the [shared memory](javascript:call_link\('abenshared_memory_glosry.htm'\) "Glossary Entry") of the current AS instance, if possible.
    

Hint

Certain [prerequisites](javascript:call_link\('abenbuffer_restrictions.htm'\)), some of which depend on the buffering type, must be met before ABAP SQL can access the table buffer instead of accessing the DDIC database table directly.

Buffering Type ¬† 

The buffering type determines which data is loaded from the table to the table buffer when a table entry is accessed and buffering is switched on. The possible buffering types are:

-   [Single record buffering](javascript:call_link\('abenbuffer_single_buffering.htm'\))
-   [Generic buffering](javascript:call_link\('abenbuffer_generic_buffering.htm'\))
-   [Full buffering](javascript:call_link\('abenbuffer_complete_buffering.htm'\))



**üìñ Source**: [abenddic_database_tables_buffer.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_buffer.htm)

### abenddic_database_tables_protocol.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_protocol.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_protocol.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_tech.htm'\))¬†‚Üí¬† [DDIC - Table-Specific Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_techspec.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Logging%20Database%20Tables%2C%20ABENDDIC_DATABASE_TABLES_PROTOCOL%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvemen
t:)

DDIC - Logging Database Tables

If logging is activated, any changes to table entries done in [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") are logged in the log table DBTABLOG. As a prerequisite, the profile parameter rec/client must be set accordingly. This profile parameter can have the following values:

-   ALL
    
    Logging is client-independent.
    
-   clnt1, clnt2, ...
    
    Changes are logged only in the specified clients clnt1, clnt2, ...
    
-   OFF
    
    No logging.
    

The logs can be evaluated using the transaction Table History (transaction code SCU3). Logging is independent of updates.

If a table row has more than 16000 bytes, logging is not possible for the table. The lengths of fields with the built-in types STRING, RAWSTRING, LCHR, LRAW, and GEOM\_EWKB are counted completely here.

Hints

-   If logging is activated, access to the DDIC database table slows down accordingly. If logging is activated for many DDIC database tables, lock situations can occur for the log table.
-   No data can be written to a DDIC database table with enabled logging using the statement [INSERT](javascript:call_link\('abapinsert_dbtab.htm'\)) with [subquery](javascript:call_link\('abapinsert_source.htm'\)).
-   The documented method IS\_LOGGING\_ON of the system class CL\_DBI\_UTILITIES can be used to check whether logging is currently switched on for a DDIC database table.



**üìñ Source**: [abenddic_database_tables_protocol.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_protocol.htm)

### abenddic_database_tables_storage.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_storage.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_storage.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_tech.htm'\))¬†‚Üí¬† [DDIC - Table-Specific Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_techspec.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Storage%20Type%20of%20Database%20Tables%2C%20ABENDDIC_DATABASE_TABLES_STORAGE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%2
0improvement:)

DDIC - Storage Type of Database Tables

The storage type has an effect only if the current database is an [SAP HANA](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") database. The specified storage type is ignored by other database systems and the platform-dependent storage type is used instead. The following settings can be defined for the SAP HANA database:

-   Column store
    
    This setting should be used in the following cases:
    
    -   The DDIC database table is designed for application data analyzed in [SAP HANA](javascript:call_link\('abensap_hana_glosry.htm'\) "Glossary Entry").
    -   The DDIC database table contains a very large number of rows since the storage type Column Store provides better compression.
    -   The DDIC database table has a [full text index](javascript:call_link\('abenfull_text_index_glosry.htm'\) "Glossary Entry").
    -   The DDIC database table contains table fields with HANA data types that are supported only by the storage type column store.
-   Row store
    
    This setting should only be used in SAP HANA databases if the database table is used mainly for frequent single row accesses. For [global temporary tables (GTTs)](javascript:call_link\('abenddic_database_tables_gtt.htm'\)), it is the only possible setting.
    

Hint

For more information about the differences between row store and column store on the SAP HANA database, see the SAP HANA documentation.



**üìñ Source**: [abenddic_database_tables_storage.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_storage.htm)

### abenddic_database_tables_load_unit.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_load_unit.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_load_unit.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_tech.htm'\))¬†‚Üí¬† [DDIC - Table-Specific Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_techspec.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Load%20Unit%20of%20Database%20Tables%2C%20ABENDDIC_DATABASE_TABLES_LOAD_UNIT%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20
improvement:)

DDIC - Load Unit of Database Tables

The load unit of a table specifies how the data of the table is loaded into the main memory of the SAP HANA database. The SAP HANA database offers the following settings:

-   Column Loadable
    
    The complete table is considered as in-memory. The table data is loaded upon system start in a column-oriented format into the main memory of the SAP HANA database. This is the default behavior.
    
-   Page Loadable
    
    By using a feature of the SAP HANA database called Native Storage Extension (NSE), table data is stored on disk in pages rather than in columns. These pages are loaded only on request into a special buffer in the HANA main memory. Unused data in the buffer can be paged out.
    

Typically, Page Loadable is used for large tables with less frequent accesses. While the SAP HANA database offers the load unit attribute also for single columns and partitions of a table, in the ABAP Dictionary this setting always affects the complete table and its indexes.

The ABAP Dictionary provides this setting in two flavors:

-   Column Preferred or Page Preferred
    -   Column Preferred is the default behavior.
    -   The load unit is only specified upon creation of the table.
    -   Changing from one preferred load unit to another does not change the load unit on the database.
    -   The ABAP DDIC consistency check does not consider the load unit. It is accepted if the load unit on the database differs from the values specified in the DDIC.
-   Column Enforced or Page Enforced
    -   The load unit is specified upon creation of the table. Furthermore, changes to the load unit in the ABAP DDIC result in corresponding changes on the database.
    -   Changing the enforced load unit results in a corresponding change on the database.
    -   The ABAP Dictionary consistency check respects the load unit. Different values for the load unit in the ABAP Dictionary and on the database result in tables that are inconsistent from the DDIC point of view.

The Column Preferred and Page Preferred settings for the load unit setting in the ABAP Dictionary offer the possibility for a database administrator or a tool like the SAP HANA NSE Advisor to overwrite the DDIC settings without making the table inconsistent. In general, most of the tables should use one of the Preferred settings for the load unit. Only if you are sure that the table should keep a specific load unit in all relevant scenarios (on premise, cloud, ...), you should use the Enforced load unit settings.

The load unit setting is completely transparent to applications.

Limitations:

-   Page Loadable cannot be used for database tables with [storage type](javascript:call_link\('abenddic_database_tables_storage.htm'\)) Row store.
-   Page Loadable cannot be used for [global temporary tables (GTTs)](javascript:call_link\('abenddic_database_tables_gtt.htm'\)).
-   Page Loadable cannot be set for tables that have [data aging](javascript:call_link\('abendata_aging_glosry.htm'\) "Glossary Entry") enabled.

Hint

For more information about the Native Storage Extension on the SAP HANA database, see the [SAP HANA documentation](https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/4efaa94f8057425c8c7021da6fc2ddf5).



**üìñ Source**: [abenddic_database_tables_load_unit.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_load_unit.htm)

### abenddic_database_tables_act_type.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_act_type.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_act_type.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_tech.htm'\))¬†‚Üí¬† [DDIC - Table-Specific Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_techspec.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Activation%20Type%20of%20Database%20Tables%2C%20ABENDDIC_DATABASE_TABLES_ACT_TYPE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

DDIC - Activation Type of Database Tables

The activation type defines whether a DDIC database table can be activated in an ABAP Dictionary [tool](javascript:call_link\('abenddic_tools.htm'\)) or whether it must be controlled using the ABAP runtime framework environment. This setting is not relevant for DDIC database tables in application programming. In these tables, the default value 00 should be preserved. The following settings are possible:

-   Activation type 00
    
    The default setting in which a DDIC database table can be activated in an ABAP Dictionary [tool](javascript:call_link\('abenddic_tools.htm'\)). DDIC database tables in application programming should always have this activation type.
    
-   The following values for the activation type only apply to those DDIC database tables required by the ABAP runtime framework itself and hence only to internal SAP developments:
    -   Activation type 01
        
        The [DDIC runtime object](javascript:call_link\('abenddic_runtime_object_glosry.htm'\) "Glossary Entry") of the database table must be created using an [ABAP kernel](javascript:call_link\('abenkernel_glosry.htm'\) "Glossary Entry") program before the table is activated in an ABAP Dictionary [tool](javascript:call_link\('abenddic_tools.htm'\)). This makes it impossible to modify and activate important system tables directly.
        
    -   Activation type 02
        
        The DDIC database table is used in the [ABAP kernel](javascript:call_link\('abenkernel_glosry.htm'\) "Glossary Entry"), but the [DDIC runtime object](javascript:call_link\('abenddic_runtime_object_glosry.htm'\) "Glossary Entry") can be activated (and hence created) in an ABAP Dictionary [tool](javascript:call_link\('abenddic_tools.htm'\)). It may be necessary to adjust the consumer programs of the kernel. This is indicated by a note in the activation log.
        
    -   Activation type 10
        
        The DDIC database table is required before other objects are modified as part of a transport.



**üìñ Source**: [abenddic_database_tables_act_type.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_act_type.htm)

### abenddic_database_tables_techspec.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_techspec.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_techspec.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Technical Properties of Database Tables](javascript:call_link\('abenddic_database_tables_tech.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Table-Specific%20Technical%20Properties%20of%20Database%20Tables%2C%20ABENDDIC_DATABASE_TABLES_TECHSPEC%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%
0A%0D%0ASuggestion%20for%20improvement:)

DDIC - Table-Specific Technical Properties of Database Tables

The following technical properties are provided specifically for DDIC database tables. They define properties of the physical database table and access via the database interface. Apart from the table category and activation type, these technical settings constitute a standalone object and can be activated and transported separately from the table.

-   [Table category](javascript:call_link\('abenddic_database_tables_tab_cat.htm'\))
-   [Data class](javascript:call_link\('abenddic_database_tables_dat_type.htm'\))
-   [Size category](javascript:call_link\('abenddic_database_tables_siz_cat.htm'\))
-   [Logging](javascript:call_link\('abenddic_database_tables_protocol.htm'\))
-   [Table buffering](javascript:call_link\('abenddic_database_tables_buffer.htm'\))
-   [Storage type](javascript:call_link\('abenddic_database_tables_storage.htm'\))
-   [Load unit](javascript:call_link\('abenddic_database_tables_load_unit.htm'\))
-   [Activation type](javascript:call_link\('abenddic_database_tables_act_type.htm'\))

Hint

Certain combinations of technical properties are not useful. There are [ABAP Test Cockpit (ATC)](javascript:call_link\('abenabap_test_cockpit_glosry.htm'\) "Glossary Entry") tests that report such combinations as errors.

Continue
[DDIC - Table Category of Database Tables](javascript:call_link\('abenddic_database_tables_tab_cat.htm'\))
[DDIC - Data Class of Database Tables](javascript:call_link\('abenddic_database_tables_dat_type.htm'\))
[DDIC - Size Category of Database Tables](javascript:call_link\('abenddic_database_tables_siz_cat.htm'\))
[DDIC - Table Buffering of Database Tables](javascript:call_link\('abenddic_database_tables_buffer.htm'\))
[DDIC - Logging Database Tables](javascript:call_link\('abenddic_database_tables_protocol.htm'\))
[DDIC - Storage Type of Database Tables](javascript:call_link\('abenddic_database_tables_storage.htm'\))
[DDIC - Load Unit of Database Tables](javascript:call_link\('abenddic_database_tables_load_unit.htm'\))
[DDIC - Activation Type of Database Tables](javascript:call_link\('abenddic_database_tables_act_type.htm'\))


---


## ABAP - Keyword Documentation / ABAP - Dictionary (DDIC) / DDIC - Database Tables / DDIC - Semantic Properties of Database Tables / DDIC - Table-Specific Semantic Properties of Database Tables / DDIC - Foreign Key Dependencies

**Files**: 6 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Dictionary (DDIC) / DDIC - Database Tables / DDIC - Semantic Properties of Database Tables / DDIC - Table-Specific Semantic Properties of Database Tables / DDIC - Foreign Key Dependencies

Included pages: 6



**üìñ Source**: [abenddic_database_tables_techspec.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_techspec.htm)

### abenddic_database_tables_forkeyrel.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_forkeyrel.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_forkeyrel.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Semantic Properties of Database Tables](javascript:call_link\('abenddic_database_tables_sema.htm'\))¬†‚Üí¬† [DDIC - Table-Specific Semantic Properties of Database Tables](javascript:call_link\('abenddic_database_tables_semasspec.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Foreign%20Key%20Dependencies%2C%20ABENDDIC_DATABASE_TABLES_FORKEYREL%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvem
ent:)

DDIC - Foreign Key Dependencies

A foreign key dependency is a semantic dependency between two DDIC database tables, namely a [foreign key table](javascript:call_link\('abenforeign_key_table_glosry.htm'\) "Glossary Entry") and a [check table](javascript:call_link\('abencheck_table_glosry.htm'\) "Glossary Entry").

The definition of a foreign key dependency is done in the foreign key table. By assigning check tables to table fields, the table fields become [foreign keys](javascript:call_link\('abenforeign_key_glosry.htm'\) "Glossary Entry").

-   [Check table](javascript:call_link\('abenddic_database_tables_checktab.htm'\))
-   [Foreign Key](javascript:call_link\('abenddic_database_tables_forkey.htm'\))

Foreign key dependencies are evaluated during input checks, for input help on dynpros and in Web Dynpros, when creating [views](javascript:call_link\('abenddic_views.htm'\)), and in [lock objects](javascript:call_link\('abenlock_object_glosry.htm'\) "Glossary Entry"). In the ABAP programming language or in ABAP SQL, foreign keys are not evaluated.

In a check table, [obsolete data can be flagged as obsolete](javascript:call_link\('abenddic_deprecation.htm'\)). This has an effect on the input check and input help on dynpros or Web Dynpros.

Continue
[DDIC - Check Table](javascript:call_link\('abenddic_database_tables_checktab.htm'\))
[DDIC - Foreign Keys](javascript:call_link\('abenddic_database_tables_forkey.htm'\))
[DDIC - Flagging of Deprecated Data in Check Tables](javascript:call_link\('abenddic_deprecation.htm'\))



**üìñ Source**: [abenddic_database_tables_forkeyrel.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_forkeyrel.htm)

### abenddic_database_tables_checktab.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_checktab.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_checktab.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Semantic Properties of Database Tables](javascript:call_link\('abenddic_database_tables_sema.htm'\))¬†‚Üí¬† [DDIC - Table-Specific Semantic Properties of Database Tables](javascript:call_link\('abenddic_database_tables_semasspec.htm'\))¬†‚Üí¬† [DDIC - Foreign Key Dependencies](javascript:call_link\('abenddic_database_tables_forkeyrel.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Check%20Table%2C%20ABENDDIC_DATABASE_TABLES_CHECKTAB%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

DDIC - Check Table

Table fields of a DDIC database table whose data type is determined by a [DDIC data element](javascript:call_link\('abendata_element_glosry.htm'\) "Glossary Entry") can be assigned a check table. The [value table](javascript:call_link\('abenvalue_table_glosry.htm'\) "Glossary Entry") of any [DDIC domain](javascript:call_link\('abendomain_glosry.htm'\) "Glossary Entry") of the data element is used as a default value. A table field to which a check table is assigned is called a [foreign key field](javascript:call_link\('abenforeign_key_field_glosry.htm'\) "Glossary Entry") and becomes a part of the [foreign key](javascript:call_link\('abenddic_database_tables_forkey.htm'\)) of the table. The table itself becomes a foreign key table. The primary key of the check table is the foreign key of the foreign key table. Each key field of the check table corresponds to a field in the foreign key table. The corresponding field pairs must have the same data type.

Hints

-   Fields whose data type is specified directly (not by using a DDIC data element) cannot be assigned a check table.
-   As long as a DDIC database table is a check table, none of its key fields can be deleted and the order of the key fields cannot be modified.
-   As long as a DDIC database table is a check table, its primary key can be expanded only by appending new key fields to its end. The existing foreign keys then automatically become generic regarding the new key fields.
-   A client field cannot be inserted later into an existing check table.
-   A special column can be used to [flag obsolete data](javascript:call_link\('abenddic_deprecation.htm'\)) in check tables.



**üìñ Source**: [abenddic_database_tables_checktab.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_checktab.htm)

### abenddic_database_tables_forkey.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_forkey.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_forkey.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Semantic Properties of Database Tables](javascript:call_link\('abenddic_database_tables_sema.htm'\))¬†‚Üí¬† [DDIC - Table-Specific Semantic Properties of Database Tables](javascript:call_link\('abenddic_database_tables_semasspec.htm'\))¬†‚Üí¬† [DDIC - Foreign Key Dependencies](javascript:call_link\('abenddic_database_tables_forkeyrel.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Foreign%20Keys%2C%20ABENDDIC_DATABASE_TABLES_FORKEY%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

DDIC - Foreign Keys

A foreign key consists of one or more [foreign key fields](javascript:call_link\('abenforeign_key_field_glosry.htm'\) "Glossary Entry") of a [foreign key table](javascript:call_link\('abenforeign_key_table_glosry.htm'\) "Glossary Entry"). The foreign key fields form the [primary key](javascript:call_link\('abenprimary_key_glosry.htm'\) "Glossary Entry") of a [check table](javascript:call_link\('abencheck_table_glosry.htm'\) "Glossary Entry"). A DDIC database table can have multiple foreign keys. A [foreign key dependency](javascript:call_link\('abenforeign_key_dependency_glosry.htm'\) "Glossary Entry") exists between a foreign key table and its check tables. A foreign key table usually only contains entries where the content of the foreign key also occurs exactly once as content of the primary key in the check table. The developer must consider this in [writes](javascript:call_link\('abenabap_sql_writing.htm'\)) made using ABAP SQL, since there is no automatic check.

Foreign keys can have the following properties:

-   Input check
    
    In the definition of the foreign key, input checks for dynpros or Web Dynpros by means of foreign key dependencies can be switched on or off. Furthermore, the standard message can be replaced by a custom [message](javascript:call_link\('abenmessage_glosry.htm'\) "Glossary Entry"). Any placeholders in the message are filled as follows when the message is sent: The first three placeholders are filled with the content of the foreign key fields that are assigned to the first three key fields of the check table after the client field. The fourth placeholder is filled with the name of the check table.
    
-   Generic foreign key fields
    
    Foreign key fields can be flagged as generic in the definition of a foreign key. Generic foreign key fields are not checked against their check table in dynpro input checks.
    
-   Constant values
    
    Foreign key fields can be given constant values in the definition of a foreign key. In dynpro input checks, the field of the check table assigned to a foreign key field with a constant value must have this constant value in the row determined by the remaining foreign key fields.
    
-   Inheritance
    
    The fields of included include structures can be foreign key fields and are part of the foreign key of the DDIC database table. An inheritance relationship with the included structure exists by default and any changes to the definition of the foreign key in the included structure affect the foreign key of the including DDIC database table. This inheritance relationship can be removed. When removed, any changes to the definition of the foreign key in the included structure are not applied to the DDIC database table.
    
-   Cardinality
    
    A [cardinality](javascript:call_link\('abencardinality_glosry.htm'\) "Glossary Entry") n:m can be defined for each foreign key. This cardinality mainly serves a documentation purpose, except in the definition of [DDIC maintenance views](javascript:call_link\('abenddic_maintenance_views.htm'\)) and [DDIC help views](javascript:call_link\('abenddic_help_views.htm'\)).
    
    Possible values for n:
    
    -   1
        
        Precisely one row of the check table must exist for each record of the foreign key table.
        
    -   C
        
        No rows must exist in the check table for a record of the foreign key table.
        
    
    Possible values for m:
    
    -   1
        
        Precisely one row in the foreign key table must exist for each row of the check table.
        
    -   C
        
        There can be no more than one assigned row in the foreign key table for each row of the check table.
        
    -   N
        
        There must be at least one row in the foreign key table for each row of the check table.
        
    -   CN
        
        There can be any number of rows in the foreign key table for each row of the check table.
        
    
    Defining a generic foreign key turns the cardinalities 1:m or C:m into CN:m. There can be multiple rows in the check table for each dependent row. This cardinality cannot, however, be specified explicitly.
    
-   Type of the foreign key fields
    
    The type of the foreign key fields can be defined to describe the meaning of the foreign key fields in the foreign key table. The possible values are as follows, whereby the first two are only for documentation purposes:
    
    -   No key fields/key candidates
        
        The foreign key fields are neither primary key fields of the foreign key table nor do they identify a record of the foreign key table uniquely.
        
    -   Key fields/key candidates
        
        The foreign key fields are either primary key fields of the foreign key table or they identify a record of the foreign key table uniquely as a key candidate.
        
    -   Key fields of a text table
        
        If this type of foreign key field is defined, the foreign key table is handled as a text table of the check table. The primary key of the foreign key table must match the check table and it must have one additional language key field with the type LANG. There can be only one text table for each check table, otherwise an activation warning occurs. The texts in a text table are used, for example, to explain input helps on dynpros and Web Dynpros.



**üìñ Source**: [abenddic_database_tables_forkey.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_forkey.htm)

### abenddic_deprecation.htm

> **üìñ Official SAP Documentation**: [abenddic_deprecation.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_deprecation.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Semantic Properties of Database Tables](javascript:call_link\('abenddic_database_tables_sema.htm'\))¬†‚Üí¬† [DDIC - Table-Specific Semantic Properties of Database Tables](javascript:call_link\('abenddic_database_tables_semasspec.htm'\))¬†‚Üí¬† [DDIC - Foreign Key Dependencies](javascript:call_link\('abenddic_database_tables_forkeyrel.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Flagging%20of%20Deprecated%20Data%20in%20Check%20Tables%2C%20ABENDDIC_DEPRECATION%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

DDIC - Flagging of Deprecated Data in Check Tables

Rows in [check tables](javascript:call_link\('abenddic_database_tables_checktab.htm'\)) can be flagged as deprecated or invalid. If the check on deprecated data is active, the flag modifies the [input check](javascript:call_link\('abenabap_dynpros_checks.htm'\)) and [input help](javascript:call_link\('abenabap_dynpros_value_help.htm'\)) in dynpros or Web Dynpros.

Checks on deprecated data are active by default when an [internal session](javascript:call_link\('abeninternal_session_glosry.htm'\) "Glossary Entry") is created. This setting can be modified and read using methods of the class CL\_CONFIGURATION\_DEPRECATION:

-   The parameter I\_RESPECT\_OBSOLETE\_VALUES of the method SET\_DEPRECATION\_ACTIVE can be used to enable and disable the deprecated data check for the current internal session.
-   If the check on deprecated data is active, the return value of the method DEPRECATION\_IS\_ACTIVE has the value of abap\_true.

A column with the predefined name CONFIGDEPRECATIONCODE is used to flag deprecated data in check tables. The data type of this column must be defined using the data element CONFIG\_DEPRECATION\_CODE. The following values are valid for this column:

Value

Meaning

Blank

The entry is valid.

W

The entry is deprecated and should no longer be used.

E

The entry is invalid and must not be used.

If the deprecated data check is enabled, the implicit [input checks](javascript:call_link\('abenabap_dynpros_checks.htm'\)) and [input helps](javascript:call_link\('abenabap_dynpros_value_help.htm'\)) in dynpros and in Web Dynpro that are based on check tables evaluate the column CONFIGDEPRECATIONCODE as follows:

-   Input check:
    -   If a deprecated value is entered, a warning occurs.
    -   If an invalid value is entered, an error message occurs.
-   Input help:
    -   Valid data and the deprecated data is displayed. Invalid data is not displayed.

Hints

-   If input helps are based on [search helps](javascript:call_link\('abensearch_help_glosry.htm'\) "Glossary Entry") linked with check tables, the deprecated data check is active and runs as described above.
-   If the input check is implemented using a [PAI](javascript:call_link\('abenpai_glosry.htm'\) "Glossary Entry") module, the column CONFIGDEPRECATIONCODE must be evaluated in the PAI module itself.
-   [SAP HANA databases](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") use the more universal concept of [data aging](javascript:call_link\('abendata_aging_glosry.htm'\) "Glossary Entry"), which is applied to each access using the [database interface](javascript:call_link\('abendatabase_interface_glosry.htm'\) "Glossary Entry").
-   Instead of CONFIGDEPRECATIONCODE, also the obsolete name CONFIGURATIONDEPRECATIONCODE can still be used.

Executable Example

[Flagging of Deprecated Data in Check Tables](javascript:call_link\('abenddic_deprecation_abexa.htm'\))

Continue
![Example](exa.gif "Example") [DDIC - Flagging of Deprecated Data in Check Tables](javascript:call_link\('abenddic_deprecation_abexa.htm'\))



**üìñ Source**: [abenddic_deprecation.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_deprecation.htm)

### abenddic_deprecation_abexa.htm

> **üìñ Official SAP Documentation**: [abenddic_deprecation_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_deprecation_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Semantic Properties of Database Tables](javascript:call_link\('abenddic_database_tables_sema.htm'\))¬†‚Üí¬† [DDIC - Table-Specific Semantic Properties of Database Tables](javascript:call_link\('abenddic_database_tables_semasspec.htm'\))¬†‚Üí¬† [DDIC - Foreign Key Dependencies](javascript:call_link\('abenddic_database_tables_forkeyrel.htm'\))¬†‚Üí¬† [DDIC - Flagging of Deprecated Data in Check Tables](javascript:call_link\('abenddic_deprecation.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Flagging%20of%20Deprecated%20Data%20in%20Check%20Tables%2C%20ABENDDIC_DEPRECATION_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggesti
on%20for%20improvement:)

DDIC - Flagging of Deprecated Data in Check Tables

This example demonstrates [how deprecated data is flagged in check tables](javascript:call_link\('abenddic_deprecation.htm'\)).

Source Code ¬† 

REPORT demo\_dynpro\_deprecation.
TABLES demo\_depr\_struc.
DATA depr\_flag TYPE abap\_bool VALUE 'X'.
START-OF-SELECTION.
¬†¬†CALL SCREEN 100.
LOAD-OF-PROGRAM.
¬†¬†depr\_flag = cl\_configuration\_deprecation=>deprecation\_is\_active( ).
¬†¬†DATA ls\_target TYPE demo\_depr\_check1.
¬†¬†SELECT planetype
¬†¬†¬†¬†¬†¬†¬†¬† FROM saplane
¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY planetype
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(planetypes).
¬†¬†DELETE FROM demo\_depr\_check1.
¬†¬†INSERT demo\_depr\_check1 FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†FOR wa IN planetypes INDEX INTO idx
¬†¬†¬†¬†¬†¬†( planetype = wa-planetype
¬†¬†¬†¬†¬†¬†¬†¬†configdeprecationcode =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†COND #( WHEN idx <= 3 THEN 'W'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHEN idx BETWEEN 4 AND 6 THEN 'E'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE ' ' ) ) ) ).
MODULE pbo\_100 OUTPUT.
¬†¬†SET PF-STATUS 'STATUS\_100'.
¬†¬†cl\_configuration\_deprecation=>set\_deprecation\_active(
¬†¬†¬†¬†i\_respect\_obsolete\_values = depr\_flag ).
ENDMODULE.
MODULE cancel INPUT.
¬†¬†LEAVE PROGRAM.
ENDMODULE.

Description ¬† 

This example uses the check table DEMO\_DEPR\_CHECK for the flagging of deprecated entries. The ABAP program flags the first three table entries as deprecated. The next three table entries are flagged as invalid.

When the ABAP program is executed, the consumer can enable or disable the deprecated data check via the [checkbox](javascript:call_link\('abencheckbox_glosry.htm'\) "Glossary Entry") Check deprecated data. This affects the input check and input help.

If checks on deprecated data are enabled, the following takes place:

-   A warning occurs if one of the deprecated values is entered. If one of the invalid values is entered, an error message occurs and the entered value is not accepted.
-   The input help displays valid values and deprecated values only and no invalid values.

If the checkbox Check deprecated data is not selected, no warnings or error messages are produced and the input help displays all entries from the check table DEMO\_DEPR\_CHECK.



**üìñ Source**: [abenddic_deprecation_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_deprecation_abexa.htm)

### abenddic_deprecation.htm

> **üìñ Official SAP Documentation**: [abenddic_deprecation.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_deprecation.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Semantic Properties of Database Tables](javascript:call_link\('abenddic_database_tables_sema.htm'\))¬†‚Üí¬† [DDIC - Table-Specific Semantic Properties of Database Tables](javascript:call_link\('abenddic_database_tables_semasspec.htm'\))¬†‚Üí¬† [DDIC - Foreign Key Dependencies](javascript:call_link\('abenddic_database_tables_forkeyrel.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Flagging%20of%20Deprecated%20Data%20in%20Check%20Tables%2C%20ABENDDIC_DEPRECATION%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

DDIC - Flagging of Deprecated Data in Check Tables

Rows in [check tables](javascript:call_link\('abenddic_database_tables_checktab.htm'\)) can be flagged as deprecated or invalid. If the check on deprecated data is active, the flag modifies the [input check](javascript:call_link\('abenabap_dynpros_checks.htm'\)) and [input help](javascript:call_link\('abenabap_dynpros_value_help.htm'\)) in dynpros or Web Dynpros.

Checks on deprecated data are active by default when an [internal session](javascript:call_link\('abeninternal_session_glosry.htm'\) "Glossary Entry") is created. This setting can be modified and read using methods of the class CL\_CONFIGURATION\_DEPRECATION:

-   The parameter I\_RESPECT\_OBSOLETE\_VALUES of the method SET\_DEPRECATION\_ACTIVE can be used to enable and disable the deprecated data check for the current internal session.
-   If the check on deprecated data is active, the return value of the method DEPRECATION\_IS\_ACTIVE has the value of abap\_true.

A column with the predefined name CONFIGDEPRECATIONCODE is used to flag deprecated data in check tables. The data type of this column must be defined using the data element CONFIG\_DEPRECATION\_CODE. The following values are valid for this column:

Value

Meaning

Blank

The entry is valid.

W

The entry is deprecated and should no longer be used.

E

The entry is invalid and must not be used.

If the deprecated data check is enabled, the implicit [input checks](javascript:call_link\('abenabap_dynpros_checks.htm'\)) and [input helps](javascript:call_link\('abenabap_dynpros_value_help.htm'\)) in dynpros and in Web Dynpro that are based on check tables evaluate the column CONFIGDEPRECATIONCODE as follows:

-   Input check:
    -   If a deprecated value is entered, a warning occurs.
    -   If an invalid value is entered, an error message occurs.
-   Input help:
    -   Valid data and the deprecated data is displayed. Invalid data is not displayed.

Hints

-   If input helps are based on [search helps](javascript:call_link\('abensearch_help_glosry.htm'\) "Glossary Entry") linked with check tables, the deprecated data check is active and runs as described above.
-   If the input check is implemented using a [PAI](javascript:call_link\('abenpai_glosry.htm'\) "Glossary Entry") module, the column CONFIGDEPRECATIONCODE must be evaluated in the PAI module itself.
-   [SAP HANA databases](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") use the more universal concept of [data aging](javascript:call_link\('abendata_aging_glosry.htm'\) "Glossary Entry"), which is applied to each access using the [database interface](javascript:call_link\('abendatabase_interface_glosry.htm'\) "Glossary Entry").
-   Instead of CONFIGDEPRECATIONCODE, also the obsolete name CONFIGURATIONDEPRECATIONCODE can still be used.

Executable Example

[Flagging of Deprecated Data in Check Tables](javascript:call_link\('abenddic_deprecation_abexa.htm'\))

Continue
![Example](exa.gif "Example") [DDIC - Flagging of Deprecated Data in Check Tables](javascript:call_link\('abenddic_deprecation_abexa.htm'\))


---


## ABAP - Keyword Documentation / ABAP - Dictionary (DDIC) / DDIC - Database Tables / DDIC - Global Temporary Tables

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Dictionary (DDIC) / DDIC - Database Tables / DDIC - Global Temporary Tables

Included pages: 2



**üìñ Source**: [abenddic_deprecation.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_deprecation.htm)

### abenddic_database_tables_gtt.htm

> **üìñ Official SAP Documentation**: [abenddic_database_tables_gtt.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_gtt.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Global%20Temporary%20Tables%2C%20ABENDDIC_DATABASE_TABLES_GTT%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

DDIC - Global Temporary Tables

Global temporary tables (GTTs) are a special kind of [transparent tables](javascript:call_link\('abentransparent_table_glosry.htm'\) "Glossary Entry") intended for storing temporary data. This data exists only within a [database LUW](javascript:call_link\('abendatabase_luw_glosry.htm'\) "Glossary Entry") and can be accessed only by a consumer. GTTs are used to store temporary interim results to split complicated database processes into multiple steps. GTTs are designed for this purpose only and hence incur far lower administration costs than regular transparent tables.

The GTT concept specifies that a GTT is always empty at the start of a database LUW and hence always must be cleared at the end of each database LUW. Most database systems provide native support for this concept by implicitly defining data in a GTT database table as transaction-specific data. This data is deleted automatically at the end of a database LUW, that means, during a [database commit](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollback](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry").

In ABAP Dictionary, the [table category](javascript:call_link\('abenddic_database_tables_tab_cat.htm'\)) global temporary table can be specified for a DDIC database table. Tables in this category are created as a GTT in the database. The following additional rules apply in [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") access to GTTs to avoid platform-dependent behavior and unexpected responses when handling GTTs:

-   If an ABAP Dictionary GTT was filled by a modifying ABAP SQL statement, it must be cleared explicitly before the end of the current [database LUW](javascript:call_link\('abendatabase_luw_glosry.htm'\) "Glossary Entry"). The following can be used here:
    -   The ABAP SQL statement [DELETE FROM dbtab](javascript:call_link\('abapdelete_dbtab.htm'\)) without specifying a WHERE condition.
    -   All explicit [database commits](javascript:call_link\('abendb_commit.htm'\)) and [database rollbacks](javascript:call_link\('abendb_rollback.htm'\)), such as the ABAP SQL statements [COMMIT WORK](javascript:call_link\('abapcommit.htm'\)), [COMMIT CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)), [ROLLBACK WORK](javascript:call_link\('abaprollback.htm'\)), [ROLLBACK CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) and all associated [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") statements and calls.
-   If an ABAP Dictionary GTT filled using ABAP SQL was not cleared explicitly using one of these methods before an [implicit database commit](javascript:call_link\('abendb_commit.htm'\)), the runtime error COMMIT\_GTT\_ERROR occurs independently of its content.
-   The obsolete addition CLIENT SPECIFIED is forbidden. This includes the use of [CLIENT SPECIFIED](javascript:call_link\('abapselect_client_obsolete.htm'\)) in queries and the use of [CLIENT SPECIFIED](javascript:call_link\('abapud_client_obsolete.htm'\)) in UPDATE SET and DELETE FROM. The [non-obsolete form](javascript:call_link\('abapiumd_client.htm'\)) of CLIENT SPECIFIED in write statements is allowed.

Besides these rules, GTTs can be used like regular transparent tables. Regarding their definition in ABAP Dictionary, the following settings are predefined and cannot be modified:

-   The [data type](javascript:call_link\('abenddic_database_tables_dat_type.htm'\)) and [size category](javascript:call_link\('abenddic_database_tables_siz_cat.htm'\)) are irrelevant and undefined.
-   [Table buffering](javascript:call_link\('abenddic_database_tables_buffer.htm'\)) is not allowed.
-   [Logging](javascript:call_link\('abenddic_database_tables_protocol.htm'\)) is disabled.
-   The [storage type](javascript:call_link\('abenddic_database_tables_storage.htm'\)) is row store.
-   The [delivery class](javascript:call_link\('abenddic_database_tables_delivery.htm'\)) is L.
-   No [replacement objects](javascript:call_link\('abenddic_replacement_objects.htm'\)) can be defined.

The number of [key fields](javascript:call_link\('abenddic_database_tables_key.htm'\)) of a GTT is limited to 15.

Hints

-   Only the variant [DELETE FROM dbtab](javascript:call_link\('abapdelete_dbtab.htm'\)) without a WHERE condition specified prevents the runtime error COMMIT\_GTT\_ERROR. Other variants of the DELETE statement do not prevent the runtime error, even if they clear the entire table.
-   It is advisable to only use [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") to access ABAP Dictionary GTTs.
-   [INSERT](javascript:call_link\('abapinsert_dbtab.htm'\)) statements with a [subquery](javascript:call_link\('abensubquery_glosry.htm'\) "Glossary Entry") after [FROM](javascript:call_link\('abapinsert_source.htm'\)) are particularly well suited for filling GTTs, since the operation is then performed only on the database and no data transports are required between the database and the AS ABAP.
-   If the data of a GTT is only required for the time span of a database access, [common table expressions](javascript:call_link\('abencommon_table_expression_glosry.htm'\) "Glossary Entry") might be an alternative option.
-   When accessed using ABAP SQL, explicit clears of ABAP Dictionary GTTs are enforced before implicit database commits for the following reasons:
    -   It prevents errors caused by any platform dependencies. It cannot be guaranteed that every database platform deletes the data of a GTT in an implicit database commit. This is guaranteed, however, when the GTT is cleared explicitly.
    -   For making the program easier to understand. If an implicit database commit occurs within a programming unit, for example due to an [RFC](javascript:call_link\('abenrfc_glosry.htm'\) "Glossary Entry"), a developer may be surprised to find that the table is empty afterwards, since the database system deleted it implicitly at the end of the database LUW.
-   These additional rules apply only to [writes](javascript:call_link\('abenabap_sql_writing.htm'\)) using [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"). If a GTT is filled using only [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry") or [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") methods, no exceptions are raised in the case of implicit database commits. The GTT is then generally cleared by the database system. Conversely, using Native SQL or AMDP to clear a table filled using ABAP SQL does not prevent the runtime error COMMIT\_GTT\_ERROR.
-   The statements [COMMIT WORK](javascript:call_link\('abapcommit.htm'\)) and [ROLLBACK WORK](javascript:call_link\('abaprollback.htm'\)) clear the GTTs of all currently open [database connections](javascript:call_link\('abendatabase_connection_glosry.htm'\) "Glossary Entry"), whereas [COMMIT CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) and [ROLLBACK CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) only delete the GTTs of the specified connection.
-   When an ABAP Dictionary GTT is accessed using ABAP SQL, the syntax check is performed in [strict mode](javascript:call_link\('abenabap_sql_strictmode_750.htm'\)), which handles the statement more strictly than the regular syntax check.

Executable Examples

-   [Global Temporary Tables, Access](javascript:call_link\('abenddic_gtt_abexa.htm'\))
-   [Union with Global Temporary Table](javascript:call_link\('abenselect_union_sum_gtt_abexa.htm'\))

Continue
![Example](exa.gif "Example") [DDIC - Global Temporary Tables, Access](javascript:call_link\('abenddic_gtt_abexa.htm'\))



**üìñ Source**: [abenddic_database_tables_gtt.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_database_tables_gtt.htm)

### abenddic_gtt_abexa.htm

> **üìñ Official SAP Documentation**: [abenddic_gtt_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_gtt_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Global Temporary Tables](javascript:call_link\('abenddic_database_tables_gtt.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Global%20Temporary%20Tables%2C%20Access%2C%20ABENDDIC_GTT_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

DDIC - Global Temporary Tables, Access

This example demonstrates how [global temporary tables](javascript:call_link\('abenddic_database_tables_gtt.htm'\)) in ABAP Dictionary are accessed.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_gtt DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_gtt IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA delete TYPE abap\_bool VALUE abap\_true.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request(
¬†¬†¬†¬†¬†¬†EXPORTING text¬†¬†¬†¬†¬†¬†¬†¬† = \`Delete lines before implicit commit\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†CHANGING¬†¬†field¬†¬†¬†¬†¬†¬† = delete ).
¬†¬†¬†¬†"Fill GTT with ABAP SQL
¬†¬†¬†¬†INSERT demo\_gtt FROM @( VALUE #( id = 'X' col = 111 ) ).
¬†¬†¬†¬†SELECT SINGLE \* FROM demo\_gtt INTO @DATA(wa).
¬†¬†¬†¬†out->write( COND #( WHEN sy-subrc = 0
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†THEN \`Line found after open insert\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE \`No line found after open insert\` ) ).
¬†¬†¬†¬†IF delete = abap\_true.
¬†¬†¬†¬†¬†¬†DELETE FROM demo\_gtt.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†WAIT UP TO 1 SECONDS.
¬†¬†¬†¬†SELECT SINGLE \* FROM demo\_gtt INTO @wa.
¬†¬†¬†¬†out->write( COND #( WHEN sy-subrc = 0
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†THEN \`Line found after implicit commit\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE \`No line found after implicit commit\` ) ).
¬†¬†¬†¬†"Fill GTT with Native SQL (for demonstration only!)
¬†¬†¬†¬†wa = VALUE demo\_gtt( id = 'X' col = 111 ).
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†INSERT INTO DEMO\_GTT VALUES ( :wa-id, :wa-col )
¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†SELECT SINGLE \* FROM demo\_gtt INTO @wa.
¬†¬†¬†¬†out->write( COND #( WHEN sy-subrc = 0
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†THEN \`Line found after native insert\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE \`No line found after native insert\` ) ).
¬†¬†¬†¬†WAIT UP TO 1 SECONDS.
¬†¬†¬†¬†SELECT SINGLE \* FROM demo\_gtt INTO @wa.
¬†¬†¬†¬†out->write( COND #( WHEN sy-subrc = 0
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†THEN \`Line found after implicit commit\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE \`No line found after implicit commit\` ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

[ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") and [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") are used to access a [global temporary table (GTT)](javascript:call_link\('abenglobal_temporary_table_glosry.htm'\) "Glossary Entry") DEMO\_GTT:

-   After the GTT is filled using the ABAP SQL statement [INSERT](javascript:call_link\('abapinsert_dbtab.htm'\)), the table is cleared again using the ABAP SQL statement [DELETE FROM](javascript:call_link\('abapdelete_dbtab.htm'\)) without a WHERE condition. If the DELETE statement is not executed, the statement [WAIT UP TO](javascript:call_link\('abapwait_up_to.htm'\)), which performs an implicit [database commit](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry"), produces the runtime error COMMIT\_GTT\_ERROR, which can be found in the ABAP dump analysis (ST22).
-   After the GTT has been filled using a static native INSERT statement between [EXEC SQL - ENDEXEC](javascript:call_link\('abapexec.htm'\)), the table is not cleared explicitly. Instead, it is cleared in most database platforms using an implicit [database commit](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") raised by the statement [WAIT UP TO](javascript:call_link\('abapwait_up_to.htm'\)).

Hint

This example uses Native SQL to fill the GTT for demonstration purposes only. Only ABAP SQL should be used to access GTTs.


---


## ABAP - Keyword Documentation / ABAP - Dictionary (DDIC) / DDIC - Database Tables / DDIC - Dictionary DDL for Defining Database Tables

**Files**: 10 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Dictionary (DDIC) / DDIC - Database Tables / DDIC - Dictionary DDL for Defining Database Tables

Included pages: 10



**üìñ Source**: [abenddic_gtt_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_gtt_abexa.htm)

### abenddic_define_table.htm

> **üìñ Official SAP Documentation**: [abenddic_define_table.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_define_table.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20-%20Dictionary%20DDL%20for%20Defining%20Database%20Tables%2C%20ABENDDIC_DEFINE_TABLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20fo
r%20improvement:)

DDIC - Dictionary DDL for Defining Database Tables

A DDIC database table can be displayed and modified in a source-code-based editor in the [ABAP development tools for Eclipse (ADT)](javascript:call_link\('abenadt_glosry.htm'\) "Glossary Entry"), using [Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry"). The source code of a DDIC database table is not saved and transported. Instead, the source code of an existing DDIC database table is generated from the metadata of the associated system tables. Conversely, when saved, the metadata is derived directly from the source code and saved to the system tables.

-   [DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\))

Hint

All properties of a DDIC database table can be defined in ADT using Dictionary DDL or in transaction SE11, with the following exceptions. The [technical properties](javascript:call_link\('abenddic_database_tables_techspec.htm'\)), which are activated and transported separately from the DDIC database table, and [secondary indexes](javascript:call_link\('abenddic_database_tables_index.htm'\)) cannot be defined using the Dictionary DDL:

-   The [standalone table-specific technical properties of DDIC database tables](javascript:call_link\('abenddic_database_tables_techspec.htm'\)) can be maintained in a form-based tool in ADT.
-   [Secondary indexes](javascript:call_link\('abenddic_database_tables_index.htm'\)) can be edited in a form-based tool in ADT.
-   [Extensibility annotations](javascript:call_link\('abenddicddl_define_ext_annos.htm'\)), which are a prerequisite for [C0 release](javascript:call_link\('abenc0_contract_rules_ddic.htm'\)), can be maintained only in ADT.

Continue
[DDIC DDL - DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\))



**üìñ Source**: [abenddic_define_table.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddic_define_table.htm)

### abenddicddl_define_table.htm

> **üìñ Official SAP Documentation**: [abenddicddl_define_table.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Dictionary DDL for Defining Database Tables](javascript:call_link\('abenddic_define_table.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20DDL%20-%20DEFINE%20TABLE%2C%20ABENDDICDDL_DEFINE_TABLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

DDIC DDL - DEFINE TABLE

Syntax

[structure\_annos](javascript:call_link\('abenddicddl_define_struct_props.htm'\))
[ext\_annos](javascript:call_link\('abenddicddl_define_ext_annos.htm'\))
[table\_annos](javascript:call_link\('abenddicddl_define_table_props.htm'\))
DEFINE TABLE dbtab {
¬†¬†...
¬†¬†[field;](javascript:call_link\('abenddicddl_define_table_comps.htm'\))
¬†¬†...
¬†¬†[include;](javascript:call_link\('abenddicddl_define_table_incl.htm'\))
¬†¬†...
}

Effect

[Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry") statement for defining an ABAP Dictionary [DDIC database table](javascript:call_link\('abenddic_database_tables.htm'\)) dbtab in the [ABAP development tools for Eclipse](javascript:call_link\('abenadt_glosry.htm'\) "Glossary Entry").

-   A DDIC database table is defined using the statement DEFINE TABLE. The name dbtab must comply with the naming rules for DDIC database tables.
-   In front of the statement DEFINE TABLE,
    -   the same mandatory structure properties must be specified as [annotations](javascript:call_link\('abenddic_annotation_glosry.htm'\) "Glossary Entry") [structure\_annos](javascript:call_link\('abenddicddl_define_struct_props.htm'\)) as in the statement [DEFINE STRUCTURE](javascript:call_link\('abenddicddl_define_structure.htm'\)).
    -   the same optional extensibility annotations [ext\_annos](javascript:call_link\('abenddicddl_define_ext_annos.htm'\)) as in the statement [DEFINE STRUCTURE](javascript:call_link\('abenddicddl_define_structure.htm'\)) are available for [C0 developer extensibility](javascript:call_link\('abendev_extensibility_glosry.htm'\) "Glossary Entry").
    -   any mandatory table properties must be specified as annotations [table\_annos](javascript:call_link\('abenddicddl_define_table_props.htm'\)). Any other properties are optional.
-   The table fields are defined in a semicolon-separated list in curly brackets { } using one of the following methods:
    -   by defining single fields [field](javascript:call_link\('abenddicddl_define_table_comps.htm'\))
    -   by including include structures [include](javascript:call_link\('abenddicddl_define_table_incl.htm'\)).

Hints

-   As in the [CDS syntax](javascript:call_link\('abencds_general_syntax_rules.htm'\)), an ABAP Dictionary structure definition can contain comments after // and between /\* ... \*/.
-   For a more detailed description of the syntax, see the ADT documentation [Syntax of ABAP Dictionary Objects](https://help.sap.com/docs/ABAP_PLATFORM_NEW/c238d694b825421f940829321ffa326a/fc6cd6f7d02f4546a33feb3f5fc9dd66).

Example

Definition of DDIC database table DEMO\_BLOB\_TABLE in the [Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry") of the [ABAP development tools for Eclipse](javascript:call_link\('abenadt_glosry.htm'\) "Glossary Entry").

@EndUserText.label : 'Table with a BLOB Column'
@AbapCatalog.enhancement.category : #NOT\_EXTENSIBLE
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #RESTRICTED
define table demo\_blob\_table {
¬†¬†key name : abap.sstring(255) not null;
¬†¬†picture¬†¬†: abap.rawstring(0);
}

Continue
[DDIC DDL - DEFINE TABLE, table\_annos](javascript:call_link\('abenddicddl_define_table_props.htm'\))
[DDIC DDL - DEFINE TABLE, field](javascript:call_link\('abenddicddl_define_table_comps.htm'\))
[DDIC DDL - DEFINE TABLE, include](javascript:call_link\('abenddicddl_define_table_incl.htm'\))



**üìñ Source**: [abenddicddl_define_table.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table.htm)

### abenddicddl_define_table_props.htm

> **üìñ Official SAP Documentation**: [abenddicddl_define_table_props.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table_props.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Dictionary DDL for Defining Database Tables](javascript:call_link\('abenddic_define_table.htm'\))¬†‚Üí¬† [DDIC DDL - DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20DDL%20-%20DEFINE%20TABLE%2C%20table_annos%2C%20ABENDDICDDL_DEFINE_TABLE_PROPS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20imp
rovement:)

DDIC DDL - DEFINE TABLE, table\_annos

Syntax

@AbapCatalog.tableCategory : table\_cat
@AbapCatalog.dataMaintenance : data\_maint
@AbapCatalog.deliveryClass : deliv\_class
*\[*@AbapCatalog.activationType : act\_type*\]*
*\[*@AbapCatalog.replacementObject : '...'*\]*

Effect

Annotations for specifying table properties in the definition of a DDIC database table using the statement [DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\)) in the [Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry").

Mandatory Definitions

-   @AbapCatalog.tableCategory defines the [table category](javascript:call_link\('abenddic_database_tables_tab_cat.htm'\)). table\_cat can be specified as:
    -   #TRANSPARENT - [transparent table](javascript:call_link\('abentransparent_table_glosry.htm'\) "Glossary Entry")
    -   #GLOBAL\_TEMPORARY - [Global Temporary Table (GTT)](javascript:call_link\('abenglobal_temporary_table_glosry.htm'\) "Glossary Entry")
-   @AbapCatalog.dataMaintenance defines how [the DDIC database table is displayed and maintained](javascript:call_link\('abenddic_database_tables_maint.htm'\)). data\_maint can be specified as:
    -   #NOT\_ALLOWED - [Display/maintenance not allowed](javascript:call_link\('abenddic_database_tables_maint.htm'\))
    -   #RESTRICTED - [Display/maintenance allowed with restrictions](javascript:call_link\('abenddic_database_tables_maint.htm'\))
    -   #ALLOWED - [Display/maintenance allowed](javascript:call_link\('abenddic_database_tables_maint.htm'\))
    -   #DISPLAY - [Only display allowed](javascript:call_link\('abenddic_database_tables_maint.htm'\))
-   @AbapCatalog.deliveryClass defines the [delivery class of the database table](javascript:call_link\('abenddic_database_tables_delivery.htm'\)). deliv\_class can be specified as:
    -   #A - [delivery class A](javascript:call_link\('abenddic_database_tables_delivery.htm'\))
    -   #C - [delivery class C](javascript:call_link\('abenddic_database_tables_delivery.htm'\))
    -   #L - [delivery class L](javascript:call_link\('abenddic_database_tables_delivery.htm'\))
    -   #G - [delivery class G](javascript:call_link\('abenddic_database_tables_delivery.htm'\))
    -   #E - [delivery class E](javascript:call_link\('abenddic_database_tables_delivery.htm'\))
    -   #S - [delivery class S](javascript:call_link\('abenddic_database_tables_delivery.htm'\))
    -   #W - [delivery class W](javascript:call_link\('abenddic_database_tables_delivery.htm'\))

Optional Definitions

-   @AbapCatalog.tableCategory defines the [activation type of the database table](javascript:call_link\('abenddic_database_tables_act_type.htm'\)). This setting is not relevant for DDIC database tables in application programming. act\_type can be specified as:
    -   #NOT\_CLASSIFIED - [activation type 00](javascript:call_link\('abenddic_database_tables_act_type.htm'\))
    -   #NAMETAB\_GENERATION\_OFFLINE - [activation type 01](javascript:call_link\('abenddic_database_tables_act_type.htm'\))
    -   #ADAPT\_C\_STRUCTURES - [activation type 02](javascript:call_link\('abenddic_database_tables_act_type.htm'\))
    -   #INITIAL\_TABLE\_REQUIRED - [activation type 10](javascript:call_link\('abenddic_database_tables_act_type.htm'\))
-   @AbapCatalog.replacementObject defines the name of a [replacement object](javascript:call_link\('abenreplacement_object_glosry.htm'\) "Glossary Entry") in quotation marks.
-   @AbapCatalog.primaryKey.invertedIndividualIndex defines the type of the [primary index](javascript:call_link\('abenprimary_index_glosry.htm'\) "Glossary Entry"):
    -   true - [INVERTED INDIVIDUAL](javascript:call_link\('abenddic_database_tables_index.htm'\)) as of HANA2, SPS 03, [INVERTED HASH](javascript:call_link\('abenddic_database_tables_index.htm'\)) before HANA2, SPS 03
    -   false - [INVERTED VALUE](javascript:call_link\('abenddic_database_tables_index.htm'\)) (default)

Example

Annotations in the definition of the DDIC database table DEMO\_SUMDIST in the [Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry") of the [ABAP development tools for Eclipse](javascript:call_link\('abenadt_glosry.htm'\) "Glossary Entry"). This table has the CDS view DEMO\_CDS\_SUMDIST as its [replacement object](javascript:call_link\('abenreplacement_object_glosry.htm'\) "Glossary Entry").

@EndUserText.label : 'Aggregation Table with Replacement Object'
@AbapCatalog.enhancement.category : #NOT\_EXTENSIBLE
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #LIMITED
@AbapCatalog.replacementObject : 'demo\_cds\_sumdist'
define table demo\_sumdist {
¬†¬†key client¬†¬† : mandt not null;
¬†¬†key carrname : s\_carrname not null;
¬†¬†key distid¬†¬† : s\_distid not null;
¬†¬†@Semantics.quantity.unitOfMeasure : 'demo\_sumdist.distid'
¬†¬†sum\_distance : s\_distance; }



**üìñ Source**: [abenddicddl_define_table_props.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table_props.htm)

### abenddicddl_define_table_comps.htm

> **üìñ Official SAP Documentation**: [abenddicddl_define_table_comps.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table_comps.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Dictionary DDL for Defining Database Tables](javascript:call_link\('abenddic_define_table.htm'\))¬†‚Üí¬† [DDIC DDL - DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20DDL%20-%20DEFINE%20TABLE%2C%20field%2C%20ABENDDICDDL_DEFINE_TABLE_COMPS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improveme
nt:)

DDIC DDL - DEFINE TABLE, field

Syntax

*\[*[component\_annos](javascript:call_link\('abenddicddl_define_struct_cmpprps.htm'\))*\]*
*\[*[foreign\_key\_annos](javascript:call_link\('abenddicddl_define_table_fkprps.htm'\))*\]*
*\[*[geo\_annos](javascript:call_link\('abenddicddl_define_table_srprps.htm'\))*\]*
*\[*KEY*\]* field : *{*data\_element *\[*[foreign\_key](javascript:call_link\('abenddicddl_define_table_forkey.htm'\))*\]*
*\[*[value\_help](javascript:call_link\('abenddicddl_define_struct_valuhelp.htm'\))*\]**}*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†*|*abap. [type](javascript:call_link\('abenddic_builtin_types.htm'\))*\[*(n)*|*(n,m)*\]*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†*\[*NOT NULL*\]*;

Effect

Defines a single [database field](javascript:call_link\('abenddic_database_tables_techstruc.htm'\)) in the definition of a DDIC database table using the [Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry") statement [DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\)).

-   In front of the field, annotations [component\_annos](javascript:call_link\('abenddicddl_define_struct_cmpprps.htm'\)) can be used to specify the same optional component properties as in the definition of a structure using [DEFINE STRUCTURE](javascript:call_link\('abenddicddl_define_structure.htm'\)).
-   [foreign\_key\_annos](javascript:call_link\('abenddicddl_define_table_fkprps.htm'\)) can be used to specify the properties of a foreign key dependency defined with [foreign\_key](javascript:call_link\('abenddicddl_define_table_forkey.htm'\)).
-   [geo\_annos](javascript:call_link\('abenddicddl_define_table_srprps.htm'\)) specify the properties of a component with the [geodata type](javascript:call_link\('abengeo_data_type_glosry.htm'\) "Glossary Entry") GEOM\_EWKB.
-   The addition KEY defines the table field as a [key field](javascript:call_link\('abenddic_database_tables_key.htm'\)).
-   field defines the name of the database field.
-   data\_element or abap.type is used to define the data type of the table field. The same rules apply as in the definition of a [structure component](javascript:call_link\('abenddicddl_define_struct_comps.htm'\)), except that only elementary types can be specified here.
-   The addition NOT NULL is used to set the [flag for initial values](javascript:call_link\('abenddic_database_tables_init.htm'\)).
-   The addition [foreign\_key](javascript:call_link\('abenddicddl_define_table_forkey.htm'\)) can be used to define a [foreign key dependency](javascript:call_link\('abenddic_database_tables_forkeyrel.htm'\)) for a table field. As a prerequisite, the table field must be typed using a data element.
-   The addition [value\_help](javascript:call_link\('abenddicddl_define_struct_valuhelp.htm'\)) can be used to assign a search help to a table field whose data type is defined using a data element. This is only useful for table fields used for input fields of dynpros or Web Dynpros (which is not recommended) and the same applies as in the definition of a [structure component](javascript:call_link\('abenddicddl_define_struct_comps.htm'\)).

Example

Definition of DDIC database table DEMO\_EXPRESSIONS in the [Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry") of the [ABAP development tools for Eclipse](javascript:call_link\('abenadt_glosry.htm'\) "Glossary Entry"). The types of all fields are determined directly using built-in data types in the ABAP Dictionary.

@EndUserText.label : 'Database table for Expression Examples'
@AbapCatalog.enhancement.category : #NOT\_EXTENSIBLE
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #ALLOWED
define table demo\_expressions {
¬†¬†key mandt¬†¬†: mandt not null;
¬†¬†key id¬†¬†¬†¬† : char1 not null;
¬†¬†num1¬†¬†¬†¬†¬†¬† : abap.int4;
¬†¬†num2¬†¬†¬†¬†¬†¬† : abap.int4;
¬†¬†numlong1¬†¬† : abap.int8;
¬†¬†numlong2¬†¬† : abap.int8;
¬†¬†dec1¬†¬†¬†¬†¬†¬† : abap.dec(31,0);
¬†¬†dec2¬†¬†¬†¬†¬†¬† : abap.dec(31,10);
¬†¬†dec3¬†¬†¬†¬†¬†¬† : abap.dec(10,3);
¬†¬†fltp1¬†¬†¬†¬†¬†¬†: abap.fltp;
¬†¬†fltp2¬†¬†¬†¬†¬†¬†: abap.fltp;
¬†¬†decf1¬†¬†¬†¬†¬†¬†: abap.df34\_dec(31,0);
¬†¬†decf2¬†¬†¬†¬†¬†¬†: abap.df34\_dec(31,0);
¬†¬†char1¬†¬†¬†¬†¬†¬†: abap.char(10);
¬†¬†char2¬†¬†¬†¬†¬†¬†: abap.char(10);
¬†¬†numc1¬†¬†¬†¬†¬†¬†: abap.numc(10);
¬†¬†numc2¬†¬†¬†¬†¬†¬†: abap.numc(10);
¬†¬†string1¬†¬†¬†¬†: abap.string(0);
¬†¬†string2¬†¬†¬†¬†: abap.string(0);
¬†¬†raw1¬†¬†¬†¬†¬†¬† : abap.raw(10);
¬†¬†raw2¬†¬†¬†¬†¬†¬† : abap.raw(10);
¬†¬†xstring1¬†¬† : abap.rawstring(0);
¬†¬†xstring2¬†¬† : abap.rawstring(0);
¬†¬†dats1¬†¬†¬†¬†¬†¬†: abap.dats;
¬†¬†dats2¬†¬†¬†¬†¬†¬†: abap.dats;
¬†¬†tims1¬†¬†¬†¬†¬†¬†: abap.tims;
¬†¬†tims2¬†¬†¬†¬†¬†¬†: abap.tims;
¬†¬†timestamp1 : abap.dec(15,0);
¬†¬†timestamp2 : abap.dec(15,0); }

Continue
[DDIC DDL - DEFINE TABLE, foreign\_key\_annos](javascript:call_link\('abenddicddl_define_table_fkprps.htm'\))
[DDIC DDL - DEFINE TABLE, foreign\_key](javascript:call_link\('abenddicddl_define_table_forkey.htm'\))
[DDIC DDL - DEFINE TABLE, geo\_annos](javascript:call_link\('abenddicddl_define_table_srprps.htm'\))



**üìñ Source**: [abenddicddl_define_table_comps.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table_comps.htm)

### abenddicddl_define_table_fkprps.htm

> **üìñ Official SAP Documentation**: [abenddicddl_define_table_fkprps.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table_fkprps.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Dictionary DDL for Defining Database Tables](javascript:call_link\('abenddic_define_table.htm'\))¬†‚Üí¬† [DDIC DDL - DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\))¬†‚Üí¬† [DDIC DDL - DEFINE TABLE, field](javascript:call_link\('abenddicddl_define_table_comps.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20DDL%20-%20DEFINE%20TABLE%2C%20foreign_key_annos%2C%20ABENDDICDDL_DEFINE_TABLE_FKPRPS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20fo
r%20improvement:)

DDIC DDL - DEFINE TABLE, foreign\_key\_annos

Syntax

*\[*@AbapCatalog.foreignKey.label : '...'*\]*
*\[*@AbapCatalog.foreignKey.keyType : key\_type*\]*
*\[*@AbapCatalog.foreignKey.screenCheck : true*|*false*\]*
*\[*@AbapCatalog.foreignKey.messageClass : msg\_cls*\]*
*\[*@AbapCatalog.foreignKey.messageNumber : msg\_no*\]*

Effect

Annotations used to specify properties for a [foreign key dependency](javascript:call_link\('abenforeign_key_dependency_glosry.htm'\) "Glossary Entry") of a [table field](javascript:call_link\('abenddicddl_define_table_comps.htm'\)) defined using [foreign\_key](javascript:call_link\('abenddicddl_define_table_forkey.htm'\)) in the definition of a DDIC database table using the [Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry") statement [DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\)).

-   In quotation marks, @AbapCatalog.foreignKey.label defines the short text of the foreign key in the original language of the database table.
-   @AbapCatalog.foreignKey.keyType defines the [type of the foreign key fields](javascript:call_link\('abenddic_database_tables_forkey.htm'\)). key\_type can be specified as:
    -   #NON\_KEY - [No key fields/candidates](javascript:call_link\('abenddic_database_tables_forkey.htm'\))
    -   #KEY - [Key fields/candidates](javascript:call_link\('abenddic_database_tables_forkey.htm'\))
    -   #TEXT\_KEY - [Key fields of a text table](javascript:call_link\('abenddic_database_tables_forkey.htm'\))
-   @AbapCatalog.foreignKey.screenCheck enables or disables the foreign key dependency for the [input check](javascript:call_link\('abenddic_database_tables_forkey.htm'\)).
-   @AbapCatalog.foreignKey.messageClass and @AbapCatalog.foreignKey.messageNumber specify the message class msg\_class and message number msg\_no for the [message](javascript:call_link\('abenmessage_glosry.htm'\) "Glossary Entry") of the [input check](javascript:call_link\('abenddic_database_tables_forkey.htm'\)).

Example

See [foreign\_key](javascript:call_link\('abenddicddl_define_table_forkey.htm'\)).



**üìñ Source**: [abenddicddl_define_table_fkprps.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table_fkprps.htm)

### abenddicddl_define_table_forkey.htm

> **üìñ Official SAP Documentation**: [abenddicddl_define_table_forkey.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table_forkey.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Dictionary DDL for Defining Database Tables](javascript:call_link\('abenddic_define_table.htm'\))¬†‚Üí¬† [DDIC DDL - DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\))¬†‚Üí¬† [DDIC DDL - DEFINE TABLE, field](javascript:call_link\('abenddicddl_define_table_comps.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20DDL%20-%20DEFINE%20TABLE%2C%20foreign_key%2C%20ABENDDICDDL_DEFINE_TABLE_FORKEY%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20im
provement:)

DDIC DDL - DEFINE TABLE, foreign\_key

Syntax

...¬†¬†WITH FOREIGN KEY *\[*\[n,m\]*\]* check\_table
¬†¬†¬†¬†¬†¬† WHERE check\_field1 = dbtab.field1
¬†¬†¬†¬†¬†¬†¬†¬† *\[*AND check\_field2 = dbtab.field2 ...*\]* ...

Effect

Assigns a [check table](javascript:call_link\('abenddic_database_tables_checktab.htm'\)) to a [table field](javascript:call_link\('abenddicddl_define_table_comps.htm'\)) whose data type is defined by a data element in the definition of a DDIC database table using the [Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry") statement [DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\)). check\_table must be an existing DDIC database table. This statement turns check\_table into a check table and turns the current DDIC database table into a [foreign key table](javascript:call_link\('abenforeign_key_table_glosry.htm'\) "Glossary Entry"). The current table field is turned into a [foreign key field](javascript:call_link\('abenforeign_key_field_glosry.htm'\) "Glossary Entry") of the [foreign key](javascript:call_link\('abenddic_database_tables_forkey.htm'\)) of the current table.

-   Fields of the check table must be assigned to the foreign key fields of the foreign key table after WHERE.
-   \[n,m\] can be used to define the [cardinality](javascript:call_link\('abencardinality_glosry.htm'\) "Glossary Entry") of the [foreign key](javascript:call_link\('abenddic_database_tables_forkey.htm'\)).
    -   The possible values for n are 1 for [1](javascript:call_link\('abenddic_database_tables_forkey.htm'\)) and \[0..1\] for [C](javascript:call_link\('abenddic_database_tables_forkey.htm'\)).
    -   The possible values for m are 1 for [1](javascript:call_link\('abenddic_database_tables_forkey.htm'\)), \[0..1\] for [C](javascript:call_link\('abenddic_database_tables_forkey.htm'\)), \[1..\*\] for [N](javascript:call_link\('abenddic_database_tables_forkey.htm'\)), and \[0..\*\] for [CN](javascript:call_link\('abenddic_database_tables_forkey.htm'\)).

Further properties of the foreign key can be specified using [foreign\_key\_annos](javascript:call_link\('abenddicddl_define_table_fkprps.htm'\)).

Hint

The addition WITH FOREIGN KEY can be used, with the same meaning, in the definition of a structure using [DEFINE STRUCTURE](javascript:call_link\('abenddicddl_define_structure.htm'\)).

Example

Dictionary DDL for specifying the check table SCARR of the foreign key field CARRID of the foreign key table SPFLI.

...
define table spfli {
¬†¬†...
¬†¬†@AbapCatalog.foreignKey.label : 'Check Against Airline'
¬†¬†@AbapCatalog.foreignKey.keyType : #KEY
¬†¬†@AbapCatalog.foreignKey.screenCheck : true
¬†¬†key carrid : s\_carr\_id not null
¬†¬†¬†¬†with foreign key \[0..\*,1\] scarr
¬†¬†¬†¬†¬†¬†where mandt = spfli.mandt
¬†¬†¬†¬†¬†¬†¬†¬†and carrid = spfli.carrid;
¬†¬†...
}



**üìñ Source**: [abenddicddl_define_table_forkey.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table_forkey.htm)

### abenddicddl_define_table_srprps.htm

> **üìñ Official SAP Documentation**: [abenddicddl_define_table_srprps.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table_srprps.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Dictionary DDL for Defining Database Tables](javascript:call_link\('abenddic_define_table.htm'\))¬†‚Üí¬† [DDIC DDL - DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\))¬†‚Üí¬† [DDIC DDL - DEFINE TABLE, field](javascript:call_link\('abenddicddl_define_table_comps.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20DDL%20-%20DEFINE%20TABLE%2C%20geo_annos%2C%20ABENDDICDDL_DEFINE_TABLE_SRPRPS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20impr
ovement:)

DDIC DDL - DEFINE TABLE, geo\_annos

Syntax

@AbapCatalog.geo.spatialRefSystem : 'id'

Effect

Specifies a property for table fields with the [geodata type](javascript:call_link\('abengeo_data_type_glosry.htm'\) "Glossary Entry") GEOM\_EWKB.

Currently, the annotation @AbapCatalog.geo.spatialRefSystem is available. This annotation is used to specify the ID id of a [spatial reference system](javascript:call_link\('abenddic_database_tables_sptlrf.htm'\)) as an integer value in quotation marks. If the annotation is not specified, the default value 0 is used implicitly and the annotation inserted accordingly. The spatial reference system can no longer be modified after activation.

Hints

-   The program ABAP\_DOCU\_SHOW\_SPATIAL\_REF\_SYS shows the spatial reference systems that are available in the current system.
-   Spatial reference systems are not managed by ABAP. A spatial reference system that is available in one system is not necessarily available in a follow-up system.

Example

Annotation @AbapCatalog.geo.spatialRefSystem for a table field LOCATION of a DDIC database table.

...
define table ... {
¬†¬†...
¬†¬†@AbapCatalog.geo.spatialRefSystem : '4326'
¬†¬†location¬†¬†: abap.geom\_ewkb;
¬†¬†...
}



**üìñ Source**: [abenddicddl_define_table_srprps.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table_srprps.htm)

### abenddicddl_define_table_comps.htm

> **üìñ Official SAP Documentation**: [abenddicddl_define_table_comps.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table_comps.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Dictionary DDL for Defining Database Tables](javascript:call_link\('abenddic_define_table.htm'\))¬†‚Üí¬† [DDIC DDL - DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20DDL%20-%20DEFINE%20TABLE%2C%20field%2C%20ABENDDICDDL_DEFINE_TABLE_COMPS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improveme
nt:)

DDIC DDL - DEFINE TABLE, field

Syntax

*\[*[component\_annos](javascript:call_link\('abenddicddl_define_struct_cmpprps.htm'\))*\]*
*\[*[foreign\_key\_annos](javascript:call_link\('abenddicddl_define_table_fkprps.htm'\))*\]*
*\[*[geo\_annos](javascript:call_link\('abenddicddl_define_table_srprps.htm'\))*\]*
*\[*KEY*\]* field : *{*data\_element *\[*[foreign\_key](javascript:call_link\('abenddicddl_define_table_forkey.htm'\))*\]*
*\[*[value\_help](javascript:call_link\('abenddicddl_define_struct_valuhelp.htm'\))*\]**}*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†*|*abap. [type](javascript:call_link\('abenddic_builtin_types.htm'\))*\[*(n)*|*(n,m)*\]*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†*\[*NOT NULL*\]*;

Effect

Defines a single [database field](javascript:call_link\('abenddic_database_tables_techstruc.htm'\)) in the definition of a DDIC database table using the [Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry") statement [DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\)).

-   In front of the field, annotations [component\_annos](javascript:call_link\('abenddicddl_define_struct_cmpprps.htm'\)) can be used to specify the same optional component properties as in the definition of a structure using [DEFINE STRUCTURE](javascript:call_link\('abenddicddl_define_structure.htm'\)).
-   [foreign\_key\_annos](javascript:call_link\('abenddicddl_define_table_fkprps.htm'\)) can be used to specify the properties of a foreign key dependency defined with [foreign\_key](javascript:call_link\('abenddicddl_define_table_forkey.htm'\)).
-   [geo\_annos](javascript:call_link\('abenddicddl_define_table_srprps.htm'\)) specify the properties of a component with the [geodata type](javascript:call_link\('abengeo_data_type_glosry.htm'\) "Glossary Entry") GEOM\_EWKB.
-   The addition KEY defines the table field as a [key field](javascript:call_link\('abenddic_database_tables_key.htm'\)).
-   field defines the name of the database field.
-   data\_element or abap.type is used to define the data type of the table field. The same rules apply as in the definition of a [structure component](javascript:call_link\('abenddicddl_define_struct_comps.htm'\)), except that only elementary types can be specified here.
-   The addition NOT NULL is used to set the [flag for initial values](javascript:call_link\('abenddic_database_tables_init.htm'\)).
-   The addition [foreign\_key](javascript:call_link\('abenddicddl_define_table_forkey.htm'\)) can be used to define a [foreign key dependency](javascript:call_link\('abenddic_database_tables_forkeyrel.htm'\)) for a table field. As a prerequisite, the table field must be typed using a data element.
-   The addition [value\_help](javascript:call_link\('abenddicddl_define_struct_valuhelp.htm'\)) can be used to assign a search help to a table field whose data type is defined using a data element. This is only useful for table fields used for input fields of dynpros or Web Dynpros (which is not recommended) and the same applies as in the definition of a [structure component](javascript:call_link\('abenddicddl_define_struct_comps.htm'\)).

Example

Definition of DDIC database table DEMO\_EXPRESSIONS in the [Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry") of the [ABAP development tools for Eclipse](javascript:call_link\('abenadt_glosry.htm'\) "Glossary Entry"). The types of all fields are determined directly using built-in data types in the ABAP Dictionary.

@EndUserText.label : 'Database table for Expression Examples'
@AbapCatalog.enhancement.category : #NOT\_EXTENSIBLE
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #ALLOWED
define table demo\_expressions {
¬†¬†key mandt¬†¬†: mandt not null;
¬†¬†key id¬†¬†¬†¬† : char1 not null;
¬†¬†num1¬†¬†¬†¬†¬†¬† : abap.int4;
¬†¬†num2¬†¬†¬†¬†¬†¬† : abap.int4;
¬†¬†numlong1¬†¬† : abap.int8;
¬†¬†numlong2¬†¬† : abap.int8;
¬†¬†dec1¬†¬†¬†¬†¬†¬† : abap.dec(31,0);
¬†¬†dec2¬†¬†¬†¬†¬†¬† : abap.dec(31,10);
¬†¬†dec3¬†¬†¬†¬†¬†¬† : abap.dec(10,3);
¬†¬†fltp1¬†¬†¬†¬†¬†¬†: abap.fltp;
¬†¬†fltp2¬†¬†¬†¬†¬†¬†: abap.fltp;
¬†¬†decf1¬†¬†¬†¬†¬†¬†: abap.df34\_dec(31,0);
¬†¬†decf2¬†¬†¬†¬†¬†¬†: abap.df34\_dec(31,0);
¬†¬†char1¬†¬†¬†¬†¬†¬†: abap.char(10);
¬†¬†char2¬†¬†¬†¬†¬†¬†: abap.char(10);
¬†¬†numc1¬†¬†¬†¬†¬†¬†: abap.numc(10);
¬†¬†numc2¬†¬†¬†¬†¬†¬†: abap.numc(10);
¬†¬†string1¬†¬†¬†¬†: abap.string(0);
¬†¬†string2¬†¬†¬†¬†: abap.string(0);
¬†¬†raw1¬†¬†¬†¬†¬†¬† : abap.raw(10);
¬†¬†raw2¬†¬†¬†¬†¬†¬† : abap.raw(10);
¬†¬†xstring1¬†¬† : abap.rawstring(0);
¬†¬†xstring2¬†¬† : abap.rawstring(0);
¬†¬†dats1¬†¬†¬†¬†¬†¬†: abap.dats;
¬†¬†dats2¬†¬†¬†¬†¬†¬†: abap.dats;
¬†¬†tims1¬†¬†¬†¬†¬†¬†: abap.tims;
¬†¬†tims2¬†¬†¬†¬†¬†¬†: abap.tims;
¬†¬†timestamp1 : abap.dec(15,0);
¬†¬†timestamp2 : abap.dec(15,0); }

Continue
[DDIC DDL - DEFINE TABLE, foreign\_key\_annos](javascript:call_link\('abenddicddl_define_table_fkprps.htm'\))
[DDIC DDL - DEFINE TABLE, foreign\_key](javascript:call_link\('abenddicddl_define_table_forkey.htm'\))
[DDIC DDL - DEFINE TABLE, geo\_annos](javascript:call_link\('abenddicddl_define_table_srprps.htm'\))



**üìñ Source**: [abenddicddl_define_table_comps.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table_comps.htm)

### abenddicddl_define_table_incl.htm

> **üìñ Official SAP Documentation**: [abenddicddl_define_table_incl.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table_incl.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Dictionary DDL for Defining Database Tables](javascript:call_link\('abenddic_define_table.htm'\))¬†‚Üí¬† [DDIC DDL - DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20DDL%20-%20DEFINE%20TABLE%2C%20include%2C%20ABENDDICDDL_DEFINE_TABLE_INCL%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvem
ent:)

DDIC DDL - DEFINE TABLE, include

Syntax

*\[*KEY*\]* *\[*group :*\]* INCLUDE struct *\[*WITH SUFFIX suffix*\]* *\[*NOT NULL*\]*
¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†*\[*...
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† [extend](javascript:call_link\('abenddicddl_define_struct_comp_ext.htm'\))
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ...*\]*;

Effect

Includes an [include structure](javascript:call_link\('abenddic_include_structure.htm'\)) in the definition of a DDIC database table with the statement [DEFINE TABLE](javascript:call_link\('abenddicddl_define_table.htm'\)) in [Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry"). The same applies as to [including](javascript:call_link\('abenddicddl_define_struct_incl.htm'\)) include structures into structures with the statement [DEFINE STRUCTURE](javascript:call_link\('abenddicddl_define_structure.htm'\)), except that the include structures must be suitable for DDIC database tables.

Additionally, the additions KEY and NOT NULL can be used:

-   By using KEY all fields of the included structure are flagged as [key fields](javascript:call_link\('abenddic_database_tables_key.htm'\)). The include structure must then be inserted between the existing key fields or directly after them. The key attribute of the individual fields of an included structure does not have an effect. Either all fields are included as key fields or none.
-   By using NOT NULL the [flag for initial values](javascript:call_link\('abenddic_database_tables_init.htm'\)) is set for the included structure. When used, those fields in the include structure for which this attribute is set also keep their attribute, but it is not switched on for fields where the attribute is not set. If the flag for initial values is not set for the included include structure, this attribute is removed for all fields.



**üìñ Source**: [abenddicddl_define_table_incl.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table_incl.htm)

### abenddicddl_define_table.htm

> **üìñ Official SAP Documentation**: [abenddicddl_define_table.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Dictionary (DDIC)](javascript:call_link\('abenabap_dictionary.htm'\))¬†‚Üí¬† [DDIC - Database Tables](javascript:call_link\('abenddic_database_tables.htm'\))¬†‚Üí¬† [DDIC - Dictionary DDL for Defining Database Tables](javascript:call_link\('abenddic_define_table.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20DDIC%20DDL%20-%20DEFINE%20TABLE%2C%20ABENDDICDDL_DEFINE_TABLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

DDIC DDL - DEFINE TABLE

Syntax

[structure\_annos](javascript:call_link\('abenddicddl_define_struct_props.htm'\))
[ext\_annos](javascript:call_link\('abenddicddl_define_ext_annos.htm'\))
[table\_annos](javascript:call_link\('abenddicddl_define_table_props.htm'\))
DEFINE TABLE dbtab {
¬†¬†...
¬†¬†[field;](javascript:call_link\('abenddicddl_define_table_comps.htm'\))
¬†¬†...
¬†¬†[include;](javascript:call_link\('abenddicddl_define_table_incl.htm'\))
¬†¬†...
}

Effect

[Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry") statement for defining an ABAP Dictionary [DDIC database table](javascript:call_link\('abenddic_database_tables.htm'\)) dbtab in the [ABAP development tools for Eclipse](javascript:call_link\('abenadt_glosry.htm'\) "Glossary Entry").

-   A DDIC database table is defined using the statement DEFINE TABLE. The name dbtab must comply with the naming rules for DDIC database tables.
-   In front of the statement DEFINE TABLE,
    -   the same mandatory structure properties must be specified as [annotations](javascript:call_link\('abenddic_annotation_glosry.htm'\) "Glossary Entry") [structure\_annos](javascript:call_link\('abenddicddl_define_struct_props.htm'\)) as in the statement [DEFINE STRUCTURE](javascript:call_link\('abenddicddl_define_structure.htm'\)).
    -   the same optional extensibility annotations [ext\_annos](javascript:call_link\('abenddicddl_define_ext_annos.htm'\)) as in the statement [DEFINE STRUCTURE](javascript:call_link\('abenddicddl_define_structure.htm'\)) are available for [C0 developer extensibility](javascript:call_link\('abendev_extensibility_glosry.htm'\) "Glossary Entry").
    -   any mandatory table properties must be specified as annotations [table\_annos](javascript:call_link\('abenddicddl_define_table_props.htm'\)). Any other properties are optional.
-   The table fields are defined in a semicolon-separated list in curly brackets { } using one of the following methods:
    -   by defining single fields [field](javascript:call_link\('abenddicddl_define_table_comps.htm'\))
    -   by including include structures [include](javascript:call_link\('abenddicddl_define_table_incl.htm'\)).

Hints

-   As in the [CDS syntax](javascript:call_link\('abencds_general_syntax_rules.htm'\)), an ABAP Dictionary structure definition can contain comments after // and between /\* ... \*/.
-   For a more detailed description of the syntax, see the ADT documentation [Syntax of ABAP Dictionary Objects](https://help.sap.com/docs/ABAP_PLATFORM_NEW/c238d694b825421f940829321ffa326a/fc6cd6f7d02f4546a33feb3f5fc9dd66).

Example

Definition of DDIC database table DEMO\_BLOB\_TABLE in the [Dictionary DDL](javascript:call_link\('abendictionary_ddl_glosry.htm'\) "Glossary Entry") of the [ABAP development tools for Eclipse](javascript:call_link\('abenadt_glosry.htm'\) "Glossary Entry").

@EndUserText.label : 'Table with a BLOB Column'
@AbapCatalog.enhancement.category : #NOT\_EXTENSIBLE
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #RESTRICTED
define table demo\_blob\_table {
¬†¬†key name : abap.sstring(255) not null;
¬†¬†picture¬†¬†: abap.rawstring(0);
}

Continue
[DDIC DDL - DEFINE TABLE, table\_annos](javascript:call_link\('abenddicddl_define_table_props.htm'\))
[DDIC DDL - DEFINE TABLE, field](javascript:call_link\('abenddicddl_define_table_comps.htm'\))
[DDIC DDL - DEFINE TABLE, include](javascript:call_link\('abenddicddl_define_table_incl.htm'\))


---


## ABAP - Keyword Documentation / ABAP - Core Data Services (ABAP CDS) / ABAP CDS - Function Definitions / ABAP CDS - FDL for Function Definitions / ABAP CDS - Scalar Functions / ABAP CDS - SQL-Based Scalar Functions

**Files**: 6 | **Difficulty**: advanced

# ABAP - Keyword Documentation / ABAP - Core Data Services (ABAP CDS) / ABAP CDS - Function Definitions / ABAP CDS - FDL for Function Definitions / ABAP CDS - Scalar Functions / ABAP CDS - SQL-Based Scalar Functions

Included pages: 6



**üìñ Source**: [abenddicddl_define_table.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenddicddl_define_table.htm)

### abencds_sql_scalar_function.htm

> **üìñ Official SAP Documentation**: [abencds_sql_scalar_function.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_sql_scalar_function.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [ABAP CDS - Function Definitions](javascript:call_link\('abencds_fdl.htm'\))¬†‚Üí¬† [ABAP CDS - FDL for Function Definitions](javascript:call_link\('abencds_functions.htm'\))¬†‚Üí¬† [ABAP CDS - Scalar Functions](javascript:call_link\('abencds_scalar_functions.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20CDS%20-%20SQL-Based%20Scalar%20Functions%2C%20ABENCDS_SQL_SCALAR_FUNCTION%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improve
ment:)

ABAP CDS - SQL-Based Scalar Functions

[SQL-based scalar functions](javascript:call_link\('abencds_sql_scalar_glosry.htm'\) "Glossary Entry") are [scalar functions](javascript:call_link\('abencds_scalar_function_glosry.htm'\) "Glossary Entry") that are evaluated by an SQL environment. They can be used in [CDS view entities](javascript:call_link\('abencds_v2_view_glosry.htm'\) "Glossary Entry") in operand positions that expect scalar values, similar to [built-in functions](javascript:call_link\('abencds_builtin_functions_v2.htm'\)).

While [analytical scalar functions](javascript:call_link\('abencds_ana_scalar_function.htm'\)) are defined and implemented by SAP, SQL-based scalar functions can also be defined and implemented by customers and partners. SQL-based scalar functions make user-defined [AMDP scalar functions](javascript:call_link\('abenamdp_scalar_function_glosry.htm'\) "Glossary Entry") known to the ABAP Dictionary and available in ABAP CDS.

An SQL-based scalar function consists of three development objects:

-   A [scalar function definition](javascript:call_link\('abencds_dsfd_glosry.htm'\) "Glossary Entry") defined using [DEFINE SCALAR FUNCTION](javascript:call_link\('abencds_define_scalar_function.htm'\)) in a [CDS function definition](javascript:call_link\('abencds_function_definition_glosry.htm'\) "Glossary Entry"). It is located in the namespace of all [global types](javascript:call_link\('abenglobal_type_glosry.htm'\) "Glossary Entry") of an AS ABAP.
-   A [scalar function implementation reference](javascript:call_link\('abencds_scalar_func_impl_ref.htm'\)) that binds the scalar function to the SQL environment and to an [AMDP function implementation](javascript:call_link\('abenamdp_function_method_glosry.htm'\) "Glossary Entry"). The scalar function implementation reference is defined in a form-based editor in the [ABAP development tools for Eclipse](javascript:call_link\('abenadt_glosry.htm'\) "Glossary Entry"). It must refer to an existing CDS scalar function. It is a standalone repository object that is transported and has its own editor in ADT.
-   An [AMDP function](javascript:call_link\('abenamdp_function_glosry.htm'\) "Glossary Entry") that implements the CDS scalar function using [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry") in a special [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry"). The implementation is managed as an [AMDP scalar function](javascript:call_link\('abenamdp_table_function_glosry.htm'\) "Glossary Entry") by the [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry") in the database system. The AMDP method must be declared as a special [AMDP function implementation](javascript:call_link\('abenamdp_function_methods.htm'\)) for exactly one CDS scalar function using the addition [FOR SCALAR FUNCTION](javascript:call_link\('abapclass-methods_for_scalfunc.htm'\)). The parameter interface of the AMDP scalar function is defined by the input parameters and the scalar result type of the CDS scalar function.

[Client handling](javascript:call_link\('abenclient_handling_glosry.htm'\) "Glossary Entry") has not yet been implemented for CDS scalar functions, so only [client-independent](javascript:call_link\('abenclient_independent_glosry.htm'\) "Glossary Entry") scalar functions are supported. The AMDP method that implements a scalar function can only access client-independent objects. However, when it is used, client dependency is ignored. A CDS scalar function can be used in both client-dependent and client-independent CDS entities.

The following topics describe the syntax for defining SQL-based scalar functions.

Continue
[CDS FDL - DEFINE SCALAR FUNCTION](javascript:call_link\('abencds_define_scalar_function.htm'\))



**üìñ Source**: [abencds_sql_scalar_function.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_sql_scalar_function.htm)

### abencds_define_scalar_function.htm

> **üìñ Official SAP Documentation**: [abencds_define_scalar_function.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_define_scalar_function.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [ABAP CDS - Function Definitions](javascript:call_link\('abencds_fdl.htm'\))¬†‚Üí¬† [ABAP CDS - FDL for Function Definitions](javascript:call_link\('abencds_functions.htm'\))¬†‚Üí¬† [ABAP CDS - Scalar Functions](javascript:call_link\('abencds_scalar_functions.htm'\))¬†‚Üí¬† [ABAP CDS - SQL-Based Scalar Functions](javascript:call_link\('abencds_sql_scalar_function.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20FDL%20-%20DEFINE%20SCALAR%20FUNCTION%2C%20ABENCDS_DEFINE_SCALAR_FUNCTION%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improveme
nt:)

CDS FDL - DEFINE SCALAR FUNCTION

Syntax

DEFINE SCALAR FUNCTION ScalarFunction
¬†¬†*\[*WITH PARAMETERS pname1 : [typing](javascript:call_link\('abencds_scalar_typing.htm'\)) *\[*,
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† pname2 : [typing](javascript:call_link\('abencds_scalar_typing.htm'\))*\]**\[*,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†...*\]**\]*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURNS [typing](javascript:call_link\('abencds_scalar_typing.htm'\))*\[*;*\]*

Effect

Defines a CDS scalar function definition ScalarFunction as a [CDS scalar function](javascript:call_link\('abencds_scalar_function_glosry.htm'\) "Glossary Entry") in the [CDS FDL](javascript:call_link\('abencds_fdl_glosry.htm'\) "Glossary Entry"). The name ScalarFunction must follow the naming conventions for [dictionary types](javascript:call_link\('abenddic_types_names.htm'\)). The following additional rules apply:

-   The name can be up to 26 characters long. Four characters are reserved for the suffix of the [scalar function implementation reference](javascript:call_link\('abencds_scalar_func_impl_ref.htm'\)).
-   The name must not start with the prefix QCM.
-   The first, second, third, and last character of the name must not be an underscore (\_).
-   A CDS scalar function is located in the namespace of all [global types](javascript:call_link\('abenglobal_type_glosry.htm'\) "Glossary Entry") of an AS ABAP.

Optionally, a list of input parameters pname1, pname2, ... can be declared using the addition WITH PARAMETERS. These also define the input parameters of the AMDP scalar function. There is no limit to the number of input parameters. The typing of these input parameters is explained in the topic [CDS FDL - typing](javascript:call_link\('abencds_scalar_typing.htm'\)).

The name of an input parameter must comply with the naming rules for [names](javascript:call_link\('abencds_general_syntax_rules.htm'\)). Furthermore, it cannot contain any slash (/) characters and cannot be a reserved name in ABAP Dictionary. All reserved names that cannot be used are specified in the DDIC database table TRESE. The evaluation of names is not case-sensitive. Each parameter name must be unique. Blanks in the comma-separated parameter list are ignored and can be omitted.

RETURNS defines the data type of the scalar return value. The topic [CDS FDL - typing](javascript:call_link\('abencds_scalar_typing.htm'\)) explains how the return value can be typed.

Use

CDS scalar functions are available in [CDS view entities](javascript:call_link\('abencds_v2_view_glosry.htm'\) "Glossary Entry") in operand positions that expect scalar values, similar to built-in functions. In particular, they can be specified in the following operand positions:

-   As the right-hand side of a join ON-condition of a CDS view entity as documented in the topic [CDS DDL - CDS View Entity, SELECT, JOIN](javascript:call_link\('abencds_joined_data_source_v2.htm'\)).
-   As an element in the element list of a CDS view entity, as documented in the topic [CDS DDL - CDS View Entity, SELECT, element](javascript:call_link\('abencds_select_list_entry_v2.htm'\)).
-   As operands in a [WHERE](javascript:call_link\('abencds_where_clause_v2.htm'\)) condition of a CDS view entity.
-   As operands of an [arithmetic expression](javascript:call_link\('abencds_arithmetic_expression_v2.htm'\)) in a CDS view entity.
-   As operand of a [case distinction](javascript:call_link\('abencds_case_expression_v2.htm'\)) in a CDS view entity.
-   As operand of a [cast expression](javascript:call_link\('abencds_cast_expression_v2.htm'\)) in a CDS view entity.
-   As operands of [built-in functions](javascript:call_link\('abencds_builtin_functions_v2.htm'\)) wherever documented.
-   As an operand of a [filter condition](javascript:call_link\('abencds_path_expression_filter_v2.htm'\)) of a [path expression](javascript:call_link\('abenpath_expression_glosry.htm'\) "Glossary Entry").

Restrictions

-   SQL-based scalar functions cannot be used in CDS entities other than CDS view entities.
-   SQL-based scalar functions can currently not be used in [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry").

Once a CDS scalar function has been activated, a [scalar function implementation reference](javascript:call_link\('abencds_scalar_func_impl_ref.htm'\)) must be created. This scalar function implementation reference binds the scalar function to a runtime environment and refers to an [AMDP function implementation](javascript:call_link\('abenamdp_function_method_glosry.htm'\) "Glossary Entry").

The scalar function is implemented in an AMDP function using the addition [FOR SCALAR FUNCTION](javascript:call_link\('abapclass-methods_for_scalfunc.htm'\)).

Hint

After activation, a CDS scalar function cannot be renamed.

Example

The following example demonstrates the definition, implementation, and use of an SQL-based scalar function.

CDS scalar function definition

The following CDS scalar function DEMO\_CDS\_SCALAR\_HELLOWORLD has no input parameters. It only defines the data type of the return parameter.

define scalar function DEMO\_CDS\_SCALAR\_HELLOWORLD
¬†¬†returns abap.char(12)

CDS scalar function implementation reference

The scalar function implementation reference DEMO\_CDS\_SCALAR\_HELLOWORLD\_SQL binds the scalar function to the SQL Engine and defines the method EXECUTE of the class CL\_DEMO\_CDS\_SCALAR\_HELLOWORLD as AMDP function implementation.

AMDP function implementation

The following listing shows the AMDP function implementation. The value of the return parameter is set to Hello World!.

METHOD execute BY DATABASE FUNCTION
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FOR HDB
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† OPTIONS READ-ONLY.
¬†¬†result = 'Hello World!';
ENDMETHOD.

Use in a CDS view entity

The following CDS view entity uses the scalar function DEMO\_CDS\_SCALAR\_HELLOWORLD as an element in the SELECT list.

@AccessControl.authorizationCheck: #NOT\_REQUIRED
@EndUserText.label: 'CDS view entity, scalar func'
define view entity DEMO\_CDS\_SCALAR\_USE
¬†¬†as select from demo\_expressions
{
¬†¬†key id¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as Id,
¬†¬†¬†¬†¬†¬†DEMO\_CDS\_SCALAR\_HELLOWORLD() as MyScalarFunc
}

Continue
[CDS FDL - typing](javascript:call_link\('abencds_scalar_typing.htm'\))



**üìñ Source**: [abencds_define_scalar_function.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_define_scalar_function.htm)

### abencds_scalar_typing.htm

> **üìñ Official SAP Documentation**: [abencds_scalar_typing.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_scalar_typing.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [ABAP CDS - Function Definitions](javascript:call_link\('abencds_fdl.htm'\))¬†‚Üí¬† [ABAP CDS - FDL for Function Definitions](javascript:call_link\('abencds_functions.htm'\))¬†‚Üí¬† [ABAP CDS - Scalar Functions](javascript:call_link\('abencds_scalar_functions.htm'\))¬†‚Üí¬† [ABAP CDS - SQL-Based Scalar Functions](javascript:call_link\('abencds_sql_scalar_function.htm'\))¬†‚Üí¬† [CDS FDL - DEFINE SCALAR FUNCTION](javascript:call_link\('abencds_define_scalar_function.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20FDL%20-%20typing%2C%20ABENCDS_SCALAR_TYPING%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

CDS FDL - typing

Syntax

¬†¬†[dtype](javascript:call_link\('abencds_typing.htm'\))¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬† *\[*[WITH REFERENCE TYPE](javascript:call_link\('abencds_with_reference_type.htm'\))*\]*
*|* [simple\_type](javascript:call_link\('abencds_define_simple_type.htm'\))¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† *\[*[WITH REFERENCE TYPE](javascript:call_link\('abencds_with_reference_type.htm'\))*\]*
*|* [data\_element](javascript:call_link\('abenddic_data_elements.htm'\))¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†*\[*[WITH REFERENCE TYPE](javascript:call_link\('abencds_with_reference_type.htm'\))*\]*
*|* [generic\_type](javascript:call_link\('abenddic_generic_types.htm'\))¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†*\[*[WITH REFERENCE TYPE](javascript:call_link\('abencds_with_reference_type.htm'\))*\]*
*|* TYPE OF ParameterReference¬†¬†*\[*[WITH REFERENCE TYPE](javascript:call_link\('abencds_with_reference_type.htm'\))*\]*

Addition:

[... WITH REFERENCE TYPE](#!ABAP_ONE_ADD@1@)

Effect

The input parameters of [SQL-based scalar functions](javascript:call_link\('abencds_sql_scalar_glosry.htm'\) "Glossary Entry") can be typed as follows:

-   Using a [built-in ABAP Dictionary data type](javascript:call_link\('abencds_typing.htm'\)).
-   Using a [CDS simple type](javascript:call_link\('abencds_simple_type_glosry.htm'\) "Glossary Entry") defined using [DEFINE TYPE](javascript:call_link\('abencds_define_simple_type.htm'\)).
-   Using a [DDIC data element](javascript:call_link\('abendata_element_glosry.htm'\) "Glossary Entry").
-   Using the [generic data type](javascript:call_link\('abenddic_generic_types.htm'\)) numeric.
    
    Note: The generic type any is only available for analytical scalar functions.
    
-   Referencing another input parameter using the syntax statement TYPE OF ParameterReference. ParameterReference can be any input parameter from the parameter list of the current scalar function that is typed with a built-in data type, a simple type, a data element, or a generic type.
    
    Note: You cannot reference the return parameter.
    
    Note: You cannot reference an input parameter that itself references an input parameter.
    

The return parameter of an SQL-based scalar function can be typed as follows:

-   Using a [built-in ABAP Dictionary data type](javascript:call_link\('abencds_typing.htm'\)).
-   Using a [CDS simple type](javascript:call_link\('abencds_simple_type_glosry.htm'\) "Glossary Entry") defined using [DEFINE TYPE](javascript:call_link\('abencds_define_simple_type.htm'\)).
-   Using a [DDIC data element](javascript:call_link\('abendata_element_glosry.htm'\) "Glossary Entry").
-   Referencing another input parameter using the syntax statement TYPE OF ParameterReference. ParameterReference can be any of the input parameters from the parameter list of the current scalar function that is typed with a built-in data type, a simple type, a data element, or a generic type.
    
    Note: You cannot reference an input parameter that itself references an input parameter.
    

Example

The following example demonstrates the definition, implementation, and use of an SQL-based scalar function with input parameters.

CDS scalar function definition

The following CDS scalar function DEMO\_CDS\_SCALAR\_RATIO defines two input parameters:

-   portion: Typed with the generic type numeric. Accepts all available reference types.
-   total: Typed with reference to the input parameter portion.

The return parameter is typed with a built-in data type.

define scalar function DEMO\_CDS\_SCALAR\_RATIO
¬†¬†with parameters
¬†¬†¬†¬†portion: numeric
¬†¬†¬†¬†¬†¬†with reference type \[ #CUKY, #UNIT, #CALC, #NONE \],
¬†¬†¬†¬†total¬†¬†: type of portion
¬†¬†¬†¬†¬†¬†with reference type of portion
¬†¬†returns abap.decfloat34
¬†¬†¬†¬†with reference type #NONE;

CDS scalar function implementation reference

The scalar function implementation reference DEMO\_CDS\_SCALAR\_RATIO\_SQL binds the scalar function to the SQL Engine and defines the method EXECUTE of the class CL\_DEMO\_CDS\_SCALAR\_RATIO as AMDP function implementation.

AMDP function implementation

The following listing shows the AMDP function implementation. The input parameter portion is divided by the input parameter total and multiplied by 100 to get the percentage of portion in relation to total.

METHOD execute BY DATABASE FUNCTION
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FOR HDB
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† OPTIONS READ-ONLY.
¬†¬†result = portion / total \* 100;
ENDMETHOD.

Use in a CDS view entity

The following CDS view entity uses the scalar function DEMO\_CDS\_SCALAR\_RATIO as an element in the SELECT list to calculate the occupancy of a flight.

@AccessControl.authorizationCheck: #NOT\_REQUIRED
@EndUserText.label: 'CDS view entity, scalar func'
define view entity DEMO\_CDS\_SCALAR\_USE\_RATIO
¬†¬†as select from sflight
{
¬†¬†key carrid ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as Carrid,
¬†¬†key connid¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as Connid,
¬†¬†key fldate¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as Fldate,
¬†¬†¬†¬†¬†¬†seatsocc¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as BookedSeats,
¬†¬†¬†¬†¬†¬†seatsmax¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as TotalSeats,
¬†¬†¬†¬†¬†¬†DEMO\_CDS\_SCALAR\_RATIO(¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†portion => seatsocc,¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†total¬†¬† => seatsmax ) as OccupationRatio
}

Access Using ABAP SQL

The following code snippet demonstrates how the CDS view entity can be accessed. The value of the column OccupationRatio is calculated by the AMDP function implementation.

SELECT \*
¬†¬†FROM demo\_cds\_scalar\_use\_ratio
¬†¬†INTO TABLE @DATA(result).
cl\_demo\_output=>display( result ).

Addition ¬† 

... WITH REFERENCE TYPE

Effect

Specifies a reference type. Reference types allow the handling of [CDS amount fields](javascript:call_link\('abencds_amount_field_glosry.htm'\) "Glossary Entry") and [CDS quantity fields](javascript:call_link\('abencds_quantity_glosry.htm'\) "Glossary Entry"). The addition is described in topic [CDS FDL - WITH REFERENCE TYPE](javascript:call_link\('abencds_with_reference_type.htm'\)).

Continue
[CDS FDL - WITH REFERENCE TYPE](javascript:call_link\('abencds_with_reference_type.htm'\))



**üìñ Source**: [abencds_scalar_typing.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_scalar_typing.htm)

### abencds_with_reference_type.htm

> **üìñ Official SAP Documentation**: [abencds_with_reference_type.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_with_reference_type.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [ABAP CDS - Function Definitions](javascript:call_link\('abencds_fdl.htm'\))¬†‚Üí¬† [ABAP CDS - FDL for Function Definitions](javascript:call_link\('abencds_functions.htm'\))¬†‚Üí¬† [ABAP CDS - Scalar Functions](javascript:call_link\('abencds_scalar_functions.htm'\))¬†‚Üí¬† [ABAP CDS - SQL-Based Scalar Functions](javascript:call_link\('abencds_sql_scalar_function.htm'\))¬†‚Üí¬† [CDS FDL - DEFINE SCALAR FUNCTION](javascript:call_link\('abencds_define_scalar_function.htm'\))¬†‚Üí¬† [CDS FDL - typing](javascript:call_link\('abencds_scalar_typing.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20FDL%20-%20WITH%20REFERENCE%20TYPE%2C%20ABENCDS_WITH_REFERENCE_TYPE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

CDS FDL - WITH REFERENCE TYPE

Syntax Forms

Static Reference Type Specification

¬†¬†WITH REFERENCE TYPE \[#CUKY *|* #UNIT *|* #CALC *|* #NONE\]
*|* WITH REFERENCE TYPE OF pname

Dynamic Reference Type Specification

WITH REFERENCE TYPE
¬†¬†CASE
¬†¬†¬†¬†WHEN pname1: reference *\[*AND pname2: reference*\]**\[*AND...*\]*
¬†¬†¬†¬†¬†¬†THEN reference
¬†¬†¬†¬†*\[*WHEN ... *\[*AND ... *\]* THEN ...*\]*
¬†¬†¬†¬†*\[*ELSE reference*\]*
¬†¬†END*\[*;*\]*

Variants:

[1\. WITH REFERENCE TYPE ref\_type *|* OF ...](#!ABAP_VARIANT_1@1@)
[2\. WITH REFERENCE TYPE CASE ...](#!ABAP_VARIANT_2@2@)

Effect

[SQL-based scalar functions](javascript:call_link\('abencds_sql_scalar_glosry.htm'\) "Glossary Entry") support the handling of [CDS amount fields](javascript:call_link\('abencds_amount_field_glosry.htm'\) "Glossary Entry") and [CDS quantity fields](javascript:call_link\('abencds_quantity_glosry.htm'\) "Glossary Entry"). CDS amount fields and CDS quantity fields are fields with a reference to a [currency key](javascript:call_link\('abencurrency_key_glosry.htm'\) "Glossary Entry"), a [unit key](javascript:call_link\('abenunit_glosry.htm'\) "Glossary Entry"), or a [calculated unit](javascript:call_link\('abencds_calculated_unit_glosry.htm'\) "Glossary Entry"). Scalar functions can handle these references. They can define which reference types are allowed for each [input parameter](javascript:call_link\('abeninput_parameter_glosry.htm'\) "Glossary Entry") and for the return parameter. The [actual parameters](javascript:call_link\('abenactual_parameter_glosry.htm'\) "Glossary Entry") passed to the input parameters must provide the required reference types. If the return parameter requires a reference type, the required annotation must be provided when the scalar function is used. Missing reference types for actual parameters or the return parameter result in a syntax check error.

The following general rules apply:

-   If the data type of a parameter is specified as abap.curr, then the reference type must be #CUKY.
-   If the type of a parameter is specified as abap.quan, then the reference type must be #UNIT.

In all other cases, the syntax checker does not check whether the data type and the reference type match and the developer must ensure logical combinations. The following definition is not logical and no actual parameter can satisfy the conditions. In other words, if a value has data type CHAR, it must not have a reference to a currency key and vice versa. The required data type and the required reference type are mutually exclusive. However, no syntax check error occurs.

p1: abap.char(10)
WITH REFERENCE TYPE \[ #CUKY \]

Example

The following example demonstrates the definition, implementation, and use of an SQL-based scalar function with parameters with reference types.

CDS scalar function definition

The following CDS scalar function DEMO\_CDS\_SCALAR\_REF\_CASE defines input parameters with reference types. The return parameter dynamically specifies the reference type.

define scalar function DEMO\_CDS\_SCALAR\_REF\_CASE
¬†¬†with parameters
¬†¬†¬†¬†p1: numeric
¬†¬†¬†¬†¬†¬†with reference type \[ #CUKY, #UNIT, #CALC, #NONE \],
¬†¬†¬†¬†p2: numeric
¬†¬†¬†¬†¬†¬†with reference type \[ #CUKY, #UNIT, #CALC, #NONE \],
¬†¬†¬†¬†p3: abap.dec(4,2)
¬†¬†¬†¬†¬†¬†with reference type \[ #CUKY, #UNIT, #CALC, #NONE \]
¬†¬†returns abap.dec(4,2)
¬†¬†¬†¬†with reference type
¬†¬†¬†¬†¬†¬†case
¬†¬†¬†¬†¬†¬†¬†¬†when p2: reference type of p1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†then #NONE
¬†¬†¬†¬†¬†¬†¬†¬†else reference type of p1
¬†¬†¬†¬†¬†¬†end;

CDS scalar function implementation reference

The scalar function implementation reference DEMO\_CDS\_SCALAR\_REF\_CASE\_SQL binds the scalar function to the SQL Engine and defines the method EXECUTE of the class CL\_DEMO\_CDS\_SCALAR\_REF\_CASE as AMDP function implementation.

AMDP function implementation

The following listing shows the AMDP function implementation. The input parameters are summed up.

METHOD execute BY DATABASE FUNCTION
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FOR HDB
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† OPTIONS READ-ONLY.
¬†¬†result = p1 + p2 + p3;
¬†¬†ENDMETHOD.

Use in a CDS view entity

The following CDS view entity uses the scalar function DEMO\_CDS\_SCALAR\_REF\_CASE as an element in the SELECT list. The passed actual parameter for p1 has a unit key as reference and the result is also linked with a unit key using the annotation @Semantics.quantity.unitOfMeasure.

Note: The syntax checker checks the reference types of the input parameters and of the return parameter. Wrong reference types lead to a syntax check error.

Note: The AMDP function implementation does not check the reference types. It would be technically possible to add 5 kilometers and 3 kilograms. The result might not make sense, but there would be no syntax check error. The developer must ensure logical calculations.

@AccessControl.authorizationCheck: #NOT\_REQUIRED
@EndUserText.label: 'CDS view entity, scalar func'
define view entity DEMO\_CDS\_SCALAR\_USE\_REF\_CASE
¬†¬†with parameters
¬†¬†¬†¬†p1 : abap.dec(4,2)
¬†¬†as select from DEMO\_CDS\_SCALAR\_HELPER
{
¬†¬†key Id,
¬†¬†¬†¬†¬†¬†Unit2,
¬†¬†¬†¬†¬†¬†@Semantics.quantity.unitOfMeasure: 'Unit2'
¬†¬†¬†¬†¬†¬†DEMO\_CDS\_SCALAR\_REF\_CASE(
¬†¬†¬†¬†¬†¬†p1 => Int4,
¬†¬†¬†¬†¬†¬†p2 => abap.int4'22',
¬†¬†¬†¬†¬†¬†p3 => $parameters.p1) as ScalarResult
}

Variant 1 ¬† 

WITH REFERENCE TYPE ref\_type *|* OF ...

Effect

The reference type can be specified statically. The following options are available:

-   Specifying a reference type ref\_type. The following values can be specified for ref\_type:
    -   #CUKY: The actual parameters passed must be [CDS amount fields](javascript:call_link\('abencds_amount_field_glosry.htm'\) "Glossary Entry"). They must have a valid data type and they must be annotated with [Semantics.amount.currencyCode](javascript:call_link\('abencds_f1_element_annotation.htm'\)).
    -   #UNIT: The actual parameters passed must be [CDS quantity fields](javascript:call_link\('abencds_quantity_glosry.htm'\) "Glossary Entry"). They must have a valid data type and they must be annotated with [Semantics.quantity.unitOfMeasure](javascript:call_link\('abencds_f1_element_annotation.htm'\)).
    -   #CALC: The passed actual parameters must be [CDS calculated quantities](javascript:call_link\('abencds_calculated_quantity_glosry.htm'\) "Glossary Entry"). This means that they must be the result of a calculation, they have data type DECFLOAT34, and they must have a calculated unit reference using the annotation [Semantics.quantity.unitOfMeasure](javascript:call_link\('abencds_f1_element_annotation.htm'\)).
    -   #NONE: The actual parameters passed must not have a reference to a currency key, a unit of measure key, or a calculated unit.
-   WITH REFERENCE TYPE OF pname: Defines a reference type with reference to another input parameter. A parameter typed with reference to another input parameter automatically inherits the reference type of the referenced parameter. This is useful when two parameters require the same reference type. The following rules apply:
    -   The referenced parameter pname must be another input parameter. References to the return parameter are not supported.
    -   pname must be a parameter that is specified statically with a reference value. Referencing parameters with a dynamic specification or with a parameter reference is not allowed.

An input parameter can have one or more reference types. The reference types can be freely combined. Here's an example:

WITH REFERENCE TYPE \[#CUKY, #CALC, #NONE, REFERENCE TYPE OF pname1\]

This means that the parameter in question supports all of the specified reference types, and the actual parameter can have a currency key reference, a calculated unit, no reference at all, or any of the reference types specified for the input parameter pname1.

Note: This does not apply to return parameters. Return parameters cannot have more than one reference type.

The data type specified for a parameter and the data type required by the reference type must match. This means:

-   The reference type #CUKY only allows actual parameters of the types CURR, DECFLOAT34, DEC, and FLTP.
-   The reference type #UNIT only allows actual parameters of the types QUAN, DECFLOAT16, DECFLOAT34, DEC, FLTP, INT1, INT2, or INT4.
-   The reference type #CALC only allows actual parameters of the type DECFLOAT34.
-   The reference type #NONE accepts all data types except for CURR and QUAN, because these data types force a reference type.

Hints

-   The [generic data type](javascript:call_link\('abenddic_generic_types.htm'\)) numeric has a different scope of data types than CDS amount fields and CDS quantity fields. When numeric is specified together with a reference type, the valid data types for the actual parameter are the intersection of the two requirements.
-   Casting and conversions may be required for the actual parameters. For example, the generic data type numeric does not support the data type abap.curr. The conversion function [CURR\_TO\_DECFLOAT\_AMOUNT](javascript:call_link\('abencds_conv_func_unit_curr_v2.htm'\)) can be used to convert fields of the data type abap.curr to a data type that is allowed for numeric, so that they can be used as actual parameter for a parameter typed with numeric.

Variant 2 ¬† 

WITH REFERENCE TYPE CASE ...

Effect

The reference type of the input parameter or return parameter can be defined dynamically, depending on the reference types of the input parameters. This is done using case statements. The following rules apply:

-   Each parameter can have exactly one CASE statement.
-   A CASE statement can have one or more WHEN branches.
-   A WHEN branch can have one or more conditions. Multiple conditions can be combined with AND.
-   For input parameters, the ELSE branch is optional. For the return parameter, the ELSE branch is mandatory.



**üìñ Source**: [abencds_with_reference_type.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_with_reference_type.htm)

### abencds_scalar_typing.htm

> **üìñ Official SAP Documentation**: [abencds_scalar_typing.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_scalar_typing.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [ABAP CDS - Function Definitions](javascript:call_link\('abencds_fdl.htm'\))¬†‚Üí¬† [ABAP CDS - FDL for Function Definitions](javascript:call_link\('abencds_functions.htm'\))¬†‚Üí¬† [ABAP CDS - Scalar Functions](javascript:call_link\('abencds_scalar_functions.htm'\))¬†‚Üí¬† [ABAP CDS - SQL-Based Scalar Functions](javascript:call_link\('abencds_sql_scalar_function.htm'\))¬†‚Üí¬† [CDS FDL - DEFINE SCALAR FUNCTION](javascript:call_link\('abencds_define_scalar_function.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20FDL%20-%20typing%2C%20ABENCDS_SCALAR_TYPING%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

CDS FDL - typing

Syntax

¬†¬†[dtype](javascript:call_link\('abencds_typing.htm'\))¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬† *\[*[WITH REFERENCE TYPE](javascript:call_link\('abencds_with_reference_type.htm'\))*\]*
*|* [simple\_type](javascript:call_link\('abencds_define_simple_type.htm'\))¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† *\[*[WITH REFERENCE TYPE](javascript:call_link\('abencds_with_reference_type.htm'\))*\]*
*|* [data\_element](javascript:call_link\('abenddic_data_elements.htm'\))¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†*\[*[WITH REFERENCE TYPE](javascript:call_link\('abencds_with_reference_type.htm'\))*\]*
*|* [generic\_type](javascript:call_link\('abenddic_generic_types.htm'\))¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†*\[*[WITH REFERENCE TYPE](javascript:call_link\('abencds_with_reference_type.htm'\))*\]*
*|* TYPE OF ParameterReference¬†¬†*\[*[WITH REFERENCE TYPE](javascript:call_link\('abencds_with_reference_type.htm'\))*\]*

Addition:

[... WITH REFERENCE TYPE](#!ABAP_ONE_ADD@1@)

Effect

The input parameters of [SQL-based scalar functions](javascript:call_link\('abencds_sql_scalar_glosry.htm'\) "Glossary Entry") can be typed as follows:

-   Using a [built-in ABAP Dictionary data type](javascript:call_link\('abencds_typing.htm'\)).
-   Using a [CDS simple type](javascript:call_link\('abencds_simple_type_glosry.htm'\) "Glossary Entry") defined using [DEFINE TYPE](javascript:call_link\('abencds_define_simple_type.htm'\)).
-   Using a [DDIC data element](javascript:call_link\('abendata_element_glosry.htm'\) "Glossary Entry").
-   Using the [generic data type](javascript:call_link\('abenddic_generic_types.htm'\)) numeric.
    
    Note: The generic type any is only available for analytical scalar functions.
    
-   Referencing another input parameter using the syntax statement TYPE OF ParameterReference. ParameterReference can be any input parameter from the parameter list of the current scalar function that is typed with a built-in data type, a simple type, a data element, or a generic type.
    
    Note: You cannot reference the return parameter.
    
    Note: You cannot reference an input parameter that itself references an input parameter.
    

The return parameter of an SQL-based scalar function can be typed as follows:

-   Using a [built-in ABAP Dictionary data type](javascript:call_link\('abencds_typing.htm'\)).
-   Using a [CDS simple type](javascript:call_link\('abencds_simple_type_glosry.htm'\) "Glossary Entry") defined using [DEFINE TYPE](javascript:call_link\('abencds_define_simple_type.htm'\)).
-   Using a [DDIC data element](javascript:call_link\('abendata_element_glosry.htm'\) "Glossary Entry").
-   Referencing another input parameter using the syntax statement TYPE OF ParameterReference. ParameterReference can be any of the input parameters from the parameter list of the current scalar function that is typed with a built-in data type, a simple type, a data element, or a generic type.
    
    Note: You cannot reference an input parameter that itself references an input parameter.
    

Example

The following example demonstrates the definition, implementation, and use of an SQL-based scalar function with input parameters.

CDS scalar function definition

The following CDS scalar function DEMO\_CDS\_SCALAR\_RATIO defines two input parameters:

-   portion: Typed with the generic type numeric. Accepts all available reference types.
-   total: Typed with reference to the input parameter portion.

The return parameter is typed with a built-in data type.

define scalar function DEMO\_CDS\_SCALAR\_RATIO
¬†¬†with parameters
¬†¬†¬†¬†portion: numeric
¬†¬†¬†¬†¬†¬†with reference type \[ #CUKY, #UNIT, #CALC, #NONE \],
¬†¬†¬†¬†total¬†¬†: type of portion
¬†¬†¬†¬†¬†¬†with reference type of portion
¬†¬†returns abap.decfloat34
¬†¬†¬†¬†with reference type #NONE;

CDS scalar function implementation reference

The scalar function implementation reference DEMO\_CDS\_SCALAR\_RATIO\_SQL binds the scalar function to the SQL Engine and defines the method EXECUTE of the class CL\_DEMO\_CDS\_SCALAR\_RATIO as AMDP function implementation.

AMDP function implementation

The following listing shows the AMDP function implementation. The input parameter portion is divided by the input parameter total and multiplied by 100 to get the percentage of portion in relation to total.

METHOD execute BY DATABASE FUNCTION
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FOR HDB
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† OPTIONS READ-ONLY.
¬†¬†result = portion / total \* 100;
ENDMETHOD.

Use in a CDS view entity

The following CDS view entity uses the scalar function DEMO\_CDS\_SCALAR\_RATIO as an element in the SELECT list to calculate the occupancy of a flight.

@AccessControl.authorizationCheck: #NOT\_REQUIRED
@EndUserText.label: 'CDS view entity, scalar func'
define view entity DEMO\_CDS\_SCALAR\_USE\_RATIO
¬†¬†as select from sflight
{
¬†¬†key carrid ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as Carrid,
¬†¬†key connid¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as Connid,
¬†¬†key fldate¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as Fldate,
¬†¬†¬†¬†¬†¬†seatsocc¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as BookedSeats,
¬†¬†¬†¬†¬†¬†seatsmax¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as TotalSeats,
¬†¬†¬†¬†¬†¬†DEMO\_CDS\_SCALAR\_RATIO(¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†portion => seatsocc,¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†total¬†¬† => seatsmax ) as OccupationRatio
}

Access Using ABAP SQL

The following code snippet demonstrates how the CDS view entity can be accessed. The value of the column OccupationRatio is calculated by the AMDP function implementation.

SELECT \*
¬†¬†FROM demo\_cds\_scalar\_use\_ratio
¬†¬†INTO TABLE @DATA(result).
cl\_demo\_output=>display( result ).

Addition ¬† 

... WITH REFERENCE TYPE

Effect

Specifies a reference type. Reference types allow the handling of [CDS amount fields](javascript:call_link\('abencds_amount_field_glosry.htm'\) "Glossary Entry") and [CDS quantity fields](javascript:call_link\('abencds_quantity_glosry.htm'\) "Glossary Entry"). The addition is described in topic [CDS FDL - WITH REFERENCE TYPE](javascript:call_link\('abencds_with_reference_type.htm'\)).

Continue
[CDS FDL - WITH REFERENCE TYPE](javascript:call_link\('abencds_with_reference_type.htm'\))



**üìñ Source**: [abencds_scalar_typing.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_scalar_typing.htm)

### abencds_define_scalar_function.htm

> **üìñ Official SAP Documentation**: [abencds_define_scalar_function.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_define_scalar_function.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [ABAP CDS - Function Definitions](javascript:call_link\('abencds_fdl.htm'\))¬†‚Üí¬† [ABAP CDS - FDL for Function Definitions](javascript:call_link\('abencds_functions.htm'\))¬†‚Üí¬† [ABAP CDS - Scalar Functions](javascript:call_link\('abencds_scalar_functions.htm'\))¬†‚Üí¬† [ABAP CDS - SQL-Based Scalar Functions](javascript:call_link\('abencds_sql_scalar_function.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20FDL%20-%20DEFINE%20SCALAR%20FUNCTION%2C%20ABENCDS_DEFINE_SCALAR_FUNCTION%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improveme
nt:)

CDS FDL - DEFINE SCALAR FUNCTION

Syntax

DEFINE SCALAR FUNCTION ScalarFunction
¬†¬†*\[*WITH PARAMETERS pname1 : [typing](javascript:call_link\('abencds_scalar_typing.htm'\)) *\[*,
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† pname2 : [typing](javascript:call_link\('abencds_scalar_typing.htm'\))*\]**\[*,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†...*\]**\]*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURNS [typing](javascript:call_link\('abencds_scalar_typing.htm'\))*\[*;*\]*

Effect

Defines a CDS scalar function definition ScalarFunction as a [CDS scalar function](javascript:call_link\('abencds_scalar_function_glosry.htm'\) "Glossary Entry") in the [CDS FDL](javascript:call_link\('abencds_fdl_glosry.htm'\) "Glossary Entry"). The name ScalarFunction must follow the naming conventions for [dictionary types](javascript:call_link\('abenddic_types_names.htm'\)). The following additional rules apply:

-   The name can be up to 26 characters long. Four characters are reserved for the suffix of the [scalar function implementation reference](javascript:call_link\('abencds_scalar_func_impl_ref.htm'\)).
-   The name must not start with the prefix QCM.
-   The first, second, third, and last character of the name must not be an underscore (\_).
-   A CDS scalar function is located in the namespace of all [global types](javascript:call_link\('abenglobal_type_glosry.htm'\) "Glossary Entry") of an AS ABAP.

Optionally, a list of input parameters pname1, pname2, ... can be declared using the addition WITH PARAMETERS. These also define the input parameters of the AMDP scalar function. There is no limit to the number of input parameters. The typing of these input parameters is explained in the topic [CDS FDL - typing](javascript:call_link\('abencds_scalar_typing.htm'\)).

The name of an input parameter must comply with the naming rules for [names](javascript:call_link\('abencds_general_syntax_rules.htm'\)). Furthermore, it cannot contain any slash (/) characters and cannot be a reserved name in ABAP Dictionary. All reserved names that cannot be used are specified in the DDIC database table TRESE. The evaluation of names is not case-sensitive. Each parameter name must be unique. Blanks in the comma-separated parameter list are ignored and can be omitted.

RETURNS defines the data type of the scalar return value. The topic [CDS FDL - typing](javascript:call_link\('abencds_scalar_typing.htm'\)) explains how the return value can be typed.

Use

CDS scalar functions are available in [CDS view entities](javascript:call_link\('abencds_v2_view_glosry.htm'\) "Glossary Entry") in operand positions that expect scalar values, similar to built-in functions. In particular, they can be specified in the following operand positions:

-   As the right-hand side of a join ON-condition of a CDS view entity as documented in the topic [CDS DDL - CDS View Entity, SELECT, JOIN](javascript:call_link\('abencds_joined_data_source_v2.htm'\)).
-   As an element in the element list of a CDS view entity, as documented in the topic [CDS DDL - CDS View Entity, SELECT, element](javascript:call_link\('abencds_select_list_entry_v2.htm'\)).
-   As operands in a [WHERE](javascript:call_link\('abencds_where_clause_v2.htm'\)) condition of a CDS view entity.
-   As operands of an [arithmetic expression](javascript:call_link\('abencds_arithmetic_expression_v2.htm'\)) in a CDS view entity.
-   As operand of a [case distinction](javascript:call_link\('abencds_case_expression_v2.htm'\)) in a CDS view entity.
-   As operand of a [cast expression](javascript:call_link\('abencds_cast_expression_v2.htm'\)) in a CDS view entity.
-   As operands of [built-in functions](javascript:call_link\('abencds_builtin_functions_v2.htm'\)) wherever documented.
-   As an operand of a [filter condition](javascript:call_link\('abencds_path_expression_filter_v2.htm'\)) of a [path expression](javascript:call_link\('abenpath_expression_glosry.htm'\) "Glossary Entry").

Restrictions

-   SQL-based scalar functions cannot be used in CDS entities other than CDS view entities.
-   SQL-based scalar functions can currently not be used in [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry").

Once a CDS scalar function has been activated, a [scalar function implementation reference](javascript:call_link\('abencds_scalar_func_impl_ref.htm'\)) must be created. This scalar function implementation reference binds the scalar function to a runtime environment and refers to an [AMDP function implementation](javascript:call_link\('abenamdp_function_method_glosry.htm'\) "Glossary Entry").

The scalar function is implemented in an AMDP function using the addition [FOR SCALAR FUNCTION](javascript:call_link\('abapclass-methods_for_scalfunc.htm'\)).

Hint

After activation, a CDS scalar function cannot be renamed.

Example

The following example demonstrates the definition, implementation, and use of an SQL-based scalar function.

CDS scalar function definition

The following CDS scalar function DEMO\_CDS\_SCALAR\_HELLOWORLD has no input parameters. It only defines the data type of the return parameter.

define scalar function DEMO\_CDS\_SCALAR\_HELLOWORLD
¬†¬†returns abap.char(12)

CDS scalar function implementation reference

The scalar function implementation reference DEMO\_CDS\_SCALAR\_HELLOWORLD\_SQL binds the scalar function to the SQL Engine and defines the method EXECUTE of the class CL\_DEMO\_CDS\_SCALAR\_HELLOWORLD as AMDP function implementation.

AMDP function implementation

The following listing shows the AMDP function implementation. The value of the return parameter is set to Hello World!.

METHOD execute BY DATABASE FUNCTION
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FOR HDB
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† OPTIONS READ-ONLY.
¬†¬†result = 'Hello World!';
ENDMETHOD.

Use in a CDS view entity

The following CDS view entity uses the scalar function DEMO\_CDS\_SCALAR\_HELLOWORLD as an element in the SELECT list.

@AccessControl.authorizationCheck: #NOT\_REQUIRED
@EndUserText.label: 'CDS view entity, scalar func'
define view entity DEMO\_CDS\_SCALAR\_USE
¬†¬†as select from demo\_expressions
{
¬†¬†key id¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as Id,
¬†¬†¬†¬†¬†¬†DEMO\_CDS\_SCALAR\_HELLOWORLD() as MyScalarFunc
}

Continue
[CDS FDL - typing](javascript:call_link\('abencds_scalar_typing.htm'\))


---


## ABAP - Keyword Documentation / ABAP - Core Data Services (ABAP CDS) / ABAP CDS - Data Definitions / ABAP CDS - DDL for Data Definitions / ABAP CDS - CDS Entities / ABAP CDS - View Entities / CDS DDL - DEFINE VIEW ENTITY / CDS DDL - CDS View Entity, SELECT / CDS DDL - SELECT, CDS View Entity, Operands and Expressions / CDS DDL - CDS View Entity, Expressions / CDS DDL - CDS View Entity, Built-In Functions / CDS DDL - CDS View Entity, sql_functions

**Files**: 4 | **Difficulty**: advanced

# ABAP - Keyword Documentation / ABAP - Core Data Services (ABAP CDS) / ABAP CDS - Data Definitions / ABAP CDS - DDL for Data Definitions / ABAP CDS - CDS Entity Extension / CDS DDL - EXTEND VIEW ddic_based

Included pages: 2



**üìñ Source**: [abencds_define_scalar_function.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_define_scalar_function.htm)

### abencds_extend_view.htm

> **üìñ Official SAP Documentation**: [abencds_extend_view.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_extend_view.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [ABAP CDS - Data Definitions](javascript:call_link\('abencds_entities.htm'\))¬†‚Üí¬† [ABAP CDS - DDL for Data Definitions](javascript:call_link\('abencds_f1_ddl_syntax.htm'\))¬†‚Üí¬† [ABAP CDS - CDS Entity Extension](javascript:call_link\('abencds_view_extension.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20DDL%20-%20EXTEND%20VIEW%20ddic_based%2C%20ABENCDS_EXTEND_VIEW%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

CDS DDL - EXTEND VIEW ddic\_based

Syntax

[@AbapCatalog.sqlViewAppendName: 'CDS\_APPEND\_VIEW'](javascript:call_link\('abencds_f1_extend_view_annotations.htm'\))
*\[*[@extension\_annot1](javascript:call_link\('abencds_f1_extend_view_annotations.htm'\))*\]*
*\[*[@extension\_annot2](javascript:call_link\('abencds_f1_extend_view_annotations.htm'\))*\]*
...
EXTEND VIEW ddic\_based\_view
¬†¬†¬†¬†¬†¬† WITH cds\_view\_extension
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†*\[*association1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† association2 ...*\]*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†{ select\_list\_extension }
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†*\[*GROUP BY field1, field2, ...¬†¬†*\]*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†*\[*UNION *\[*ALL*\]* { ... }*\]* *\[*;*\]*

Additions:

[1\. ... GROUP BY field1, field2, ...](#!ABAP_ADDITION_1@1@)
[2\. ... UNION *\[*ALL*\]* { ... }](#!ABAP_ADDITION_2@2@)

Effect

Extends an existing [CDS DDIC-based view (obsolete)](javascript:call_link\('abencds_v1_view_glosry.htm'\) "Glossary Entry") ddic\_based\_view using a [CDS DDIC-based view extension](javascript:call_link\('abencds_view_extend_glosry.htm'\) "Glossary Entry") cds\_view\_extension in the [CDS DDL](javascript:call_link\('abencds_ddl_glosry.htm'\) "Glossary Entry"). An existing CDS DDIC-based view (obsolete) can have one or more CDS DDIC-based view extensions.

The extended CDS view ddic\_based\_view must be specified under the name of its [CDS entity](javascript:call_link\('abencds_entity_glosry.htm'\) "Glossary Entry"). The name of the [CDS-managed DDIC view (obsolete)](javascript:call_link\('abencds_mngdddic_view_glosry.htm'\) "Glossary Entry") cannot be specified.

Prerequisite

As a prerequisite for the extension of the CDS view with the statement EXTEND VIEW, the elements of the [annotation array](javascript:call_link\('abenannotation_array_glosry.htm'\) "Glossary Entry") [AbapCatalog.viewEnhancementCategory\[ \]](javascript:call_link\('abencds_view_anno_v1.htm'\)) must be specified accordingly in its definition with [DEFINE VIEW](javascript:call_link\('abencds_define_view_v1.htm'\)):

-   By default or if only the value #PROJECTION\_LIST is specified, views without [aggregate expressions](javascript:call_link\('abencds_aggregate_functions_v1.htm'\)) in the SELECT list and without a [UNION](javascript:call_link\('abencds_union_v1.htm'\)) clause can be extended.
-   In order to extend views that have [aggregate expressions](javascript:call_link\('abencds_aggregate_functions_v1.htm'\)) in the SELECT list, the annotation array must contain the value #GROUP\_BY alongside #PROJECTION\_LIST.
-   In order to extend views that contain [UNION](javascript:call_link\('abencds_union_v1.htm'\)) clauses, the annotation array must contain the value #UNION alongside #PROJECTION\_LIST.
-   If the annotation array contains the value #NONE, the view cannot be extended.

Components of a View Extension

View extensions can make additions to the original view, but it cannot modify, overwrite, or delete elements from the original view. The following components are possible in a CDS view extension:

-   The annotation [AbapCatalog.sqlViewAppendName](javascript:call_link\('abencds_f1_extend_view_annotations.htm'\)) is mandatory. Further annotations [extension\_annot1](javascript:call_link\('abencds_f1_extend_view_annotations.htm'\)), [extension\_annot2](javascript:call_link\('abencds_f1_extend_view_annotations.htm'\)), ... can also be specified. This is optional.
-   New associations association1, association2 can be defined and exposed in the CDS view extension. The same rules apply that are described in topic [CDS DDL - DDIC-based view, ASSOCIATION](javascript:call_link\('abencds_simple_association_v1.htm'\)).
    
    Note: The definition of new [to-child associations](javascript:call_link\('abento_child_association_glosry.htm'\) "Glossary Entry") or [CDS to-parent associations](javascript:call_link\('abento_parent_association_glosry.htm'\) "Glossary Entry") in a view extension is not allowed.
    
-   The elements of the extension list select\_list\_extension specified after EXTEND VIEW are added to the existing SELECT list. At least one element must be added. It is possible to access all fields of all data sources of the extended view in the extension list select\_list\_extension. The list can have all [elements](javascript:call_link\('abencds_select_list_entry_v1.htm'\)) of a [SELECT list](javascript:call_link\('abencds_select_list_v1.htm'\)), namely:
    -   [field](javascript:call_link\('abencds_field_v2.htm'\)) of a data source
    -   [Input parameters](javascript:call_link\('abencds_parameter_v1.htm'\)) of the extended CDS view. It is not possible to specify new input parameters in a view extension.
    -   It can expose a [CDS association](javascript:call_link\('abencds_select_list_association_v2.htm'\)) of the extended view or a newly defined association
    -   Using a [path expressions](javascript:call_link\('abencds_path_expression_v1.htm'\)), a field of an association target can be included. Path expressions are possible for associations of the extended view or for newly defined associations.
    -   [literals, session variables, expressions and functions](javascript:call_link\('abencds_operands_and_expr_v1.htm'\))
        
        Note: To add aggregate expressions to a view extension, special rules apply. See below.
        
-   Aggregate expressions are possible in the SELECT list of a view extension only if the following conditions are met:
    -   The original view must contain [aggregate expressions](javascript:call_link\('abencds_aggregate_functions_v1.htm'\)). If the original view does not contain any aggregate expressions, this is not possible.
    -   The extended view must be annotated with AbapCatalog.viewEnhancementCategory \[#PROJECTION\_LIST, #GROUP\_BY\]
    -   If non-aggregated elements are added to a CDS view with aggregate expressions, then the [GROUP-BY](javascript:call_link\('abencds_group_by_v1.htm'\)) clause must be extended using the addition GROUP BY
-   If the original view contains [UNION](javascript:call_link\('abencds_union_v1.htm'\)), equivalent UNION additions must be used in the statement EXTEND VIEW. As a prerequisite, the extended view must be annotated with AbapCatalog.viewEnhancementCategory \[#PROJECTION\_LIST, #UNION\]
    
    If an appended element already occurs in the existing SELECT list or if a different extension occurs, it must be given an alternative element name using AS.
    

Restrictions

-   CDS views with an explicit [name list](javascript:call_link\('abencds_name_list_v1.htm'\)) cannot currently be extended.
-   CDS view extensions themselves cannot be extended.
-   It is not possible to specify new input parameters in a view extension.
-   No addition [ROOT](javascript:call_link\('abencds_define_root_view_v1.htm'\)) can be specified in the statement EXTEND VIEW to transform a regular view to a [root entity](javascript:call_link\('abenroot_entity_glosry.htm'\) "Glossary Entry").
-   An appended field cannot be defined as a key field using KEY.
-   The definition of new to-parent or to-child associations in a view extension is not allowed.
-   For views that have an element of data type LRAW or LCHR in the SELECT list, no view extension is possible and the annotation AbapCatalog.viewEnhancementCategory\[#NONE\] is enforced. The reason is that elements of data types LRAW or LCHR must always be in the last position of the SELECT list.

Naming

Two repository objects are created for a CDS view extension that is defined using EXTEND VIEW. A name must be specified for each of the two objects:

-   The actual name cds\_view\_extension of the CDS view extension is specified after the keywords EXTEND VIEW. This name follows the same rules as the name of an [DDIC append view](javascript:call_link\('abenddic_append_view_glosry.htm'\) "Glossary Entry"), but can have up to 30 characters.
-   The name CDS\_APPEND\_VIEW for an [append view](javascript:call_link\('abenddic_append_view_glosry.htm'\) "Glossary Entry") in ABAP Dictionary must be specified in quotation marks after the annotation [@AbapCatalog.sqlViewAppendName](javascript:call_link\('abencds_f1_extend_view_annotations.htm'\)). This name is subject to the same rules as the name of a [DDIC database view](javascript:call_link\('abendatabase_view_glosry.htm'\) "Glossary Entry") in ABAP Dictionary, see topic [DDIC - Naming Rules for DDIC Views](javascript:call_link\('abenddic_view_names.htm'\)). The new DDIC append view extends the [CDS-managed DDIC view (obsolete)](javascript:call_link\('abencds_mngdddic_view_glosry.htm'\) "Glossary Entry") of the extended CDS view. The name given to the DDIC append view can no longer be changed after the CDS view extension is transported into a follow-on system.

The name of the new DDIC append view and of the actual CDS view extension should be located in the customer namespace (or in the namespace of a partner or special development) to protect it against being overwritten by upgrades or new releases.

-   Once the DDL source code of a CDS view extension has been transported, the actual name cds\_view\_extension and the name of the DDIC append view CDS\_APPEND\_VIEW can no longer be changed. The extended view ddic\_based\_view can also no longer be changed.

Note: The DDL source code of a CDS view extension does not need to have the same name as the CDS view extension entity, but it is advisable to use the name of the entity.

Hints

-   Currently it is not possible to define extension categories for CDS views. As a consequence, the following restrictions apply:
    -   CDS views have the property can be extended in any way with respect to the [extension category of DDIC structures](javascript:call_link\('abenddic_structures_enh_cat.htm'\)). The consequences of this must be respected when extending a CDS view.
    -   The properties of a CDS view defined using [annotations](javascript:call_link\('abencds_view_anno_v1.htm'\)), such as switching on [table buffering](javascript:call_link\('abentable_buffering_glosry.htm'\) "Glossary Entry"), cannot currently be modified using extensions.
-   CDS view extensions specified with EXTEND ENTITY are recommended for CDS DDIC-based views (obsolete) only. However, for compatibility and migration reasons, it is also possible to extend [CDS projection views](javascript:call_link\('abencds_projection_view_glosry.htm'\) "Glossary Entry") or [CDS view entities](javascript:call_link\('abencds_v2_view_glosry.htm'\) "Glossary Entry") with the statement EXTEND VIEW. However, view extends defined using EXTEND VIEW do not support the syntax elements specific to projection views and CDS view entities. Therefore, it is recommended that the statement [EXTEND VIEW ENTITY](javascript:call_link\('abencds_extend_view_entity.htm'\)) is used for extensions of CDS projection views and CDS view entities instead.
-   If, for some reason, a CDS projection view or a CDS view entity is extended with EXTEND VIEW, the [CDS-managed DDIC view (obsolete)](javascript:call_link\('abencds_mngdddic_view_glosry.htm'\) "Glossary Entry") is deleted (as CDS projection views and CDS view entities do not have any DDIC artefacts), and entity annotations referring to the CDS-managed DDIC view are ignored.
-   CDS DDIC-based views (obsolete) are [obsolete](javascript:call_link\('abencds_ddic_entity.htm'\)). If new CDS views are required, CDS view entities should be used.

Example

The following CDS view extension

@AbapCatalog.sqlViewAppendName: 'DEMO\_CDS\_EXTENS'
extend view demo\_cds\_original\_view with demo\_cds\_view\_extension¬†¬†
¬†¬†{
¬†¬†¬†¬†spfli.distance,
¬†¬†¬†¬†spfli.distid as unit
¬†¬†};

adds two view fields to the existing CDS view.

@AbapCatalog.sqlViewName: 'DEMO\_CDS\_ORIG'
@AccessControl.authorizationCheck: #NOT\_REQUIRED
@AbapCatalog.viewEnhancementCategory: \[#PROJECTION\_LIST\]
@EndUserText.label: 'Further information about the CDS entity'
define view demo\_cds\_original\_view¬†¬†
¬†¬†as select from
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† spfli
¬†¬†¬†¬†¬†¬†join scarr on
¬†¬†¬†¬†¬†¬†¬†¬†scarr.carrid = spfli.carrid
¬†¬†¬†¬†{
¬†¬†¬†¬†¬†¬†key scarr.carrname¬†¬†¬†¬† as carrier,
¬†¬†¬†¬†¬†¬†key spfli.connid¬†¬†¬†¬†¬†¬† as flight,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†spfli.cityfrom¬†¬†¬†¬† as departure,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†spfli.cityto¬†¬†¬†¬†¬†¬† as destination
¬†¬†¬†¬†};

The DDIC append view DEMO\_CDS\_EXTENS is created in ABAP Dictionary. The class CL\_DEMO\_CDS\_VIEW\_EXTENSION uses the statement [SELECT](javascript:call_link\('abapselect.htm'\)) to access the extended view and also displays the components of the dictionary structures in question.

Addition 1 ¬† 

... GROUP BY field1, field2, ...

Effect

This addition must be specified if elements not defined using aggregate expressions are added to a view with [aggregate expressions](javascript:call_link\('abencds_aggregate_functions_v1.htm'\)). These elements must be specified after GROUP BY add extend the [GROUP-BY](javascript:call_link\('abencds_group_by_v1.htm'\)) clause of the original view. With respect to the extended view, the extended GROUP-BY clause must follow the general rules for a GROUP-BY clause.

The addition cannot be specified if the definition of the original view does not contain any aggregate expressions in its SELECT list.

Hint

Extensions of a view with aggregate expressions require it to contain the annotation array viewEnhancementCategory\[ \] with the value #GROUP\_BY.

Example

The following CDS view extension

@AbapCatalog.sqlViewAppendName: 'DEMO\_CDS\_EXTAGG'
extend view demo\_cds\_aggregate with demo\_cds\_extend\_aggregate
¬†¬†{
¬†¬†¬†¬†connid,¬†¬†
¬†¬†¬†¬†sum(distance) as sum\_distance
¬†¬†}
¬†¬†group by
¬†¬†¬†¬†connid;

extends the existing CDS view.

@AbapCatalog.sqlViewName: 'DEMO\_CDS\_AGG'
@AccessControl.authorizationCheck: #NOT\_REQUIRED
@AbapCatalog.viewEnhancementCategory: \[#PROJECTION\_LIST,#GROUP\_BY\]
define view demo\_cds\_aggregate
¬†¬†as select from
¬†¬†¬†¬†spfli¬†¬†
¬†¬†¬†¬†{
¬†¬†¬†¬†¬†¬†carrid,
¬†¬†¬†¬†¬†¬†sum(fltime) as sum\_fltime
¬†¬†¬†¬†}
¬†¬†¬†¬†group by
¬†¬†¬†¬†¬†¬†carrid;

A database field connid and an aggregate expression sum(distance) are added to the SELECT list. Accordingly, the addition GROUP BY must be used to add the database field to the GROUP-BY clause of the original view.

Addition 2 ¬† 

... UNION *\[*ALL*\]* { ... }

Effect

This addition must be specified when a view with [UNION](javascript:call_link\('abencds_union_v1.htm'\)) clauses is extended. A corresponding UNION addition must be specified for each UNION clause of the original view. The addition ALL must be specified each time it is specified in the associated UNION clause of the original view. The curly brackets can contain elements that extend the SELECT list of the associated UNION clause of the original view. As specified by the SELECT list extended using select\_list\_extension, the UNION clauses must be extended so that the rules for UNION clauses are not broken in the extended view.

The addition cannot be specified if the definition of the original view does not have a UNION clause.

Hint

Extensions of a view with UNION clauses require it to contain the annotation array viewEnhancementCategory\[ \] with the value #UNION.

Example

The following CDS view extension

@AbapCatalog.sqlViewAppendName: 'DEMO\_CDS\_EXTUNI'
extend view demo\_cds\_union with demo\_cds\_extend\_union
¬†¬†{
¬†¬†¬†¬†c as c3,
¬†¬†¬†¬†d as c4
¬†¬†}
union
¬†¬†{
¬†¬†¬†¬†f as c3,
¬†¬†¬†¬†g as c4
¬†¬†}
union all
¬†¬†{
¬†¬†¬†¬†k as c3,
¬†¬†¬†¬†l as c4
¬†¬†};

extends the existing CDS view.

@AbapCatalog.sqlViewName: 'DEMO\_CDS\_UIO'
@AccessControl.authorizationCheck: #NOT\_REQUIRED
@AbapCatalog.viewEnhancementCategory: \[#PROJECTION\_LIST,#UNION\]
define view demo\_cds\_union
¬†¬†as select from
¬†¬†¬†¬†demo\_join1
¬†¬†¬†¬†{
¬†¬†¬†¬†¬†¬†a as c1,
¬†¬†¬†¬†¬†¬†b as c2
¬†¬†¬†¬†}
union select from
¬†¬†demo\_join2
¬†¬†¬†¬†{
¬†¬†¬†¬†¬†¬†d as c1,
¬†¬†¬†¬†¬†¬†e as c2
¬†¬†¬†¬†}
union all select from
¬†¬†demo\_join3
¬†¬†¬†¬†{
¬†¬†¬†¬†¬†¬†i as c1,
¬†¬†¬†¬†¬†¬†j as c2
¬†¬†¬†¬†};

The original view has two UNION clauses represented using corresponding UNION additions in the definition of the CDS view extension. Two elements with matching types are added to the three SELECT lists of the original view.

Continue
[CDS DDL - EXTEND VIEW, extension\_annot](javascript:call_link\('abencds_f1_extend_view_annotations.htm'\))



**üìñ Source**: [abencds_extend_view.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_extend_view.htm)

### abencds_f1_extend_view_annotations.htm

> **üìñ Official SAP Documentation**: [abencds_f1_extend_view_annotations.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_f1_extend_view_annotations.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [ABAP CDS - Data Definitions](javascript:call_link\('abencds_entities.htm'\))¬†‚Üí¬† [ABAP CDS - DDL for Data Definitions](javascript:call_link\('abencds_f1_ddl_syntax.htm'\))¬†‚Üí¬† [ABAP CDS - CDS Entity Extension](javascript:call_link\('abencds_view_extension.htm'\))¬†‚Üí¬† [CDS DDL - EXTEND VIEW ddic\_based](javascript:call_link\('abencds_extend_view.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20DDL%20-%20EXTEND%20VIEW%2C%20extension_annot%2C%20ABENCDS_F1_EXTEND_VIEW_ANNOTATIONS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for
%20improvement:)

CDS DDL - EXTEND VIEW, extension\_annot

Syntax

... @[annotation](javascript:call_link\('abencds_annotations_syntax.htm'\)) ...

Effect

Specifies an [annotation](javascript:call_link\('abencds_annotation_glosry.htm'\) "Glossary Entry") [annotation](javascript:call_link\('abencds_annotations_syntax.htm'\)) as an extension annotation in the definition of a [CDS view extension](javascript:call_link\('abencds_view_extend_glosry.htm'\) "Glossary Entry") before the statement [EXTEND VIEW](javascript:call_link\('abencds_extend_view.htm'\)). The character @ must be placed in front of the name annotation of the annotation. The annotation should be defined as a CDS object in a [CDS annotation definition](javascript:call_link\('abencds_anno_definition_glosry.htm'\) "Glossary Entry") and the annotation definition annotation [@Scope](javascript:call_link\('abencds_f1_define_anno_annos.htm'\)) should be specified here using the value #EXTEND\_VIEW.

The following tables show the possible [ABAP annotations](javascript:call_link\('abenabap_annotation_glosry.htm'\) "Glossary Entry") that can be specified and their meanings. The ABAP annotations are evaluated by the ABAP runtime framework for every CDS object. Annotations with other identifiers are usually [framework-specific annotations](javascript:call_link\('abencds_annotations_frmwrk.htm'\)). These are not evaluated by the ABAP runtime framework but by other SAP frameworks instead.

The first column of the table shows the (possibly structured) name annotation of an ABAP annotation and the second column shows its meaning. The third column shows the possible [annotation values](javascript:call_link\('abenannotation_value_glosry.htm'\) "Glossary Entry"). The fourth column shows the default value which is used if the annotation is not used at all. The fifth column shows the default value set implicitly for value in accordance with the [annotation definition](javascript:call_link\('abencds_anno_definition_glosry.htm'\) "Glossary Entry") if the annotation is specified without a value. If nothing is specified for the annotation value, the annotation should be specified without a value.

AbapCatalog Annotations ¬† 

Technical settings of a CDS view extension.

Annotation

Meaning

Annotation Values

Default Value if Not Used

Default Value if Used Without Value

AbapCatalog.sqlViewAppendName

Name of the DDIC append view of the CDS view extension

Character string with a maximum of 16 characters consisting of letters, numbers and underscores and that starts with a [namespace prefix](javascript:call_link\('abenname_space_prefix_glosry.htm'\) "Glossary Entry").

\-

\-

Hints

-   Each definition of a CDS view extension must contain the ABAP annotation AbapCatalog.sqlViewAppendName that defines the name of the DDIC append view in ABAP Dictionary.
-   The name given to the DDIC append view can no longer be changed after the CDS view extension is transported into a follow-on system.


---


## ABAP - Keyword Documentation / ABAP - Core Data Services (ABAP CDS) / Obsolete CDS Language Elements / Obsolete CDS Entities / ABAP CDS - DDIC-Based Entities (Obsolete) / ABAP CDS - DDIC-Based Views (Obsolete) / CDS DDL - DEFINE VIEW ddic_based / CDS DDL - DDIC-Based View, SELECT / CDS DDL - DDIC-Based View, SELECT, Operands and Expressions / CDS DDL - DDIC-Based View, Expressions / CDS DDL - DDIC-Based View, Built-In Functions / CDS DDL - DDIC-Based View, sql_functions

**Files**: 4 | **Difficulty**: advanced

# ABAP - Keyword Documentation / ABAP - Core Data Services (ABAP CDS) / Obsolete CDS Language Elements / Obsolete CDS Entities / ABAP CDS - DDIC-Based Entities (Obsolete) / ABAP CDS - DDIC-Based Views (Obsolete) / CDS DDL - DEFINE VIEW ddic_based / CDS DDL - DDIC-Based View, SELECT / CDS DDL - DDIC-Based View, SELECT, Operands and Expressions / CDS DDL - DDIC-Based View, path_expr

Included pages: 9



**üìñ Source**: [abencds_f1_extend_view_annotations.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_f1_extend_view_annotations.htm)

### abencds_path_expression_v1.htm

> **üìñ Official SAP Documentation**: [abencds_path_expression_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_path_expression_v1.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [Obsolete CDS Language Elements](javascript:call_link\('abencds_obsolete.htm'\))¬†‚Üí¬† [Obsolete CDS Entities](javascript:call_link\('abencds_entities_obsolete.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Entities (Obsolete)](javascript:call_link\('abencds_ddic_entity.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Views (Obsolete)](javascript:call_link\('abencds_v1_views.htm'\))¬†‚Üí¬† [CDS DDL - DEFINE VIEW ddic\_based](javascript:call_link\('abencds_define_view_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT](javascript:call_link\('abencds_select_statement_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT, Operands and Expressions](javascript:call_link\('abencds_operands_and_expr_v1.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20DDL%20-%20DDIC-Based%20View%2C%20path_expr%2C%20ABENCDS_PATH_EXPRESSION_V1%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improve
ment:)

CDS DDL - DDIC-Based View, path\_expr

Syntax

... *\[*source.*\]*\_assoc1*\[* [parameters](javascript:call_link\('abencds_select_parameters_v1.htm'\))*\]**\[*[attributes](javascript:call_link\('abencds_path_expr_attr_v1.htm'\))*\]*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† *\[*.\_assoc2*\[* [parameters](javascript:call_link\('abencds_select_parameters_v1.htm'\))*\]**\[* [attributes](javascript:call_link\('abencds_path_expr_attr_v1.htm'\))*\]* ... *\]* ...

Effect

Specifies an [SQL path expression](javascript:call_link\('abensql_path_expression_glosry.htm'\) "Glossary Entry") that can be used in a SELECT statement of a [CDS DDIC-based view (obsolete)](javascript:call_link\('abencds_v1_view_glosry.htm'\) "Glossary Entry"). A path expression of the [CDS DDL](javascript:call_link\('abencds_ddl_glosry.htm'\) "Glossary Entry") is a sequence of [CDS associations](javascript:call_link\('abencds_association_glosry.htm'\) "Glossary Entry") separated by periods (.) whose names are specified using \_assoc1, \_assoc2, and so on. The name of the CDS entity source in which the first CDS association is defined or exposed can be specified in front of this CDS association. The first CDS association of a path expression must be either:

-   Defined in the current CDS view.
-   Exposed as an element of the SELECT list or of the [element list](javascript:call_link\('abencds_f1_hiera_element_list.htm'\)) in a CDS view or CDS hierarchy that is a data source of the current view.

All further CDS associations must be exposed in the [association target](javascript:call_link\('abenassociation_target_glosry.htm'\) "Glossary Entry") of the directly prefixed CDS association in the path expression. It is not possible to use a CDS association in a path expression that is defined in a [CDS abstract entity](javascript:call_link\('abencds_abstract_entity_glosry.htm'\) "Glossary Entry") or in a [CDS custom entity](javascript:call_link\('abencds_custom_entity_glosry.htm'\) "Glossary Entry").

[attributes](javascript:call_link\('abencds_path_expr_attr_v1.htm'\)) can be used to specify attributes in angle brackets after every CDS association. These attributes define the following further properties of this section of the path expression:

-   [Cardinality](javascript:call_link\('abencds_path_expr_card_v1.htm'\))
-   [Join type](javascript:call_link\('abencds_path_expr_jointype_v1.htm'\)) implemented when used
-   [Filter conditions](javascript:call_link\('abencds_path_expression_filter_v1.htm'\))

If the [association target](javascript:call_link\('abenassociation_target_glosry.htm'\) "Glossary Entry") of a specified [CDS association](javascript:call_link\('abencds_association_glosry.htm'\) "Glossary Entry") is a CDS entity with [input parameters](javascript:call_link\('abencds_f1_param.htm'\)), then actual parameters must be passed to them, using [parameters](javascript:call_link\('abencds_select_parameters_v1.htm'\)) after the name \_assoc. No parameters can be specified for a CDS association exposed as an [element](javascript:call_link\('abencds_select_list_entry_v1.htm'\)) of a [SELECT](javascript:call_link\('abencds_select_list_v1.htm'\)) list.

Use of Path Expressions

Path expressions can be used as follows in the CDS DDL in ABAP CDS:

-   They can [expose](javascript:call_link\('abencds_select_list_association_v1.htm'\)) their final CDS associations as [elements](javascript:call_link\('abencds_select_list_entry_v1.htm'\)) of [SELECT lists](javascript:call_link\('abencds_select_list_v1.htm'\)) for use in other CDS entities or in ABAP SQL.
-   Path expressions with CDS associations whose [association target](javascript:call_link\('abenassociation_target_glosry.htm'\) "Glossary Entry") is not an [CDS abstract entity](javascript:call_link\('abencds_abstract_entity_glosry.htm'\) "Glossary Entry") or a [CDS custom entity](javascript:call_link\('abencds_custom_entity_glosry.htm'\) "Glossary Entry") can be used as follows:
    
    -   To specify the [association target](javascript:call_link\('abenassociation_target_glosry.htm'\) "Glossary Entry") of the final CDS association as the data source [data\_source](javascript:call_link\('abencds_data_source_v1.htm'\)) after [FROM](javascript:call_link\('abencds_select_statement_v1.htm'\)). The path expression represents an [inner join](javascript:call_link\('abeninner_join_glosry.htm'\) "Glossary Entry") by default.
    -   To specify an element .element of the [association target](javascript:call_link\('abenassociation_target_glosry.htm'\) "Glossary Entry") of the last CDS association as an [element](javascript:call_link\('abencds_select_list_entry_v1.htm'\)) of a [SELECT list](javascript:call_link\('abencds_select_list_v1.htm'\)). The path expression represents a [left outer join](javascript:call_link\('abenleft_outer_join_glosry.htm'\) "Glossary Entry") by default.
    -   To specify an element .element of the [association target](javascript:call_link\('abenassociation_target_glosry.htm'\) "Glossary Entry") of the last CDS association as an operand of [WHERE](javascript:call_link\('abencds_where_clause_v1.htm'\)), [HAVING](javascript:call_link\('abencds_having_clause_v1.htm'\)), or [WHEN](javascript:call_link\('abencds_searched_case_expr_v1.htm'\)) conditions. The path expression represents a [left outer join](javascript:call_link\('abenleft_outer_join_glosry.htm'\) "Glossary Entry") by default.
    -   To specify an element .element of the [association target](javascript:call_link\('abenassociation_target_glosry.htm'\) "Glossary Entry") of the last CDS association after GROUP BY. The path expression represents a [left outer join](javascript:call_link\('abenleft_outer_join_glosry.htm'\) "Glossary Entry") by default.
    -   To specify an element .element of the [association target](javascript:call_link\('abenassociation_target_glosry.htm'\) "Glossary Entry") of the last CDS association as an operand of an [aggregate expression](javascript:call_link\('abencds_aggregate_functions_v1.htm'\)), a [built-in function](javascript:call_link\('abencds_builtin_functions_v1.htm'\)), a [case expression](javascript:call_link\('abencds_case_expression_v1.htm'\)), or a [cast expression](javascript:call_link\('abencds_cast_expression_v1.htm'\)). The path expression represents a [left outer join](javascript:call_link\('abenleft_outer_join_glosry.htm'\) "Glossary Entry") by default.
    
    In the case of self associations in which the [association target](javascript:call_link\('abenassociation_target_glosry.htm'\) "Glossary Entry") is the same as the [association source](javascript:call_link\('abenassociation_source_glosry.htm'\) "Glossary Entry"), these usages are not possible in the CDS entity where they are defined.
    

For a non-aggregated element of a SELECT list that contains [aggregate expressions](javascript:call_link\('abencds_aggregate_functions_v1.htm'\)), as well as in a WHERE and HAVING condition, the result of the path expression must be unique. This means that the [cardinality](javascript:call_link\('abencardinality_glosry.htm'\) "Glossary Entry") of all CDS associations used must be either to-one or the path expression can contain only [filter conditions](javascript:call_link\('abencds_path_expr_attr_v1.htm'\)) that are declared as unique using the addition 1:.

The following is evaluated when a CDS entity is accessed using a path expression:

-   The joins defined by the CDS associations, from left to right.
-   All other conditions of the CDS entities involved.

The path expression addresses the full result of this evaluation or a single element .element.

Hints

-   The most simple path expression is the name of a single CDS association.
-   For joins of CDS associations used in path expressions, note that their left side is always the CDS entity that exposes the CDS association. This applies particularly to CDS associations that are exposed in data sources of CDS entities and passed on.
-   CDS DDL path expressions can also be used in the ABAP [CDS DCL](javascript:call_link\('abencds_dcl_glosry.htm'\) "Glossary Entry") of ABAP CDS to specify [conditions](javascript:call_link\('abencds_dcl_role_conditions.htm'\)).
-   A CDS association whose [association target](javascript:call_link\('abenassociation_target_glosry.htm'\) "Glossary Entry") does not expose a CDS association cannot be followed by any further associations in a path expression. More specifically, for CDS associations whose association targets are DDIC database tables or DDIC views, no further CDS associations can be specified in a path expression.
-   When the CDS associations of the path expressions of a view are implemented as joins, they are mapped to as few join expressions as possible. The [ABAP annotation](javascript:call_link\('abenabap_annotation_glosry.htm'\) "Glossary Entry") [AbapCatalog.compiler.compareFilter](javascript:call_link\('abencds_view_anno_v1.htm'\)) can serve as support. It this annotation is used with the value true, it guarantees that CDS associations with semantically identical [filter conditions](javascript:call_link\('abencds_path_expr_attr_v1.htm'\)) do not produce differing join expressions.
-   Path expressions with CDS associations whose [association target](javascript:call_link\('abenassociation_target_glosry.htm'\) "Glossary Entry") is a [non-SQL CDS entity](javascript:call_link\('abencds_non_sql_entity_glosry.htm'\) "Glossary Entry") cannot be used anywhere where they could produce instances of join expressions.

Example

The following DDIC-based view contains the simple path expression \_scarr\[inner\].carrname in its SELECT list. The attribute [INNER](javascript:call_link\('abencds_path_expr_attr_v1.htm'\)) controls the [join type](javascript:call_link\('abenjoin_type_glosry.htm'\) "Glossary Entry"). The class CL\_DEMO\_FROM\_JOIN\_TO\_ASSCTN demonstrates that this view returns the same result as a directly programmed inner join in ABAP CDS or in ABAP SQL.

@AbapCatalog.sqlViewName: 'DEMO\_CDS\_JN2'
@AccessControl.authorizationCheck: #NOT\_REQUIRED
define view demo\_cds\_join2
¬†¬†as select from spfli
¬†¬†association to scarr as \_scarr on
¬†¬†¬†¬†spfli.carrid = \_scarr.carrid
¬†¬†{
¬†¬†¬†¬†\_scarr\[inner\].carrname as carrier,
¬†¬†¬†¬†spfli.connid¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as flight,
¬†¬†¬†¬†spfli.cityfrom¬†¬†¬†¬†¬†¬†¬†¬† as departure,
¬†¬†¬†¬†spfli.cityto¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as arrival
¬†¬†}

Example

This example shows three CDS views, demo\_sales\_order\_old, demo\_business\_partner\_old1, and demo\_invoice. The CDS view demo\_invoice uses its own CDS association and CDS associations from the other two views in path expressions:

-   The CDS association demo\_sales\_order of the CDS view demo\_business\_partner\_old1 is specified as a data source after FROM. A filter condition guarantees that only certain orders can be used as data sources.
-   The CDS association invoice\_header, which is defined by the view demo\_invoice itself, is used in a path expression as an operand in the WHERE condition.
-   The CDS association note\_header of the CDS view demo\_sales\_order\_old is addressed using the alternative name bpa in demo\_business\_partner\_old1 and defined as an element of the SELECT list. This means this CDS association can also be used in CDS views that use demo\_invoice as a data source.
    
    @AbapCatalog.sqlViewName: 'DEMO\_SO\_VW\_A'
    define view DEMO\_SALES\_ORDER\_OLD as
    ¬†¬†select from snwd\_so
    ¬†¬†¬†¬†¬†¬†¬†¬† association \[0..1\] to snwd\_text\_key as \_note\_header
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† on snwd\_so.note\_guid = \_note\_header.node\_key
    ¬†¬†{ \* } // Include all fields from snwd\_text\_key
    
    @AbapCatalog.sqlViewName: 'DEMO\_BPA\_VW\_OLD1'
    define view DEMO\_BUSINESS\_PARTNER\_OLD1 as
    ¬†¬†select from snwd\_bpa
    ¬†¬†¬†¬†¬†¬†¬†¬† association \[0..\*\] to DEMO\_SALES\_ORDER\_OLD
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† on snwd\_bpa.node\_key = DEMO\_SALES\_ORDER\_OLD.BUYER\_GUID
    ¬†¬†{ \* }
    
    ¬†¬†@AbapCatalog.sqlViewName: 'SALESO\_INV\_VW'
    ¬†¬†define view demo\_invoice as
    ¬†¬†¬†¬†select from¬†¬†
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†/\* Association "sales\_order" with filter as data source \*/
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† DEMO\_BUSINESS\_PARTNER\_OLD1.DEMO\_SALES\_ORDER\_OLD\[
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LIFECYCLE\_STATUS <> 'C' and LIFECYCLE\_STATUS <> 'X'\]
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as bpa\_so //alias for data source
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† /\* Association only used in this view definition \*/
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† association \[0..1\] to snwd\_so\_inv\_head as \_invoice\_header¬†¬†
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† on bpa\_so.NODE\_KEY = \_invoice\_header.so\_guid
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†{ key bpa\_so.NODE\_KEY, //Field from ON-condition in\_invoice\_header
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†bpa\_so.SO\_ID,
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†bpa\_so.NOTE\_GUID, //Field from ON-condition in note\_header
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†bpa\_so.LIFECYCLE\_STATUS,
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†/\* Association is not exposed, but its element \*/
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\_invoice\_header.dunning\_level,
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†/\* Association from data source is exposed here \*/
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†bpa\_so.\_note\_header }
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†/\* Path expression in WHERE clause \*/
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where \_invoice\_header.dunning\_level > '0';
    

Executable Example

[Path Expressions, Use in the SELECT List](javascript:call_link\('abenpath_expr_in_colspec_abexa.htm'\))

Continue
[CDS DDL - DDIC-Based View, path\_expr, attributes](javascript:call_link\('abencds_path_expr_attr_v1.htm'\))
![Example](exa.gif "Example") [CDS DDL - DDIC-Based View, Joins of Associations](javascript:call_link\('abencds_assoc_join_v1_abexa.htm'\))



**üìñ Source**: [abencds_path_expression_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_path_expression_v1.htm)

### abencds_path_expr_attr_v1.htm

> **üìñ Official SAP Documentation**: [abencds_path_expr_attr_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_path_expr_attr_v1.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [Obsolete CDS Language Elements](javascript:call_link\('abencds_obsolete.htm'\))¬†‚Üí¬† [Obsolete CDS Entities](javascript:call_link\('abencds_entities_obsolete.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Entities (Obsolete)](javascript:call_link\('abencds_ddic_entity.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Views (Obsolete)](javascript:call_link\('abencds_v1_views.htm'\))¬†‚Üí¬† [CDS DDL - DEFINE VIEW ddic\_based](javascript:call_link\('abencds_define_view_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT](javascript:call_link\('abencds_select_statement_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT, Operands and Expressions](javascript:call_link\('abencds_operands_and_expr_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, path\_expr](javascript:call_link\('abencds_path_expression_v1.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20DDL%20-%20DDIC-Based%20View%2C%20path_expr%2C%20attributes%2C%20ABENCDS_PATH_EXPR_ATTR_V1%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%
20for%20improvement:)

CDS DDL - DDIC-Based View, path\_expr, attributes

Syntax

... \[ [*\[*1*|*\*:*\]*](javascript:call_link\('abencds_path_expr_card_v1.htm'\)) [*\[*INNER*|**{*LEFT OUTER*}**\]*](javascript:call_link\('abencds_path_expr_jointype_v1.htm'\)) [*\[*WHERE*\]* *\[*cds\_cond*\]*](javascript:call_link\('abencds_path_expression_filter_v1.htm'\)) \] ...

Effect

For every CDS association [\_assoc](javascript:call_link\('abencds_association_v1.htm'\)) of a [path expression](javascript:call_link\('abencds_path_expression_v1.htm'\)) of a [CDS DDIC-based view (obsolete)](javascript:call_link\('abencds_v1_view_glosry.htm'\) "Glossary Entry"), attributes for this part of the path expression can be defined in square brackets \[ \]. The following attributes can be specified:

-   With [1*|*\*:](javascript:call_link\('abencds_path_expr_card_v1.htm'\)), the [cardinality](javascript:call_link\('abencardinality_glosry.htm'\) "Glossary Entry") of the section can be specified.
-   With [INNER*|**{*LEFT OUTER*}*](javascript:call_link\('abencds_path_expr_jointype_v1.htm'\)) the [join type](javascript:call_link\('abenjoin_type_glosry.htm'\) "Glossary Entry") can be specified.
-   With [*\[*WHERE*\]* cds\_cond](javascript:call_link\('abencds_path_expression_filter_v1.htm'\)) a filter condition cds\_cond can be specified.

Continue
[CDS DDL - DDIC-Based View, path\_expr, Cardinality](javascript:call_link\('abencds_path_expr_card_v1.htm'\))
[CDS DDL - DDIC-Based View, path\_expr, join\_type](javascript:call_link\('abencds_path_expr_jointype_v1.htm'\))
[CDS DDL - DDIC-Based View, path\_expr, Filter](javascript:call_link\('abencds_path_expression_filter_v1.htm'\))



**üìñ Source**: [abencds_path_expr_attr_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_path_expr_attr_v1.htm)

### abencds_path_expr_card_v1.htm

> **üìñ Official SAP Documentation**: [abencds_path_expr_card_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_path_expr_card_v1.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [Obsolete CDS Language Elements](javascript:call_link\('abencds_obsolete.htm'\))¬†‚Üí¬† [Obsolete CDS Entities](javascript:call_link\('abencds_entities_obsolete.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Entities (Obsolete)](javascript:call_link\('abencds_ddic_entity.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Views (Obsolete)](javascript:call_link\('abencds_v1_views.htm'\))¬†‚Üí¬† [CDS DDL - DEFINE VIEW ddic\_based](javascript:call_link\('abencds_define_view_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT](javascript:call_link\('abencds_select_statement_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT, Operands and Expressions](javascript:call_link\('abencds_operands_and_expr_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, path\_expr](javascript:call_link\('abencds_path_expression_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, path\_expr, attributes](javascript:call_link\('abencds_path_expr_attr_v1.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20DDL%20-%20DDIC-Based%20View%2C%20path_expr%2C%20Cardinality%2C%20ABENCDS_PATH_EXPR_CARD_V1%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion
%20for%20improvement:)

CDS DDL - DDIC-Based View, path\_expr, Cardinality

Syntax

...¬†¬†1*|*\*: ...

Effect

Specifies the [cardinality](javascript:call_link\('abencardinality_glosry.htm'\) "Glossary Entry") of the current CDS association:

-   If the attribute 1: is specified, the current CDS association is declared as unique.
-   If the attribute \*: is specified, the current CDS association is declared as non-unique.

The addition 1: makes it possible to use filter conditions in path expressions, which are used in [WHERE](javascript:call_link\('abencds_where_clause_v1.htm'\)) clauses or [HAVING](javascript:call_link\('abencds_having_clause_v1.htm'\)) clauses. In a clause like this, it overwrites the [cardinality](javascript:call_link\('abencardinality_glosry.htm'\) "Glossary Entry") of the [CDS association](javascript:call_link\('abencds_association_v1.htm'\)). (The variant of the path expression can, however, be affected differently on certain database systems.)

The addition 1: or \*: cannot be specified as the only addition in square brackets.

Hint

The addition 1: prevents a syntax error if a path specified with filter conditions or with a non-unique cardinality is used in a [WHERE](javascript:call_link\('abencds_where_clause_v1.htm'\)) clause or [HAVING](javascript:call_link\('abencds_having_clause_v1.htm'\)) clause. However, at runtime, there is no check to validate whether the condition achieves the required unique cardinality.



**üìñ Source**: [abencds_path_expr_card_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_path_expr_card_v1.htm)

### abencds_path_expr_jointype_v1.htm

> **üìñ Official SAP Documentation**: [abencds_path_expr_jointype_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_path_expr_jointype_v1.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [Obsolete CDS Language Elements](javascript:call_link\('abencds_obsolete.htm'\))¬†‚Üí¬† [Obsolete CDS Entities](javascript:call_link\('abencds_entities_obsolete.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Entities (Obsolete)](javascript:call_link\('abencds_ddic_entity.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Views (Obsolete)](javascript:call_link\('abencds_v1_views.htm'\))¬†‚Üí¬† [CDS DDL - DEFINE VIEW ddic\_based](javascript:call_link\('abencds_define_view_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT](javascript:call_link\('abencds_select_statement_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT, Operands and Expressions](javascript:call_link\('abencds_operands_and_expr_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, path\_expr](javascript:call_link\('abencds_path_expression_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, path\_expr, attributes](javascript:call_link\('abencds_path_expr_attr_v1.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20DDL%20-%20DDIC-Based%20View%2C%20path_expr%2C%20join_type%2C%20ABENCDS_PATH_EXPR_JOINTYPE_V1%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggesti
on%20for%20improvement:)

CDS DDL - DDIC-Based View, path\_expr, join\_type

Syntax

... INNER*|**{*LEFT OUTER*}* ...

Effect

Defines the [join type](javascript:call_link\('abenjoin_type_glosry.htm'\) "Glossary Entry") with which the current CDS association is implemented:

-   INNER determines an [inner join](javascript:call_link\('abeninner_join_glosry.htm'\) "Glossary Entry")
-   LEFT OUTER determines a [left outer join](javascript:call_link\('abenleft_outer_join_glosry.htm'\) "Glossary Entry")

If the join type is not specified explicitly, the type depends on the place where the path expression is used:

-   After [FROM](javascript:call_link\('abencds_select_statement_v1.htm'\)), it is an inner join (INNER JOIN)
-   In all other locations, it is a left outer join (LEFT OUTER JOIN)

Hint

In the DDL source text editor of the [ADT](javascript:call_link\('abenadt_glosry.htm'\) "Glossary Entry"), you can view the configuration of the join in the display of the generated SQL DDL statement.

Executable Example

[Joins of CDS Associations](javascript:call_link\('abencds_assoc_join_v1_abexa.htm'\))



**üìñ Source**: [abencds_path_expr_jointype_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_path_expr_jointype_v1.htm)

### abencds_path_expression_filter_v1.htm

> **üìñ Official SAP Documentation**: [abencds_path_expression_filter_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_path_expression_filter_v1.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [Obsolete CDS Language Elements](javascript:call_link\('abencds_obsolete.htm'\))¬†‚Üí¬† [Obsolete CDS Entities](javascript:call_link\('abencds_entities_obsolete.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Entities (Obsolete)](javascript:call_link\('abencds_ddic_entity.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Views (Obsolete)](javascript:call_link\('abencds_v1_views.htm'\))¬†‚Üí¬† [CDS DDL - DEFINE VIEW ddic\_based](javascript:call_link\('abencds_define_view_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT](javascript:call_link\('abencds_select_statement_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT, Operands and Expressions](javascript:call_link\('abencds_operands_and_expr_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, path\_expr](javascript:call_link\('abencds_path_expression_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, path\_expr, attributes](javascript:call_link\('abencds_path_expr_attr_v1.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20DDL%20-%20DDIC-Based%20View%2C%20path_expr%2C%20Filter%2C%20ABENCDS_PATH_EXPRESSION_FILTER_V1%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggest
ion%20for%20improvement:)

CDS DDL - DDIC-Based View, path\_expr, Filter

Syntax

... *\[*WHERE*\]* [cds\_cond](javascript:call_link\('abencds_conditional_expression_v1.htm'\)) ...

Effect

[Filter condition](javascript:call_link\('abenfilter_condition_glosry.htm'\) "Glossary Entry") for the current CDS association. If the join type is explicitly defined with [INNER*|**{*LEFT OUTER*}*](javascript:call_link\('abencds_path_expr_jointype_v1.htm'\)), the addition WHERE must be specified explicitly. If this is not the case, WHERE must not be specified.

A filter condition is a condition [cds\_cond](javascript:call_link\('abencds_conditional_expression_v1.htm'\)) implemented as an expanded condition for the join when resolving the CDS association with the join in question. For the operands, [general](javascript:call_link\('abencds_cond_expr_operands_v1.htm'\)) and [special rules](javascript:call_link\('abencds_cond_expr_filter_v1.htm'\)) apply when specifying the condition.

If no filter condition is specified in the path expression, any default filter condition specified for the [CDS association](javascript:call_link\('abencds_association_v1.htm'\)) is used.

Hint

In most cases, a filter condition modifies the join expression defined for a CDS association of a path expression on the database. This means that a separate join expression is defined for each CDS association with a filter condition by default. This is not necessary, however, if a CDS association is used more than once and the same filter condition is specified. This is why the [ABAP annotation](javascript:call_link\('abenabap_annotation_glosry.htm'\) "Glossary Entry") [AbapCatalog.compiler.compareFilter](javascript:call_link\('abencds_view_anno_v1.htm'\)) can be used to configure whether the filter conditions of multiple CDS associations are compared semantically for the path expressions defined as joins when a view is activated. If the filter condition matches, the associated join expression is created only once, which generally improves performance. In most cases, it is best to use the annotation and it is automatically proposed when creating a CDS view in the ADT. The result sets of the two configurations can, however, differ.

Example

The following three views contain path expressions with filter conditions in their SELECT list that are implemented as join expressions upon activation.

@AbapCatalog.sqlViewName: 'DEMOCDSASSFI1'
@AbapCatalog.compiler.compareFilter: true
@AccessControl.authorizationCheck: #NOT\_REQUIRED
define view demo\_cds\_assoc\_filter1¬†¬†
¬†¬† as select from
¬†¬†¬†¬†demo\_join1
¬†¬†¬†¬†association to Demo\_Cds\_Assoc\_Join2 as \_demo\_join2 on
¬†¬†¬†¬†¬†¬†\_demo\_join2.d = demo\_join1.d
¬†¬†¬†¬†{
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '1' \].d¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as d\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬† ¬†inner where d = '1' \].e¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as e\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '1' \].\_demo\_join3\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†inner where i = '2' \].i as i\_3,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '1' \].\_demo\_join3\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†inner where i = '2' \].j as j\_3
¬†¬†¬†¬†}

@AbapCatalog.sqlViewName: 'DEMOCDSASSFI2'
@AbapCatalog.compiler.compareFilter: false
@AccessControl.authorizationCheck: #NOT\_REQUIRED
define view demo\_cds\_assoc\_filter2¬†¬†
¬†¬† as select from
¬†¬†¬†¬†demo\_join1
¬†¬†¬†¬†association to Demo\_Cds\_Assoc\_Join2 as \_demo\_join2 on
¬†¬†¬†¬†¬†¬†\_demo\_join2.d = demo\_join1.d
¬†¬†¬†¬†{
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '1' \].d¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as d\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬† ¬†inner where d = '1' \].e¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as e\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '1' \].\_demo\_join3\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†inner where i = '2' \].i as i\_3,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '1' \].\_demo\_join3\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†inner where i = '2' \].j as j\_3
¬†¬†¬†¬†}

@AbapCatalog.sqlViewName: 'DEMOCDSASSFI3'
@AbapCatalog.compiler.compareFilter: true
@AccessControl.authorizationCheck: #NOT\_REQUIRED
define view demo\_cds\_assoc\_filter3¬†¬†
¬†¬† as select from
¬†¬†¬†¬†demo\_join1
¬†¬†¬†¬†association to Demo\_Cds\_Assoc\_Join2 as \_demo\_join2 on
¬†¬†¬†¬†¬†¬†\_demo\_join2.d = demo\_join1.d
¬†¬†¬†¬†{
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '1' \].d¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as d\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬† ¬†inner where d = '2' \].e¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as e\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '3' \].\_demo\_join3\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†inner where i = '5' \].i as i\_3,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '4' \].\_demo\_join3\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†inner where i = '6' \].j as j\_3
¬†¬†¬†¬†}

In the first view, the annotation AbapCatalog.compiler.compareFilter has the recommended value true. The conditions are detected as identical and the variants of the path expressions on a SAP HANA database looks something like this:

CREATE VIEW "DEMOCDSASSFI1" AS SELECT
¬†¬†"=A0"."D" AS "D\_2",
¬†¬†"=A0"."E" AS "E\_2",
¬†¬†"=A1"."I" AS "I\_3",
¬†¬†"=A1"."J" AS "J\_3"
FROM (
¬†¬†"DEMO\_JOIN1" "DEMO\_JOIN1" INNER JOIN "DEMO\_CDS\_ASJO2" "=A0" ON (
¬†¬†¬†¬†"=A0"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†"=A0"."D" = N'1'
¬†¬†)
) INNER JOIN "DEMO\_JOIN3" "=A1" ON (
¬†¬†"=A1"."L" = "=A0"."D" AND
¬†¬†"=A1"."I" = N'2'
)

In the second view, AbapCatalog.compiler.compareFilter has the value false and a join expression is defined for each CDS association of the path expressions regardless of the identical conditions. This means that this variant looks like the variant of the third views (in which all conditions are different):

CREATE VIEW "DEMOCDSASSFI2" AS SELECT
¬†¬†"=A0"."D" AS "D\_2",
¬†¬†"=A1"."E" AS "E\_2",
¬†¬†"=A3"."I" AS "I\_3",
¬†¬†"=A5"."J" AS "J\_3"
FROM (
¬†¬†(
¬†¬†¬†¬†(
¬†¬†¬†¬†¬†¬†(
¬†¬†¬†¬†¬†¬†¬†¬†(
¬† ¬†¬†¬†¬†¬†¬†¬†¬†"DEMO\_JOIN1" "DEMO\_JOIN1" INNER JOIN "DEMO\_CDS\_ASJO2" "=A0" ON (
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A0"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A0"."D" = N'1'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†¬†¬†¬†¬†) INNER JOIN "DEMO\_CDS\_ASJO2" "=A1" ON (
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A1"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A1"."D" = N'1'
¬†¬†¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†¬†¬†) INNER JOIN "DEMO\_CDS\_ASJO2" "=A2" ON (
¬†¬†¬†¬†¬†¬†¬†¬†"=A2"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†¬†¬†¬†¬†"=A2"."D" = N'1'
¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†) INNER JOIN "DEMO\_JOIN3" "=A3" ON (
¬†¬†¬†¬†¬†¬†"=A3"."L" = "=A2"."D" AND
¬†¬†¬†¬†¬†¬†"=A3"."I" = N'2'
¬†¬†¬†¬†)
¬†¬†) INNER JOIN "DEMO\_CDS\_ASJO2" "=A4" ON (
¬†¬†¬†¬†"=A4"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†"=A4"."D" = N'1'
¬†¬†)
) INNER JOIN "DEMO\_JOIN3" "=A5" ON (
¬†¬†"=A5"."L" = "=A4"."D" AND
¬†¬†"=A5"."I" = N'2'
)
CREATE VIEW "DEMOCDSASSFI3" AS SELECT
¬†¬†"=A0"."D" AS "D\_2",
¬†¬†"=A1"."E" AS "E\_2",
¬†¬†"=A3"."I" AS "I\_3",
¬†¬†"=A5"."J" AS "J\_3"
FROM (
¬†¬†(
¬†¬†¬†¬†(
¬†¬†¬†¬†¬†¬†(
¬†¬†¬†¬†¬†¬†¬†¬†(
¬† ¬†¬†¬†¬†¬†¬†¬†¬†"DEMO\_JOIN1" "DEMO\_JOIN1" INNER JOIN "DEMO\_CDS\_ASJO2" "=A0" ON (
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A0"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A0"."D" = N'1'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†¬†¬†¬†¬†) INNER JOIN "DEMO\_CDS\_ASJO2" "=A1" ON (
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A1"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A1"."D" = N'2'
¬†¬†¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†¬†¬†) INNER JOIN "DEMO\_CDS\_ASJO2" "=A2" ON (
¬†¬†¬†¬†¬†¬†¬†¬†"=A2"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†¬†¬†¬†¬†"=A2"."D" = N'3'
¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†) INNER JOIN "DEMO\_JOIN3" "=A3" ON (
¬†¬†¬†¬†¬†¬†"=A3"."L" = "=A2"."D" AND
¬†¬†¬†¬†¬†¬†"=A3"."I" = N'5'
¬†¬†¬†¬†)
¬†¬†) INNER JOIN "DEMO\_CDS\_ASJO2" "=A4" ON (
¬†¬†¬†¬†"=A4"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†"=A4"."D" = N'4'
¬†¬†)
) INNER JOIN "DEMO\_JOIN3" "=A5" ON (
¬†¬†"=A5"."L" = "=A4"."D" AND
¬†¬†"=A5"."I" = N'6'
)

Continue
[CDS DDL - DDIC-Based View, cds\_cond, Filter](javascript:call_link\('abencds_cond_expr_filter_v1.htm'\))



**üìñ Source**: [abencds_path_expression_filter_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_path_expression_filter_v1.htm)

### abencds_cond_expr_filter_v1.htm

> **üìñ Official SAP Documentation**: [abencds_cond_expr_filter_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_cond_expr_filter_v1.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [Obsolete CDS Language Elements](javascript:call_link\('abencds_obsolete.htm'\))¬†‚Üí¬† [Obsolete CDS Entities](javascript:call_link\('abencds_entities_obsolete.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Entities (Obsolete)](javascript:call_link\('abencds_ddic_entity.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Views (Obsolete)](javascript:call_link\('abencds_v1_views.htm'\))¬†‚Üí¬† [CDS DDL - DEFINE VIEW ddic\_based](javascript:call_link\('abencds_define_view_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT](javascript:call_link\('abencds_select_statement_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT, Operands and Expressions](javascript:call_link\('abencds_operands_and_expr_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, path\_expr](javascript:call_link\('abencds_path_expression_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, path\_expr, attributes](javascript:call_link\('abencds_path_expr_attr_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, path\_expr, Filter](javascript:call_link\('abencds_path_expression_filter_v1.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20DDL%20-%20DDIC-Based%20View%2C%20cds_cond%2C%20Filter%2C%20ABENCDS_COND_EXPR_FILTER_V1%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

CDS DDL - DDIC-Based View, cds\_cond, Filter

Rules for conditions [cds\_cond](javascript:call_link\('abencds_conditional_expression_v1.htm'\)) in a

[filter condition](javascript:call_link\('abencds_path_expression_filter_v1.htm'\)) of a [path expression](javascript:call_link\('abencds_path_expression_v1.htm'\)) of a [CDS DDIC-based view (obsolete)](javascript:call_link\('abencds_v1_view_glosry.htm'\) "Glossary Entry"):

-   All relational operators are allowed.
-   lhs expects a [field](javascript:call_link\('abencds_field_v1.htm'\)) of the [association target](javascript:call_link\('abenassociation_target_glosry.htm'\) "Glossary Entry") of the current [CDS association](javascript:call_link\('abencds_association_glosry.htm'\) "Glossary Entry").
-   A [field](javascript:call_link\('abencds_field_v1.htm'\)) of the [association target](javascript:call_link\('abenassociation_target_glosry.htm'\) "Glossary Entry") of the current [CDS association](javascript:call_link\('abencds_association_v1.htm'\)), a [literal](javascript:call_link\('abencds_literal_v1.htm'\)) with optional domain prefix, a [parameter](javascript:call_link\('abencds_parameter_v1.htm'\)), a [session variable](javascript:call_link\('abencds_session_variable_v1.htm'\)), or a [built-in function](javascript:call_link\('abencds_builtin_functions_v1.htm'\)) can be specified for rhs (with the exception of the operator [LIKE](javascript:call_link\('abencds_cond_expr_like_v1.htm'\))).
-   No path expressions or other expressions or function calls can be specified.



**üìñ Source**: [abencds_cond_expr_filter_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_cond_expr_filter_v1.htm)

### abencds_path_expression_filter_v1.htm

> **üìñ Official SAP Documentation**: [abencds_path_expression_filter_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_path_expression_filter_v1.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [Obsolete CDS Language Elements](javascript:call_link\('abencds_obsolete.htm'\))¬†‚Üí¬† [Obsolete CDS Entities](javascript:call_link\('abencds_entities_obsolete.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Entities (Obsolete)](javascript:call_link\('abencds_ddic_entity.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Views (Obsolete)](javascript:call_link\('abencds_v1_views.htm'\))¬†‚Üí¬† [CDS DDL - DEFINE VIEW ddic\_based](javascript:call_link\('abencds_define_view_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT](javascript:call_link\('abencds_select_statement_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT, Operands and Expressions](javascript:call_link\('abencds_operands_and_expr_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, path\_expr](javascript:call_link\('abencds_path_expression_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, path\_expr, attributes](javascript:call_link\('abencds_path_expr_attr_v1.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20DDL%20-%20DDIC-Based%20View%2C%20path_expr%2C%20Filter%2C%20ABENCDS_PATH_EXPRESSION_FILTER_V1%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggest
ion%20for%20improvement:)

CDS DDL - DDIC-Based View, path\_expr, Filter

Syntax

... *\[*WHERE*\]* [cds\_cond](javascript:call_link\('abencds_conditional_expression_v1.htm'\)) ...

Effect

[Filter condition](javascript:call_link\('abenfilter_condition_glosry.htm'\) "Glossary Entry") for the current CDS association. If the join type is explicitly defined with [INNER*|**{*LEFT OUTER*}*](javascript:call_link\('abencds_path_expr_jointype_v1.htm'\)), the addition WHERE must be specified explicitly. If this is not the case, WHERE must not be specified.

A filter condition is a condition [cds\_cond](javascript:call_link\('abencds_conditional_expression_v1.htm'\)) implemented as an expanded condition for the join when resolving the CDS association with the join in question. For the operands, [general](javascript:call_link\('abencds_cond_expr_operands_v1.htm'\)) and [special rules](javascript:call_link\('abencds_cond_expr_filter_v1.htm'\)) apply when specifying the condition.

If no filter condition is specified in the path expression, any default filter condition specified for the [CDS association](javascript:call_link\('abencds_association_v1.htm'\)) is used.

Hint

In most cases, a filter condition modifies the join expression defined for a CDS association of a path expression on the database. This means that a separate join expression is defined for each CDS association with a filter condition by default. This is not necessary, however, if a CDS association is used more than once and the same filter condition is specified. This is why the [ABAP annotation](javascript:call_link\('abenabap_annotation_glosry.htm'\) "Glossary Entry") [AbapCatalog.compiler.compareFilter](javascript:call_link\('abencds_view_anno_v1.htm'\)) can be used to configure whether the filter conditions of multiple CDS associations are compared semantically for the path expressions defined as joins when a view is activated. If the filter condition matches, the associated join expression is created only once, which generally improves performance. In most cases, it is best to use the annotation and it is automatically proposed when creating a CDS view in the ADT. The result sets of the two configurations can, however, differ.

Example

The following three views contain path expressions with filter conditions in their SELECT list that are implemented as join expressions upon activation.

@AbapCatalog.sqlViewName: 'DEMOCDSASSFI1'
@AbapCatalog.compiler.compareFilter: true
@AccessControl.authorizationCheck: #NOT\_REQUIRED
define view demo\_cds\_assoc\_filter1¬†¬†
¬†¬† as select from
¬†¬†¬†¬†demo\_join1
¬†¬†¬†¬†association to Demo\_Cds\_Assoc\_Join2 as \_demo\_join2 on
¬†¬†¬†¬†¬†¬†\_demo\_join2.d = demo\_join1.d
¬†¬†¬†¬†{
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '1' \].d¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as d\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬† ¬†inner where d = '1' \].e¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as e\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '1' \].\_demo\_join3\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†inner where i = '2' \].i as i\_3,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '1' \].\_demo\_join3\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†inner where i = '2' \].j as j\_3
¬†¬†¬†¬†}

@AbapCatalog.sqlViewName: 'DEMOCDSASSFI2'
@AbapCatalog.compiler.compareFilter: false
@AccessControl.authorizationCheck: #NOT\_REQUIRED
define view demo\_cds\_assoc\_filter2¬†¬†
¬†¬† as select from
¬†¬†¬†¬†demo\_join1
¬†¬†¬†¬†association to Demo\_Cds\_Assoc\_Join2 as \_demo\_join2 on
¬†¬†¬†¬†¬†¬†\_demo\_join2.d = demo\_join1.d
¬†¬†¬†¬†{
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '1' \].d¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as d\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬† ¬†inner where d = '1' \].e¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as e\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '1' \].\_demo\_join3\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†inner where i = '2' \].i as i\_3,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '1' \].\_demo\_join3\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†inner where i = '2' \].j as j\_3
¬†¬†¬†¬†}

@AbapCatalog.sqlViewName: 'DEMOCDSASSFI3'
@AbapCatalog.compiler.compareFilter: true
@AccessControl.authorizationCheck: #NOT\_REQUIRED
define view demo\_cds\_assoc\_filter3¬†¬†
¬†¬† as select from
¬†¬†¬†¬†demo\_join1
¬†¬†¬†¬†association to Demo\_Cds\_Assoc\_Join2 as \_demo\_join2 on
¬†¬†¬†¬†¬†¬†\_demo\_join2.d = demo\_join1.d
¬†¬†¬†¬†{
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '1' \].d¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as d\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬† ¬†inner where d = '2' \].e¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as e\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '3' \].\_demo\_join3\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†inner where i = '5' \].i as i\_3,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†inner where d = '4' \].\_demo\_join3\[¬†¬†
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†inner where i = '6' \].j as j\_3
¬†¬†¬†¬†}

In the first view, the annotation AbapCatalog.compiler.compareFilter has the recommended value true. The conditions are detected as identical and the variants of the path expressions on a SAP HANA database looks something like this:

CREATE VIEW "DEMOCDSASSFI1" AS SELECT
¬†¬†"=A0"."D" AS "D\_2",
¬†¬†"=A0"."E" AS "E\_2",
¬†¬†"=A1"."I" AS "I\_3",
¬†¬†"=A1"."J" AS "J\_3"
FROM (
¬†¬†"DEMO\_JOIN1" "DEMO\_JOIN1" INNER JOIN "DEMO\_CDS\_ASJO2" "=A0" ON (
¬†¬†¬†¬†"=A0"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†"=A0"."D" = N'1'
¬†¬†)
) INNER JOIN "DEMO\_JOIN3" "=A1" ON (
¬†¬†"=A1"."L" = "=A0"."D" AND
¬†¬†"=A1"."I" = N'2'
)

In the second view, AbapCatalog.compiler.compareFilter has the value false and a join expression is defined for each CDS association of the path expressions regardless of the identical conditions. This means that this variant looks like the variant of the third views (in which all conditions are different):

CREATE VIEW "DEMOCDSASSFI2" AS SELECT
¬†¬†"=A0"."D" AS "D\_2",
¬†¬†"=A1"."E" AS "E\_2",
¬†¬†"=A3"."I" AS "I\_3",
¬†¬†"=A5"."J" AS "J\_3"
FROM (
¬†¬†(
¬†¬†¬†¬†(
¬†¬†¬†¬†¬†¬†(
¬†¬†¬†¬†¬†¬†¬†¬†(
¬† ¬†¬†¬†¬†¬†¬†¬†¬†"DEMO\_JOIN1" "DEMO\_JOIN1" INNER JOIN "DEMO\_CDS\_ASJO2" "=A0" ON (
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A0"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A0"."D" = N'1'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†¬†¬†¬†¬†) INNER JOIN "DEMO\_CDS\_ASJO2" "=A1" ON (
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A1"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A1"."D" = N'1'
¬†¬†¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†¬†¬†) INNER JOIN "DEMO\_CDS\_ASJO2" "=A2" ON (
¬†¬†¬†¬†¬†¬†¬†¬†"=A2"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†¬†¬†¬†¬†"=A2"."D" = N'1'
¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†) INNER JOIN "DEMO\_JOIN3" "=A3" ON (
¬†¬†¬†¬†¬†¬†"=A3"."L" = "=A2"."D" AND
¬†¬†¬†¬†¬†¬†"=A3"."I" = N'2'
¬†¬†¬†¬†)
¬†¬†) INNER JOIN "DEMO\_CDS\_ASJO2" "=A4" ON (
¬†¬†¬†¬†"=A4"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†"=A4"."D" = N'1'
¬†¬†)
) INNER JOIN "DEMO\_JOIN3" "=A5" ON (
¬†¬†"=A5"."L" = "=A4"."D" AND
¬†¬†"=A5"."I" = N'2'
)
CREATE VIEW "DEMOCDSASSFI3" AS SELECT
¬†¬†"=A0"."D" AS "D\_2",
¬†¬†"=A1"."E" AS "E\_2",
¬†¬†"=A3"."I" AS "I\_3",
¬†¬†"=A5"."J" AS "J\_3"
FROM (
¬†¬†(
¬†¬†¬†¬†(
¬†¬†¬†¬†¬†¬†(
¬†¬†¬†¬†¬†¬†¬†¬†(
¬† ¬†¬†¬†¬†¬†¬†¬†¬†"DEMO\_JOIN1" "DEMO\_JOIN1" INNER JOIN "DEMO\_CDS\_ASJO2" "=A0" ON (
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A0"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A0"."D" = N'1'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†¬†¬†¬†¬†) INNER JOIN "DEMO\_CDS\_ASJO2" "=A1" ON (
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A1"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"=A1"."D" = N'2'
¬†¬†¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†¬†¬†) INNER JOIN "DEMO\_CDS\_ASJO2" "=A2" ON (
¬†¬†¬†¬†¬†¬†¬†¬†"=A2"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†¬†¬†¬†¬†"=A2"."D" = N'3'
¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†) INNER JOIN "DEMO\_JOIN3" "=A3" ON (
¬†¬†¬†¬†¬†¬†"=A3"."L" = "=A2"."D" AND
¬†¬†¬†¬†¬†¬†"=A3"."I" = N'5'
¬†¬†¬†¬†)
¬†¬†) INNER JOIN "DEMO\_CDS\_ASJO2" "=A4" ON (
¬†¬†¬†¬†"=A4"."D" = "DEMO\_JOIN1"."D" AND
¬†¬†¬†¬†"=A4"."D" = N'4'
¬†¬†)
) INNER JOIN "DEMO\_JOIN3" "=A5" ON (
¬†¬†"=A5"."L" = "=A4"."D" AND
¬†¬†"=A5"."I" = N'6'
)

Continue
[CDS DDL - DDIC-Based View, cds\_cond, Filter](javascript:call_link\('abencds_cond_expr_filter_v1.htm'\))



**üìñ Source**: [abencds_path_expression_filter_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_path_expression_filter_v1.htm)

### abencds_path_expr_attr_v1.htm

> **üìñ Official SAP Documentation**: [abencds_path_expr_attr_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_path_expr_attr_v1.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [Obsolete CDS Language Elements](javascript:call_link\('abencds_obsolete.htm'\))¬†‚Üí¬† [Obsolete CDS Entities](javascript:call_link\('abencds_entities_obsolete.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Entities (Obsolete)](javascript:call_link\('abencds_ddic_entity.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Views (Obsolete)](javascript:call_link\('abencds_v1_views.htm'\))¬†‚Üí¬† [CDS DDL - DEFINE VIEW ddic\_based](javascript:call_link\('abencds_define_view_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT](javascript:call_link\('abencds_select_statement_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT, Operands and Expressions](javascript:call_link\('abencds_operands_and_expr_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, path\_expr](javascript:call_link\('abencds_path_expression_v1.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20DDL%20-%20DDIC-Based%20View%2C%20path_expr%2C%20attributes%2C%20ABENCDS_PATH_EXPR_ATTR_V1%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%
20for%20improvement:)

CDS DDL - DDIC-Based View, path\_expr, attributes

Syntax

... \[ [*\[*1*|*\*:*\]*](javascript:call_link\('abencds_path_expr_card_v1.htm'\)) [*\[*INNER*|**{*LEFT OUTER*}**\]*](javascript:call_link\('abencds_path_expr_jointype_v1.htm'\)) [*\[*WHERE*\]* *\[*cds\_cond*\]*](javascript:call_link\('abencds_path_expression_filter_v1.htm'\)) \] ...

Effect

For every CDS association [\_assoc](javascript:call_link\('abencds_association_v1.htm'\)) of a [path expression](javascript:call_link\('abencds_path_expression_v1.htm'\)) of a [CDS DDIC-based view (obsolete)](javascript:call_link\('abencds_v1_view_glosry.htm'\) "Glossary Entry"), attributes for this part of the path expression can be defined in square brackets \[ \]. The following attributes can be specified:

-   With [1*|*\*:](javascript:call_link\('abencds_path_expr_card_v1.htm'\)), the [cardinality](javascript:call_link\('abencardinality_glosry.htm'\) "Glossary Entry") of the section can be specified.
-   With [INNER*|**{*LEFT OUTER*}*](javascript:call_link\('abencds_path_expr_jointype_v1.htm'\)) the [join type](javascript:call_link\('abenjoin_type_glosry.htm'\) "Glossary Entry") can be specified.
-   With [*\[*WHERE*\]* cds\_cond](javascript:call_link\('abencds_path_expression_filter_v1.htm'\)) a filter condition cds\_cond can be specified.

Continue
[CDS DDL - DDIC-Based View, path\_expr, Cardinality](javascript:call_link\('abencds_path_expr_card_v1.htm'\))
[CDS DDL - DDIC-Based View, path\_expr, join\_type](javascript:call_link\('abencds_path_expr_jointype_v1.htm'\))
[CDS DDL - DDIC-Based View, path\_expr, Filter](javascript:call_link\('abencds_path_expression_filter_v1.htm'\))



**üìñ Source**: [abencds_path_expr_attr_v1.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_path_expr_attr_v1.htm)

### abencds_assoc_join_v1_abexa.htm

> **üìñ Official SAP Documentation**: [abencds_assoc_join_v1_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_assoc_join_v1_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Core Data Services (ABAP CDS)](javascript:call_link\('abencds.htm'\))¬†‚Üí¬† [Obsolete CDS Language Elements](javascript:call_link\('abencds_obsolete.htm'\))¬†‚Üí¬† [Obsolete CDS Entities](javascript:call_link\('abencds_entities_obsolete.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Entities (Obsolete)](javascript:call_link\('abencds_ddic_entity.htm'\))¬†‚Üí¬† [ABAP CDS - DDIC-Based Views (Obsolete)](javascript:call_link\('abencds_v1_views.htm'\))¬†‚Üí¬† [CDS DDL - DEFINE VIEW ddic\_based](javascript:call_link\('abencds_define_view_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT](javascript:call_link\('abencds_select_statement_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, SELECT, Operands and Expressions](javascript:call_link\('abencds_operands_and_expr_v1.htm'\))¬†‚Üí¬† [CDS DDL - DDIC-Based View, path\_expr](javascript:call_link\('abencds_path_expression_v1.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CDS%20DDL%20-%20DDIC-Based%20View%2C%20Joins%20of%20Associations%2C%20ABENCDS_ASSOC_JOIN_V1_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestio
n%20for%20improvement:)

CDS DDL - DDIC-Based View, Joins of Associations

This example demonstrates how path expressions are transformed to joins in ABAP CDS.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_cds\_assoc\_joins DEFINITION
¬†¬†PUBLIC
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†CREATE PUBLIC .
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main
¬†¬†¬†¬†¬†¬†¬†¬†REDEFINITION .
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†TYPES wa1 TYPE demo\_join1 .
¬†¬†¬†¬†TYPES wa2 TYPE demo\_join2 .
¬†¬†¬†¬†TYPES wa3 TYPE demo\_join3 .
¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†BEGIN OF wa.
¬†¬†¬†¬†¬†¬†¬†¬†INCLUDE TYPE wa1 AS wa1 RENAMING WITH SUFFIX \_1.
¬†¬†¬†¬†¬†¬†¬†¬†INCLUDE TYPE wa2 AS wa2 RENAMING WITH SUFFIX \_2.
¬†¬†¬†¬†¬†¬†¬†¬†INCLUDE TYPE wa3 AS wa3 RENAMING WITH SUFFIX \_3.
¬†¬†TYPES END OF wa .
¬†¬†¬†¬†METHODS fill\_tables .
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_cds\_assoc\_joins IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA:
¬†¬†¬†¬†¬†¬†path\_outer TYPE TABLE OF demo\_cds\_assoc\_join1\_o WITH DEFAULT KEY,
¬†¬†¬†¬†¬†¬†path\_inner TYPE TABLE OF demo\_cds\_assoc\_join1\_i WITH DEFAULT KEY,
¬†¬†¬†¬†¬†¬†join\_outer TYPE TABLE OF wa WITH DEFAULT KEY,
¬†¬†¬†¬†¬†¬†join\_inner TYPE TABLE OF wa WITH DEFAULT KEY.
¬†¬†¬†¬†fill\_tables( ).
¬†¬†¬†¬†out->begin\_section( 'CDS Views'
¬†¬†¬†¬†¬†¬†)->begin\_section( 'Path with \[left outer\]' ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_assoc\_join1\_o
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @path\_outer.
¬†¬†¬†¬†SORT path\_outer.
¬†¬†¬†¬†out->write( path\_outer
¬†¬†¬†¬†¬†¬†)->next\_section( 'Path with \[inner\]' ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_assoc\_join1\_i
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @path\_inner.
¬†¬†¬†¬†SORT path\_inner.
¬†¬†¬†¬†out->write( path\_inner
¬†¬†¬†¬†¬†¬†)->end\_section( )->end\_section(
¬†¬†¬†¬†¬†¬†)->begin\_section( \`ABAP SQL Joins\`
¬†¬†¬†¬†¬†¬†)->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†\`LEFT OUTER JOINs\` ).
¬†¬†¬†¬†SELECT FROM
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† demo\_cds\_assoc\_join1\_o AS t1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LEFT OUTER JOIN
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† demo\_cds\_assoc\_join2 AS t2 ON t2~d = t1~d\_1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LEFT OUTER JOIN
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† demo\_join3 AS t3 ON t3~l = t2~d
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FIELDS t1~a\_1,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t1~b\_1,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t1~c\_1,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t1~d\_1,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t2~d AS d\_2,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t2~e AS e\_2,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t2~f AS f\_2,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t2~g AS g\_2,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t2~h AS h\_2,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t3~i AS i\_3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t3~j AS j\_3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t3~k AS k\_3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t3~l AS l\_3
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO CORRESPONDING FIELDS OF TABLE @join\_outer.
¬†¬†¬†¬†SORT join\_outer.
¬†¬†¬†¬†out->write( join\_outer
¬†¬†¬†¬†¬†¬†)->next\_section( \`INNER JOINs\` ).
¬†¬†¬†¬†SELECT FROM
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† demo\_cds\_assoc\_join1\_i AS t1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INNER JOIN
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† demo\_cds\_assoc\_join2 AS t2 ON t2~d = t1~d\_1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INNER JOIN
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† demo\_join3 AS t3 ON t3~l = t2~d
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FIELDS t1~a\_1,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t1~b\_1,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t1~c\_1,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t1~d\_1,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t2~d AS d\_2,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t2~e AS e\_2,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t2~f AS f\_2,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t2~g AS g\_2,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t2~h AS h\_2,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t3~i AS i\_3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t3~j AS j\_3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t3~k AS k\_3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†t3~l AS l\_3
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO CORRESPONDING FIELDS OF TABLE @join\_inner.
¬†¬†¬†¬†SORT join\_inner.
¬†¬†¬†¬†out->write( join\_inner ).
¬†¬†¬†¬†ASSERT path\_inner = join\_inner.
¬†¬†¬†¬†ASSERT path\_outer = join\_outer.
¬†¬†ENDMETHOD.
¬†¬†METHOD fill\_tables.
¬†¬†¬†¬†out->begin\_section( \`Database Tables\` ).
¬†¬†¬†¬†DELETE FROM demo\_join1.
¬†¬†¬†¬†INSERT demo\_join1 FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( a = 'a1' b = 'b1' c = 'c1' d = 'uu' )
¬†¬†¬†¬†¬†¬†( a = 'a2' b = 'b2' c = 'c2' d = 'uu' )
¬†¬†¬†¬†¬†¬†( a = 'a3' b = 'b3' c = 'c3' d = 'vv' )
¬†¬†¬†¬†¬†¬†( a = 'a4' b = 'b4' c = 'c4' d = 'ww' ) ) ).
¬†¬†¬†¬†SELECT \* FROM demo\_join1 INTO TABLE @FINAL(itab1).
¬†¬†¬†¬†DELETE FROM demo\_join2.
¬†¬†¬†¬†INSERT demo\_join2 FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( d = 'uu' e = 'e1' f = 'f1' g = 'g1'¬†¬†h = 'h1' )
¬†¬†¬†¬†¬†¬†( d = 'ww' e = 'e2' f = 'f2' g = 'g2'¬†¬†h = 'h2' )
¬†¬†¬†¬†¬†¬†( d = 'xx' e = 'e3' f = 'f3' g = 'g3'¬†¬†h = 'h3' ) ) ).
¬†¬†¬†¬†SELECT \* FROM demo\_join2 INTO TABLE @FINAL(itab2).
¬†¬†¬†¬†DELETE FROM demo\_join3.
¬†¬†¬†¬†INSERT demo\_join3 FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( i = 'i1' j = 'j1' k = 'k1' l = 'vv' )
¬†¬†¬†¬†¬†¬†( i = 'i2' j = 'j2' k = 'k2' l = 'vv' )
¬†¬†¬†¬†¬†¬†( i = 'i3' j = 'j3' k = 'k3' l = 'ww' ) ) ).
¬†¬†¬†¬†SELECT \* FROM demo\_join3 INTO TABLE @FINAL(itab3).
¬†¬†¬†¬†out->begin\_section( \`demo\_join1\`
¬†¬†¬†¬†¬†¬†)->write( itab1
¬†¬†¬†¬†¬†¬†)->next\_section( \`demo\_join2\`
¬†¬†¬†¬†¬†¬†)->write( itab2
¬†¬†¬†¬†¬†¬†)->next\_section( \`demo\_join3\`
¬†¬†¬†¬†¬†¬†)->write( itab3
¬†¬†¬†¬†¬†¬†)->end\_section(
¬†¬†¬†¬†¬†¬†)->end\_section( ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This example demonstrates which joins are implemented for [path expressions](javascript:call_link\('abencds_path_expression_v1.htm'\)) containing [CDS associations](javascript:call_link\('abencds_association_glosry.htm'\) "Glossary Entry"). The following two CDS views - DEMO\_CDS\_ASSOC\_JOIN1\_O and DEMO\_CDS\_ASSOC\_JOIN1\_I - access their own association \_demo\_join2 in path expressions of the SELECT list and the [exposed](javascript:call_link\('abencds_select_list_association_v1.htm'\)) CDS association \_demo\_join3 of DEMO\_CDS\_ASSOC\_JOIN2.

@AbapCatalog.sqlViewName: 'DEMO\_CDS\_ASJO1O'
@AccessControl.authorizationCheck: #NOT\_REQUIRED
define view Demo\_Cds\_Assoc\_Join1\_o
¬†¬†as select from demo\_join1
¬†¬†association to Demo\_Cds\_Assoc\_Join2¬†¬†
¬†¬†¬†¬†as \_demo\_join2¬†¬†
¬†¬†¬†¬†on \_demo\_join2.d = demo\_join1.d
{
¬†¬†key demo\_join1.a¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as a\_1,
¬†¬†¬†¬†¬†¬†demo\_join1.b¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as b\_1,
¬†¬†¬†¬†¬†¬†demo\_join1.c¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as c\_1,
¬†¬†¬†¬†¬†¬†demo\_join1.d¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as d\_1,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[left outer\].d¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as d\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[left outer\].e¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as e\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[left outer\].f¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as f\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[left outer\].g¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as g\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[left outer\].h¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as h\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[left outer\].\_demo\_join3\[left outer\].i as i\_3,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[left outer\].\_demo\_join3\[left outer\].j as j\_3,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[left outer\].\_demo\_join3\[left outer\].k as k\_3,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[left outer\].\_demo\_join3\[left outer\].l as l\_3
}

@AbapCatalog.sqlViewName: 'DEMO\_CDS\_ASJO1I'
@AccessControl.authorizationCheck: #NOT\_REQUIRED
define view Demo\_Cds\_Assoc\_Join1\_i
¬†¬†as select from demo\_join1
¬†¬†association to Demo\_Cds\_Assoc\_Join2 as \_demo\_join2
¬†¬†¬†¬†on \_demo\_join2.d = demo\_join1.d
{
¬†¬†key demo\_join1.a¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as a\_1,
¬†¬†¬†¬†¬†¬†demo\_join1.b¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as b\_1,
¬†¬†¬†¬†¬†¬†demo\_join1.c¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as c\_1,
¬†¬†¬†¬†¬†¬†demo\_join1.d¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as d\_1,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[inner\].d¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as d\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[inner\].e¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as e\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[inner\].f¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as f\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[inner\].g¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as g\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[inner\].h¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†as h\_2,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[inner\].\_demo\_join3\[inner\].i as i\_3,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[inner\].\_demo\_join3\[inner\].j as j\_3,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[inner\].\_demo\_join3\[inner\].k as k\_3,
¬†¬†¬†¬†¬†¬†\_demo\_join2\[inner\].\_demo\_join3\[inner\].l as l\_3
}

@AbapCatalog.sqlViewName: 'DEMO\_CDS\_ASJO2'
@AccessControl.authorizationCheck: #NOT\_REQUIRED
define view Demo\_Cds\_Assoc\_Join2
¬†¬†as select from demo\_join2
¬†¬†association \[\*\] to demo\_join3 as \_demo\_join3
¬†¬†¬†¬†on \_demo\_join3.l = demo\_join2.d
{
¬†¬†¬†¬†¬†¬†\_demo\_join3,
¬†¬†key demo\_join2.d,
¬†¬†¬†¬†¬†¬†demo\_join2.e,
¬†¬†¬†¬†¬†¬†demo\_join2.f,
¬†¬†¬†¬†¬†¬†demo\_join2.g,
¬†¬†¬†¬†¬†¬†demo\_join2.h
}

[LEFT OUTER](javascript:call_link\('abencds_path_expr_jointype_v1.htm'\)) and [INNER](javascript:call_link\('abencds_path_expr_jointype_v1.htm'\)) are explicitly specified in the path expressions.

-   LEFT OUTER specifies the implementation of CDS associations as a left outer join, which is the default behavior at these places.
-   INNER specifies the implementation of CDS associations as an inner join, which overwrites the default behavior at these places.

In the DDL source code editor of the [ADT](javascript:call_link\('abenadt_glosry.htm'\) "Glossary Entry"), the respective join can be seen in the display of the generated SQL DDL statement.

This example shows that the result sets of the CDS views DEMO\_CDS\_ASSOC\_JOIN1\_O and DEMO\_CDS\_ASSOC\_JOIN1\_I are identical to the result sets of ABAP SQL statements [SELECT](javascript:call_link\('abapselect.htm'\)) with explicitly programmed left outer and inner joins. The CDS views and the DDIC database table DEMO\_JOIN3 above are accessed. All involved database tables are filled with sample data. With an inner join, unlike a left outer join, only the row is returned for which the join condition t3~l = t2~d is fulfilled.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP-Managed Database Objects / Access to ABAP-Managed Database Objects

**Files**: 4 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abencds_assoc_join_v1_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencds_assoc_join_v1_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Overview / ABAP SQL - ABAP SQL Engine

**Files**: 8 | **Difficulty**: beginner

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Overview / ABAP SQL - Table Buffering

**Files**: 9 | **Difficulty**: beginner

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Overview / ABAP SQL - Release-Dependent Syntax Check Modes

**Files**: 12 | **Difficulty**: beginner

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Operands sql_elem / ABAP SQL - literal

**Files**: 3 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Operands sql_elem / ABAP SQL - @( expr )

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Expressions sql_exp / sql_exp - sql_elem

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Expressions sql_exp / sql_exp - sql_func / ABAP SQL - Built-In Functions sql_func / sql_func - SQL Functions / sql_func - String Functions

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Expressions sql_exp / sql_exp - sql_func / ABAP SQL - Built-In Functions sql_func / sql_func - SQL Functions / sql_func - Coalesce Function

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Expressions sql_exp / sql_exp - sql_func / ABAP SQL - Built-In Functions sql_func / sql_func - Special Functions / sql_func - Conversion Functions

**Files**: 4 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Expressions sql_exp / sql_exp - sql_arith

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Expressions sql_exp / sql_exp - sql_cast

**Files**: 3 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Expressions sql_exp / sql_exp - sql_string

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Expressions sql_exp / sql_exp - sql_case

**Files**: 7 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Expressions sql_exp / sql_exp - sql_agg / sql_agg - agg_func

**Files**: 3 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Expressions sql_exp / sql_exp - sql_agg / sql_agg - Examples of Aggregate Expressions

**Files**: 5 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Expressions sql_exp / sql_exp - sql_win / sql_win - Examples of Window Expressions

**Files**: 8 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Expressions sql_exp / sql_exp - sql_null

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Conditions sql_cond / sql_cond - rel_exp for Statements / sql_cond - Comparison Operators

**Files**: 3 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Conditions sql_cond / sql_cond - rel_exp for Statements / sql_cond - IN ( ... )

**Files**: 3 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Conditions sql_cond / sql_cond - rel_exp for Statements / sql_cond - subquery_clauses

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Path Expressions sql_path

**Files**: 5 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Operands and Expressions / ABAP SQL - SQL Parameter Passing sql_para

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / SELECT

**Files**: 4 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / WITH / WITH, ASSOCIATIONS

**Files**: 3 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / WITH / WITH, Examples

**Files**: 7 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / OPEN CURSOR

**Files**: 5 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / UNION, INTERSECT, EXCEPT / UNION, Examples

**Files**: 6 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / UNION, INTERSECT, EXCEPT / INTERSECT, Examples

**Files**: 5 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / UNION, INTERSECT, EXCEPT / EXCEPT, Examples

**Files**: 5 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / SELECT, clauses / SELECT, FROM / SELECT, FROM data_source / SELECT, FROM hierarchy_data / SELECT, FROM hierarchy / SELECT, FROM HIERARCHY

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / SELECT, clauses / SELECT, FROM / SELECT, FROM data_source / SELECT, FROM hierarchy_data / SELECT, FROM hierarchy_navigator / SELECT, FROM hierarchy_aggregate_navigator / SELECT, FROM hierarchy_descendants_aggregate

**Files**: 3 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / SELECT, clauses / SELECT, FROM / SELECT, FROM data_source / SELECT, FROM hierarchy_data / SELECT, FROM hierarchy_navigator / SELECT, FROM hierarchy_aggregate_navigator / SELECT, hierarchy_ancestors_aggregate

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / SELECT, clauses / SELECT, FROM / SELECT, FROM data_source / SELECT, FROM @itab

**Files**: 4 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / SELECT, clauses / SELECT, FROM / SELECT, FROM JOIN

**Files**: 3 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / SELECT, clauses / SELECT, select_clause

**Files**: 5 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / SELECT, clauses / SELECT, WHERE

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / SELECT, clauses / SELECT, GROUP BY

**Files**: 6 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / SELECT, clauses / SELECT, ORDER BY

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / SELECT, clauses / SELECT, INTO, APPENDING / SELECT, INTO target

**Files**: 4 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / SELECT, clauses / SELECT, INTO, APPENDING / SELECT, indicators

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / SELECT, clauses / SELECT, INTO, APPENDING / SELECT, LOB Handles

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Read Access / SELECT, clauses / SELECT, abap_options

**Files**: 7 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Write Access / INSERT dbtab / INSERT dbtab, source

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Write Access / UPDATE dbtab / UPDATE dbtab, source / UPDATE dbtab, set indicators

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Write Access / UPDATE dbtab / UPDATE dbtab, source / UPDATE dbtab, set_expression

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Write Access / MODIFY dbtab

**Files**: 3 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Write Access / DELETE dbtab

**Files**: 3 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Write Access / INSERT, UPDATE, MODIFY, DELETE, target

**Files**: 5 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - Streaming and Locators

**Files**: 10 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP SQL / ABAP SQL - System Classes

**Files**: 4 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP Managed Database Procedures (AMDP) / AMDP - Methods / METHOD, BY DATABASE PROCEDURE, FUNCTION, GRAPH WORKSPACE / AMDP - SQLScript for the SAP HANA Database

**Files**: 2 | **Difficulty**: advanced

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP Managed Database Procedures (AMDP) / AMDP - Macros

**Files**: 3 | **Difficulty**: advanced

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Native SQL / ABAP Database Connectivity (ADBC) / ADBC - CL_SQL_STATEMENT

**Files**: 5 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Native SQL / Embedded Native SQL (EXEC SQL) / EXEC SQL - Examples

Included pages: 3



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenexec_sql_abexas.htm

> **üìñ Official SAP Documentation**: [abenexec_sql_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Examples%2C%20ABENEXEC_SQL_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

EXEC SQL - Examples

-   [EXEC SQL - Use](javascript:call_link\('abennative_sql_abexa.htm'\))
-   [EXEC SQL - Access to Database Functions](javascript:call_link\('abenexec_sql_db_function_abexa.htm'\))

Continue
![Example](exa.gif "Example") [EXEC SQL - Use](javascript:call_link\('abennative_sql_abexa.htm'\))
![Example](exa.gif "Example") [EXEC SQL - Access to Database Functions](javascript:call_link\('abenexec_sql_db_function_abexa.htm'\))



**üìñ Source**: [abenexec_sql_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_abexas.htm)

### abennative_sql_abexa.htm

> **üìñ Official SAP Documentation**: [abennative_sql_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abennative_sql_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬† [EXEC SQL - Examples](javascript:call_link\('abenexec_sql_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Use%2C%20ABENNATIVE_SQL_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

EXEC SQL - Use

This example demonstrates the use of embedded static Native SQL.

Source Code ¬† 

REPORT demo\_exec\_sql.
"This program uses platform dependent Native SQL.
"It may not work for every database system.
PARAMETERS: p\_create RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_insert RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_select RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_drop¬†¬† RADIOBUTTON GROUP grp.
SELECTION-SCREEN SKIP.
PARAMETERS¬†¬†p\_key TYPE i DEFAULT 1.
CLASS native\_sql DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†CLASS-DATA: wa1 TYPE c LENGTH 10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa2 TYPE c LENGTH 10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†err TYPE REF TO cx\_sy\_native\_sql\_error.
¬†¬†¬†¬†CLASS-METHODS: create RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† insert RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† select RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† drop¬†¬† RAISING cx\_sy\_native\_sql\_error.
ENDCLASS.
CLASS native\_sql IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†IF p\_create = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†create( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Create was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_insert = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†insert( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Insert was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_select = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Select was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_drop¬†¬† = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†drop( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Drop was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO err.
¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE err TYPE 'I' DISPLAY LIKE 'E'.
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
¬†¬†METHOD create.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†CREATE TABLE abap\_docu\_demo\_mytab (
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† val1 char(10) NOT NULL,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† val2 char(10) NOT NULL,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† PRIMARY KEY (val1)¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†ENDEXEC.
¬†¬†ENDMETHOD.
¬†¬†METHOD insert.
¬†¬†¬†¬†DO 100 TIMES.
¬†¬†¬†¬†¬†¬†wa1 = sy-index.
¬†¬†¬†¬†¬†¬†wa2 = sy-index \*\* 2.
¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†INSERT INTO abap\_docu\_demo\_mytab VALUES (:wa1, :wa2)
¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†¬†¬†RAISE EXCEPTION TYPE cx\_sy\_native\_sql\_error
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†textid = cx\_sy\_native\_sql\_error=>key\_already\_exists.
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDDO.
¬†¬†ENDMETHOD.
¬†¬†METHOD select.
¬†¬†¬†¬†DATA: msg TYPE c LENGTH 30,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†key TYPE c LENGTH 10.
¬†¬†¬†¬†p\_key = cl\_abap\_dyn\_prg=>escape\_quotes( CONV string( p\_key ) ).
¬†¬†¬†¬†key = p\_key.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†SELECT val1, val2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO :wa1, :wa2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM abap\_docu\_demo\_mytab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE val1 = :key
¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†IF sy-subrc = 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Result:' TO msg,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† wa1 TO msg+10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† wa2 TO msg+20.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†msg = 'No entry found'.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†MESSAGE msg TYPE 'I'.
¬†¬†ENDMETHOD.
¬†¬†METHOD drop.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†DROP TABLE abap\_docu\_demo\_mytab
¬†¬†¬†¬†ENDEXEC.
¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†native\_sql=>main( ).

Description ¬† 

The program is the static equivalent of the executable [ADBC](javascript:call_link\('abenadbc_dml_ddl_abexa.htm'\)) example. The name of the database abap\_docu\_demo\_mytab cannot be modified. Instead of passing the SQL statements dynamically to methods of the class CL\_SQL\_STATEMENT, they are specified statically between EXEC and ENDEXEC. Attempts to insert existing rows can only be detected using sy-subrc and the corresponding SQL exception must be raised explicitly.



**üìñ Source**: [abennative_sql_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abennative_sql_abexa.htm)

### abenexec_sql_db_function_abexa.htm

> **üìñ Official SAP Documentation**: [abenexec_sql_db_function_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_db_function_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬† [EXEC SQL - Examples](javascript:call_link\('abenexec_sql_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Access%20to%20Database%20Functions%2C%20ABENEXEC_SQL_DB_FUNCTION_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20
improvement:)

EXEC SQL - Access to Database Functions

This example demonstrates how a database function is accessed using static Native SQL.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_exec\_sql\_db\_function DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_exec\_sql\_db\_function IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†DROP FUNCTION abap\_docu\_demo\_scalar\_function;
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†CREATE FUNCTION
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_docu\_demo\_scalar\_function
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( IN p1 NVARCHAR(5), IN p2 NVARCHAR(5) )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURNS r NVARCHAR(10) AS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†BEGIN
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†r = concat(p1,p2);
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†END;
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO DATA(exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†DELETE FROM demo\_expressions.
¬†¬†¬†¬†INSERT demo\_expressions
¬†¬†¬†¬†¬†¬†FROM TABLE @( VALUE #( ( id = 'X' char1 = 'xxxxxaaaaa' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( id = 'Y' char1 = 'yyyyybbbbb' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( id = 'Z' char1 = 'zzzzzccccc' ) ) ).
¬†¬†¬†¬†DATA in1 TYPE c LENGTH 5 VALUE 'yyyyy'.
¬†¬†¬†¬†DATA in2 TYPE c LENGTH 5 VALUE 'bbbbb'.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = in1
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = in2 )->request( ).
¬†¬†¬†¬†DATA result TYPE demo\_expressions-id.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from demo\_expressions
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where char1 = abap\_docu\_demo\_scalar\_function(:in1,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:in2)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :result
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO exc.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†out->write( result ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

After [EXEC SQL](javascript:call_link\('abapexec.htm'\)), this example creates a scalar [database function](javascript:call_link\('abendatabase_function_glosry.htm'\) "Glossary Entry") with two input parameters and uses this function in the WHERE condition of a SELECT statement.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Native SQL / ABAP Database Connectivity (ADBC) / ADBC - CL_SQL_CONNECTION

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Native SQL / Embedded Native SQL (EXEC SQL) / EXEC SQL - Examples

Included pages: 3



**üìñ Source**: [abenexec_sql_db_function_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_db_function_abexa.htm)

### abenexec_sql_abexas.htm

> **üìñ Official SAP Documentation**: [abenexec_sql_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Examples%2C%20ABENEXEC_SQL_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

EXEC SQL - Examples

-   [EXEC SQL - Use](javascript:call_link\('abennative_sql_abexa.htm'\))
-   [EXEC SQL - Access to Database Functions](javascript:call_link\('abenexec_sql_db_function_abexa.htm'\))

Continue
![Example](exa.gif "Example") [EXEC SQL - Use](javascript:call_link\('abennative_sql_abexa.htm'\))
![Example](exa.gif "Example") [EXEC SQL - Access to Database Functions](javascript:call_link\('abenexec_sql_db_function_abexa.htm'\))



**üìñ Source**: [abenexec_sql_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_abexas.htm)

### abennative_sql_abexa.htm

> **üìñ Official SAP Documentation**: [abennative_sql_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abennative_sql_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬† [EXEC SQL - Examples](javascript:call_link\('abenexec_sql_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Use%2C%20ABENNATIVE_SQL_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

EXEC SQL - Use

This example demonstrates the use of embedded static Native SQL.

Source Code ¬† 

REPORT demo\_exec\_sql.
"This program uses platform dependent Native SQL.
"It may not work for every database system.
PARAMETERS: p\_create RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_insert RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_select RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_drop¬†¬† RADIOBUTTON GROUP grp.
SELECTION-SCREEN SKIP.
PARAMETERS¬†¬†p\_key TYPE i DEFAULT 1.
CLASS native\_sql DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†CLASS-DATA: wa1 TYPE c LENGTH 10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa2 TYPE c LENGTH 10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†err TYPE REF TO cx\_sy\_native\_sql\_error.
¬†¬†¬†¬†CLASS-METHODS: create RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† insert RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† select RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† drop¬†¬† RAISING cx\_sy\_native\_sql\_error.
ENDCLASS.
CLASS native\_sql IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†IF p\_create = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†create( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Create was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_insert = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†insert( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Insert was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_select = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Select was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_drop¬†¬† = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†drop( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Drop was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO err.
¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE err TYPE 'I' DISPLAY LIKE 'E'.
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
¬†¬†METHOD create.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†CREATE TABLE abap\_docu\_demo\_mytab (
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† val1 char(10) NOT NULL,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† val2 char(10) NOT NULL,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† PRIMARY KEY (val1)¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†ENDEXEC.
¬†¬†ENDMETHOD.
¬†¬†METHOD insert.
¬†¬†¬†¬†DO 100 TIMES.
¬†¬†¬†¬†¬†¬†wa1 = sy-index.
¬†¬†¬†¬†¬†¬†wa2 = sy-index \*\* 2.
¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†INSERT INTO abap\_docu\_demo\_mytab VALUES (:wa1, :wa2)
¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†¬†¬†RAISE EXCEPTION TYPE cx\_sy\_native\_sql\_error
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†textid = cx\_sy\_native\_sql\_error=>key\_already\_exists.
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDDO.
¬†¬†ENDMETHOD.
¬†¬†METHOD select.
¬†¬†¬†¬†DATA: msg TYPE c LENGTH 30,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†key TYPE c LENGTH 10.
¬†¬†¬†¬†p\_key = cl\_abap\_dyn\_prg=>escape\_quotes( CONV string( p\_key ) ).
¬†¬†¬†¬†key = p\_key.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†SELECT val1, val2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO :wa1, :wa2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM abap\_docu\_demo\_mytab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE val1 = :key
¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†IF sy-subrc = 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Result:' TO msg,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† wa1 TO msg+10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† wa2 TO msg+20.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†msg = 'No entry found'.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†MESSAGE msg TYPE 'I'.
¬†¬†ENDMETHOD.
¬†¬†METHOD drop.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†DROP TABLE abap\_docu\_demo\_mytab
¬†¬†¬†¬†ENDEXEC.
¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†native\_sql=>main( ).

Description ¬† 

The program is the static equivalent of the executable [ADBC](javascript:call_link\('abenadbc_dml_ddl_abexa.htm'\)) example. The name of the database abap\_docu\_demo\_mytab cannot be modified. Instead of passing the SQL statements dynamically to methods of the class CL\_SQL\_STATEMENT, they are specified statically between EXEC and ENDEXEC. Attempts to insert existing rows can only be detected using sy-subrc and the corresponding SQL exception must be raised explicitly.



**üìñ Source**: [abennative_sql_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abennative_sql_abexa.htm)

### abenexec_sql_db_function_abexa.htm

> **üìñ Official SAP Documentation**: [abenexec_sql_db_function_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_db_function_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬† [EXEC SQL - Examples](javascript:call_link\('abenexec_sql_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Access%20to%20Database%20Functions%2C%20ABENEXEC_SQL_DB_FUNCTION_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20
improvement:)

EXEC SQL - Access to Database Functions

This example demonstrates how a database function is accessed using static Native SQL.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_exec\_sql\_db\_function DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_exec\_sql\_db\_function IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†DROP FUNCTION abap\_docu\_demo\_scalar\_function;
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†CREATE FUNCTION
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_docu\_demo\_scalar\_function
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( IN p1 NVARCHAR(5), IN p2 NVARCHAR(5) )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURNS r NVARCHAR(10) AS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†BEGIN
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†r = concat(p1,p2);
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†END;
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO DATA(exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†DELETE FROM demo\_expressions.
¬†¬†¬†¬†INSERT demo\_expressions
¬†¬†¬†¬†¬†¬†FROM TABLE @( VALUE #( ( id = 'X' char1 = 'xxxxxaaaaa' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( id = 'Y' char1 = 'yyyyybbbbb' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( id = 'Z' char1 = 'zzzzzccccc' ) ) ).
¬†¬†¬†¬†DATA in1 TYPE c LENGTH 5 VALUE 'yyyyy'.
¬†¬†¬†¬†DATA in2 TYPE c LENGTH 5 VALUE 'bbbbb'.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = in1
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = in2 )->request( ).
¬†¬†¬†¬†DATA result TYPE demo\_expressions-id.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from demo\_expressions
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where char1 = abap\_docu\_demo\_scalar\_function(:in1,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:in2)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :result
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO exc.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†out->write( result ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

After [EXEC SQL](javascript:call_link\('abapexec.htm'\)), this example creates a scalar [database function](javascript:call_link\('abendatabase_function_glosry.htm'\) "Glossary Entry") with two input parameters and uses this function in the WHERE condition of a SELECT statement.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Native SQL / ABAP Database Connectivity (ADBC) / ADBC - Examples

**Files**: 8 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Native SQL / Embedded Native SQL (EXEC SQL) / EXEC SQL - Examples

Included pages: 3



**üìñ Source**: [abenexec_sql_db_function_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_db_function_abexa.htm)

### abenexec_sql_abexas.htm

> **üìñ Official SAP Documentation**: [abenexec_sql_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Examples%2C%20ABENEXEC_SQL_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

EXEC SQL - Examples

-   [EXEC SQL - Use](javascript:call_link\('abennative_sql_abexa.htm'\))
-   [EXEC SQL - Access to Database Functions](javascript:call_link\('abenexec_sql_db_function_abexa.htm'\))

Continue
![Example](exa.gif "Example") [EXEC SQL - Use](javascript:call_link\('abennative_sql_abexa.htm'\))
![Example](exa.gif "Example") [EXEC SQL - Access to Database Functions](javascript:call_link\('abenexec_sql_db_function_abexa.htm'\))



**üìñ Source**: [abenexec_sql_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_abexas.htm)

### abennative_sql_abexa.htm

> **üìñ Official SAP Documentation**: [abennative_sql_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abennative_sql_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬† [EXEC SQL - Examples](javascript:call_link\('abenexec_sql_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Use%2C%20ABENNATIVE_SQL_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

EXEC SQL - Use

This example demonstrates the use of embedded static Native SQL.

Source Code ¬† 

REPORT demo\_exec\_sql.
"This program uses platform dependent Native SQL.
"It may not work for every database system.
PARAMETERS: p\_create RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_insert RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_select RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_drop¬†¬† RADIOBUTTON GROUP grp.
SELECTION-SCREEN SKIP.
PARAMETERS¬†¬†p\_key TYPE i DEFAULT 1.
CLASS native\_sql DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†CLASS-DATA: wa1 TYPE c LENGTH 10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa2 TYPE c LENGTH 10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†err TYPE REF TO cx\_sy\_native\_sql\_error.
¬†¬†¬†¬†CLASS-METHODS: create RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† insert RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† select RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† drop¬†¬† RAISING cx\_sy\_native\_sql\_error.
ENDCLASS.
CLASS native\_sql IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†IF p\_create = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†create( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Create was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_insert = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†insert( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Insert was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_select = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Select was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_drop¬†¬† = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†drop( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Drop was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO err.
¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE err TYPE 'I' DISPLAY LIKE 'E'.
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
¬†¬†METHOD create.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†CREATE TABLE abap\_docu\_demo\_mytab (
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† val1 char(10) NOT NULL,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† val2 char(10) NOT NULL,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† PRIMARY KEY (val1)¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†ENDEXEC.
¬†¬†ENDMETHOD.
¬†¬†METHOD insert.
¬†¬†¬†¬†DO 100 TIMES.
¬†¬†¬†¬†¬†¬†wa1 = sy-index.
¬†¬†¬†¬†¬†¬†wa2 = sy-index \*\* 2.
¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†INSERT INTO abap\_docu\_demo\_mytab VALUES (:wa1, :wa2)
¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†¬†¬†RAISE EXCEPTION TYPE cx\_sy\_native\_sql\_error
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†textid = cx\_sy\_native\_sql\_error=>key\_already\_exists.
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDDO.
¬†¬†ENDMETHOD.
¬†¬†METHOD select.
¬†¬†¬†¬†DATA: msg TYPE c LENGTH 30,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†key TYPE c LENGTH 10.
¬†¬†¬†¬†p\_key = cl\_abap\_dyn\_prg=>escape\_quotes( CONV string( p\_key ) ).
¬†¬†¬†¬†key = p\_key.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†SELECT val1, val2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO :wa1, :wa2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM abap\_docu\_demo\_mytab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE val1 = :key
¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†IF sy-subrc = 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Result:' TO msg,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† wa1 TO msg+10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† wa2 TO msg+20.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†msg = 'No entry found'.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†MESSAGE msg TYPE 'I'.
¬†¬†ENDMETHOD.
¬†¬†METHOD drop.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†DROP TABLE abap\_docu\_demo\_mytab
¬†¬†¬†¬†ENDEXEC.
¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†native\_sql=>main( ).

Description ¬† 

The program is the static equivalent of the executable [ADBC](javascript:call_link\('abenadbc_dml_ddl_abexa.htm'\)) example. The name of the database abap\_docu\_demo\_mytab cannot be modified. Instead of passing the SQL statements dynamically to methods of the class CL\_SQL\_STATEMENT, they are specified statically between EXEC and ENDEXEC. Attempts to insert existing rows can only be detected using sy-subrc and the corresponding SQL exception must be raised explicitly.



**üìñ Source**: [abennative_sql_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abennative_sql_abexa.htm)

### abenexec_sql_db_function_abexa.htm

> **üìñ Official SAP Documentation**: [abenexec_sql_db_function_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_db_function_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬† [EXEC SQL - Examples](javascript:call_link\('abenexec_sql_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Access%20to%20Database%20Functions%2C%20ABENEXEC_SQL_DB_FUNCTION_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20
improvement:)

EXEC SQL - Access to Database Functions

This example demonstrates how a database function is accessed using static Native SQL.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_exec\_sql\_db\_function DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_exec\_sql\_db\_function IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†DROP FUNCTION abap\_docu\_demo\_scalar\_function;
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†CREATE FUNCTION
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_docu\_demo\_scalar\_function
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( IN p1 NVARCHAR(5), IN p2 NVARCHAR(5) )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURNS r NVARCHAR(10) AS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†BEGIN
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†r = concat(p1,p2);
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†END;
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO DATA(exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†DELETE FROM demo\_expressions.
¬†¬†¬†¬†INSERT demo\_expressions
¬†¬†¬†¬†¬†¬†FROM TABLE @( VALUE #( ( id = 'X' char1 = 'xxxxxaaaaa' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( id = 'Y' char1 = 'yyyyybbbbb' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( id = 'Z' char1 = 'zzzzzccccc' ) ) ).
¬†¬†¬†¬†DATA in1 TYPE c LENGTH 5 VALUE 'yyyyy'.
¬†¬†¬†¬†DATA in2 TYPE c LENGTH 5 VALUE 'bbbbb'.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = in1
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = in2 )->request( ).
¬†¬†¬†¬†DATA result TYPE demo\_expressions-id.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from demo\_expressions
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where char1 = abap\_docu\_demo\_scalar\_function(:in1,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:in2)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :result
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO exc.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†out->write( result ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

After [EXEC SQL](javascript:call_link\('abapexec.htm'\)), this example creates a scalar [database function](javascript:call_link\('abendatabase_function_glosry.htm'\) "Glossary Entry") with two input parameters and uses this function in the WHERE condition of a SELECT statement.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Native SQL / Embedded Native SQL (EXEC SQL) / EXEC SQL

**Files**: 8 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Native SQL / Embedded Native SQL (EXEC SQL) / EXEC SQL - Examples

Included pages: 3



**üìñ Source**: [abenexec_sql_db_function_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_db_function_abexa.htm)

### abenexec_sql_abexas.htm

> **üìñ Official SAP Documentation**: [abenexec_sql_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Examples%2C%20ABENEXEC_SQL_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

EXEC SQL - Examples

-   [EXEC SQL - Use](javascript:call_link\('abennative_sql_abexa.htm'\))
-   [EXEC SQL - Access to Database Functions](javascript:call_link\('abenexec_sql_db_function_abexa.htm'\))

Continue
![Example](exa.gif "Example") [EXEC SQL - Use](javascript:call_link\('abennative_sql_abexa.htm'\))
![Example](exa.gif "Example") [EXEC SQL - Access to Database Functions](javascript:call_link\('abenexec_sql_db_function_abexa.htm'\))



**üìñ Source**: [abenexec_sql_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_abexas.htm)

### abennative_sql_abexa.htm

> **üìñ Official SAP Documentation**: [abennative_sql_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abennative_sql_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬† [EXEC SQL - Examples](javascript:call_link\('abenexec_sql_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Use%2C%20ABENNATIVE_SQL_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

EXEC SQL - Use

This example demonstrates the use of embedded static Native SQL.

Source Code ¬† 

REPORT demo\_exec\_sql.
"This program uses platform dependent Native SQL.
"It may not work for every database system.
PARAMETERS: p\_create RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_insert RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_select RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_drop¬†¬† RADIOBUTTON GROUP grp.
SELECTION-SCREEN SKIP.
PARAMETERS¬†¬†p\_key TYPE i DEFAULT 1.
CLASS native\_sql DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†CLASS-DATA: wa1 TYPE c LENGTH 10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa2 TYPE c LENGTH 10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†err TYPE REF TO cx\_sy\_native\_sql\_error.
¬†¬†¬†¬†CLASS-METHODS: create RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† insert RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† select RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† drop¬†¬† RAISING cx\_sy\_native\_sql\_error.
ENDCLASS.
CLASS native\_sql IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†IF p\_create = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†create( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Create was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_insert = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†insert( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Insert was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_select = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Select was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_drop¬†¬† = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†drop( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Drop was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO err.
¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE err TYPE 'I' DISPLAY LIKE 'E'.
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
¬†¬†METHOD create.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†CREATE TABLE abap\_docu\_demo\_mytab (
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† val1 char(10) NOT NULL,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† val2 char(10) NOT NULL,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† PRIMARY KEY (val1)¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†ENDEXEC.
¬†¬†ENDMETHOD.
¬†¬†METHOD insert.
¬†¬†¬†¬†DO 100 TIMES.
¬†¬†¬†¬†¬†¬†wa1 = sy-index.
¬†¬†¬†¬†¬†¬†wa2 = sy-index \*\* 2.
¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†INSERT INTO abap\_docu\_demo\_mytab VALUES (:wa1, :wa2)
¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†¬†¬†RAISE EXCEPTION TYPE cx\_sy\_native\_sql\_error
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†textid = cx\_sy\_native\_sql\_error=>key\_already\_exists.
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDDO.
¬†¬†ENDMETHOD.
¬†¬†METHOD select.
¬†¬†¬†¬†DATA: msg TYPE c LENGTH 30,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†key TYPE c LENGTH 10.
¬†¬†¬†¬†p\_key = cl\_abap\_dyn\_prg=>escape\_quotes( CONV string( p\_key ) ).
¬†¬†¬†¬†key = p\_key.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†SELECT val1, val2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO :wa1, :wa2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM abap\_docu\_demo\_mytab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE val1 = :key
¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†IF sy-subrc = 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Result:' TO msg,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† wa1 TO msg+10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† wa2 TO msg+20.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†msg = 'No entry found'.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†MESSAGE msg TYPE 'I'.
¬†¬†ENDMETHOD.
¬†¬†METHOD drop.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†DROP TABLE abap\_docu\_demo\_mytab
¬†¬†¬†¬†ENDEXEC.
¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†native\_sql=>main( ).

Description ¬† 

The program is the static equivalent of the executable [ADBC](javascript:call_link\('abenadbc_dml_ddl_abexa.htm'\)) example. The name of the database abap\_docu\_demo\_mytab cannot be modified. Instead of passing the SQL statements dynamically to methods of the class CL\_SQL\_STATEMENT, they are specified statically between EXEC and ENDEXEC. Attempts to insert existing rows can only be detected using sy-subrc and the corresponding SQL exception must be raised explicitly.



**üìñ Source**: [abennative_sql_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abennative_sql_abexa.htm)

### abenexec_sql_db_function_abexa.htm

> **üìñ Official SAP Documentation**: [abenexec_sql_db_function_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_db_function_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬† [EXEC SQL - Examples](javascript:call_link\('abenexec_sql_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Access%20to%20Database%20Functions%2C%20ABENEXEC_SQL_DB_FUNCTION_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20
improvement:)

EXEC SQL - Access to Database Functions

This example demonstrates how a database function is accessed using static Native SQL.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_exec\_sql\_db\_function DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_exec\_sql\_db\_function IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†DROP FUNCTION abap\_docu\_demo\_scalar\_function;
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†CREATE FUNCTION
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_docu\_demo\_scalar\_function
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( IN p1 NVARCHAR(5), IN p2 NVARCHAR(5) )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURNS r NVARCHAR(10) AS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†BEGIN
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†r = concat(p1,p2);
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†END;
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO DATA(exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†DELETE FROM demo\_expressions.
¬†¬†¬†¬†INSERT demo\_expressions
¬†¬†¬†¬†¬†¬†FROM TABLE @( VALUE #( ( id = 'X' char1 = 'xxxxxaaaaa' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( id = 'Y' char1 = 'yyyyybbbbb' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( id = 'Z' char1 = 'zzzzzccccc' ) ) ).
¬†¬†¬†¬†DATA in1 TYPE c LENGTH 5 VALUE 'yyyyy'.
¬†¬†¬†¬†DATA in2 TYPE c LENGTH 5 VALUE 'bbbbb'.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = in1
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = in2 )->request( ).
¬†¬†¬†¬†DATA result TYPE demo\_expressions-id.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from demo\_expressions
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where char1 = abap\_docu\_demo\_scalar\_function(:in1,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:in2)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :result
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO exc.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†out->write( result ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

After [EXEC SQL](javascript:call_link\('abapexec.htm'\)), this example creates a scalar [database function](javascript:call_link\('abendatabase_function_glosry.htm'\) "Glossary Entry") with two input parameters and uses this function in the WHERE condition of a SELECT statement.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Native SQL / Embedded Native SQL (EXEC SQL) / EXEC SQL - Examples

**Files**: 3 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Native SQL / Embedded Native SQL (EXEC SQL) / EXEC SQL - Examples

Included pages: 3



**üìñ Source**: [abenexec_sql_db_function_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_db_function_abexa.htm)

### abenexec_sql_abexas.htm

> **üìñ Official SAP Documentation**: [abenexec_sql_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Examples%2C%20ABENEXEC_SQL_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

EXEC SQL - Examples

-   [EXEC SQL - Use](javascript:call_link\('abennative_sql_abexa.htm'\))
-   [EXEC SQL - Access to Database Functions](javascript:call_link\('abenexec_sql_db_function_abexa.htm'\))

Continue
![Example](exa.gif "Example") [EXEC SQL - Use](javascript:call_link\('abennative_sql_abexa.htm'\))
![Example](exa.gif "Example") [EXEC SQL - Access to Database Functions](javascript:call_link\('abenexec_sql_db_function_abexa.htm'\))



**üìñ Source**: [abenexec_sql_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_abexas.htm)

### abennative_sql_abexa.htm

> **üìñ Official SAP Documentation**: [abennative_sql_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abennative_sql_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬† [EXEC SQL - Examples](javascript:call_link\('abenexec_sql_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Use%2C%20ABENNATIVE_SQL_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

EXEC SQL - Use

This example demonstrates the use of embedded static Native SQL.

Source Code ¬† 

REPORT demo\_exec\_sql.
"This program uses platform dependent Native SQL.
"It may not work for every database system.
PARAMETERS: p\_create RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_insert RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_select RADIOBUTTON GROUP grp,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†p\_drop¬†¬† RADIOBUTTON GROUP grp.
SELECTION-SCREEN SKIP.
PARAMETERS¬†¬†p\_key TYPE i DEFAULT 1.
CLASS native\_sql DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†CLASS-DATA: wa1 TYPE c LENGTH 10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa2 TYPE c LENGTH 10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†err TYPE REF TO cx\_sy\_native\_sql\_error.
¬†¬†¬†¬†CLASS-METHODS: create RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† insert RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† select RAISING cx\_sy\_native\_sql\_error,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† drop¬†¬† RAISING cx\_sy\_native\_sql\_error.
ENDCLASS.
CLASS native\_sql IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†IF p\_create = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†create( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Create was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_insert = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†insert( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Insert was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_select = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Select was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ELSEIF p\_drop¬†¬† = 'X'.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†drop( ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE 'Drop was successful' TYPE 'S'.
¬†¬†¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO err.
¬†¬†¬†¬†¬†¬†¬†¬†MESSAGE err TYPE 'I' DISPLAY LIKE 'E'.
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
¬†¬†METHOD create.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†CREATE TABLE abap\_docu\_demo\_mytab (
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† val1 char(10) NOT NULL,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† val2 char(10) NOT NULL,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† PRIMARY KEY (val1)¬†¬†¬†¬†¬†¬†)
¬†¬†¬†¬†ENDEXEC.
¬†¬†ENDMETHOD.
¬†¬†METHOD insert.
¬†¬†¬†¬†DO 100 TIMES.
¬†¬†¬†¬†¬†¬†wa1 = sy-index.
¬†¬†¬†¬†¬†¬†wa2 = sy-index \*\* 2.
¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†INSERT INTO abap\_docu\_demo\_mytab VALUES (:wa1, :wa2)
¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†¬†¬†RAISE EXCEPTION TYPE cx\_sy\_native\_sql\_error
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†textid = cx\_sy\_native\_sql\_error=>key\_already\_exists.
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDDO.
¬†¬†ENDMETHOD.
¬†¬†METHOD select.
¬†¬†¬†¬†DATA: msg TYPE c LENGTH 30,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†key TYPE c LENGTH 10.
¬†¬†¬†¬†p\_key = cl\_abap\_dyn\_prg=>escape\_quotes( CONV string( p\_key ) ).
¬†¬†¬†¬†key = p\_key.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†SELECT val1, val2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO :wa1, :wa2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM abap\_docu\_demo\_mytab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE val1 = :key
¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†IF sy-subrc = 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Result:' TO msg,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† wa1 TO msg+10,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† wa2 TO msg+20.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†msg = 'No entry found'.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†MESSAGE msg TYPE 'I'.
¬†¬†ENDMETHOD.
¬†¬†METHOD drop.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†DROP TABLE abap\_docu\_demo\_mytab
¬†¬†¬†¬†ENDEXEC.
¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†native\_sql=>main( ).

Description ¬† 

The program is the static equivalent of the executable [ADBC](javascript:call_link\('abenadbc_dml_ddl_abexa.htm'\)) example. The name of the database abap\_docu\_demo\_mytab cannot be modified. Instead of passing the SQL statements dynamically to methods of the class CL\_SQL\_STATEMENT, they are specified statically between EXEC and ENDEXEC. Attempts to insert existing rows can only be detected using sy-subrc and the corresponding SQL exception must be raised explicitly.



**üìñ Source**: [abennative_sql_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abennative_sql_abexa.htm)

### abenexec_sql_db_function_abexa.htm

> **üìñ Official SAP Documentation**: [abenexec_sql_db_function_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_db_function_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Native SQL](javascript:call_link\('abennative_sql.htm'\))¬†‚Üí¬† [Embedded Native SQL (EXEC SQL)](javascript:call_link\('abennativesql.htm'\))¬†‚Üí¬† [EXEC SQL - Examples](javascript:call_link\('abenexec_sql_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20EXEC%20SQL%20-%20Access%20to%20Database%20Functions%2C%20ABENEXEC_SQL_DB_FUNCTION_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20
improvement:)

EXEC SQL - Access to Database Functions

This example demonstrates how a database function is accessed using static Native SQL.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_exec\_sql\_db\_function DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_exec\_sql\_db\_function IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†DROP FUNCTION abap\_docu\_demo\_scalar\_function;
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†CREATE FUNCTION
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_docu\_demo\_scalar\_function
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( IN p1 NVARCHAR(5), IN p2 NVARCHAR(5) )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURNS r NVARCHAR(10) AS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†BEGIN
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†r = concat(p1,p2);
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†END;
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO DATA(exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†DELETE FROM demo\_expressions.
¬†¬†¬†¬†INSERT demo\_expressions
¬†¬†¬†¬†¬†¬†FROM TABLE @( VALUE #( ( id = 'X' char1 = 'xxxxxaaaaa' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( id = 'Y' char1 = 'yyyyybbbbb' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( id = 'Z' char1 = 'zzzzzccccc' ) ) ).
¬†¬†¬†¬†DATA in1 TYPE c LENGTH 5 VALUE 'yyyyy'.
¬†¬†¬†¬†DATA in2 TYPE c LENGTH 5 VALUE 'bbbbb'.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = in1
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = in2 )->request( ).
¬†¬†¬†¬†DATA result TYPE demo\_expressions-id.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from demo\_expressions
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where char1 = abap\_docu\_demo\_scalar\_function(:in1,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:in2)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :result
¬†¬†¬†¬†¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO exc.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†out->write( result ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

After [EXEC SQL](javascript:call_link\('abapexec.htm'\)), this example creates a scalar [database function](javascript:call_link\('abendatabase_function_glosry.htm'\) "Glossary Entry") with two input parameters and uses this function in the WHERE condition of a SELECT statement.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / Data Aging in SAP HANA

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abenexec_sql_db_function_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenexec_sql_db_function_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / Access to Objects in SAP HANA XS

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

**Files**: 6 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / ABAP and SAP HANA / ABAP and SAP HANA, Examples

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_and_hana_abexas.htm

> **üìñ Official SAP Documentation**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20ABAP%20and%20SAP%20HANA%2C%20Examples%2C%20ABENABAP_AND_HANA_ABEXAS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

ABAP and SAP HANA, Examples

-   [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
-   [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
-   [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
-   [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
-   [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))

Continue
![Example](exa.gif "Example") [SAP HANA, ABAP-Specific Session Variables](javascript:call_link\('abenhana_session_variables_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Cached Views](javascript:call_link\('abenhana_cached_views_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, from ADBC to AMDP](javascript:call_link\('abenfrom_adbc_to_amdp_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Call Database Procedure](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))
![Example](exa.gif "Example") [SAP HANA, Currency Conversion with SQLScript](javascript:call_link\('abensql_script_curr_conv_abexa.htm'\))



**üìñ Source**: [abenabap_and_hana_abexas.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_and_hana_abexas.htm)

### abenhana_session_variables_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20ABAP-Specific%20Session%20Variables%2C%20ABENHANA_SESSION_VARIABLES_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%
20improvement:)

SAP HANA, ABAP-Specific Session Variables

This example demonstrates potential Native SQL reads on [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_hana\_abap\_variables DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_hana\_abap\_variables IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†LEAVE PROGRAM.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_hana\_session\_variables( ).
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_exec\_sql) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_exec\_sql( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_exec\_sql ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sy\_native\_sql\_error INTO FINAL(exec\_sql\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exec\_sql\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(result\_adbc) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_adbc( ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_adbc ).
¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(adbc\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( adbc\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†DATA result\_amdp
¬†¬†¬†¬†¬†¬†¬†¬† TYPE cl\_demo\_hana\_session\_variables=>session\_variables.
¬†¬†¬†¬†¬†¬†¬†¬†oref->get\_session\_variables\_amdp(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING clnt¬†¬†¬†¬† = result\_amdp-client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cds\_clnt = result\_amdp-cds\_client
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†unam¬†¬†¬†¬† = result\_amdp-uname
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†lang¬†¬†¬†¬† = result\_amdp-langu
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬† = result\_amdp-datum ).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( result\_amdp ).
¬†¬†¬†¬†¬†¬†CATCH cx\_amdp\_error INTO FINAL(amdp\_exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( amdp\_exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

This class calls the following methods of the class CL\_DEMO\_HANA\_SESSION\_VARIABLES:

-   GET\_SESSION\_VARIABLES\_EXEC\_SQL
    
    METHOD get\_session\_variables\_exec\_sql.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('CDS\_CLIENT')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-cds\_client
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('APPLICATIONUSER')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-uname
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('LOCALE\_SAP')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-langu
    ¬†¬†ENDEXEC.
    ¬†¬†EXEC SQL.
    ¬†¬†¬†¬†select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE')
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from DUMMY
    ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† into :session\_variables-datum
    ¬†¬†ENDEXEC.
    ENDMETHOD.
    
    This method calls the built-in function SESSION\_CONTEXT for the four ABAP-specific [session variables](javascript:call_link\('abenhana_session_variables.htm'\)) on the SAP HANA database in three static Native SQL statements between [EXEC - ENDEXEC](javascript:call_link\('abapexec.htm'\)). The result is returned as a column of the SELECT list of an access to the pseudo table DUMMY.
    
-   GET\_SESSION\_VARIABLES\_ADBC
    
    METHOD get\_session\_variables\_adbc.
    ¬†¬†DATA(result) = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('CDS\_CLIENT') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-cds\_client ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('APPLICATIONUSER') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-uname ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('LOCALE\_SAP') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-langu ) ).
    ¬†¬†result->next( ).
    ¬†¬†result = NEW cl\_sql\_statement( )->execute\_query(
    ¬†¬†¬†¬†\`select SESSION\_CONTEXT('SAP\_SYSTEM\_DATE') from DUMMY\` ).
    ¬†¬†result->set\_param( REF #( session\_variables-datum ) ).
    ¬†¬†result->next( ).
    ENDMETHOD.
    
    This method replaces the static Native SQL statements of the preceding method with corresponding Native SQL statements in [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry").
    
-   GET\_SESSION\_VARIABLES\_AMDP
    
    METHOD get\_session\_variables\_amdp
    ¬†¬†¬†¬†¬†¬† BY DATABASE PROCEDURE FOR HDB
    ¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT.
    ¬†¬†clnt := session\_context('CLIENT');
    ¬†¬†cds\_clnt := session\_context('CDS\_CLIENT');
    ¬†¬†unam := session\_context('APPLICATIONUSER');
    ¬†¬†lang := session\_context('LOCALE\_SAP');
    ¬†¬†date := session\_context('SAP\_SYSTEM\_DATE');
    ENDMETHOD.
    
    This method is an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") and shows how the result of the built-in function SESSION\_CONTEXT can be used directly in [SQLScript](javascript:call_link\('abensql_script_glosry.htm'\) "Glossary Entry").



**üìñ Source**: [abenhana_session_variables_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_session_variables_abexa.htm)

### abenhana_cached_views_abexa.htm

> **üìñ Official SAP Documentation**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Cached%20Views%2C%20ABENHANA_CACHED_VIEWS_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, Cached Views

This example demonstrates ABAP SQL access to a [cached view](javascript:call_link\('abenhana_cached_views.htm'\)) on the SAP HANA database.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_select\_cached\_view DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_select\_cached\_view IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF cl\_db\_sys=>is\_in\_memory\_db = abap\_false.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`Example can be executed on SAP HANA Database only\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA reset TYPE abap\_bool.
¬†¬†¬†¬†DATA minutes TYPE i VALUE 30.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬† )->add\_field( EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Reset cache'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† as\_checkbox = abap\_true
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = reset
¬†¬†¬†¬† )->request(¬†¬† EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† text = 'Maximal age in minutes'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field = minutes ).
¬†¬†¬†¬†minutes = COND i( WHEN minutes < 1 OR minutes > 60 THEN 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†ELSE minutes ).
¬†¬†¬†¬†IF reset = abap\_true.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`alter view DEMOCDSCACH drop cache;\` ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†NEW cl\_sql\_statement( )->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|alter view DEMOCDSCACH add cache retention {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† minutes } of | &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|MANDT, CARRID, MAX(FLDATE), MIN(PRICE), SUM(SEATSOCC);| ).
¬†¬†¬†¬†¬†¬†¬†¬†CATCH cx\_sql\_exception INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†¬†¬†ENDTRY.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(extended\_result) =
¬†¬†¬†¬†¬†¬†NEW cl\_osql\_extended\_result( iv\_cached\_view = abap\_true ).
¬†¬†¬†¬†SELECT carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MAX( fldate )¬†¬† AS max\_fldate ,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† MIN( price )¬†¬†¬†¬†AS min\_price,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† SUM( seatsocc ) AS sum\_seatsocc
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_cds\_cached\_view
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† GROUP BY carrid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %\_HINTS HDB 'RESULT\_CACHE'¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "#EC CI\_HINTS
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(result)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† EXTENDED RESULT @extended\_result.
¬†¬†¬†¬†out->write( result
¬†¬†¬†¬†¬†¬†)->write\_html( \`<b>Extended Result</b>\` ).
¬†¬†¬†¬†IF extended\_result->cview\_valid( ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬† | CVIEW\_MAX\_AGE: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_max\_age( ) } seconds\\n| &&
¬†¬†¬†¬†¬†¬† | CVIEW\_LAST\_REFRESH\_TSTMPL: {
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†extended\_result->cview\_last\_refresh\_tstmpl( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†TIMESTAMP = ISO }\\n| ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†out->write( \`Invalid result\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The instance DEMOCDSCACH of the [CDS view](javascript:call_link\('abencds_view_glosry.htm'\) "Glossary Entry") DEMO\_CDS\_CACHED\_VIEW on the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is designated for caching using [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") and the SQL statement ALTER TABLE. The maximum cache lifetime cannot be specified. It is also possible to delete an existing cache.

When the CDS view is accessed using the ABAP SQL statement [SELECT](javascript:call_link\('abapselect.htm'\)), the [database hint](javascript:call_link\('abendatabase_hint_glosry.htm'\) "Glossary Entry") [%\_HINTS](javascript:call_link\('abenabap_sql_db_hints.htm'\)) HDB 'RESULT\_CACHE' is used to specify that the cache is accessed.

The addition [EXTENDED RESULT](javascript:call_link\('abapselect_extended_result.htm'\)) of the [INTO](javascript:call_link\('abapinto_clause.htm'\)) clause can be used to determine whether a cache is available, and the cache properties are read.



**üìñ Source**: [abenhana_cached_views_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenhana_cached_views_abexa.htm)

### abenfrom_adbc_to_amdp_abexa.htm

> **üìñ Official SAP Documentation**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20from%20ADBC%20to%20AMDP%2C%20ABENFROM_ADBC_TO_AMDP_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

SAP HANA, from ADBC to AMDP

This example demonstrates how a task can be performed using HANA-specific language elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_adbc\_to\_amdp DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_adbc\_to\_amdp IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) = NEW cl\_demo\_from\_adbc\_to\_amdp( to\_upper( carrier ) ).
¬†¬†¬†¬†FINAL(asql\_result) = oref->asql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF asql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† asql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

The task is to read all rows from the database table SFLIGHT whose key fields MANDT, CARRID, and CONNID occur in a predefined three-column internal table. To do this, the example class calls various methods of the class CL\_DEMO\_FROM\_ADBC\_TO\_AMDP in whose instance constructor the internal table connection\_tab is filled in accordance with user input.

Hint

The examples of using HANA-specific language elements shown in the methods are syntax-only examples. The task presented here can be solved just as well using ABAP SQL, which is why ABAP SQL is the preferred method as specified in the [programming guidelines](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline").

Reference Implementation Using ABAP SQL ¬† 

The method ASQL shows how the task can be solved in ABAP SQL by simply using the addition [FOR ALL ENTRIES](javascript:call_link\('abenwhere_all_entries.htm'\)). The result of the method is used as a reference for the HANA-specific implementations.

METHOD asql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Using Native SQL with ADBC ¬† 

The method ADBC solves the task by using HANA-specific [Native SQL statements](javascript:call_link\('abennative_sql.htm'\)) that are passed to the SAP HANA database using [ADBC](javascript:call_link\('abenadbc.htm'\)). The table with the key values is evaluated after the addition exists in a subquery of a select statement. To do this, a temporary table DEMO\_ADBC\_CONNECTIONS is created on the database and filled with the content of the connection\_tab using the statement insert. To access the result of the select statement, a standard table std\_flights must be declared as a local internal table of the method, since the return value flights cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after SPFLI is read.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) = sql->execute\_query(
¬†¬†¬† ¬†¬†¬†¬†\`¬†¬†¬†¬†select \* \`¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†from SFLIGHT as S \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†where exists (\` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from¬†¬†DEMO\_ADBC\_CONNECTIONS as C\` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID )\` ).
¬†¬†¬†¬†¬†¬†DATA std\_flights TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( std\_flights ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = std\_flights.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( '¬†¬† drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call of a Database Procedure Using a Database Procedure Proxy ¬† 

The method CDBP solves the task by implementing the HANA-specific select statement in a [database procedure](javascript:call_link\('abendatabase_procedure_glosry.htm'\) "Glossary Entry") that is called by specifying a [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") in the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)). In a more realistic example, the database procedure DEMO\_ADBC\_GET\_FLIGHTS and the database procedure proxy DEMO\_ADBC\_GET\_FLIGHTS\_PROXY would already exist and the implementation of the method would be restricted to the call CALL DATABASE PROCEDURE (see the executable example for [procedure calls](javascript:call_link\('abencall_hana_db_proc_abexa.htm'\))). In this example, the database procedure and the database procedure proxy are created temporarily and deleted again using ADBC methods and the associated API. The input parameter connections of the procedure references an additional temporary HANA table type, DEMO\_ADBC\_CONNECTIONS\_TYPE. HANA does not support a separate type for numeric text, which means that the type NVARCHAR(4) must be used for the column CONNID. Therefore, the internal table connection\_tab must be assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create type DEMO\_ADBC\_CONNECTIONS\_TYPE as table \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`( MANDT¬†¬†NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CARRID NVARCHAR(3), \`¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`CONNID NVARCHAR(4) )\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create procedure DEMO\_ADBC\_GET\_FLIGHTS¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†( in CONNECTIONS DEMO\_ADBC\_CONNECTIONS\_TYPE,¬†¬†\`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†out FLIGHTS SFLIGHT ) language sqlscript as \`¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†begin \`¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†FLIGHTS = \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select \* \` ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†from SFLIGHT as S \`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†where exists (¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†select MANDT, CARRID, CONNID \`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C\`¬†¬†¬†¬†¬†¬†¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and \`¬†¬†&&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and \` &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );\`¬†¬† &&
¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†¬†¬†¬†¬†end\` ).
¬†¬†¬†¬†¬†¬†DATA db\_schema TYPE if\_dbproc\_proxy\_basic\_types=>ty\_db\_name.
¬†¬†¬†¬†¬†¬†CALL FUNCTION 'DB\_DBSCHEMA\_CURRENT'
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†dbschema = db\_schema.
¬†¬†¬†¬†¬†¬†DATA(params) =
¬†¬†¬†¬†¬†¬†¬†¬†VALUE if\_dbproc\_proxy\_basic\_types=>ty\_param\_override\_t(
¬†¬†¬†¬†¬†¬†¬†¬†( db\_name¬†¬† = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abap\_name = 'FLIGHTS'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†descr¬†¬†¬†¬† = cl\_abap\_typedescr=>describe\_by\_name(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†'SFLIGHT' ) ) ).
¬†¬†¬†¬†¬†¬†DATA(api) = cl\_dbproc\_proxy\_factory=>get\_proxy\_public\_api(
¬†¬†¬†¬†¬†¬†¬†¬†if\_proxy\_name = 'DEMO\_ADBC\_GET\_FLIGHTS\_PROXY' ).
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†api->create\_proxy( EXPORTING
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_schema¬†¬†¬†¬†= db\_schema
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†it\_param\_override = params
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if\_proc\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_ADBC\_GET\_FLIGHTS' ).
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†TYPES:
¬†¬†¬†¬†¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†¬†¬†¬†¬†END OF connection.
¬†¬†¬†¬†¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†connections = connection\_tab.
¬†¬†¬†¬†¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
¬†¬†¬†¬†¬†¬†COMMIT CONNECTION default.
¬†¬†¬†¬†¬†¬†api->delete( ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( \`drop procedure DEMO\_ADBC\_GET\_FLIGHTS\` ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl( 'drop type DEMO\_ADBC\_CONNECTIONS\_TYPE' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception cx\_dbproc\_proxy.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call an AMDP Procedure ¬† 

The method AMDP solves the task in the easiest possible way by calling an [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH in which the HANA-specific select statement is implemented in an [AMDP procedure](javascript:call_link\('abenamdp_procedure_glosry.htm'\) "Glossary Entry"). The main advantage of the AMDP method is that it can be called in the same way as any ABAP method and no auxiliary tables must be introduced, as was the case in the preceding examples.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT OPTIONS READ-ONLY
¬†¬†¬†¬†¬†¬† USING sflight.
¬†¬†FLIGHTS = select \*
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists ( select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† C.CONNID = S.CONNID );
ENDMETHOD.



**üìñ Source**: [abenfrom_adbc_to_amdp_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenfrom_adbc_to_amdp_abexa.htm)

### abencall_hana_db_proc_abexa.htm

> **üìñ Official SAP Documentation**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Call%20Database%20Procedure%2C%20ABENCALL_HANA_DB_PROC_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

SAP HANA, Call Database Procedure

This example demonstrates how a database procedure in the SAP HANA database can be called.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_call\_hana\_db\_proc DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_call\_hana\_db\_proc IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†IF NOT cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_database\_procedure )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†\`Current database system does not support all procedure calls\` ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†DATA carrier TYPE spfli-carrid VALUE 'LH'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = carrier ).
¬†¬†¬†¬†FINAL(oref) =
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_call\_hana\_db\_procedure( to\_upper( carrier ) ).
¬†¬†¬†¬†IF oref->ok IS INITIAL.
¬†¬†¬†¬†¬†¬†out->write( 'Error in setup' ).
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†FINAL(osql\_result) = oref->osql( ).
¬†¬†¬†¬†FINAL(adbc\_result) = oref->adbc( ).
¬†¬†¬†¬†FINAL(cdbp\_result) = oref->cdbp( ).
¬†¬†¬†¬†FINAL(amdp\_result) = oref->amdp( ).
¬†¬†¬†¬†IF NOT cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = cdbp\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, CALL DATABASE PROCEDURE, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†IF osql\_result = adbc\_result AND
¬†¬†¬†¬†¬†¬†¬†¬† osql\_result = amdp\_result.
¬†¬†¬†¬†¬†¬†¬†¬†out->begin\_section(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`Result of ABAP SQL, ADBC, and AMDP\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->write( amdp\_result ).
¬†¬†¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†¬†¬†out->write( 'Error' ).
¬†¬†¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†ENDIF.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Take a database procedure called /1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS in the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry"):

begin
¬†¬†FLIGHTS =
¬†¬†¬†¬†select \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† from SFLIGHT as S
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† where exists (
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†select MANDT, CARRID, CONNID
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†from :CONNECTIONS as C
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†where C.MANDT¬†¬†= S.MANDT and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CARRID = S.CARRID and
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†C.CONNID = S.CONNID );
end

The procedure has a tabular input parameter CONNECTIONS with the three-column HANA table type DEMO\_ADBC\_CONNECTIONS\_TYPE and an output parameter FLIGHTS with the type SFLIGHT defined in the ABAP Dictionary. The HANA table type has three character-like columns, MANDT with length 3, CARRID with length 3, and CONNID with length 4. The task is to call this procedure from ABAP while passing an internal table to the input parameter and copying the output parameter to an internal table.

To do this, the example class calls various methods of the class CL\_DEMO\_CALL\_HANA\_DB\_PROCEDURE. The table to be passed connection\_tab is filled in the instance constructor of the class in accordance with user input. Furthermore, the database procedure, the HANA table type, and a database procedure proxy, which is usually static, are created here temporarily.

Comparison Implementation Using ABAP SQL ¬† 

The method OSQL shows how the implementation of the database procedure can also be expressed in ABAP SQL. If the function is required only in ABAP, an implementation in SQLScript is unnecessary in this case and should be avoided in accordance with the relevant [programming guideline](javascript:call_link\('abendatabase_access_guidl.htm'\) "Guideline"). In our example, the database procedure is a replacement for a globally available procedure that is also to be called in ABAP. The result of the method OSQL is compared with the results of the various procedure calls to determine whether they are correct.

METHOD osql.
¬†¬†IF connection\_tab IS NOT INITIAL.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FROM sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR ALL ENTRIES IN @connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†WHERE carrid = @connection\_tab-carrid AND
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = @connection\_tab-connid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†INTO TABLE @flights.
¬†¬†ENDIF.
ENDMETHOD.

Call with Native SQL Using ADBC ¬† 

The method ADBC uses [Native SQL](javascript:call_link\('abennative_sql_glosry.htm'\) "Glossary Entry") and [ADBC](javascript:call_link\('abenadbc_glosry.htm'\) "Glossary Entry") to call the database procedure. To pass the internal table connection\_tab to the database procedure, a temporary table DEMO\_ADBC\_CONNECTIONS with the required type DEMO\_ADBC\_CONNECTIONS\_TYPE is created on the database and provided with the values of the internal table using insert. The database procedure is then called with the temporary table as an input parameter and the result is assigned to an ADBC result set. To read from the result set, a standard table flights\_std is required as an auxiliary table, since the return value flights is a sorted table that cannot be used for ADBC. The temporary table DEMO\_ADBC\_CONNECTIONS is removed again after the database procedure is called.

METHOD adbc.
¬†¬†DATA(sql) = NEW cl\_sql\_statement( ).
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception ##no\_handler.
¬†¬†ENDTRY.
¬†¬†TRY.
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(
¬†¬†¬†¬†¬†¬†¬†¬†\`create global temporary row table DEMO\_ADBC\_CONNECTIONS \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† \`like DEMO\_ADBC\_CONNECTIONS\_TYPE\` ).
¬†¬†¬†¬†¬†¬†sql->set\_param\_table( REF #( connection\_tab ) ).
¬†¬†¬†¬†¬†¬†sql->execute\_update(
¬†¬†¬†¬†¬†¬†¬†¬†\`insert into DEMO\_ADBC\_CONNECTIONS values ( ?, ?, ? )\` ).
¬†¬†¬†¬†¬†¬†DATA(result) =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†sql->execute\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"( \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†CONNECTIONS =>DEMO\_ADBC\_CONNECTIONS, \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`¬†¬†FLIGHTS => NULL )\` ).
¬†¬†¬†¬†¬†¬†DATA flights\_std TYPE STANDARD TABLE OF sflight WITH EMPTY KEY.
¬†¬†¬†¬†¬†¬†result->set\_param\_table( REF #( flights\_std ) ).
¬†¬†¬†¬†¬†¬†result->next\_package( ).
¬†¬†¬†¬†¬†¬†result->close( ).
¬†¬†¬†¬†¬†¬†flights = flights\_std.
¬†¬†¬†¬†¬†¬†sql->execute\_update( 'truncate table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†¬†¬†sql->execute\_ddl(¬†¬†¬†¬†'drop table DEMO\_ADBC\_CONNECTIONS' ).
¬†¬†¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†¬†¬†CLEAR flights.
¬†¬†ENDTRY.
ENDMETHOD.

Call Using Database Procedure Proxy ¬† 

The method CDBP calls the database procedure with the statement [CALL DATABASE PROCEDURE](javascript:call_link\('abapcall_database_procedure.htm'\)) using the assigned [database procedure proxy](javascript:call_link\('abendatabase_proc_proxy_glosry.htm'\) "Glossary Entry") DEMO\_ADBC\_GET\_FLIGHTS\_PROXY. The only thing to note here is that input parameters and output parameters of the database procedure have different row types than the internal tables that are to be assigned to them. In both cases, the column CONNID has the type NVARCHAR(4) on the database, but the type n with length 4 in ABAP. For this reason, the internal table connection\_tab is first assigned to a temporary table connections with the correct row type before the procedure is called. No auxiliary table is required for the result flights, since the row type is described using an ABAP Dictionary type. An appropriate mapping can be performed for this type using the mapping table params. As an alternative to an auxiliary table for connection\_tab, its data type could also be declared in the ABAP Dictionary and an appropriate mapping performed.

The statement CALL DATABASE PROCEDURE is not possible on a [SAP HANA Cloud database](javascript:call_link\('abensap_hana_cloud_db_glosry.htm'\) "Glossary Entry").

METHOD cdbp.
¬†¬†TYPES:
¬†¬†¬†¬†BEGIN OF connection,
¬†¬†¬†¬†¬†¬†mandt¬†¬†TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†carrid TYPE c LENGTH 3,
¬†¬†¬†¬†¬†¬†connid TYPE c LENGTH 4,
¬†¬†¬†¬†END OF connection.
¬†¬†DATA connections TYPE STANDARD TABLE OF connection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WITH EMPTY KEY.
¬†¬†IF cl\_shdb\_hc=>is\_hana\_cloud(¬†¬†).
¬†¬†¬†¬†RETURN.
¬†¬†ENDIF.
¬†¬†connections = connection\_tab.
¬†¬†CALL DATABASE PROCEDURE ('DEMO\_ADBC\_GET\_FLIGHTS\_PROXY')
¬†¬†¬†¬†EXPORTING connections = connections
¬†¬†¬†¬†IMPORTING flights¬†¬†¬†¬† = flights.
ENDMETHOD.

Call Using AMDP ¬† 

The method AMDP calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") AMDP\_METH, in which a call of the database procedure is implemented in SQLScript. In this case, all type-dependent actions required are performed by the AMDP framework.

METHOD amdp.
¬†¬†amdp\_meth( EXPORTING connections = connection\_tab
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† IMPORTING flights¬†¬†¬†¬† = flights ).
ENDMETHOD.

METHOD amdp\_meth BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT.
¬†¬†call "/1BCAMDP/DEMO\_ADBC\_GET\_FLIGHTS"(
¬†¬†¬†¬†¬†¬†¬†¬† CONNECTIONS => :CONNECTIONS,
¬†¬†¬†¬†¬†¬†¬†¬† FLIGHTS => :FLIGHTS );
ENDMETHOD.



**üìñ Source**: [abencall_hana_db_proc_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abencall_hana_db_proc_abexa.htm)

### abensql_script_curr_conv_abexa.htm

> **üìñ Official SAP Documentation**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [ABAP and SAP HANA](javascript:call_link\('abenabap_hana.htm'\))¬†‚Üí¬† [ABAP and SAP HANA, Examples](javascript:call_link\('abenabap_and_hana_abexas.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20SAP%20HANA%2C%20Currency%20Conversion%20with%20SQLScript%2C%20ABENSQL_SCRIPT_CURR_CONV_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20f
or%20improvement:)

SAP HANA, Currency Conversion with SQLScript

This example demonstrates how a built-in HANA SQL function is called in SQLScript.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS setup.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_sqlscript\_curr\_cnvrsn IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA currency TYPE c LENGTH 5 VALUE 'USD'.
¬†¬†¬†¬†cl\_demo\_input=>new( )->request( CHANGING field = currency ).
¬†¬†¬†¬†setup( ).
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(original\_prices).
¬†¬†¬†¬†out->begin\_section( \`Original Prices\`
¬†¬†¬†¬†¬†¬†)->write( original\_prices ).
¬†¬†¬†¬†IF cl\_abap\_dbfeatures=>use\_features(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†requested\_features =
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE #( ( cl\_abap\_dbfeatures=>call\_amdp\_method ) ) ).
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ELSE.
¬†¬†¬†¬†¬†¬†NEW cl\_demo\_sqlscript\_curr\_conv(
¬†¬†¬†¬†¬†¬†¬†¬†)->abap\_convert(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†to\_currency¬†¬†¬†¬†¬†¬†= to\_upper( currency )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†mandt¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= sy-mandt
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = sy-datlo ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ORDER BY id
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(converted\_prices).
¬†¬†¬†¬†out->next\_section( \`Converted Prices\`
¬†¬†¬†¬†¬†¬†)->write( converted\_prices ).
¬†¬†ENDMETHOD.
¬†¬†METHOD setup.
¬†¬†¬†¬†DELETE FROM demo\_prices.
¬†¬†¬†¬†INSERT demo\_prices FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( id = 1 amount = '1.00' currency = 'EUR' )
¬†¬†¬†¬†¬†¬†( id = 2 amount = '1.00' currency = 'GBP' )
¬†¬†¬†¬†¬†¬†( id = 3 amount = '1.00' currency = 'JPY' )
¬†¬†¬†¬†¬†¬†( id = 4 amount = '1.00' currency = 'USD' ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

If possible, the example class calls the [AMDP method](javascript:call_link\('abenamdp_method_glosry.htm'\) "Glossary Entry") CONVERT of the [AMDP class](javascript:call_link\('abenamdp_class_glosry.htm'\) "Glossary Entry") CL\_DEMO\_SQLSCRIPT\_CURR\_CONV.

METHOD convert BY DATABASE PROCEDURE FOR HDB
¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† LANGUAGE SQLSCRIPT
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† USING demo\_prices.
¬†¬†replace DEMO\_PRICES
¬†¬†¬†¬†select client,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONVERT\_CURRENCY(
¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"AMOUNT" => "DEMO\_PRICES"."AMOUNT",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SOURCE\_UNIT" => "DEMO\_PRICES"."CURRENCY",
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"TARGET\_UNIT" => :TO\_CURRENCY,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"REFERENCE\_DATE" => :DATE,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CONVERSION\_TYPE" => N'M',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"CLIENT" => :MANDT,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ERROR\_HANDLING" => N'SET\_TO\_NULL',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"SCHEMA" => CURRENT\_SCHEMA,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"ACCURACY" => N'highest',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LOOKUP" => N'regular',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"STEPS" => 'convert,shift\_back,shift,round' ) as amount,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†:TO\_CURRENCY as currency
¬†¬†¬†¬†¬†¬†from DEMO\_PRICES;
ENDMETHOD.

The SQLScript implementation of this method uses the built-in SQL function [CONVERT\_CURRENCY](https://help.sap.com/docs/SAP_HANA_PLATFORM/4fe29514fd584807ac9f2a04f6754767/b4b0eec1968f41a099c828a4a6c8ca0f) to convert the amounts in the column amount in the database DEMO\_PRICES to a currency entered by the user.

If the current database is not an SAP HANA database, the method ABAP\_CONVERT is called as an alternative.

METHOD abap\_convert.
¬†¬†DATA prices TYPE STANDARD TABLE OF demo\_prices.
¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬† FROM demo\_prices
¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE prices.
¬†¬†LOOP AT prices ASSIGNING FIELD-SYMBOL(<price>).
¬†¬†¬†¬†CALL FUNCTION 'CONVERT\_TO\_LOCAL\_CURRENCY'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†client¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = mandt
¬†¬†¬†¬†¬†¬†¬†¬†date¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = date
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_amount¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†¬†¬†foreign\_currency = <price>-currency
¬†¬†¬†¬†¬†¬†¬†¬†local\_currency¬†¬† = to\_currency
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†local\_amount¬†¬†¬†¬† = <price>-amount
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†CONTINUE.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†<price>-currency = to\_currency.
¬†¬†ENDLOOP.
¬†¬†MODIFY demo\_prices FROM TABLE prices.
ENDMETHOD.

This method uses the function module CONVERT\_TO\_LOCAL\_CURRENCY. Here, the table to b converted is first read to an internal table in AS ABAP and must be written again after the conversion.

Hint

See also

-   [Unit and Currency Conversion Functions in ABAP SQL](javascript:call_link\('abensql_curr_unit_conv_func.htm'\)).
    
    The built-in SQL function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_ASQL\_FUNC\_CURR\_CONV shows how the same function as above can be achieved by using an ABAP SQL SELECT that calls the SQL function.
    
-   [Unit and Currency Conversion Functions in ABAP CDS](javascript:call_link\('abencds_conversion_functions_v2.htm'\)).
    
    The built-in CDS function CURRENCY\_CONVERSION wraps the HANA function CONVERT\_CURRENCY. The class CL\_DEMO\_CDS\_FUNC\_CURR\_CONV\_VE shows how the same function as above can be achieved by using a CDS view that calls the CDS function.
    

A complete code relocation using a subquery in the ABAP SQL statement MODIFY is only possible if no table logging takes place.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Object Services (OS) / OS - Persistence Service

**Files**: 9 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Object Services (OS) / OS - Query Service

Included pages: 6



**üìñ Source**: [abensql_script_curr_conv_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abensql_script_curr_conv_abexa.htm)

### abenabap_object_services_query.htm

> **üìñ Official SAP Documentation**: [abenabap_object_services_query.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_object_services_query.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Query%20Service%2C%20ABENABAP_OBJECT_SERVICES_QUERY%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Query Service

The query service makes it possible to search for and load persistent objects using logical expressions.

-   [Query Service Overview](javascript:call_link\('abenos_query_terms.htm'\))
-   [Query Service Components](javascript:call_link\('abenos_query_comps.htm'\))
-   [Query Conditions](javascript:call_link\('abenos_query_filter_cond.htm'\))
-   [Sort Conditions](javascript:call_link\('abenos_query_sort_cond.htm'\))

Continue
[OS - Query Service, Overview](javascript:call_link\('abenos_query_terms.htm'\))
[OS - Components of the Query Service](javascript:call_link\('abenos_query_comps.htm'\))
[OS - Query Conditions](javascript:call_link\('abenos_query_filter_cond.htm'\))
[OS - Sort Conditions](javascript:call_link\('abenos_query_sort_cond.htm'\))
![Example](exa.gif "Example") [OS - Query Service](javascript:call_link\('abenos_query_abexa.htm'\))



**üìñ Source**: [abenabap_object_services_query.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_object_services_query.htm)

### abenos_query_terms.htm

> **üìñ Official SAP Documentation**: [abenos_query_terms.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_terms.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬† [OS - Query Service](javascript:call_link\('abenabap_object_services_query.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Query%20Service%2C%20Overview%2C%20ABENOS_QUERY_TERMS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Query Service, Overview

A query is used to search for persistent objects in the database using conditions and to create the corresponding instances of the persistent class in the ABAP program.

A query is implemented by an object (query object) that implements the interface IF\_OS\_QUERY and is created by a query manager.

A query is a logical expression that compares the attributes of a persistent class with freely selectable parameters or values, known as the [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)). Those objects are loaded whose attributes meet the query conditions. A query also contains a [sort condition](javascript:call_link\('abenos_query_sort_cond.htm'\)), which determines the order of the loaded objects in the results table.

When a query is created using the query manager method CREATE\_QUERY, the query conditions and sort conditions are passed to it.

The query itself is merely a container for the query condition and the sort condition. A query is executed by calling the interface method IF\_OS\_CA\_PERSISTENCY~GET\_PERSISTENT\_BY\_QUERY in the class agent of a persistent class. Similarly, the result of an executed query is not bound to the query, and it is returned by the method of the class agent as a table of references instead.

Hint

When the result set of a query is determined, the changes that are made to persistent objects in the current transaction are ignored. The query is executed directly in the database.



**üìñ Source**: [abenos_query_terms.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_terms.htm)

### abenos_query_comps.htm

> **üìñ Official SAP Documentation**: [abenos_query_comps.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_comps.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬† [OS - Query Service](javascript:call_link\('abenabap_object_services_query.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Components%20of%20the%20Query%20Service%2C%20ABENOS_QUERY_COMPS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Components of the Query Service

A query is represented by a query object, which is managed by a query manager (also an object). The query manager represents the query service with respect to the ABAP program.

To create a query manager, the static method GET\_QUERY\_MANAGER of the general system service class CL\_OS\_SYSTEM is required.

An ABAP program does not work with the query manager and queries using class reference variables. Instead, it uses the interfaces IF\_OS\_QUERY\_MANAGER, IF\_OS\_QUERY, and IF\_OS\_QUERY\_EXPR\_FACTORY to access them.

A query is not executed directly, but using the method GET\_PERSISTENT\_BY\_QUERY of the interface IF\_OS\_CA\_PERSISTENCY of a class agent. This searches for persistent objects of the associated persistent class that match the [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)).

The options for executing a query are controlled using the interface IF\_OS\_QUERY\_OPTIONS. To do this, a structure of the type IF\_OS\_QUERY\_OPTIONS=>OPTIONS can be passed to the method GET\_PERSISTENT\_BY\_QUERY.

Relevant Method of the System Service ¬† 

Most of the components of the system service class CL\_OS\_SYSTEM are used internally by the Object Services. A method must be used in an application program to be able to work explicitly with object-oriented queries.

-   GET\_QUERY\_MANAGER
    
    This static method returns the return value RESULT of type IF\_OS\_QUERY\_MANAGER containing a reference to the Query Manager. The query manager is created when the Object Services are initialized.
    

Methods of the Query Manager ¬† 

The query manager manages the object-oriented queries of the ABAP program and is executed from interface IF\_OS\_QUERY\_MANAGER.

-   IF\_OS\_QUERY\_MANAGER~CREATE\_QUERY
    
    Creates a query and returns a reference to the query object in the return value RESULT of type IF\_OS\_QUERY. The [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) is passed to the parameter I\_FILTER of type string. The [sort condition](javascript:call_link\('abenos_query_sort_cond.htm'\)) is passed to the parameter I\_ORDERING of type string. If the parameters of the query are specified using a parameter list, they must be passed to the parameter I\_PARAMETERS of type string.
    

Methods of a Query ¬† 

Queries are executed from interfaces IF\_OS\_QUERY and IF\_OS\_QUERY\_EXPR\_FACTORY.

Methods of the Interface IF\_OS\_QUERY ¬† 

-   IF\_OS\_QUERY~GET\_EXPR\_FACTORY
    
    Returns a reference to a query expression factory in the return parameter RESULT of type IF\_OS\_QUERY\_EXPR\_FACTORY. Technically speaking, a query expression factory is part of a query object, although it is executed using the interface IF\_OS\_QUERY\_EXPR\_FACTORY, like a separate object.
    
-   IF\_OS\_QUERY~SET\_FILTER\_EXPR
    
    Sets the [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)). The internal representation of the query condition that is created with a query expression factory is passed to the parameter I\_FILTER\_EXPR of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY~SET\_PARAMETERS\_EXPR
    
    Sets the parameter list of the [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)). The internal representation of the parameter list that is created with a query expression factory is passed to the parameter I\_PARAMETERS\_EXPR of type IF\_OS\_QUERY\_PARAMETERS\_EXPR.
    
-   IF\_OS\_QUERY~SET\_ORDERING\_EXPR
    
    Sets the [sort condition](javascript:call_link\('abenos_query_sort_cond.htm'\)). The internal representation of a sort condition created with the query expression factory is passed to the parameter I\_ORDERING\_EXPR of type IF\_OS\_QUERY\_ORDERING\_EXPR.
    
-   IF\_OS\_QUERY~PARSE
    
    Creates the internal representation of the query condition, the parameter list, and the sort condition if these have not yet been created or set.
    

Methods of the Interface IF\_OS\_QUERY\_EXPR\_FACTORY ¬† 

-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_OPERATOR\_EXPR
    
    Creates either a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    attr1 operator attr2,
    where attr1, operator, and attr2 are the values of the parameters I\_ATTR, I\_OPERATOR, and I\_ATTR2 or a query condition of the form
    attr1 operator 'val' or
    attr1 operator val\_w\_quotes
    where val and val\_w\_quotes are the values of the parameters I\_VAL and I\_VAL\_W\_QUOTES.
    
    If the parameter I\_IDX of type i is passed, val is the value of the parameter from the parameter list, for which the index when the query is executed is determined by the value of the parameter I\_IDX.
    
    The query condition that is created is returned in the return value RESULT of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_LIKE\_EXPR
    
    Depending on the value of the parameter I\_NOT, creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    attr *\[*NOT*\]* LIKE 'pattern' or
    attr *\[*NOT*\]* LIKE pattern\_w\_quotes,
    where attr, pattern, and pattern\_w\_quotes are the values of the parameters I\_ATTR, I\_PATTERN and I\_PATTERN\_W\_QUOTES.
    
    If the parameter I\_IDX of type i is passed, pattern is the value of the parameter from the parameter list, for which the index when the query is executed is determined by the value of the parameter I\_IDX.
    
    Passing one of the parameters I\_ESCAPE or I\_ESCAPE\_W\_QUOTES appends the definition of an escape character of the form ... ESCAPE 'escape' or ... ESCAPE escape\_w\_quotes where escape and escape\_w\_quotes are the values of the parameters I\_ESCAPE and I\_ESCAPE\_W\_QUOTES.
    
    The query condition that is created is returned in the return value RESULT of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_ISNULL\_EXPR
    
    Depending on the value of the parameter I\_NOT, creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    attr IS *\[*NOT*\]* NULL,
    where attr is the value of the parameter I\_ATTR.
    
    The query condition that is created is returned in the return value RESULT of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_REF\_EXPR
    
    Creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    attr EQUALSREF ref,
    where attr is the value of the parameter I\_ATTR and ref is the value of the parameter from the parameter list whose index when the query is executed is determined by the value of the parameter I\_IDX.
    
    Instead of using a parameter to set the persistent object reference, the instance GUID and class GUID can be specified using the parameters I\_GUID and I\_CLSGUID of type OS\_GUID.
    
    The query condition that is created is returned in the return value RESULT of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_NOT\_EXPR
    
    Creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    NOT ( expr ),
    where expr is a query condition that already exists and was passed to the parameter I\_EXPR.
    
    The new query condition is returned in the return value RESULT.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_AND\_EXPR
    
    Creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    ( expr1 ) AND ( expr2 )
    where expr1 or expr2 are query conditions that already exist and were passed to the parameters I\_EXPR1 or I\_EXPR2.
    
    The new query condition is returned in the return value RESULT.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_OR\_EXPR
    
    Creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    ( expr1 ) OR ( expr2 )
    where expr1 or expr2 are query conditions that already exist and were passed to the parameters I\_EXPR1 or I\_EXPR2.
    
    The new query condition is returned in the return value RESULT.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_PARAMETERS\_EXPR
    
    Creates a parameter list. The parameter list that is created is returned in return value RESULT of type IF\_OS\_QUERY\_PARAMETERS\_EXPR.
    
    The parameters are appended consecutively when the method APPEND of an additional interface IF\_OS\_QUERY\_PARAMETERS\_EXPR is called. The parameter name is passed to the parameter I\_PAR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_ORDERING\_EXPR
    
    Creates a [sort condition](javascript:call_link\('abenos_query_sort_cond.htm'\)). The sort condition is returned in the return value RESULT of type IF\_OS\_QUERY\_ORDERING\_EXPR.
    
    The attributes used for the sort are appended consecutively when the method APPEND\_ASCENDING or APPEND\_DESCENDING of the additional interface IF\_OS\_QUERY\_ORDERING\_EXPR is called. The parameter name is passed to the parameter I\_ATTR.



**üìñ Source**: [abenos_query_comps.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_comps.htm)

### abenos_query_filter_cond.htm

> **üìñ Official SAP Documentation**: [abenos_query_filter_cond.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_filter_cond.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬† [OS - Query Service](javascript:call_link\('abenabap_object_services_query.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Query%20Conditions%2C%20ABENOS_QUERY_FILTER_COND%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Query Conditions

A query condition is a logical expression that compares the attributes of a persistent class with free parameters or values. The syntax of a query condition is based on the syntax of the ABAP SQL WHERE condition, where reference variables for object references are also supported. Like a WHERE condition, a query condition is made up of elementary comparisons that can be combined using the Boolean operators AND, OR, and NOT, where grouping using parentheses is supported.

-   [Comparison Operators](#abenos-query-filter-cond-1-------like---@ITOC@@ABENOS_QUERY_FILTER_COND_2)
-   [IS NULL](#abenos-query-filter-cond-3-------equalsref---@ITOC@@ABENOS_QUERY_FILTER_COND_4)
-   [AND, OR, NOT](#abenos-query-filter-cond-5---when-a-query-is-executed-using-a-class-agent--the-query-is-bound-exactly-to-its-persistent-class--the-attributes-specified-in-a-query-condition-must-exist-in-the-persistent-class-as-public-persistent-attributes--if-not--an-exception-is-raised--on-the-other-hand--a-query-that-has-been-created-can-certainly-be-executed-consecutively-by-class-agents-of-different-persistent-classes--as-long-as-the-specified-attributes-exist--when-a-query-is-executed--a-select-statement-is-created-internally-with-a-where-condition--in-which-the-attributes-are-replaced-by-concrete-column-identifiers-and-the-free-parameters-are-replaced-by-current-values---the-elementary-comparison-operators-below-are-supported-in-a-query-condition--an-attribute--attr--of-a-persistent-class-must-be-specified-as-the-first-operand-of-a-condition--the-second-operand-operand-or-pattern-of-a-comparison-may-be-an-attribute--a-parameter-par--or-a-literal-value---the-names-of-parameters-can-be-defined-freely-by-specifying-a-parameter-list--the-parameter-list-is-a-list-of-parameter-names-that-can-be-used-in-the-query-condition--the-position-of-the-parameter-in-the-parameter-list-defines-the-index-of-the-parameter-in-the-parameter-table--if-no-parameter-list-is-specified--a-predefined-parameter-list-with-the-three-parameter-names-par1--par2--and-par3-is-used---literal-values-are-generally-enclosed-by-quotation-marks--the-semantics-of-the-comparison-operators-are-defined-by-the-corresponding-abap-sql-language-element-into-which-the-logical-expression-is-converted---hint--the-query-condition-and-its-parameter-list-are-analyzed-when-a-query-is-executed-and-transformed-into-an-internal-representation--to-bypass-parsing-each-time-the-query-is-executed--the-methods-of-the-interface-if--os--query--expr--factory-can-be-used-to-create-reusable-query-conditions-in-the-internal-representation---security-hints------the-layout-of-a-query-condition-in-a-program-is-one-of-the-dynamic-programming-techniques--if-used-incorrectly--dynamic-programming-techniques-can-present-a-serious-security-risk--any-dynamic-content-that-is-passed-to-a-program-from-the-outside-must-be-checked-thoroughly-or-escaped-before-it-is-used-in-dynamic-statements--this-can-be-done-using-the-system-class-cl--abap--dyn--prg-or-the-built-in-function--escape--javascript-call-link---abenescape-functions-htm----------to-avoid--sql-injections--javascript-call-link---abensql-injection-glosry-htm-----glossary-entry----the-use-of-parameters-from-the-parameter-list-of-a-concatenation-is-recommended--where-dynamic-values-are-represented-as-literals------see-also--sql-injections-using-object-services--javascript-call-link---abensql-inj-os-query-scrty-htm-------comparison-operators-----attr--------------------------------operand------like-----attr-----not-----like-----pattern---------escape-escape------is-null-----attr-is-----not-----null--equalsref-----attr-equalsref-par--comparison-of-two-object-references--when-the-query-is-executed--the-parameter-par-must-be-bound-to-a-reference-variable-that-refers-to-a-persistent-instance-of-a-persistent-class---and--or--not-----not-expr--expr-and-expr--expr-or-expr--the-semantics-of-the-boolean-operators-and--or--and-not-are-also-defined-by-their-semantics-in-abap-sql--explicit-parentheses-are-possible--if-no-parentheses-are-specified--the-abap-sql-priority-rules-apply---examples--price----100--and-currency----eur---name-like-par1-and-age----45--and-age----65-----department-equalsref-dep1-or-department-equalsref-dep2---and-not---salary----50000--and-currency----eur------------abenos-query-sort-cond-htm-------------as-abap-release-758---copyright-2024-sap-se--all-rights-reserved----abap---keyword-documentation--javascript-call-link---abenabap-htm---------abap---programming-language--javascript-call-link---abenabap-reference-htm---------processing-external-data--javascript-call-link---abenabap-language-external-data-htm---------abap-database-access--javascript-call-link---abendb-access-htm---------object-services--os---javascript-call-link---abenabap-object-services-htm---------os---query-service--javascript-call-link---abenabap-object-services-query-htm---------------mail-gif-object-mail-gif--feedback-mail-for-displayed-topic---mail-feedback--mailto-f1-helpsap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Sort%20Conditions%2C%20ABENOS_QUERY_SORT_COND%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Sort Conditions

A sort condition is a list of attributes attr that specifies the direction in which they are to be sorted. Only attributes with an elementary type can be specified. For each attribute, an order must be specified, either ascending or descending. This information is placed after the attribute. Only public attributes can be used.

ASCENDING ¬† 

attr ASCENDING

DESCENDING ¬† 

attr DESCENDING

Hint

The sort condition and its parameter list are analyzed when a query is executed and transformed into an internal representation. To bypass parsing each time the query is executed, the methods of the interface IF\_OS\_QUERY\_EXPR\_FACTORY can be used to create reusable sort conditions in the internal representation.

Example

price ASCENDING date DESCENDING



**üìñ Source**: [abenos_query_filter_cond.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_filter_cond.htm)

### abenos_query_abexa.htm

> **üìñ Official SAP Documentation**: [abenos_query_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬† [OS - Query Service](javascript:call_link\('abenabap_object_services_query.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Query%20Service%2C%20ABENOS_QUERY_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Query Service

This example demonstrates how an object-oriented query is used.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_query\_service DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_query\_service IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA: airpfrom TYPE s\_fromairp VALUE 'FRA',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†airpto¬†¬† TYPE s\_toairp¬†¬† VALUE 'SIN'.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = airpfrom
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = airpto )->request( ).
¬†¬†¬†¬†TYPES: BEGIN OF result,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† carrid TYPE s\_carr\_id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† connid TYPE s\_conn\_id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† END OF result,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† results TYPE TABLE OF result WITH EMPTY KEY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(query) = cl\_os\_system=>get\_query\_manager( )->create\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_filter¬†¬† = \`AIRPFROM = PAR1 AND AIRPTO = PAR2\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_ordering = \`CARRID ASCENDING CONNID ASCENDING\` ).
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(agent) = ca\_spfli\_persistent=>agent.
¬†¬†¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE results(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR <connection>
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IN agent->if\_os\_ca\_persistency~get\_persistent\_by\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_query¬†¬† = query
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_par1¬†¬†¬†¬†= airpfrom
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_par2¬†¬†¬†¬†= airpto )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( carrid = CAST cl\_spfli\_persistent(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<connection> )->get\_carrid( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = CAST cl\_spfli\_persistent(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<connection> )->get\_connid( ) ) ) ).
¬†¬†¬†¬†¬†¬†CATCH cx\_root INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

A query manager is called using the method GET\_QUERY\_MANAGER of the class CL\_OS\_SYSTEM and a query created using the method CREATE\_QUERY and a specified filter and sort conditions. The query is executed using the interface method GET\_PERSISTENT\_BY\_QUERY of the interface IF\_OS\_CA\_PERSISTENCY and the flights found are displayed.

Since the predefined parameters PAR1, PAR2 from a parameter list are used here, an [SQL injection](javascript:call_link\('abensql_injection_glosry.htm'\) "Glossary Entry") is not possible in this example.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Object Services (OS) / OS - Transaction Service

**Files**: 8 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Object Services (OS) / OS - Query Service

Included pages: 6



**üìñ Source**: [abenos_query_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_abexa.htm)

### abenabap_object_services_query.htm

> **üìñ Official SAP Documentation**: [abenabap_object_services_query.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_object_services_query.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Query%20Service%2C%20ABENABAP_OBJECT_SERVICES_QUERY%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Query Service

The query service makes it possible to search for and load persistent objects using logical expressions.

-   [Query Service Overview](javascript:call_link\('abenos_query_terms.htm'\))
-   [Query Service Components](javascript:call_link\('abenos_query_comps.htm'\))
-   [Query Conditions](javascript:call_link\('abenos_query_filter_cond.htm'\))
-   [Sort Conditions](javascript:call_link\('abenos_query_sort_cond.htm'\))

Continue
[OS - Query Service, Overview](javascript:call_link\('abenos_query_terms.htm'\))
[OS - Components of the Query Service](javascript:call_link\('abenos_query_comps.htm'\))
[OS - Query Conditions](javascript:call_link\('abenos_query_filter_cond.htm'\))
[OS - Sort Conditions](javascript:call_link\('abenos_query_sort_cond.htm'\))
![Example](exa.gif "Example") [OS - Query Service](javascript:call_link\('abenos_query_abexa.htm'\))



**üìñ Source**: [abenabap_object_services_query.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_object_services_query.htm)

### abenos_query_terms.htm

> **üìñ Official SAP Documentation**: [abenos_query_terms.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_terms.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬† [OS - Query Service](javascript:call_link\('abenabap_object_services_query.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Query%20Service%2C%20Overview%2C%20ABENOS_QUERY_TERMS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Query Service, Overview

A query is used to search for persistent objects in the database using conditions and to create the corresponding instances of the persistent class in the ABAP program.

A query is implemented by an object (query object) that implements the interface IF\_OS\_QUERY and is created by a query manager.

A query is a logical expression that compares the attributes of a persistent class with freely selectable parameters or values, known as the [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)). Those objects are loaded whose attributes meet the query conditions. A query also contains a [sort condition](javascript:call_link\('abenos_query_sort_cond.htm'\)), which determines the order of the loaded objects in the results table.

When a query is created using the query manager method CREATE\_QUERY, the query conditions and sort conditions are passed to it.

The query itself is merely a container for the query condition and the sort condition. A query is executed by calling the interface method IF\_OS\_CA\_PERSISTENCY~GET\_PERSISTENT\_BY\_QUERY in the class agent of a persistent class. Similarly, the result of an executed query is not bound to the query, and it is returned by the method of the class agent as a table of references instead.

Hint

When the result set of a query is determined, the changes that are made to persistent objects in the current transaction are ignored. The query is executed directly in the database.



**üìñ Source**: [abenos_query_terms.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_terms.htm)

### abenos_query_comps.htm

> **üìñ Official SAP Documentation**: [abenos_query_comps.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_comps.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬† [OS - Query Service](javascript:call_link\('abenabap_object_services_query.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Components%20of%20the%20Query%20Service%2C%20ABENOS_QUERY_COMPS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Components of the Query Service

A query is represented by a query object, which is managed by a query manager (also an object). The query manager represents the query service with respect to the ABAP program.

To create a query manager, the static method GET\_QUERY\_MANAGER of the general system service class CL\_OS\_SYSTEM is required.

An ABAP program does not work with the query manager and queries using class reference variables. Instead, it uses the interfaces IF\_OS\_QUERY\_MANAGER, IF\_OS\_QUERY, and IF\_OS\_QUERY\_EXPR\_FACTORY to access them.

A query is not executed directly, but using the method GET\_PERSISTENT\_BY\_QUERY of the interface IF\_OS\_CA\_PERSISTENCY of a class agent. This searches for persistent objects of the associated persistent class that match the [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)).

The options for executing a query are controlled using the interface IF\_OS\_QUERY\_OPTIONS. To do this, a structure of the type IF\_OS\_QUERY\_OPTIONS=>OPTIONS can be passed to the method GET\_PERSISTENT\_BY\_QUERY.

Relevant Method of the System Service ¬† 

Most of the components of the system service class CL\_OS\_SYSTEM are used internally by the Object Services. A method must be used in an application program to be able to work explicitly with object-oriented queries.

-   GET\_QUERY\_MANAGER
    
    This static method returns the return value RESULT of type IF\_OS\_QUERY\_MANAGER containing a reference to the Query Manager. The query manager is created when the Object Services are initialized.
    

Methods of the Query Manager ¬† 

The query manager manages the object-oriented queries of the ABAP program and is executed from interface IF\_OS\_QUERY\_MANAGER.

-   IF\_OS\_QUERY\_MANAGER~CREATE\_QUERY
    
    Creates a query and returns a reference to the query object in the return value RESULT of type IF\_OS\_QUERY. The [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) is passed to the parameter I\_FILTER of type string. The [sort condition](javascript:call_link\('abenos_query_sort_cond.htm'\)) is passed to the parameter I\_ORDERING of type string. If the parameters of the query are specified using a parameter list, they must be passed to the parameter I\_PARAMETERS of type string.
    

Methods of a Query ¬† 

Queries are executed from interfaces IF\_OS\_QUERY and IF\_OS\_QUERY\_EXPR\_FACTORY.

Methods of the Interface IF\_OS\_QUERY ¬† 

-   IF\_OS\_QUERY~GET\_EXPR\_FACTORY
    
    Returns a reference to a query expression factory in the return parameter RESULT of type IF\_OS\_QUERY\_EXPR\_FACTORY. Technically speaking, a query expression factory is part of a query object, although it is executed using the interface IF\_OS\_QUERY\_EXPR\_FACTORY, like a separate object.
    
-   IF\_OS\_QUERY~SET\_FILTER\_EXPR
    
    Sets the [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)). The internal representation of the query condition that is created with a query expression factory is passed to the parameter I\_FILTER\_EXPR of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY~SET\_PARAMETERS\_EXPR
    
    Sets the parameter list of the [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)). The internal representation of the parameter list that is created with a query expression factory is passed to the parameter I\_PARAMETERS\_EXPR of type IF\_OS\_QUERY\_PARAMETERS\_EXPR.
    
-   IF\_OS\_QUERY~SET\_ORDERING\_EXPR
    
    Sets the [sort condition](javascript:call_link\('abenos_query_sort_cond.htm'\)). The internal representation of a sort condition created with the query expression factory is passed to the parameter I\_ORDERING\_EXPR of type IF\_OS\_QUERY\_ORDERING\_EXPR.
    
-   IF\_OS\_QUERY~PARSE
    
    Creates the internal representation of the query condition, the parameter list, and the sort condition if these have not yet been created or set.
    

Methods of the Interface IF\_OS\_QUERY\_EXPR\_FACTORY ¬† 

-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_OPERATOR\_EXPR
    
    Creates either a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    attr1 operator attr2,
    where attr1, operator, and attr2 are the values of the parameters I\_ATTR, I\_OPERATOR, and I\_ATTR2 or a query condition of the form
    attr1 operator 'val' or
    attr1 operator val\_w\_quotes
    where val and val\_w\_quotes are the values of the parameters I\_VAL and I\_VAL\_W\_QUOTES.
    
    If the parameter I\_IDX of type i is passed, val is the value of the parameter from the parameter list, for which the index when the query is executed is determined by the value of the parameter I\_IDX.
    
    The query condition that is created is returned in the return value RESULT of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_LIKE\_EXPR
    
    Depending on the value of the parameter I\_NOT, creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    attr *\[*NOT*\]* LIKE 'pattern' or
    attr *\[*NOT*\]* LIKE pattern\_w\_quotes,
    where attr, pattern, and pattern\_w\_quotes are the values of the parameters I\_ATTR, I\_PATTERN and I\_PATTERN\_W\_QUOTES.
    
    If the parameter I\_IDX of type i is passed, pattern is the value of the parameter from the parameter list, for which the index when the query is executed is determined by the value of the parameter I\_IDX.
    
    Passing one of the parameters I\_ESCAPE or I\_ESCAPE\_W\_QUOTES appends the definition of an escape character of the form ... ESCAPE 'escape' or ... ESCAPE escape\_w\_quotes where escape and escape\_w\_quotes are the values of the parameters I\_ESCAPE and I\_ESCAPE\_W\_QUOTES.
    
    The query condition that is created is returned in the return value RESULT of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_ISNULL\_EXPR
    
    Depending on the value of the parameter I\_NOT, creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    attr IS *\[*NOT*\]* NULL,
    where attr is the value of the parameter I\_ATTR.
    
    The query condition that is created is returned in the return value RESULT of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_REF\_EXPR
    
    Creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    attr EQUALSREF ref,
    where attr is the value of the parameter I\_ATTR and ref is the value of the parameter from the parameter list whose index when the query is executed is determined by the value of the parameter I\_IDX.
    
    Instead of using a parameter to set the persistent object reference, the instance GUID and class GUID can be specified using the parameters I\_GUID and I\_CLSGUID of type OS\_GUID.
    
    The query condition that is created is returned in the return value RESULT of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_NOT\_EXPR
    
    Creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    NOT ( expr ),
    where expr is a query condition that already exists and was passed to the parameter I\_EXPR.
    
    The new query condition is returned in the return value RESULT.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_AND\_EXPR
    
    Creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    ( expr1 ) AND ( expr2 )
    where expr1 or expr2 are query conditions that already exist and were passed to the parameters I\_EXPR1 or I\_EXPR2.
    
    The new query condition is returned in the return value RESULT.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_OR\_EXPR
    
    Creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    ( expr1 ) OR ( expr2 )
    where expr1 or expr2 are query conditions that already exist and were passed to the parameters I\_EXPR1 or I\_EXPR2.
    
    The new query condition is returned in the return value RESULT.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_PARAMETERS\_EXPR
    
    Creates a parameter list. The parameter list that is created is returned in return value RESULT of type IF\_OS\_QUERY\_PARAMETERS\_EXPR.
    
    The parameters are appended consecutively when the method APPEND of an additional interface IF\_OS\_QUERY\_PARAMETERS\_EXPR is called. The parameter name is passed to the parameter I\_PAR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_ORDERING\_EXPR
    
    Creates a [sort condition](javascript:call_link\('abenos_query_sort_cond.htm'\)). The sort condition is returned in the return value RESULT of type IF\_OS\_QUERY\_ORDERING\_EXPR.
    
    The attributes used for the sort are appended consecutively when the method APPEND\_ASCENDING or APPEND\_DESCENDING of the additional interface IF\_OS\_QUERY\_ORDERING\_EXPR is called. The parameter name is passed to the parameter I\_ATTR.



**üìñ Source**: [abenos_query_comps.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_comps.htm)

### abenos_query_filter_cond.htm

> **üìñ Official SAP Documentation**: [abenos_query_filter_cond.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_filter_cond.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬† [OS - Query Service](javascript:call_link\('abenabap_object_services_query.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Query%20Conditions%2C%20ABENOS_QUERY_FILTER_COND%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Query Conditions

A query condition is a logical expression that compares the attributes of a persistent class with free parameters or values. The syntax of a query condition is based on the syntax of the ABAP SQL WHERE condition, where reference variables for object references are also supported. Like a WHERE condition, a query condition is made up of elementary comparisons that can be combined using the Boolean operators AND, OR, and NOT, where grouping using parentheses is supported.

-   [Comparison Operators](#abenos-query-filter-cond-1-------like---@ITOC@@ABENOS_QUERY_FILTER_COND_2)
-   [IS NULL](#abenos-query-filter-cond-3-------equalsref---@ITOC@@ABENOS_QUERY_FILTER_COND_4)
-   [AND, OR, NOT](#abenos-query-filter-cond-5---when-a-query-is-executed-using-a-class-agent--the-query-is-bound-exactly-to-its-persistent-class--the-attributes-specified-in-a-query-condition-must-exist-in-the-persistent-class-as-public-persistent-attributes--if-not--an-exception-is-raised--on-the-other-hand--a-query-that-has-been-created-can-certainly-be-executed-consecutively-by-class-agents-of-different-persistent-classes--as-long-as-the-specified-attributes-exist--when-a-query-is-executed--a-select-statement-is-created-internally-with-a-where-condition--in-which-the-attributes-are-replaced-by-concrete-column-identifiers-and-the-free-parameters-are-replaced-by-current-values---the-elementary-comparison-operators-below-are-supported-in-a-query-condition--an-attribute--attr--of-a-persistent-class-must-be-specified-as-the-first-operand-of-a-condition--the-second-operand-operand-or-pattern-of-a-comparison-may-be-an-attribute--a-parameter-par--or-a-literal-value---the-names-of-parameters-can-be-defined-freely-by-specifying-a-parameter-list--the-parameter-list-is-a-list-of-parameter-names-that-can-be-used-in-the-query-condition--the-position-of-the-parameter-in-the-parameter-list-defines-the-index-of-the-parameter-in-the-parameter-table--if-no-parameter-list-is-specified--a-predefined-parameter-list-with-the-three-parameter-names-par1--par2--and-par3-is-used---literal-values-are-generally-enclosed-by-quotation-marks--the-semantics-of-the-comparison-operators-are-defined-by-the-corresponding-abap-sql-language-element-into-which-the-logical-expression-is-converted---hint--the-query-condition-and-its-parameter-list-are-analyzed-when-a-query-is-executed-and-transformed-into-an-internal-representation--to-bypass-parsing-each-time-the-query-is-executed--the-methods-of-the-interface-if--os--query--expr--factory-can-be-used-to-create-reusable-query-conditions-in-the-internal-representation---security-hints------the-layout-of-a-query-condition-in-a-program-is-one-of-the-dynamic-programming-techniques--if-used-incorrectly--dynamic-programming-techniques-can-present-a-serious-security-risk--any-dynamic-content-that-is-passed-to-a-program-from-the-outside-must-be-checked-thoroughly-or-escaped-before-it-is-used-in-dynamic-statements--this-can-be-done-using-the-system-class-cl--abap--dyn--prg-or-the-built-in-function--escape--javascript-call-link---abenescape-functions-htm----------to-avoid--sql-injections--javascript-call-link---abensql-injection-glosry-htm-----glossary-entry----the-use-of-parameters-from-the-parameter-list-of-a-concatenation-is-recommended--where-dynamic-values-are-represented-as-literals------see-also--sql-injections-using-object-services--javascript-call-link---abensql-inj-os-query-scrty-htm-------comparison-operators-----attr--------------------------------operand------like-----attr-----not-----like-----pattern---------escape-escape------is-null-----attr-is-----not-----null--equalsref-----attr-equalsref-par--comparison-of-two-object-references--when-the-query-is-executed--the-parameter-par-must-be-bound-to-a-reference-variable-that-refers-to-a-persistent-instance-of-a-persistent-class---and--or--not-----not-expr--expr-and-expr--expr-or-expr--the-semantics-of-the-boolean-operators-and--or--and-not-are-also-defined-by-their-semantics-in-abap-sql--explicit-parentheses-are-possible--if-no-parentheses-are-specified--the-abap-sql-priority-rules-apply---examples--price----100--and-currency----eur---name-like-par1-and-age----45--and-age----65-----department-equalsref-dep1-or-department-equalsref-dep2---and-not---salary----50000--and-currency----eur------------abenos-query-sort-cond-htm-------------as-abap-release-758---copyright-2024-sap-se--all-rights-reserved----abap---keyword-documentation--javascript-call-link---abenabap-htm---------abap---programming-language--javascript-call-link---abenabap-reference-htm---------processing-external-data--javascript-call-link---abenabap-language-external-data-htm---------abap-database-access--javascript-call-link---abendb-access-htm---------object-services--os---javascript-call-link---abenabap-object-services-htm---------os---query-service--javascript-call-link---abenabap-object-services-query-htm---------------mail-gif-object-mail-gif--feedback-mail-for-displayed-topic---mail-feedback--mailto-f1-helpsap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Sort%20Conditions%2C%20ABENOS_QUERY_SORT_COND%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Sort Conditions

A sort condition is a list of attributes attr that specifies the direction in which they are to be sorted. Only attributes with an elementary type can be specified. For each attribute, an order must be specified, either ascending or descending. This information is placed after the attribute. Only public attributes can be used.

ASCENDING ¬† 

attr ASCENDING

DESCENDING ¬† 

attr DESCENDING

Hint

The sort condition and its parameter list are analyzed when a query is executed and transformed into an internal representation. To bypass parsing each time the query is executed, the methods of the interface IF\_OS\_QUERY\_EXPR\_FACTORY can be used to create reusable sort conditions in the internal representation.

Example

price ASCENDING date DESCENDING



**üìñ Source**: [abenos_query_filter_cond.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_filter_cond.htm)

### abenos_query_abexa.htm

> **üìñ Official SAP Documentation**: [abenos_query_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬† [OS - Query Service](javascript:call_link\('abenabap_object_services_query.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Query%20Service%2C%20ABENOS_QUERY_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Query Service

This example demonstrates how an object-oriented query is used.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_query\_service DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_query\_service IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA: airpfrom TYPE s\_fromairp VALUE 'FRA',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†airpto¬†¬† TYPE s\_toairp¬†¬† VALUE 'SIN'.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = airpfrom
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = airpto )->request( ).
¬†¬†¬†¬†TYPES: BEGIN OF result,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† carrid TYPE s\_carr\_id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† connid TYPE s\_conn\_id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† END OF result,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† results TYPE TABLE OF result WITH EMPTY KEY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(query) = cl\_os\_system=>get\_query\_manager( )->create\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_filter¬†¬† = \`AIRPFROM = PAR1 AND AIRPTO = PAR2\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_ordering = \`CARRID ASCENDING CONNID ASCENDING\` ).
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(agent) = ca\_spfli\_persistent=>agent.
¬†¬†¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE results(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR <connection>
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IN agent->if\_os\_ca\_persistency~get\_persistent\_by\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_query¬†¬† = query
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_par1¬†¬†¬†¬†= airpfrom
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_par2¬†¬†¬†¬†= airpto )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( carrid = CAST cl\_spfli\_persistent(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<connection> )->get\_carrid( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = CAST cl\_spfli\_persistent(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<connection> )->get\_connid( ) ) ) ).
¬†¬†¬†¬†¬†¬†CATCH cx\_root INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

A query manager is called using the method GET\_QUERY\_MANAGER of the class CL\_OS\_SYSTEM and a query created using the method CREATE\_QUERY and a specified filter and sort conditions. The query is executed using the interface method GET\_PERSISTENT\_BY\_QUERY of the interface IF\_OS\_CA\_PERSISTENCY and the flights found are displayed.

Since the predefined parameters PAR1, PAR2 from a parameter list are used here, an [SQL injection](javascript:call_link\('abensql_injection_glosry.htm'\) "Glossary Entry") is not possible in this example.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Object Services (OS) / OS - Query Service

**Files**: 6 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Object Services (OS) / OS - Query Service

Included pages: 6



**üìñ Source**: [abenos_query_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_abexa.htm)

### abenabap_object_services_query.htm

> **üìñ Official SAP Documentation**: [abenabap_object_services_query.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_object_services_query.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Query%20Service%2C%20ABENABAP_OBJECT_SERVICES_QUERY%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Query Service

The query service makes it possible to search for and load persistent objects using logical expressions.

-   [Query Service Overview](javascript:call_link\('abenos_query_terms.htm'\))
-   [Query Service Components](javascript:call_link\('abenos_query_comps.htm'\))
-   [Query Conditions](javascript:call_link\('abenos_query_filter_cond.htm'\))
-   [Sort Conditions](javascript:call_link\('abenos_query_sort_cond.htm'\))

Continue
[OS - Query Service, Overview](javascript:call_link\('abenos_query_terms.htm'\))
[OS - Components of the Query Service](javascript:call_link\('abenos_query_comps.htm'\))
[OS - Query Conditions](javascript:call_link\('abenos_query_filter_cond.htm'\))
[OS - Sort Conditions](javascript:call_link\('abenos_query_sort_cond.htm'\))
![Example](exa.gif "Example") [OS - Query Service](javascript:call_link\('abenos_query_abexa.htm'\))



**üìñ Source**: [abenabap_object_services_query.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenabap_object_services_query.htm)

### abenos_query_terms.htm

> **üìñ Official SAP Documentation**: [abenos_query_terms.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_terms.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬† [OS - Query Service](javascript:call_link\('abenabap_object_services_query.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Query%20Service%2C%20Overview%2C%20ABENOS_QUERY_TERMS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Query Service, Overview

A query is used to search for persistent objects in the database using conditions and to create the corresponding instances of the persistent class in the ABAP program.

A query is implemented by an object (query object) that implements the interface IF\_OS\_QUERY and is created by a query manager.

A query is a logical expression that compares the attributes of a persistent class with freely selectable parameters or values, known as the [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)). Those objects are loaded whose attributes meet the query conditions. A query also contains a [sort condition](javascript:call_link\('abenos_query_sort_cond.htm'\)), which determines the order of the loaded objects in the results table.

When a query is created using the query manager method CREATE\_QUERY, the query conditions and sort conditions are passed to it.

The query itself is merely a container for the query condition and the sort condition. A query is executed by calling the interface method IF\_OS\_CA\_PERSISTENCY~GET\_PERSISTENT\_BY\_QUERY in the class agent of a persistent class. Similarly, the result of an executed query is not bound to the query, and it is returned by the method of the class agent as a table of references instead.

Hint

When the result set of a query is determined, the changes that are made to persistent objects in the current transaction are ignored. The query is executed directly in the database.



**üìñ Source**: [abenos_query_terms.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_terms.htm)

### abenos_query_comps.htm

> **üìñ Official SAP Documentation**: [abenos_query_comps.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_comps.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬† [OS - Query Service](javascript:call_link\('abenabap_object_services_query.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Components%20of%20the%20Query%20Service%2C%20ABENOS_QUERY_COMPS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Components of the Query Service

A query is represented by a query object, which is managed by a query manager (also an object). The query manager represents the query service with respect to the ABAP program.

To create a query manager, the static method GET\_QUERY\_MANAGER of the general system service class CL\_OS\_SYSTEM is required.

An ABAP program does not work with the query manager and queries using class reference variables. Instead, it uses the interfaces IF\_OS\_QUERY\_MANAGER, IF\_OS\_QUERY, and IF\_OS\_QUERY\_EXPR\_FACTORY to access them.

A query is not executed directly, but using the method GET\_PERSISTENT\_BY\_QUERY of the interface IF\_OS\_CA\_PERSISTENCY of a class agent. This searches for persistent objects of the associated persistent class that match the [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)).

The options for executing a query are controlled using the interface IF\_OS\_QUERY\_OPTIONS. To do this, a structure of the type IF\_OS\_QUERY\_OPTIONS=>OPTIONS can be passed to the method GET\_PERSISTENT\_BY\_QUERY.

Relevant Method of the System Service ¬† 

Most of the components of the system service class CL\_OS\_SYSTEM are used internally by the Object Services. A method must be used in an application program to be able to work explicitly with object-oriented queries.

-   GET\_QUERY\_MANAGER
    
    This static method returns the return value RESULT of type IF\_OS\_QUERY\_MANAGER containing a reference to the Query Manager. The query manager is created when the Object Services are initialized.
    

Methods of the Query Manager ¬† 

The query manager manages the object-oriented queries of the ABAP program and is executed from interface IF\_OS\_QUERY\_MANAGER.

-   IF\_OS\_QUERY\_MANAGER~CREATE\_QUERY
    
    Creates a query and returns a reference to the query object in the return value RESULT of type IF\_OS\_QUERY. The [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) is passed to the parameter I\_FILTER of type string. The [sort condition](javascript:call_link\('abenos_query_sort_cond.htm'\)) is passed to the parameter I\_ORDERING of type string. If the parameters of the query are specified using a parameter list, they must be passed to the parameter I\_PARAMETERS of type string.
    

Methods of a Query ¬† 

Queries are executed from interfaces IF\_OS\_QUERY and IF\_OS\_QUERY\_EXPR\_FACTORY.

Methods of the Interface IF\_OS\_QUERY ¬† 

-   IF\_OS\_QUERY~GET\_EXPR\_FACTORY
    
    Returns a reference to a query expression factory in the return parameter RESULT of type IF\_OS\_QUERY\_EXPR\_FACTORY. Technically speaking, a query expression factory is part of a query object, although it is executed using the interface IF\_OS\_QUERY\_EXPR\_FACTORY, like a separate object.
    
-   IF\_OS\_QUERY~SET\_FILTER\_EXPR
    
    Sets the [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)). The internal representation of the query condition that is created with a query expression factory is passed to the parameter I\_FILTER\_EXPR of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY~SET\_PARAMETERS\_EXPR
    
    Sets the parameter list of the [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)). The internal representation of the parameter list that is created with a query expression factory is passed to the parameter I\_PARAMETERS\_EXPR of type IF\_OS\_QUERY\_PARAMETERS\_EXPR.
    
-   IF\_OS\_QUERY~SET\_ORDERING\_EXPR
    
    Sets the [sort condition](javascript:call_link\('abenos_query_sort_cond.htm'\)). The internal representation of a sort condition created with the query expression factory is passed to the parameter I\_ORDERING\_EXPR of type IF\_OS\_QUERY\_ORDERING\_EXPR.
    
-   IF\_OS\_QUERY~PARSE
    
    Creates the internal representation of the query condition, the parameter list, and the sort condition if these have not yet been created or set.
    

Methods of the Interface IF\_OS\_QUERY\_EXPR\_FACTORY ¬† 

-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_OPERATOR\_EXPR
    
    Creates either a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    attr1 operator attr2,
    where attr1, operator, and attr2 are the values of the parameters I\_ATTR, I\_OPERATOR, and I\_ATTR2 or a query condition of the form
    attr1 operator 'val' or
    attr1 operator val\_w\_quotes
    where val and val\_w\_quotes are the values of the parameters I\_VAL and I\_VAL\_W\_QUOTES.
    
    If the parameter I\_IDX of type i is passed, val is the value of the parameter from the parameter list, for which the index when the query is executed is determined by the value of the parameter I\_IDX.
    
    The query condition that is created is returned in the return value RESULT of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_LIKE\_EXPR
    
    Depending on the value of the parameter I\_NOT, creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    attr *\[*NOT*\]* LIKE 'pattern' or
    attr *\[*NOT*\]* LIKE pattern\_w\_quotes,
    where attr, pattern, and pattern\_w\_quotes are the values of the parameters I\_ATTR, I\_PATTERN and I\_PATTERN\_W\_QUOTES.
    
    If the parameter I\_IDX of type i is passed, pattern is the value of the parameter from the parameter list, for which the index when the query is executed is determined by the value of the parameter I\_IDX.
    
    Passing one of the parameters I\_ESCAPE or I\_ESCAPE\_W\_QUOTES appends the definition of an escape character of the form ... ESCAPE 'escape' or ... ESCAPE escape\_w\_quotes where escape and escape\_w\_quotes are the values of the parameters I\_ESCAPE and I\_ESCAPE\_W\_QUOTES.
    
    The query condition that is created is returned in the return value RESULT of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_ISNULL\_EXPR
    
    Depending on the value of the parameter I\_NOT, creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    attr IS *\[*NOT*\]* NULL,
    where attr is the value of the parameter I\_ATTR.
    
    The query condition that is created is returned in the return value RESULT of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_REF\_EXPR
    
    Creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    attr EQUALSREF ref,
    where attr is the value of the parameter I\_ATTR and ref is the value of the parameter from the parameter list whose index when the query is executed is determined by the value of the parameter I\_IDX.
    
    Instead of using a parameter to set the persistent object reference, the instance GUID and class GUID can be specified using the parameters I\_GUID and I\_CLSGUID of type OS\_GUID.
    
    The query condition that is created is returned in the return value RESULT of type IF\_OS\_QUERY\_FILTER\_EXPR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_NOT\_EXPR
    
    Creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    NOT ( expr ),
    where expr is a query condition that already exists and was passed to the parameter I\_EXPR.
    
    The new query condition is returned in the return value RESULT.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_AND\_EXPR
    
    Creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    ( expr1 ) AND ( expr2 )
    where expr1 or expr2 are query conditions that already exist and were passed to the parameters I\_EXPR1 or I\_EXPR2.
    
    The new query condition is returned in the return value RESULT.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_OR\_EXPR
    
    Creates a [query condition](javascript:call_link\('abenos_query_filter_cond.htm'\)) of the form
    ( expr1 ) OR ( expr2 )
    where expr1 or expr2 are query conditions that already exist and were passed to the parameters I\_EXPR1 or I\_EXPR2.
    
    The new query condition is returned in the return value RESULT.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_PARAMETERS\_EXPR
    
    Creates a parameter list. The parameter list that is created is returned in return value RESULT of type IF\_OS\_QUERY\_PARAMETERS\_EXPR.
    
    The parameters are appended consecutively when the method APPEND of an additional interface IF\_OS\_QUERY\_PARAMETERS\_EXPR is called. The parameter name is passed to the parameter I\_PAR.
    
-   IF\_OS\_QUERY\_EXPR\_FACTORY~CREATE\_ORDERING\_EXPR
    
    Creates a [sort condition](javascript:call_link\('abenos_query_sort_cond.htm'\)). The sort condition is returned in the return value RESULT of type IF\_OS\_QUERY\_ORDERING\_EXPR.
    
    The attributes used for the sort are appended consecutively when the method APPEND\_ASCENDING or APPEND\_DESCENDING of the additional interface IF\_OS\_QUERY\_ORDERING\_EXPR is called. The parameter name is passed to the parameter I\_ATTR.



**üìñ Source**: [abenos_query_comps.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_comps.htm)

### abenos_query_filter_cond.htm

> **üìñ Official SAP Documentation**: [abenos_query_filter_cond.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_filter_cond.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬† [OS - Query Service](javascript:call_link\('abenabap_object_services_query.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Query%20Conditions%2C%20ABENOS_QUERY_FILTER_COND%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Query Conditions

A query condition is a logical expression that compares the attributes of a persistent class with free parameters or values. The syntax of a query condition is based on the syntax of the ABAP SQL WHERE condition, where reference variables for object references are also supported. Like a WHERE condition, a query condition is made up of elementary comparisons that can be combined using the Boolean operators AND, OR, and NOT, where grouping using parentheses is supported.

-   [Comparison Operators](#abenos-query-filter-cond-1-------like---@ITOC@@ABENOS_QUERY_FILTER_COND_2)
-   [IS NULL](#abenos-query-filter-cond-3-------equalsref---@ITOC@@ABENOS_QUERY_FILTER_COND_4)
-   [AND, OR, NOT](#abenos-query-filter-cond-5---when-a-query-is-executed-using-a-class-agent--the-query-is-bound-exactly-to-its-persistent-class--the-attributes-specified-in-a-query-condition-must-exist-in-the-persistent-class-as-public-persistent-attributes--if-not--an-exception-is-raised--on-the-other-hand--a-query-that-has-been-created-can-certainly-be-executed-consecutively-by-class-agents-of-different-persistent-classes--as-long-as-the-specified-attributes-exist--when-a-query-is-executed--a-select-statement-is-created-internally-with-a-where-condition--in-which-the-attributes-are-replaced-by-concrete-column-identifiers-and-the-free-parameters-are-replaced-by-current-values---the-elementary-comparison-operators-below-are-supported-in-a-query-condition--an-attribute--attr--of-a-persistent-class-must-be-specified-as-the-first-operand-of-a-condition--the-second-operand-operand-or-pattern-of-a-comparison-may-be-an-attribute--a-parameter-par--or-a-literal-value---the-names-of-parameters-can-be-defined-freely-by-specifying-a-parameter-list--the-parameter-list-is-a-list-of-parameter-names-that-can-be-used-in-the-query-condition--the-position-of-the-parameter-in-the-parameter-list-defines-the-index-of-the-parameter-in-the-parameter-table--if-no-parameter-list-is-specified--a-predefined-parameter-list-with-the-three-parameter-names-par1--par2--and-par3-is-used---literal-values-are-generally-enclosed-by-quotation-marks--the-semantics-of-the-comparison-operators-are-defined-by-the-corresponding-abap-sql-language-element-into-which-the-logical-expression-is-converted---hint--the-query-condition-and-its-parameter-list-are-analyzed-when-a-query-is-executed-and-transformed-into-an-internal-representation--to-bypass-parsing-each-time-the-query-is-executed--the-methods-of-the-interface-if--os--query--expr--factory-can-be-used-to-create-reusable-query-conditions-in-the-internal-representation---security-hints------the-layout-of-a-query-condition-in-a-program-is-one-of-the-dynamic-programming-techniques--if-used-incorrectly--dynamic-programming-techniques-can-present-a-serious-security-risk--any-dynamic-content-that-is-passed-to-a-program-from-the-outside-must-be-checked-thoroughly-or-escaped-before-it-is-used-in-dynamic-statements--this-can-be-done-using-the-system-class-cl--abap--dyn--prg-or-the-built-in-function--escape--javascript-call-link---abenescape-functions-htm----------to-avoid--sql-injections--javascript-call-link---abensql-injection-glosry-htm-----glossary-entry----the-use-of-parameters-from-the-parameter-list-of-a-concatenation-is-recommended--where-dynamic-values-are-represented-as-literals------see-also--sql-injections-using-object-services--javascript-call-link---abensql-inj-os-query-scrty-htm-------comparison-operators-----attr--------------------------------operand------like-----attr-----not-----like-----pattern---------escape-escape------is-null-----attr-is-----not-----null--equalsref-----attr-equalsref-par--comparison-of-two-object-references--when-the-query-is-executed--the-parameter-par-must-be-bound-to-a-reference-variable-that-refers-to-a-persistent-instance-of-a-persistent-class---and--or--not-----not-expr--expr-and-expr--expr-or-expr--the-semantics-of-the-boolean-operators-and--or--and-not-are-also-defined-by-their-semantics-in-abap-sql--explicit-parentheses-are-possible--if-no-parentheses-are-specified--the-abap-sql-priority-rules-apply---examples--price----100--and-currency----eur---name-like-par1-and-age----45--and-age----65-----department-equalsref-dep1-or-department-equalsref-dep2---and-not---salary----50000--and-currency----eur------------abenos-query-sort-cond-htm-------------as-abap-release-758---copyright-2024-sap-se--all-rights-reserved----abap---keyword-documentation--javascript-call-link---abenabap-htm---------abap---programming-language--javascript-call-link---abenabap-reference-htm---------processing-external-data--javascript-call-link---abenabap-language-external-data-htm---------abap-database-access--javascript-call-link---abendb-access-htm---------object-services--os---javascript-call-link---abenabap-object-services-htm---------os---query-service--javascript-call-link---abenabap-object-services-query-htm---------------mail-gif-object-mail-gif--feedback-mail-for-displayed-topic---mail-feedback--mailto-f1-helpsap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Sort%20Conditions%2C%20ABENOS_QUERY_SORT_COND%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Sort Conditions

A sort condition is a list of attributes attr that specifies the direction in which they are to be sorted. Only attributes with an elementary type can be specified. For each attribute, an order must be specified, either ascending or descending. This information is placed after the attribute. Only public attributes can be used.

ASCENDING ¬† 

attr ASCENDING

DESCENDING ¬† 

attr DESCENDING

Hint

The sort condition and its parameter list are analyzed when a query is executed and transformed into an internal representation. To bypass parsing each time the query is executed, the methods of the interface IF\_OS\_QUERY\_EXPR\_FACTORY can be used to create reusable sort conditions in the internal representation.

Example

price ASCENDING date DESCENDING



**üìñ Source**: [abenos_query_filter_cond.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_filter_cond.htm)

### abenos_query_abexa.htm

> **üìñ Official SAP Documentation**: [abenos_query_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Object Services (OS)](javascript:call_link\('abenabap_object_services.htm'\))¬†‚Üí¬† [OS - Query Service](javascript:call_link\('abenabap_object_services_query.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20OS%20-%20Query%20Service%2C%20ABENOS_QUERY_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

OS - Query Service

This example demonstrates how an object-oriented query is used.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_query\_service DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_query\_service IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA: airpfrom TYPE s\_fromairp VALUE 'FRA',
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†airpto¬†¬† TYPE s\_toairp¬†¬† VALUE 'SIN'.
¬†¬†¬†¬†cl\_demo\_input=>new(
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = airpfrom
¬†¬†¬†¬†¬†¬†)->add\_field( CHANGING field = airpto )->request( ).
¬†¬†¬†¬†TYPES: BEGIN OF result,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† carrid TYPE s\_carr\_id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† connid TYPE s\_conn\_id,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† END OF result,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† results TYPE TABLE OF result WITH EMPTY KEY.
¬†¬†¬†¬†TRY.
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(query) = cl\_os\_system=>get\_query\_manager( )->create\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_filter¬†¬† = \`AIRPFROM = PAR1 AND AIRPTO = PAR2\`
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_ordering = \`CARRID ASCENDING CONNID ASCENDING\` ).
¬†¬†¬†¬†¬†¬†¬†¬†FINAL(agent) = ca\_spfli\_persistent=>agent.
¬†¬†¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†VALUE results(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†FOR <connection>
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†IN agent->if\_os\_ca\_persistency~get\_persistent\_by\_query(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_query¬†¬† = query
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_par1¬†¬†¬†¬†= airpfrom
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†i\_par2¬†¬†¬†¬†= airpto )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( carrid = CAST cl\_spfli\_persistent(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<connection> )->get\_carrid( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†connid = CAST cl\_spfli\_persistent(
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<connection> )->get\_connid( ) ) ) ).
¬†¬†¬†¬†¬†¬†CATCH cx\_root INTO FINAL(exc).
¬†¬†¬†¬†¬†¬†¬†¬†out->write( exc->get\_text( ) ).
¬†¬†¬†¬†ENDTRY.
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

A query manager is called using the method GET\_QUERY\_MANAGER of the class CL\_OS\_SYSTEM and a query created using the method CREATE\_QUERY and a specified filter and sort conditions. The query is executed using the interface method GET\_PERSISTENT\_BY\_QUERY of the interface IF\_OS\_CA\_PERSISTENCY and the flights found are displayed.

Since the predefined parameters PAR1, PAR2 from a parameter list are used here, an [SQL injection](javascript:call_link\('abensql_injection_glosry.htm'\) "Glossary Entry") is not possible in this example.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Data Consistency / Database LUW

**Files**: 5 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Database Connections

Included pages: 5



**üìñ Source**: [abenos_query_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenos_query_abexa.htm)

### abendb_connections.htm

> **üìñ Official SAP Documentation**: [abendb_connections.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Connections%2C%20ABENDB_CONNECTIONS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Database Connections

An [AS ABAP](javascript:call_link\('abenas_abap_glosry.htm'\) "Glossary Entry") uses database connections to access databases. A database connection defines the address of the database system (database host), the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry"), and hence the assigned [database schema](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") that is accessed. The [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") and [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") statements of an ABAP program and the [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry") Framework use a database connection of the current [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") to access a database. By default, the [standard connection](javascript:call_link\('abenstandard_db_connection_glosry.htm'\) "Glossary Entry") is used to access the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry") of the [standard AS ABAP database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry"). By opening a [secondary connection](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry"), it is also possible to access databases or database schemas other than the [standard database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry"). This makes possible a number of options, for example, data can be passed to and committed in other databases or in other database schemas. The [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") does not need to be part of an AS ABAP here, but it must be supported by SAP. Connections called [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") can also be used to access the standard database.

-   [Possible Database Connections](javascript:call_link\('abendb_connections_types.htm'\))
-   [Management of Database Connections](javascript:call_link\('abendb_connections_mngmnt.htm'\))
-   [Database Access Using Secondary Connections](javascript:call_link\('abendb_connections_using.htm'\))
-   [Database Connections and Transactions](javascript:call_link\('abendb_connections_trans.htm'\))

Continue
[Possible Database Connections](javascript:call_link\('abendb_connections_types.htm'\))
[Management of Database Connections](javascript:call_link\('abendb_connections_mngmnt.htm'\))
[Database Access Using Secondary Connections and Service Connections](javascript:call_link\('abendb_connections_using.htm'\))
[Database Connections and Transactions](javascript:call_link\('abendb_connections_trans.htm'\))



**üìñ Source**: [abendb_connections.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections.htm)

### abendb_connections_types.htm

> **üìñ Official SAP Documentation**: [abendb_connections_types.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_types.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Possible%20Database%20Connections%2C%20ABENDB_CONNECTIONS_TYPES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Possible Database Connections

When ABAP SQL, Native SQL, or AMDP is used in an ABAP program, the [database interface](javascript:call_link\('abendatabase_interface_glosry.htm'\) "Glossary Entry") uses a [database connection](javascript:call_link\('abendatabase_connection_glosry.htm'\) "Glossary Entry") of the current [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") to access a database. Every work process always has a standard connection to the standard database. In addition, secondary connections to other databases or database schemas can be defined. Service connections can also still be opened to the standard database.

-   [Standard Connection](#abendb-connections-types-1-------secondary-connections---@ITOC@@ABENDB_CONNECTIONS_TYPES_2)
-   [Service Connections to the Standard Database](#abendb-connections-types-3---standard-connection-----each-as-abap-work-process-always-has-a-standard-connection-to-the--standard-database--javascript-call-link---abenstandard-db-glosry-htm-----glossary-entry---and-this-connection-cannot-be-closed--it-is-shared-by-all--internal-sessions--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----if-the-standard-connection-is-used--the-work-process-acts-as-a--database-user--javascript-call-link---abendatabase-user-glosry-htm-----glossary-entry---to-which-the--abap-database-schema--javascript-call-link---abenabap-db-schema-glosry-htm-----glossary-entry---is-assigned-------by-default---abap-sql--javascript-call-link---abenabap-sql-glosry-htm-----glossary-entry-----native-sql--javascript-call-link---abenabap-sql-glosry-htm-----glossary-entry----and--amdp--javascript-call-link---abenamdp-glosry-htm-----glossary-entry---all-use-the-standard-connection-to-access-the-abap-database-schema-of-the-standard-as-abap-database------in-all-places-where-a-database-connection-can-be-specified-explicitly-in-abap--the-standard-connection-can-also-be-specified-using-the-predefined-name-default---example--specifies-the-standard-connection-explicitly-in-abap-sql--it-would-not-be-necessary-to-specify-the-connection-in-the-statements-delete-and-insert--the-statement--commit-connection--javascript-call-link---abapcommit-rollback-connection-htm------however--makes-an-explicit--database-commit--javascript-call-link---abendatabase-commit-glosry-htm-----glossary-entry---possible-on-the-standard-connection---delete-from-demo--update-connection-default--insert-demo--update-connection-default---from-( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION default.

Secondary Connections ¬† 

A secondary connection is a database connection to a [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") defined by an entry in the database table DBCON. The table key CON\_NAME of the table DBCON is the name of the secondary connection in uppercase letters under which it can be specified explicitly in ABAP. The remaining columns describe the properties of the secondary connection, such as the [database system](javascript:call_link\('abendatabase_system_glosry.htm'\) "Glossary Entry"), the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry"), and the physical address.

Entries in the database table DBCON are created and modified using the central [DBA Cockpit](javascript:call_link\('abendba_cockpit_glosry.htm'\) "Glossary Entry") tool. If the DBA Cockpit tool is not available in a system for some reason, transaction DBCO can be used instead, but this requires some expertise. DBCON should not be accessed in any other way. More specifically, the table DBCON cannot be displayed using the [Data Browser](javascript:call_link\('abendata_browser_glosry.htm'\) "Glossary Entry") tool.

The [database user name](javascript:call_link\('abendatabase_user_name_glosry.htm'\) "Glossary Entry") of the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry") used to log on the database connection to the database system is part of the definition of a secondary connection in the table DBCON. An ABAP SQL statement that uses a secondary connection accesses only that [database schema](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") that is assigned to this user.

A secondary connection must be specified explicitly before it can be used in [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") or [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"). If possible, the secondary connection is opened for the current work process or an existing inactive secondary connection with the same name is reused. Secondary connections cannot be used in [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry").

Secondary connections between an AS ABAP that has a SAP HANA database as its standard database and other non-SAP HANA secondary databases are now obsolete. [SAP HANA Smart Data Access (SDA)](https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/a07c7ff25997460bbcb73099fb59007d) should be used instead (see [SAP Note 2626805](https://launchpad.support.sap.com/#/notes/2626805)). In SDA, secondary databases are addressed from the SAP HANA database using special qualified names or by using virtual tables. If a SAP HANA database is used as a standard AS ABAP database, ABAP programs can use these names via the standard connection. This is only possible using AMDP and Native SQL, since no qualified names can be specified in ABAP SQL.

Hints

-   Secondary connections can address any number of [database schemas](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") in the [standard database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry") or databases other than the standard database as [secondary databases](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry"). An AS ABAP can, for example, access the SAP HANA database of an independently operated SAP HANA appliance.
-   The prerequisite for a [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") is that it must be a database system supported by SAP. Only this system has software for ABAP SQL and Native SQL access as a shared library.
-   If the [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") is a database system other than the standard database of the current AS ABAP, the Database Shared Library (DBSL) provided for this database by SAP and client software provided by the database vendor must be installed here before an access using a secondary connection from the table DBCON. Information about creating the DBCON entry and installing the additional software is described in the standard SAP Notes for every supported database system.
-   Once all reads on secondary database, except SAP HANA databases, have been replaced by [SDA](https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/a07c7ff25997460bbcb73099fb59007d), Shared Libraries (DBSL) are no longer required.

Example

Use of a secondary connection in ABAP SQL. The connection can be entered, and a check is made to see whether it exists in the database table DBCON. If no secondary connection exists in ABAP SQL, the uncatchable exception DBSQL\_UNKNOWN\_CONNECTION is raised.

DATA conn TYPE dbcon-con\_name.
cl\_demo\_input=>request( CHANGING field = conn ).
SELECT SINGLE @abap\_true
¬†¬†¬†¬†¬†¬† FROM dbcon
¬†¬†¬†¬†¬†¬† WHERE con\_name = @conn
¬†¬†¬†¬†¬†¬† INTO @FINAL(dbtype).
IF sy-subrc <> 0.
¬†¬†cl\_demo\_output=>display( 'Connection not in DBCON' ).
¬†¬†RETURN.
ENDIF.
DELETE FROM demo\_update CONNECTION (conn).
INSERT demo\_update CONNECTION (conn)
¬†¬†FROM @( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION (conn).

Service Connections to the Standard Database ¬† 

A service connection is a database connection defined by specifying its name in an ABAP program. The name of a service connection is R/3\*name and consists of the prefix R/3\* in uppercase letters and a definable case-sensitive name that can have between 1 and 26 alphanumeric characters.

A service connection is always a database connection to the standard database and inherits all settings from the standard connection automatically.

When a service connection is requested in [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"), [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"), or [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry"), it is opened for the current work process if possible or an existing inactive service connection with the same name is reused.

Hints

-   The freely definable name is not associated with the entries in the database table DBCON and is used only to identify a service connection. Hence, specifying a database connection from the database table DBCON for name does not mean that this database connection is used.
-   Service connections to the standard SAP database are useful for performing operations in a [database LUW](javascript:call_link\('abendb_transaction.htm'\)) that are independent of the LUW of the standard connection. It should be noted that the current [isolation level](javascript:call_link\('abendb_isolation.htm'\)) is responsible for determining whether a read from a database LUW can access data modified in a different database LUW, before this data is committed using a database commit.
-   Like secondary connections, service connections add to the number of open connections of the current work process. There can be a maximum of 16 open connections, including the standard connection itself.

Example

Use of a service connection called R/3\*service\_conn in ABAP SQL.

DELETE FROM demo\_update CONNECTION R/3\*service\_conn.
INSERT demo\_update CONNECTION R/3\*service\_conn
¬†¬†FROM @( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION R/3\*service\_conn.



**üìñ Source**: [abendb_connections_types.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_types.htm)

### abendb_connections_mngmnt.htm

> **üìñ Official SAP Documentation**: [abendb_connections_mngmnt.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_mngmnt.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Management%20of%20Database%20Connections%2C%20ABENDB_CONNECTIONS_MNGMNT%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Management of Database Connections

Database connections are managed by the ABAP runtime framework. This is done at the [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") level and the [internal session](javascript:call_link\('abeninternal_session_glosry.htm'\) "Glossary Entry") level. Each time an AS ABAP is started, a [standard connection](javascript:call_link\('abenstandard_db_connection_glosry.htm'\) "Glossary Entry") is opened for every [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") and this connection cannot be closed. In addition to the standard connection, 15 further [secondary connections](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry") or [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") can be opened for each work process. A maximum of 16 database connections can be open for each work process. On certain databases, it may not be possible to reach this number. If more than 16 database connections are opened, the runtime error DBSQL\_NO\_MORE\_CONNECTION occurs.

-   [Opening and Closing Secondary Connections and Service Connections](#abendb-connections-mngmnt-1-------active-and-inactive-secondary-connections-and-service-connections---@ITOC@@ABENDB_CONNECTIONS_MNGMNT_2)
-   [Secondary Connections and Service Connections in the Internal Session](#abendb-connections-mngmnt-3-------displaying-secondary-connections-and-service-connections---@ITOC@@ABENDB_CONNECTIONS_MNGMNT_4)

Opening and Closing Secondary Connections and Service Connections ¬† 

ABAP SQL and Native SQL can request secondary connections or service connections. AMDP can only request service connections. A secondary connection or a service connection is requested as follows:

-   Implicitly in ABAP SQL by specifying the name of the connection after the addition [CONNECTION](javascript:call_link\('abapselect_connection.htm'\))
-   Explicitly and implicitly in Native SQL using one of the following:
    -   The methods [GET\_ABAP\_CONNECTION](javascript:call_link\('abencl_sql_connection.htm'\)) and [GET\_CONNECTION](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION
    -   The statement [CONNECT TO](javascript:call_link\('abapexec_connection.htm'\)) after [EXEC SQL](javascript:call_link\('abapexec.htm'\))
-   The input parameter [CONNECTION](javascript:call_link\('abenamdp_db_connections.htm'\)) of [AMDP procedure implementations](javascript:call_link\('abenamdp_procedure_method_glosry.htm'\) "Glossary Entry") (for service connections only)

If no inactive database connection can be activated after the specified name, it is opened for the current work process and activated for the current internal session.

A secondary connection or service connection is closed explicitly in Native SQL using the following:

-   The method [CLOSE](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION
-   The statement [DISCONNECT](javascript:call_link\('abapexec_connection.htm'\)) after [EXEC SQL](javascript:call_link\('abapexec.htm'\))

If closed explicitly in Native SQL, all database changes in the current database LUW of the connection that were not yet [committed on the database](javascript:call_link\('abendb_commit.htm'\)) are discarded.

ABAP SQL does not have a statement that closes a database connection explicitly. Any secondary connection or service connection that is inactive for a specific period of time (approximately 15 minutes by default) is closed by the ABAP runtime framework implicitly.

Hints

-   Generally speaking, database connections should only be closed implicitly by the ABAP runtime framework. Since it takes a significant amount of resources to restore a connection, database connections should only be closed explicitly in the following cases:
    -   A database connection was used in such a way that unwanted side effects occur when reusing it.
    -   They are not required for a long time in the current process,
-   The method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC does not actually close a connection but makes it inactive (see below). The connection is not available via the respective connection object any more, but it can be activated again.
-   A closed connection has the status DISCONNECTED in the output of program DBCONINFO.

Example

Opening of three service connections with ABAP SQL, ADBC, and after EXEC SQL. The connection opened using ABAP SQL is closed again using Native SQL, which requires its name to be specified in uppercase letters.

TRY.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM scarr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(itab)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONNECTION r/3\*demo1.
¬†¬†¬†¬†FINAL(con) = cl\_sql\_connection=>get\_abap\_connection( \`R/3\*Demo2\` ).
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†CONNECT TO 'R/3\*Demo3'
¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†DISCONNECT 'R/3\*DEMO1'
¬†¬†¬†¬†ENDEXEC.
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.

Active and Inactive Secondary Connections and Service Connections ¬† 

An open secondary connection or service connection can be active or inactive. Once opened in ABAP SQL, Native SQL, or AMDP, a database connection is active and can be used by ABAP SQL, Native SQL, or AMDP. The secondary connection or service connection becomes inactive as soon as the current database LUW of this connection is ended. This can occur as follows:

-   Using the statements [COMMIT CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) or [ROLLBACK CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) for this connection.
-   Using the Native SQL statements COMMIT WORK or ROLLBACK WORK after [EXEC SQL](javascript:call_link\('abapexec.htm'\)) for this connection
-   Using the methods [COMMIT](javascript:call_link\('abenadbc_transaction.htm'\)) and [ROLLBACK](javascript:call_link\('abenadbc_transaction.htm'\)) of the ADBC class CL\_SQL\_CONNECTION for this connection.
-   Using the method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION for this connection. This method ends the current database LUW with a database rollback and also closes the connection for the respective ADBC connection object.
-   Using the statements [COMMIT WORK](javascript:call_link\('abapcommit.htm'\)) and [ROLLBACK WORK](javascript:call_link\('abaprollback.htm'\)) for all connections
-   In an implicit [database commit](javascript:call_link\('abendb_commit.htm'\)) or [database rollback](javascript:call_link\('abendb_rollback.htm'\)) for all connections
-   When closing the internal session in which the connection was opened, where a COMMIT CONNECTION is executed for the connection implicitly.

An inactive open secondary connection or service connection is reused by the ABAP runtime framework if it is to be reopened for its work process. Once activated in an internal session, a secondary connection or service connection can be reused here regardless of whether it is active or inactive. It is not necessary to open it again explicitly in Native SQL. When an inactive connection is reused, it is activated implicitly and a new database LUW is opened. For a shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry"), the usage can be ABAP SQL, Native SQL or ADBC, An exception to this rule are connections closed by method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC. They cannot be used via the connection object any longer.

Hints

-   When a database connection is closed explicitly in Native SQL it is actually closed and not just set to inactive. The next request must then reopen the connection for the current work process.
-   The method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC does not fully close a connection but makes it inactive. A shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") closed in such a way can be implicitly reopened as any inactive ABAP connection.
-   Active and inactive connections have the status ACTIVE and INACTIVE in the output of program DBCONINFO respectively.

Example

A service connection R/3\*DEMO is requested using ADBC and used for an SQL statement. The statement COMMIT CONNECTION ends the database LUW of the connection and sets it from active to inactive. Since the connection is a shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") and the connection name does not contain any lowercase letters, it is reused by being specified in the ABAP SQL statement INSERT. The connection is reactivated here and a new database LUW is started. A further COMMIT CONNECTION statement ends this LUW and deactivates the connection.

FINAL(conn) = CONV dbcon-con\_name( \`R/3\*DEMO\` ).
TRY.
¬†¬†¬†¬†NEW cl\_sql\_statement(
¬†¬†¬†¬†¬†¬†con\_ref =
¬†¬†¬†¬†¬†¬†¬†¬†cl\_sql\_connection=>get\_abap\_connection( con\_name = conn )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->execute\_update( \`DELETE FROM demo\_update\` ).
¬†¬†¬†¬†COMMIT CONNECTION (conn).
¬†¬†¬†¬†INSERT demo\_update CONNECTION (conn)
¬†¬†¬†¬†¬†¬†FROM @( VALUE #( id = 'X' col1 = 1
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col2 = 2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col3 = 3
¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col4 = 4 ) ).
¬†¬†¬†¬†COMMIT CONNECTION (conn).
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.

Secondary Connections and Service Connections in the Internal Session ¬† 

Active open secondary connections or service connections can only be used within the [internal session](javascript:call_link\('abeninternal_session_glosry.htm'\) "Glossary Entry") in which they are opened. An active open secondary connection or service connection is usually an [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") that can be shared by ABAP SQL, Native SQL, and AMDP within an internal session. Exceptions from this rule are connections opened in Native SQL or AMDP with lowercase letters in the name or exclusive connections opened in ADBC with method GET\_CONNECTION instead of GET\_ABAP\_CONNECTION of class CL\_SQL\_CONNECTION.

When the internal session is closed, any changes made using the connections are committed and the connections are set to inactive. When an ABAP program is called that returns to the called program (SUBMIT AND RETURN or CALL TRANSACTION), the states of any secondary connections or service connections opened here are preserved as active or inactive. They are not, however, passed to the called program. If a secondary connection or service connection with the same name is requested here, a further connection of the same type is opened.

Any shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") that becomes inactive within an internal session when its database LUW is ended can be reused in the same session without being requested explicitly, not just in ABAP SQL, but also in Native SQL or AMDP.

Example

An ABAP SQL statement requests a service connection R/3\*DEMO and then calls a further program. The called program requests a service connection with the same name. After this, two service connections with the same name are open and active for the current work process until the end of the internal session of the called program. When a return is made from the called program, its service connection is deactivated, just as the service connection of the calling program is deactivated when it is exited. No database commit was made before the call, which means that the [isolation level](javascript:call_link\('abendb_isolation.htm'\)) of the database determines whether the change made in the caller is visible in the called program.

Calling Program

DELETE FROM demo\_update CONNECTION r/3\*demo.
SUBMIT ... AND RETURN.

Called Program

SELECT \*
¬†¬†¬†¬†¬†¬† FROM demo\_update
¬†¬†¬†¬†¬†¬† INTO TABLE @DATA(itab)
¬†¬†¬†¬†¬†¬† CONNECTION r/3\*demo.

Displaying Secondary Connections and Service Connections ¬† 

The program DBCONINFO shows all database connection of all work processes in the current AS ABAP. The name R/3 in the column ConName identifies the standard connection. Other names indicate the secondary connections and service connections. The column ConState shows the states ACTIVE, INACTIVE, and DISCONNECTED. The column Hdl indicates whether a connection is a secondary connection or a service connection. Identically named secondary and service connections can occur for the following reasons:

-   Identically named connections are opened in called programs
-   Connections are opened using the method GET\_CONNECTION of the class CL\_SQL\_CONNECTION in ADBC, where the value abap\_false is used for the parameter SHARABLE
-   Connections are opened using CONNECT TO after EXEC SQL, where AS is used to specify an explicit name

Example

The program DBCONINFO can be used to explore the examples shown in this section while they are being executed step by step in the ABAP Debugger.



**üìñ Source**: [abendb_connections_mngmnt.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_mngmnt.htm)

### abendb_connections_using.htm

> **üìñ Official SAP Documentation**: [abendb_connections_using.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_using.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Access%20Using%20Secondary%20Connections%20and%20Service%20Connections%2C%20ABENDB_CONNECTIONS_USING%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%
0D%0ASuggestion%20for%20improvement:)

Database Access Using Secondary Connections and Service Connections

Secondary connections and service connections are opened and used in different ways in ABAP SQL, Native SQL, and AMDP. A secondary or service connection active for an internal session can be shared by ABAP SQL, Native SQL, or AMDP. Connections used by ABAP SQL, however, cannot have any lowercase letters in their names and ADBC can reserve connections for itself exclusively.

-   [ABAP SQL](#abendb-connections-using-1-------native-sql---adbc---@ITOC@@ABENDB_CONNECTIONS_USING_2)
-   [Native SQL - EXEC SQL](#abendb-connections-using-3-------amdp---@ITOC@@ABENDB_CONNECTIONS_USING_4)
-   [Shared ABAP Connections](#abendb-connections-using-5---abap-sql-----the-following-additions-can-be-used-to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in-abap-sql-------the-addition--connection--javascript-call-link---abapselect-connection-htm-----for-read-statements-----the-identical-addition--connection--javascript-call-link---abapiumd-conn-htm-----for-write-statements--if-the-addition-connection-is-specified-using-the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---from-the-database-table-dbcon-or-using-the-name-of-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---in-an-abap-sql-statement--the-following-applies-------if-the-specified-connection-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-given-the-state-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--or-amdp------if-the-specified-connection-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----the-abap-sql-statement-uses-this-connection-and-works-in-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry----the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp---when-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---is-used--an-abap-sql-statement-only-accesses-the--database-schema--javascript-call-link---abendatabase-schema-glosry-htm-----glossary-entry---assigned-to-the--database-user-name--javascript-call-link---abendatabase-user-name-glosry-htm-----glossary-entry---assigned-to-the-secondary-connection--abap-sql-can-only-access-database-tables-and-views-that-are-defined-in-the--abap-dictionary--javascript-call-link---abenabap-dictionary-glosry-htm-----glossary-entry---in-the-current-as-abap--which-means-that-every-database-table-or-view-accessed-using-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---must-exist-and-be-active-as-a-database-or-view-with-the-same-name-and-matching-ddic-structure-in-the-current-as-abap--regardless-of-the--secondary-database--javascript-call-link---abensecondary-db-glosry-htm-----glossary-entry---and-database-schema--for-the-database-tables-or-views-of-the-secondary-database--abap-sql-assumes-that-their--table-category--javascript-call-link---abenddic-database-tables-tab-cat-htm-----and-type-information-matches-the-local-definition-exactly--this-prerequisite-is-essential--for-example--for-the-correct-interpretation-of-the-database-content-and--if-necessary--their-conversion-with-respect-to-the-abap-types-of-the-target-fields--if-this-prerequisite-is-not-met--incorrect-data-or-runtime-errors-can-be-caused-by-reads-or-writes-depending-on-the-database-system--because-the-abap-runtime-framework-cannot-ensure-the-consistency-of-the-type-descriptions-in-the-local-and-remote-databases--the-consistency-must-be-guaranteed-by-the-relevant-application-program---the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---or--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---specified-after-connection-is-transformed-into-uppercase-letters-internally--this-must-be-respected-when-native-sql-accesses-the-connection-explicitly--conversely--an-abap-sql-statement-can-reuse-database-connections-active-in-native-sql-or-amdp-only-if-their-names-do-not-contain-any-lowercase-letters---hints------the-type-of-a-database-object-specified-in-an-abap-sql-statement-using-the-addition-connection-does-not-necessarily-need-to-match-the-type-of-the-database-object-with-the-same-name-in-the-secondary-database--for-example--a-view-with-the-same-name-in-the-secondary-database-can-be-accessed-by-specifying-a-database-table-and-vice-versa-if-they-have-the-same-structure------if-a-database-table-specified-using-the-addition-connection-in-an-abap-sql-statement-is-a--global-temporary-table--gtt---javascript-call-link---abenglobal-temporary-table-glosry-htm-----glossary-entry----it-is-handled-like-a-gtt--even-if-it-is-a-regular-transparent-table-in-the-secondary-database--conversely--there-is-no-special-handling-in-abap-sql-if-the-database-is-a-gtt-on-the-secondary-database-only------the-prerequisite-that-an-identically-named-database-object-with-a-suitable-ddic-structure-must-exist-in-the-current-system-for-views-accessed-using-a-secondary-connection-is-particularly-important-for--ddic-external-views--javascript-call-link---abenexternal-view-glosry-htm-----glossary-entry-----example--specification-of-a-database-connection-in-abap-sql---final-conn----conv-dbcon-con--name-------------delete-from-demo--update-connection--conn----native-sql---adbc-----to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in--adbc--javascript-call-link---abenadbc-glosry-htm-----glossary-entry----the-static-method--get--abap--connection--javascript-call-link---abencl-sql-connection-htm-----of-the-class-cl--sql--connection-can-be-used--the-return-value-of-the-method-is-a-reference-to-a-connection-object-that-can-be-passed-to-other-adbc-objects--using-the-input-parameter-con--name--the-method-can-be-passed-the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---from-the-database-table-dbcon-or-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry----these-names-are-case-sensitive--the-activated-connection-is-an--abap-connection--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry---that-can-be-used-in-abap-sql--native-sql--and-amdp--a-further-method--get--connection--javascript-call-link---abencl-sql-connection-htm-----works-in-a-similar-way-to-get--abap--connection--but-has-an-additional-input-parameter-sharable--which-activates-an-exclusive-connection-if-its-default-parameter-abap--false-is-used-------get--abap--connection-or-get--connection-with-abap--true-passed-to-sharable-for-shared--abap-connections--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry------------if-the-connection-passed-to-con--name-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it----------if-the-connection-passed-to-con--name-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-used--the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp------get--connection-with-abap--false-passed-to-sharable--default--for-exclusive-connections-----------a-new-connection-is-always-activated-for-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry---by-opening-a-new-connection-or-activating-an-inactive-connection-of-the-current-work-process--no-existing-active-connection-of-the-name-passed-to-con--name-is-used--a-connection-activated-like-this-can-only-be-used-exclusively-using-the-returned-connection-object-in-adbc--------after-successful-execution--get--connection-gets-a-reference-to-a-connection-object--the-connection-object-represents-the-connection-activated-or-reused-using-get--connection-in-adbc-and-can-be-passed-to-the-instance-constructors-of-the-classes-cl--sql--statement-and-cl--sql--prepared--statement--the-sql-statements-of-these-classes-are-then-executed-on-this-connection-in-its-database-luw---hints------abap--false-can-be-used-for-the-parameter-sharable-of-the-method-get--connection-to-control-the-use-of-a-database-connection-and-its-database-luw-explicitly--database-connections-that-are-activated-differently-are-usually-available-to-all-accesses-in-abap-sql-and-native-sql------if-abap--false-is-passed-to-the-parameter-sharable-of-the-method-get--connection--multiple-database-connections-with-the-same-name-can-be-activated-and-used-within-a-single-internal-session--these-are-indicated-in-the-output-of-the-program-dbconinfo-by-the-different-values-in-the-column-hdl------when-opening-exclusive-connections-for-connection-objects--the-maximum-number-of-connections-for-each-work-process-must-not-be-exceeded--exclusive-connection-should-be-closed-explicitly-once-they-are-no-longer-needed-and-if-there-are-a-large-number-of-connection-objects---example--specification-of-a-database-connection-in-adbc---final-conn----conv-dbcon-con--name-------------try------new-cl--sql--statement--------con--ref---cl--sql--connection--get--abap--connection--------------------con--name---conn----------------------execute--update----delete-from-demo--update--------catch-cx--sql--exception----------endtry---native-sql---exec-sql-----the-following-special-statements-can-be-used-to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in-native-sql-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm-----------connect-to--javascript-call-link---abapexec-connection-htm----------set-connection--javascript-call-link---abapexec-connection-htm------the-statement--connect-to--javascript-call-link---abapexec-connection-htm-----can-be-used-to-activate-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---or-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry----here--the-addition-as-can-be-used-to-open-the-same-connection-more-than-once-under-different-names--the-entries-made-here-are-case-sensitive-------if-no-name-is-specified-using-as--the-following-applies----------if-the-connection-specified-after-connect-to-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--and-amdp----------if-the-connection-specified-after-con--name-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-reused--the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp------if-a-name-is-specified-using-as--the-following-applies----------if-the-connection-specified-after-connect-to-is-not-yet-active-under-this-name-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-given-the-state-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it--a-connection-with-a-name-defined-using-as-is-only-used-by-native-sql-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm------abap-sql-and-other-kinds-of-native-sql-or-amdp-do-not-use-this-type-of-connection----------if-the-connection-specified-after-con--name-is-already-active-under-this-name-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-reused--the-connection-can-only-have-been-activated-using-connect-to---after-the-statement-connect-to--all-subsequent-native-sql-statements-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm-----in-the-current-internal-session-use-the-connection-activated-or-reused-using-connect-to--the-statement--set-connection--javascript-call-link---abapexec-connection-htm-----can-be-used-to-switch-to-the-use-of-the-previously-activated-connection-of-the-current-internal-session--here--a-name-defined-with-as-must-be-specified-using-this-connection--more-specifically--the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---can-be-activated-by-specifying-default--the-statement-set-connection-is-ignored-by-the-database-luws-of-the-connections-involved---hint--when-a-name-is-specified-after-as-in-the-statement-connect-to--multiple-database-connections-with-the-same-original-name-can-be-activated-and-used-in-the-same-internal-session--these-are-indicated-in-the-output-of-the-program-dbconinfo-by-the-different-values-in-the-column-hdl---example--specification-of-a-database-connection-after-exec-sql---final-conn----conv-dbcon-con--name-------------exec-sql----connect-to--conn-endexec--exec-sql----delete-from-demo--update-endexec---amdp-----to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---to-execute-an--amdp-procedure-implementation--javascript-call-link---abenamdp-procedure-method-glosry-htm-----glossary-entry----the-names-of--service-connections--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---can-be-passed-to-the-input-parameter--connection--javascript-call-link---abenamdp-db-connections-htm-----of-the-associated--amdp-method--javascript-call-link---abenamdp-method-glosry-htm-----glossary-entry----the-names-are-case-sensitive-here---secondary-connections--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---cannot-be-used-------if-the-passed-connection-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--and-amdp------if-the-specified-connection-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----the-procedure-implementation-is-called-using-this-connection-and-works-in-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry----the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp---hint--the-service-connections-that-can-be-used-by-amdp-are-also-connections-that-can-be-used-by-abap-sql--native-sql--and-amdp--as-long-as-the-appropriate-conditions-are-met---example--specification-of-a-database-connection-in-amdp---final-conn----conv-dbcon-con--name----r-3-----------try------new-cl--demo--amdp--connection---------------get--scarr--exporting---------------------------connection---conn---------------------------clnt---------sy-mandt-------------------------importing---------------------------carriers---final-result-------catch-cx--amdp--error-into-final-amdp--error-----------endtry---shared-abap-connections-----a-secondary-connection-or-service-connection-active-within-an-internal-session-is-an--abap-connection--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry---that-is-shared-by-abap-sql--native-sql--and-amdp-with-the-following-exceptions-------a-connection-activated-using-adbc-that-uses-the-value-abap--false-for-the-parameter-sharable-of-the-method-get--connection-of-the-class-cl--sql--connection-can-only-be-used-exclusively-using-the-associated-connection-object------a-connection-activated-after-exec-sql-with-connect-to-using-a-name-specified-after-as-can-only-be-used-between-exec-and-endexec------amdp-can-only-use-service-connections---shared-abap-connections-are-activated-as-follows-------using-the-connection-addition-of-abap-sql-statements-to-activate-the-connection-----using-either-the-method-get--abap--connection-of-the-adbc-class-cl--sql--connection-or-the-method-get--connection-with-the-value-abap--true-for-the-parameter-sharable-to-activate-the-connection------passing-the-name-to-the-input-parameter-connection-of-an-amdp-method-to-activate-the-connection------using-the-statement-connect-to-after-exec-sql-to-activate-the-connection--without-specifying-a-name-after-as---after-a-shared-abap-connection-is-activated--it-is-reused-by-all-following-accesses-from-abap-sql--native-sql--and-amdp-within-the-same-internal-session--regardless-of-how-it-was-activated---shared-abap-connections-can-be-closed-using-native-sql--as-described--here--abendb-connections-mngmnt-htm-@ITOC@@ABENDB_CONNECTIONS_MNGMNT_1). The connection can then no longer be used. When a closed connection is specified in ABAP SQL, it is opened again implicitly. If a closed connection is reused in Native SQL or AMDP an exception is raised.

Hint

When sharing database connections, it should be noted that the name of a database connection is always converted to uppercase letters in ABAP SQL. In Native SQL and AMDP, on the other hand, the name is case-sensitive. To access a database connection activated in ABAP SQL in Native SQL or AMDP, the connection must be specified in uppercase letters. Conversely, an ABAP SQL statement cannot use a database connection activated using Native SQL AMDP if its name contains lowercase letters. This mainly affects [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") and names defined using the addition AS of the statement [CONNECT TO](javascript:call_link\('abapexec_connection.htm'\)). [Secondary connections](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry"), on the other hand, must be specified in uppercase letters in Native SQL too in accordance with their spelling in the table DBCON.

Example

Use of a shared service connection in ADBC and ABAP SQL. The modifying statements are executed in a database LUW. If the name of the service connection were to contain lowercase letters or if the method GET\_CONNECTION with the value abap\_false were used for the parameter SHARABLE in ADBC, separate connections with two different database LUWs would be produced. Accessing the same database table would then usually cause a lock situation.

FINAL(conn) = CONV dbcon-con\_name( \`R/3\*DEMO\` ).
TRY.
¬†¬†¬†¬†NEW cl\_sql\_statement(
¬†¬†¬†¬†¬†¬†con\_ref = cl\_sql\_connection=>get\_abap\_connection(
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†con\_name = conn )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->execute\_update( \`DELETE FROM demo\_update\` ).
¬†¬†¬†¬†INSERT demo\_update CONNECTION (conn)
¬†¬†¬†¬†¬†¬†FROM @( VALUE #(
¬†¬†¬†¬†¬†¬†¬†¬†id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.



**üìñ Source**: [abendb_connections_using.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_using.htm)

### abendb_connections_trans.htm

> **üìñ Official SAP Documentation**: [abendb_connections_trans.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_trans.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Connections%20and%20Transactions%2C%20ABENDB_CONNECTIONS_TRANS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Database Connections and Transactions

Every active database connection creates a separate transaction context or is linked with its own [database LUW](javascript:call_link\('abendatabase_luw_glosry.htm'\) "Glossary Entry"). This means that database changes on one connection can be committed or rolled back independently of changes on other database connections. In this way, for example, log data can be stored in and committed on a secondary connection without modifying the database LUW of the standard connection.

Database changes can be committed or rolled back as follows specifically for database connections:

-   The statements [COMMIT CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) and [ROLLBACK CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) trigger targeted [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") on specific connections.
-   In ADBC, the instance methods [COMMIT](javascript:call_link\('abenadbc_transaction.htm'\)) and [ROLLBACK](javascript:call_link\('abenadbc_transaction.htm'\)) as well as [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of the class CL\_SQL\_CONNECTION trigger [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") for the connection of the current connection object.
-   In static Native SQL, the statements COMMIT WORK and ROLLBACK WORK after EXEC SQL trigger [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") for the current connection.
-   When a database connection is made inactive implicitly at the end of an internal session, a [database commit](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") is triggered.
-   When a database connection is closed explicitly in Native SQL, a [database rollback](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") is triggered.

In addition, there are the statements [COMMIT WORK](javascript:call_link\('abapcommit.htm'\)) and [ROLLBACK WORK](javascript:call_link\('abaprollback.htm'\)), as well as the implicit [database commits](javascript:call_link\('abendb_commit.htm'\)) and [database rollbacks](javascript:call_link\('abendb_rollback.htm'\)), that act on all active connections.

A secondary connection or service connection is always set to inactive when its database changes are committed or rolled back. A connection deactivated in this way can, however, still be used in the same internal session without being opened explicitly, not just in ABAP SQL, but also in Native SQL or AMDP. The first time an inactive secondary connection or service connection previously active in the current internal session is reused, it is made active again and a new database LUW is opened.

Warning

Extreme care must be taken when using SQL SET TRANSACTION statements to set the transaction behavior of the current database connection. The transaction behavior set using these statements is preserved across the entire current database LUW, which can cause unexpected or critical situations when the database connection is reused. The default behavior of the transactions must be restored before the end of the database LUW. When the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is accessed, special methods must be called for [setting the transaction behavior](javascript:call_link\('abenhana_set_transaction.htm'\)) instead of using the SQL SET TRANSACTION statements directly. In this case, the default transaction behavior is restored automatically at the end of the database LUW. No automatic resets can currently be performed for other database platforms.

Hints

-   All ABAP SQL, Native SQL, and AMDP reads made on a active shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") of an internal session work in the same database LUW.
-   The static Native SQL statement [SET CONNECTION](javascript:call_link\('abapexec_connection.htm'\)) is ignored by the database LUWs of the connections involved.
-   Secondary connections and service connections in an internal session cannot be used in called programs, which means that a called program always activates its own connection and hence its own database LUW, even if the same connection name is used.
-   Secondary connections, more specifically service connections, can be used to implement independent database LUWs on a secondary database or on the standard database. Care must be taken to avoid lock situations here.
-   Working with multiple database connections, namely independent database LUWs, can produce lock situations in which only one work process is involved: a program changes a database row on the first connection and tries to change the same row on a second connection. This results in the program waiting for the lock of the first database LUW, without this first LUW ever being able to continue. This situation can only be resolved by ending the work process. This is done automatically for dialog processes, but it must be done manually for background jobs. It is therefore not advisable to change the same table within the a single program using multiple database connections.

Example

If the statement COMMIT CONNECTION default were not used, the following program section would produce a lock situation because the standard connection (ABAP SQL here) and a service connection (Native SQL here) would be used in independent database LUWs to access the same row of a database table.

INSERT demo\_update FROM @( VALUE #( id = 'X' ) ).
DELETE FROM demo\_update.
COMMIT CONNECTION default.
DATA conn TYPE dbcon-con\_name VALUE 'R/3\*DEMO'.
EXEC SQL.
¬†¬†CONNECT TO :conn
ENDEXEC.
EXEC SQL.
¬†¬†INSERT INTO demo\_update VALUES( :sy-mandt, 'X', 1, 2, 3, 4 )
ENDEXEC.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Data Consistency / SAP LUW / Controlled SAP LUW

**Files**: 5 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Database Connections

Included pages: 5



**üìñ Source**: [abendb_connections_trans.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_trans.htm)

### abendb_connections.htm

> **üìñ Official SAP Documentation**: [abendb_connections.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Connections%2C%20ABENDB_CONNECTIONS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Database Connections

An [AS ABAP](javascript:call_link\('abenas_abap_glosry.htm'\) "Glossary Entry") uses database connections to access databases. A database connection defines the address of the database system (database host), the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry"), and hence the assigned [database schema](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") that is accessed. The [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") and [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") statements of an ABAP program and the [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry") Framework use a database connection of the current [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") to access a database. By default, the [standard connection](javascript:call_link\('abenstandard_db_connection_glosry.htm'\) "Glossary Entry") is used to access the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry") of the [standard AS ABAP database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry"). By opening a [secondary connection](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry"), it is also possible to access databases or database schemas other than the [standard database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry"). This makes possible a number of options, for example, data can be passed to and committed in other databases or in other database schemas. The [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") does not need to be part of an AS ABAP here, but it must be supported by SAP. Connections called [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") can also be used to access the standard database.

-   [Possible Database Connections](javascript:call_link\('abendb_connections_types.htm'\))
-   [Management of Database Connections](javascript:call_link\('abendb_connections_mngmnt.htm'\))
-   [Database Access Using Secondary Connections](javascript:call_link\('abendb_connections_using.htm'\))
-   [Database Connections and Transactions](javascript:call_link\('abendb_connections_trans.htm'\))

Continue
[Possible Database Connections](javascript:call_link\('abendb_connections_types.htm'\))
[Management of Database Connections](javascript:call_link\('abendb_connections_mngmnt.htm'\))
[Database Access Using Secondary Connections and Service Connections](javascript:call_link\('abendb_connections_using.htm'\))
[Database Connections and Transactions](javascript:call_link\('abendb_connections_trans.htm'\))



**üìñ Source**: [abendb_connections.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections.htm)

### abendb_connections_types.htm

> **üìñ Official SAP Documentation**: [abendb_connections_types.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_types.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Possible%20Database%20Connections%2C%20ABENDB_CONNECTIONS_TYPES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Possible Database Connections

When ABAP SQL, Native SQL, or AMDP is used in an ABAP program, the [database interface](javascript:call_link\('abendatabase_interface_glosry.htm'\) "Glossary Entry") uses a [database connection](javascript:call_link\('abendatabase_connection_glosry.htm'\) "Glossary Entry") of the current [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") to access a database. Every work process always has a standard connection to the standard database. In addition, secondary connections to other databases or database schemas can be defined. Service connections can also still be opened to the standard database.

-   [Standard Connection](#abendb-connections-types-1-------secondary-connections---@ITOC@@ABENDB_CONNECTIONS_TYPES_2)
-   [Service Connections to the Standard Database](#abendb-connections-types-3---standard-connection-----each-as-abap-work-process-always-has-a-standard-connection-to-the--standard-database--javascript-call-link---abenstandard-db-glosry-htm-----glossary-entry---and-this-connection-cannot-be-closed--it-is-shared-by-all--internal-sessions--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----if-the-standard-connection-is-used--the-work-process-acts-as-a--database-user--javascript-call-link---abendatabase-user-glosry-htm-----glossary-entry---to-which-the--abap-database-schema--javascript-call-link---abenabap-db-schema-glosry-htm-----glossary-entry---is-assigned-------by-default---abap-sql--javascript-call-link---abenabap-sql-glosry-htm-----glossary-entry-----native-sql--javascript-call-link---abenabap-sql-glosry-htm-----glossary-entry----and--amdp--javascript-call-link---abenamdp-glosry-htm-----glossary-entry---all-use-the-standard-connection-to-access-the-abap-database-schema-of-the-standard-as-abap-database------in-all-places-where-a-database-connection-can-be-specified-explicitly-in-abap--the-standard-connection-can-also-be-specified-using-the-predefined-name-default---example--specifies-the-standard-connection-explicitly-in-abap-sql--it-would-not-be-necessary-to-specify-the-connection-in-the-statements-delete-and-insert--the-statement--commit-connection--javascript-call-link---abapcommit-rollback-connection-htm------however--makes-an-explicit--database-commit--javascript-call-link---abendatabase-commit-glosry-htm-----glossary-entry---possible-on-the-standard-connection---delete-from-demo--update-connection-default--insert-demo--update-connection-default---from-( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION default.

Secondary Connections ¬† 

A secondary connection is a database connection to a [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") defined by an entry in the database table DBCON. The table key CON\_NAME of the table DBCON is the name of the secondary connection in uppercase letters under which it can be specified explicitly in ABAP. The remaining columns describe the properties of the secondary connection, such as the [database system](javascript:call_link\('abendatabase_system_glosry.htm'\) "Glossary Entry"), the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry"), and the physical address.

Entries in the database table DBCON are created and modified using the central [DBA Cockpit](javascript:call_link\('abendba_cockpit_glosry.htm'\) "Glossary Entry") tool. If the DBA Cockpit tool is not available in a system for some reason, transaction DBCO can be used instead, but this requires some expertise. DBCON should not be accessed in any other way. More specifically, the table DBCON cannot be displayed using the [Data Browser](javascript:call_link\('abendata_browser_glosry.htm'\) "Glossary Entry") tool.

The [database user name](javascript:call_link\('abendatabase_user_name_glosry.htm'\) "Glossary Entry") of the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry") used to log on the database connection to the database system is part of the definition of a secondary connection in the table DBCON. An ABAP SQL statement that uses a secondary connection accesses only that [database schema](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") that is assigned to this user.

A secondary connection must be specified explicitly before it can be used in [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") or [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"). If possible, the secondary connection is opened for the current work process or an existing inactive secondary connection with the same name is reused. Secondary connections cannot be used in [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry").

Secondary connections between an AS ABAP that has a SAP HANA database as its standard database and other non-SAP HANA secondary databases are now obsolete. [SAP HANA Smart Data Access (SDA)](https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/a07c7ff25997460bbcb73099fb59007d) should be used instead (see [SAP Note 2626805](https://launchpad.support.sap.com/#/notes/2626805)). In SDA, secondary databases are addressed from the SAP HANA database using special qualified names or by using virtual tables. If a SAP HANA database is used as a standard AS ABAP database, ABAP programs can use these names via the standard connection. This is only possible using AMDP and Native SQL, since no qualified names can be specified in ABAP SQL.

Hints

-   Secondary connections can address any number of [database schemas](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") in the [standard database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry") or databases other than the standard database as [secondary databases](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry"). An AS ABAP can, for example, access the SAP HANA database of an independently operated SAP HANA appliance.
-   The prerequisite for a [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") is that it must be a database system supported by SAP. Only this system has software for ABAP SQL and Native SQL access as a shared library.
-   If the [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") is a database system other than the standard database of the current AS ABAP, the Database Shared Library (DBSL) provided for this database by SAP and client software provided by the database vendor must be installed here before an access using a secondary connection from the table DBCON. Information about creating the DBCON entry and installing the additional software is described in the standard SAP Notes for every supported database system.
-   Once all reads on secondary database, except SAP HANA databases, have been replaced by [SDA](https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/a07c7ff25997460bbcb73099fb59007d), Shared Libraries (DBSL) are no longer required.

Example

Use of a secondary connection in ABAP SQL. The connection can be entered, and a check is made to see whether it exists in the database table DBCON. If no secondary connection exists in ABAP SQL, the uncatchable exception DBSQL\_UNKNOWN\_CONNECTION is raised.

DATA conn TYPE dbcon-con\_name.
cl\_demo\_input=>request( CHANGING field = conn ).
SELECT SINGLE @abap\_true
¬†¬†¬†¬†¬†¬† FROM dbcon
¬†¬†¬†¬†¬†¬† WHERE con\_name = @conn
¬†¬†¬†¬†¬†¬† INTO @FINAL(dbtype).
IF sy-subrc <> 0.
¬†¬†cl\_demo\_output=>display( 'Connection not in DBCON' ).
¬†¬†RETURN.
ENDIF.
DELETE FROM demo\_update CONNECTION (conn).
INSERT demo\_update CONNECTION (conn)
¬†¬†FROM @( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION (conn).

Service Connections to the Standard Database ¬† 

A service connection is a database connection defined by specifying its name in an ABAP program. The name of a service connection is R/3\*name and consists of the prefix R/3\* in uppercase letters and a definable case-sensitive name that can have between 1 and 26 alphanumeric characters.

A service connection is always a database connection to the standard database and inherits all settings from the standard connection automatically.

When a service connection is requested in [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"), [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"), or [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry"), it is opened for the current work process if possible or an existing inactive service connection with the same name is reused.

Hints

-   The freely definable name is not associated with the entries in the database table DBCON and is used only to identify a service connection. Hence, specifying a database connection from the database table DBCON for name does not mean that this database connection is used.
-   Service connections to the standard SAP database are useful for performing operations in a [database LUW](javascript:call_link\('abendb_transaction.htm'\)) that are independent of the LUW of the standard connection. It should be noted that the current [isolation level](javascript:call_link\('abendb_isolation.htm'\)) is responsible for determining whether a read from a database LUW can access data modified in a different database LUW, before this data is committed using a database commit.
-   Like secondary connections, service connections add to the number of open connections of the current work process. There can be a maximum of 16 open connections, including the standard connection itself.

Example

Use of a service connection called R/3\*service\_conn in ABAP SQL.

DELETE FROM demo\_update CONNECTION R/3\*service\_conn.
INSERT demo\_update CONNECTION R/3\*service\_conn
¬†¬†FROM @( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION R/3\*service\_conn.



**üìñ Source**: [abendb_connections_types.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_types.htm)

### abendb_connections_mngmnt.htm

> **üìñ Official SAP Documentation**: [abendb_connections_mngmnt.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_mngmnt.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Management%20of%20Database%20Connections%2C%20ABENDB_CONNECTIONS_MNGMNT%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Management of Database Connections

Database connections are managed by the ABAP runtime framework. This is done at the [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") level and the [internal session](javascript:call_link\('abeninternal_session_glosry.htm'\) "Glossary Entry") level. Each time an AS ABAP is started, a [standard connection](javascript:call_link\('abenstandard_db_connection_glosry.htm'\) "Glossary Entry") is opened for every [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") and this connection cannot be closed. In addition to the standard connection, 15 further [secondary connections](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry") or [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") can be opened for each work process. A maximum of 16 database connections can be open for each work process. On certain databases, it may not be possible to reach this number. If more than 16 database connections are opened, the runtime error DBSQL\_NO\_MORE\_CONNECTION occurs.

-   [Opening and Closing Secondary Connections and Service Connections](#abendb-connections-mngmnt-1-------active-and-inactive-secondary-connections-and-service-connections---@ITOC@@ABENDB_CONNECTIONS_MNGMNT_2)
-   [Secondary Connections and Service Connections in the Internal Session](#abendb-connections-mngmnt-3-------displaying-secondary-connections-and-service-connections---@ITOC@@ABENDB_CONNECTIONS_MNGMNT_4)

Opening and Closing Secondary Connections and Service Connections ¬† 

ABAP SQL and Native SQL can request secondary connections or service connections. AMDP can only request service connections. A secondary connection or a service connection is requested as follows:

-   Implicitly in ABAP SQL by specifying the name of the connection after the addition [CONNECTION](javascript:call_link\('abapselect_connection.htm'\))
-   Explicitly and implicitly in Native SQL using one of the following:
    -   The methods [GET\_ABAP\_CONNECTION](javascript:call_link\('abencl_sql_connection.htm'\)) and [GET\_CONNECTION](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION
    -   The statement [CONNECT TO](javascript:call_link\('abapexec_connection.htm'\)) after [EXEC SQL](javascript:call_link\('abapexec.htm'\))
-   The input parameter [CONNECTION](javascript:call_link\('abenamdp_db_connections.htm'\)) of [AMDP procedure implementations](javascript:call_link\('abenamdp_procedure_method_glosry.htm'\) "Glossary Entry") (for service connections only)

If no inactive database connection can be activated after the specified name, it is opened for the current work process and activated for the current internal session.

A secondary connection or service connection is closed explicitly in Native SQL using the following:

-   The method [CLOSE](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION
-   The statement [DISCONNECT](javascript:call_link\('abapexec_connection.htm'\)) after [EXEC SQL](javascript:call_link\('abapexec.htm'\))

If closed explicitly in Native SQL, all database changes in the current database LUW of the connection that were not yet [committed on the database](javascript:call_link\('abendb_commit.htm'\)) are discarded.

ABAP SQL does not have a statement that closes a database connection explicitly. Any secondary connection or service connection that is inactive for a specific period of time (approximately 15 minutes by default) is closed by the ABAP runtime framework implicitly.

Hints

-   Generally speaking, database connections should only be closed implicitly by the ABAP runtime framework. Since it takes a significant amount of resources to restore a connection, database connections should only be closed explicitly in the following cases:
    -   A database connection was used in such a way that unwanted side effects occur when reusing it.
    -   They are not required for a long time in the current process,
-   The method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC does not actually close a connection but makes it inactive (see below). The connection is not available via the respective connection object any more, but it can be activated again.
-   A closed connection has the status DISCONNECTED in the output of program DBCONINFO.

Example

Opening of three service connections with ABAP SQL, ADBC, and after EXEC SQL. The connection opened using ABAP SQL is closed again using Native SQL, which requires its name to be specified in uppercase letters.

TRY.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM scarr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(itab)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONNECTION r/3\*demo1.
¬†¬†¬†¬†FINAL(con) = cl\_sql\_connection=>get\_abap\_connection( \`R/3\*Demo2\` ).
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†CONNECT TO 'R/3\*Demo3'
¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†DISCONNECT 'R/3\*DEMO1'
¬†¬†¬†¬†ENDEXEC.
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.

Active and Inactive Secondary Connections and Service Connections ¬† 

An open secondary connection or service connection can be active or inactive. Once opened in ABAP SQL, Native SQL, or AMDP, a database connection is active and can be used by ABAP SQL, Native SQL, or AMDP. The secondary connection or service connection becomes inactive as soon as the current database LUW of this connection is ended. This can occur as follows:

-   Using the statements [COMMIT CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) or [ROLLBACK CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) for this connection.
-   Using the Native SQL statements COMMIT WORK or ROLLBACK WORK after [EXEC SQL](javascript:call_link\('abapexec.htm'\)) for this connection
-   Using the methods [COMMIT](javascript:call_link\('abenadbc_transaction.htm'\)) and [ROLLBACK](javascript:call_link\('abenadbc_transaction.htm'\)) of the ADBC class CL\_SQL\_CONNECTION for this connection.
-   Using the method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION for this connection. This method ends the current database LUW with a database rollback and also closes the connection for the respective ADBC connection object.
-   Using the statements [COMMIT WORK](javascript:call_link\('abapcommit.htm'\)) and [ROLLBACK WORK](javascript:call_link\('abaprollback.htm'\)) for all connections
-   In an implicit [database commit](javascript:call_link\('abendb_commit.htm'\)) or [database rollback](javascript:call_link\('abendb_rollback.htm'\)) for all connections
-   When closing the internal session in which the connection was opened, where a COMMIT CONNECTION is executed for the connection implicitly.

An inactive open secondary connection or service connection is reused by the ABAP runtime framework if it is to be reopened for its work process. Once activated in an internal session, a secondary connection or service connection can be reused here regardless of whether it is active or inactive. It is not necessary to open it again explicitly in Native SQL. When an inactive connection is reused, it is activated implicitly and a new database LUW is opened. For a shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry"), the usage can be ABAP SQL, Native SQL or ADBC, An exception to this rule are connections closed by method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC. They cannot be used via the connection object any longer.

Hints

-   When a database connection is closed explicitly in Native SQL it is actually closed and not just set to inactive. The next request must then reopen the connection for the current work process.
-   The method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC does not fully close a connection but makes it inactive. A shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") closed in such a way can be implicitly reopened as any inactive ABAP connection.
-   Active and inactive connections have the status ACTIVE and INACTIVE in the output of program DBCONINFO respectively.

Example

A service connection R/3\*DEMO is requested using ADBC and used for an SQL statement. The statement COMMIT CONNECTION ends the database LUW of the connection and sets it from active to inactive. Since the connection is a shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") and the connection name does not contain any lowercase letters, it is reused by being specified in the ABAP SQL statement INSERT. The connection is reactivated here and a new database LUW is started. A further COMMIT CONNECTION statement ends this LUW and deactivates the connection.

FINAL(conn) = CONV dbcon-con\_name( \`R/3\*DEMO\` ).
TRY.
¬†¬†¬†¬†NEW cl\_sql\_statement(
¬†¬†¬†¬†¬†¬†con\_ref =
¬†¬†¬†¬†¬†¬†¬†¬†cl\_sql\_connection=>get\_abap\_connection( con\_name = conn )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->execute\_update( \`DELETE FROM demo\_update\` ).
¬†¬†¬†¬†COMMIT CONNECTION (conn).
¬†¬†¬†¬†INSERT demo\_update CONNECTION (conn)
¬†¬†¬†¬†¬†¬†FROM @( VALUE #( id = 'X' col1 = 1
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col2 = 2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col3 = 3
¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col4 = 4 ) ).
¬†¬†¬†¬†COMMIT CONNECTION (conn).
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.

Secondary Connections and Service Connections in the Internal Session ¬† 

Active open secondary connections or service connections can only be used within the [internal session](javascript:call_link\('abeninternal_session_glosry.htm'\) "Glossary Entry") in which they are opened. An active open secondary connection or service connection is usually an [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") that can be shared by ABAP SQL, Native SQL, and AMDP within an internal session. Exceptions from this rule are connections opened in Native SQL or AMDP with lowercase letters in the name or exclusive connections opened in ADBC with method GET\_CONNECTION instead of GET\_ABAP\_CONNECTION of class CL\_SQL\_CONNECTION.

When the internal session is closed, any changes made using the connections are committed and the connections are set to inactive. When an ABAP program is called that returns to the called program (SUBMIT AND RETURN or CALL TRANSACTION), the states of any secondary connections or service connections opened here are preserved as active or inactive. They are not, however, passed to the called program. If a secondary connection or service connection with the same name is requested here, a further connection of the same type is opened.

Any shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") that becomes inactive within an internal session when its database LUW is ended can be reused in the same session without being requested explicitly, not just in ABAP SQL, but also in Native SQL or AMDP.

Example

An ABAP SQL statement requests a service connection R/3\*DEMO and then calls a further program. The called program requests a service connection with the same name. After this, two service connections with the same name are open and active for the current work process until the end of the internal session of the called program. When a return is made from the called program, its service connection is deactivated, just as the service connection of the calling program is deactivated when it is exited. No database commit was made before the call, which means that the [isolation level](javascript:call_link\('abendb_isolation.htm'\)) of the database determines whether the change made in the caller is visible in the called program.

Calling Program

DELETE FROM demo\_update CONNECTION r/3\*demo.
SUBMIT ... AND RETURN.

Called Program

SELECT \*
¬†¬†¬†¬†¬†¬† FROM demo\_update
¬†¬†¬†¬†¬†¬† INTO TABLE @DATA(itab)
¬†¬†¬†¬†¬†¬† CONNECTION r/3\*demo.

Displaying Secondary Connections and Service Connections ¬† 

The program DBCONINFO shows all database connection of all work processes in the current AS ABAP. The name R/3 in the column ConName identifies the standard connection. Other names indicate the secondary connections and service connections. The column ConState shows the states ACTIVE, INACTIVE, and DISCONNECTED. The column Hdl indicates whether a connection is a secondary connection or a service connection. Identically named secondary and service connections can occur for the following reasons:

-   Identically named connections are opened in called programs
-   Connections are opened using the method GET\_CONNECTION of the class CL\_SQL\_CONNECTION in ADBC, where the value abap\_false is used for the parameter SHARABLE
-   Connections are opened using CONNECT TO after EXEC SQL, where AS is used to specify an explicit name

Example

The program DBCONINFO can be used to explore the examples shown in this section while they are being executed step by step in the ABAP Debugger.



**üìñ Source**: [abendb_connections_mngmnt.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_mngmnt.htm)

### abendb_connections_using.htm

> **üìñ Official SAP Documentation**: [abendb_connections_using.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_using.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Access%20Using%20Secondary%20Connections%20and%20Service%20Connections%2C%20ABENDB_CONNECTIONS_USING%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%
0D%0ASuggestion%20for%20improvement:)

Database Access Using Secondary Connections and Service Connections

Secondary connections and service connections are opened and used in different ways in ABAP SQL, Native SQL, and AMDP. A secondary or service connection active for an internal session can be shared by ABAP SQL, Native SQL, or AMDP. Connections used by ABAP SQL, however, cannot have any lowercase letters in their names and ADBC can reserve connections for itself exclusively.

-   [ABAP SQL](#abendb-connections-using-1-------native-sql---adbc---@ITOC@@ABENDB_CONNECTIONS_USING_2)
-   [Native SQL - EXEC SQL](#abendb-connections-using-3-------amdp---@ITOC@@ABENDB_CONNECTIONS_USING_4)
-   [Shared ABAP Connections](#abendb-connections-using-5---abap-sql-----the-following-additions-can-be-used-to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in-abap-sql-------the-addition--connection--javascript-call-link---abapselect-connection-htm-----for-read-statements-----the-identical-addition--connection--javascript-call-link---abapiumd-conn-htm-----for-write-statements--if-the-addition-connection-is-specified-using-the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---from-the-database-table-dbcon-or-using-the-name-of-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---in-an-abap-sql-statement--the-following-applies-------if-the-specified-connection-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-given-the-state-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--or-amdp------if-the-specified-connection-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----the-abap-sql-statement-uses-this-connection-and-works-in-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry----the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp---when-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---is-used--an-abap-sql-statement-only-accesses-the--database-schema--javascript-call-link---abendatabase-schema-glosry-htm-----glossary-entry---assigned-to-the--database-user-name--javascript-call-link---abendatabase-user-name-glosry-htm-----glossary-entry---assigned-to-the-secondary-connection--abap-sql-can-only-access-database-tables-and-views-that-are-defined-in-the--abap-dictionary--javascript-call-link---abenabap-dictionary-glosry-htm-----glossary-entry---in-the-current-as-abap--which-means-that-every-database-table-or-view-accessed-using-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---must-exist-and-be-active-as-a-database-or-view-with-the-same-name-and-matching-ddic-structure-in-the-current-as-abap--regardless-of-the--secondary-database--javascript-call-link---abensecondary-db-glosry-htm-----glossary-entry---and-database-schema--for-the-database-tables-or-views-of-the-secondary-database--abap-sql-assumes-that-their--table-category--javascript-call-link---abenddic-database-tables-tab-cat-htm-----and-type-information-matches-the-local-definition-exactly--this-prerequisite-is-essential--for-example--for-the-correct-interpretation-of-the-database-content-and--if-necessary--their-conversion-with-respect-to-the-abap-types-of-the-target-fields--if-this-prerequisite-is-not-met--incorrect-data-or-runtime-errors-can-be-caused-by-reads-or-writes-depending-on-the-database-system--because-the-abap-runtime-framework-cannot-ensure-the-consistency-of-the-type-descriptions-in-the-local-and-remote-databases--the-consistency-must-be-guaranteed-by-the-relevant-application-program---the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---or--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---specified-after-connection-is-transformed-into-uppercase-letters-internally--this-must-be-respected-when-native-sql-accesses-the-connection-explicitly--conversely--an-abap-sql-statement-can-reuse-database-connections-active-in-native-sql-or-amdp-only-if-their-names-do-not-contain-any-lowercase-letters---hints------the-type-of-a-database-object-specified-in-an-abap-sql-statement-using-the-addition-connection-does-not-necessarily-need-to-match-the-type-of-the-database-object-with-the-same-name-in-the-secondary-database--for-example--a-view-with-the-same-name-in-the-secondary-database-can-be-accessed-by-specifying-a-database-table-and-vice-versa-if-they-have-the-same-structure------if-a-database-table-specified-using-the-addition-connection-in-an-abap-sql-statement-is-a--global-temporary-table--gtt---javascript-call-link---abenglobal-temporary-table-glosry-htm-----glossary-entry----it-is-handled-like-a-gtt--even-if-it-is-a-regular-transparent-table-in-the-secondary-database--conversely--there-is-no-special-handling-in-abap-sql-if-the-database-is-a-gtt-on-the-secondary-database-only------the-prerequisite-that-an-identically-named-database-object-with-a-suitable-ddic-structure-must-exist-in-the-current-system-for-views-accessed-using-a-secondary-connection-is-particularly-important-for--ddic-external-views--javascript-call-link---abenexternal-view-glosry-htm-----glossary-entry-----example--specification-of-a-database-connection-in-abap-sql---final-conn----conv-dbcon-con--name-------------delete-from-demo--update-connection--conn----native-sql---adbc-----to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in--adbc--javascript-call-link---abenadbc-glosry-htm-----glossary-entry----the-static-method--get--abap--connection--javascript-call-link---abencl-sql-connection-htm-----of-the-class-cl--sql--connection-can-be-used--the-return-value-of-the-method-is-a-reference-to-a-connection-object-that-can-be-passed-to-other-adbc-objects--using-the-input-parameter-con--name--the-method-can-be-passed-the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---from-the-database-table-dbcon-or-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry----these-names-are-case-sensitive--the-activated-connection-is-an--abap-connection--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry---that-can-be-used-in-abap-sql--native-sql--and-amdp--a-further-method--get--connection--javascript-call-link---abencl-sql-connection-htm-----works-in-a-similar-way-to-get--abap--connection--but-has-an-additional-input-parameter-sharable--which-activates-an-exclusive-connection-if-its-default-parameter-abap--false-is-used-------get--abap--connection-or-get--connection-with-abap--true-passed-to-sharable-for-shared--abap-connections--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry------------if-the-connection-passed-to-con--name-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it----------if-the-connection-passed-to-con--name-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-used--the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp------get--connection-with-abap--false-passed-to-sharable--default--for-exclusive-connections-----------a-new-connection-is-always-activated-for-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry---by-opening-a-new-connection-or-activating-an-inactive-connection-of-the-current-work-process--no-existing-active-connection-of-the-name-passed-to-con--name-is-used--a-connection-activated-like-this-can-only-be-used-exclusively-using-the-returned-connection-object-in-adbc--------after-successful-execution--get--connection-gets-a-reference-to-a-connection-object--the-connection-object-represents-the-connection-activated-or-reused-using-get--connection-in-adbc-and-can-be-passed-to-the-instance-constructors-of-the-classes-cl--sql--statement-and-cl--sql--prepared--statement--the-sql-statements-of-these-classes-are-then-executed-on-this-connection-in-its-database-luw---hints------abap--false-can-be-used-for-the-parameter-sharable-of-the-method-get--connection-to-control-the-use-of-a-database-connection-and-its-database-luw-explicitly--database-connections-that-are-activated-differently-are-usually-available-to-all-accesses-in-abap-sql-and-native-sql------if-abap--false-is-passed-to-the-parameter-sharable-of-the-method-get--connection--multiple-database-connections-with-the-same-name-can-be-activated-and-used-within-a-single-internal-session--these-are-indicated-in-the-output-of-the-program-dbconinfo-by-the-different-values-in-the-column-hdl------when-opening-exclusive-connections-for-connection-objects--the-maximum-number-of-connections-for-each-work-process-must-not-be-exceeded--exclusive-connection-should-be-closed-explicitly-once-they-are-no-longer-needed-and-if-there-are-a-large-number-of-connection-objects---example--specification-of-a-database-connection-in-adbc---final-conn----conv-dbcon-con--name-------------try------new-cl--sql--statement--------con--ref---cl--sql--connection--get--abap--connection--------------------con--name---conn----------------------execute--update----delete-from-demo--update--------catch-cx--sql--exception----------endtry---native-sql---exec-sql-----the-following-special-statements-can-be-used-to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in-native-sql-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm-----------connect-to--javascript-call-link---abapexec-connection-htm----------set-connection--javascript-call-link---abapexec-connection-htm------the-statement--connect-to--javascript-call-link---abapexec-connection-htm-----can-be-used-to-activate-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---or-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry----here--the-addition-as-can-be-used-to-open-the-same-connection-more-than-once-under-different-names--the-entries-made-here-are-case-sensitive-------if-no-name-is-specified-using-as--the-following-applies----------if-the-connection-specified-after-connect-to-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--and-amdp----------if-the-connection-specified-after-con--name-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-reused--the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp------if-a-name-is-specified-using-as--the-following-applies----------if-the-connection-specified-after-connect-to-is-not-yet-active-under-this-name-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-given-the-state-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it--a-connection-with-a-name-defined-using-as-is-only-used-by-native-sql-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm------abap-sql-and-other-kinds-of-native-sql-or-amdp-do-not-use-this-type-of-connection----------if-the-connection-specified-after-con--name-is-already-active-under-this-name-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-reused--the-connection-can-only-have-been-activated-using-connect-to---after-the-statement-connect-to--all-subsequent-native-sql-statements-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm-----in-the-current-internal-session-use-the-connection-activated-or-reused-using-connect-to--the-statement--set-connection--javascript-call-link---abapexec-connection-htm-----can-be-used-to-switch-to-the-use-of-the-previously-activated-connection-of-the-current-internal-session--here--a-name-defined-with-as-must-be-specified-using-this-connection--more-specifically--the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---can-be-activated-by-specifying-default--the-statement-set-connection-is-ignored-by-the-database-luws-of-the-connections-involved---hint--when-a-name-is-specified-after-as-in-the-statement-connect-to--multiple-database-connections-with-the-same-original-name-can-be-activated-and-used-in-the-same-internal-session--these-are-indicated-in-the-output-of-the-program-dbconinfo-by-the-different-values-in-the-column-hdl---example--specification-of-a-database-connection-after-exec-sql---final-conn----conv-dbcon-con--name-------------exec-sql----connect-to--conn-endexec--exec-sql----delete-from-demo--update-endexec---amdp-----to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---to-execute-an--amdp-procedure-implementation--javascript-call-link---abenamdp-procedure-method-glosry-htm-----glossary-entry----the-names-of--service-connections--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---can-be-passed-to-the-input-parameter--connection--javascript-call-link---abenamdp-db-connections-htm-----of-the-associated--amdp-method--javascript-call-link---abenamdp-method-glosry-htm-----glossary-entry----the-names-are-case-sensitive-here---secondary-connections--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---cannot-be-used-------if-the-passed-connection-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--and-amdp------if-the-specified-connection-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----the-procedure-implementation-is-called-using-this-connection-and-works-in-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry----the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp---hint--the-service-connections-that-can-be-used-by-amdp-are-also-connections-that-can-be-used-by-abap-sql--native-sql--and-amdp--as-long-as-the-appropriate-conditions-are-met---example--specification-of-a-database-connection-in-amdp---final-conn----conv-dbcon-con--name----r-3-----------try------new-cl--demo--amdp--connection---------------get--scarr--exporting---------------------------connection---conn---------------------------clnt---------sy-mandt-------------------------importing---------------------------carriers---final-result-------catch-cx--amdp--error-into-final-amdp--error-----------endtry---shared-abap-connections-----a-secondary-connection-or-service-connection-active-within-an-internal-session-is-an--abap-connection--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry---that-is-shared-by-abap-sql--native-sql--and-amdp-with-the-following-exceptions-------a-connection-activated-using-adbc-that-uses-the-value-abap--false-for-the-parameter-sharable-of-the-method-get--connection-of-the-class-cl--sql--connection-can-only-be-used-exclusively-using-the-associated-connection-object------a-connection-activated-after-exec-sql-with-connect-to-using-a-name-specified-after-as-can-only-be-used-between-exec-and-endexec------amdp-can-only-use-service-connections---shared-abap-connections-are-activated-as-follows-------using-the-connection-addition-of-abap-sql-statements-to-activate-the-connection-----using-either-the-method-get--abap--connection-of-the-adbc-class-cl--sql--connection-or-the-method-get--connection-with-the-value-abap--true-for-the-parameter-sharable-to-activate-the-connection------passing-the-name-to-the-input-parameter-connection-of-an-amdp-method-to-activate-the-connection------using-the-statement-connect-to-after-exec-sql-to-activate-the-connection--without-specifying-a-name-after-as---after-a-shared-abap-connection-is-activated--it-is-reused-by-all-following-accesses-from-abap-sql--native-sql--and-amdp-within-the-same-internal-session--regardless-of-how-it-was-activated---shared-abap-connections-can-be-closed-using-native-sql--as-described--here--abendb-connections-mngmnt-htm-@ITOC@@ABENDB_CONNECTIONS_MNGMNT_1). The connection can then no longer be used. When a closed connection is specified in ABAP SQL, it is opened again implicitly. If a closed connection is reused in Native SQL or AMDP an exception is raised.

Hint

When sharing database connections, it should be noted that the name of a database connection is always converted to uppercase letters in ABAP SQL. In Native SQL and AMDP, on the other hand, the name is case-sensitive. To access a database connection activated in ABAP SQL in Native SQL or AMDP, the connection must be specified in uppercase letters. Conversely, an ABAP SQL statement cannot use a database connection activated using Native SQL AMDP if its name contains lowercase letters. This mainly affects [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") and names defined using the addition AS of the statement [CONNECT TO](javascript:call_link\('abapexec_connection.htm'\)). [Secondary connections](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry"), on the other hand, must be specified in uppercase letters in Native SQL too in accordance with their spelling in the table DBCON.

Example

Use of a shared service connection in ADBC and ABAP SQL. The modifying statements are executed in a database LUW. If the name of the service connection were to contain lowercase letters or if the method GET\_CONNECTION with the value abap\_false were used for the parameter SHARABLE in ADBC, separate connections with two different database LUWs would be produced. Accessing the same database table would then usually cause a lock situation.

FINAL(conn) = CONV dbcon-con\_name( \`R/3\*DEMO\` ).
TRY.
¬†¬†¬†¬†NEW cl\_sql\_statement(
¬†¬†¬†¬†¬†¬†con\_ref = cl\_sql\_connection=>get\_abap\_connection(
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†con\_name = conn )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->execute\_update( \`DELETE FROM demo\_update\` ).
¬†¬†¬†¬†INSERT demo\_update CONNECTION (conn)
¬†¬†¬†¬†¬†¬†FROM @( VALUE #(
¬†¬†¬†¬†¬†¬†¬†¬†id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.



**üìñ Source**: [abendb_connections_using.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_using.htm)

### abendb_connections_trans.htm

> **üìñ Official SAP Documentation**: [abendb_connections_trans.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_trans.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Connections%20and%20Transactions%2C%20ABENDB_CONNECTIONS_TRANS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Database Connections and Transactions

Every active database connection creates a separate transaction context or is linked with its own [database LUW](javascript:call_link\('abendatabase_luw_glosry.htm'\) "Glossary Entry"). This means that database changes on one connection can be committed or rolled back independently of changes on other database connections. In this way, for example, log data can be stored in and committed on a secondary connection without modifying the database LUW of the standard connection.

Database changes can be committed or rolled back as follows specifically for database connections:

-   The statements [COMMIT CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) and [ROLLBACK CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) trigger targeted [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") on specific connections.
-   In ADBC, the instance methods [COMMIT](javascript:call_link\('abenadbc_transaction.htm'\)) and [ROLLBACK](javascript:call_link\('abenadbc_transaction.htm'\)) as well as [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of the class CL\_SQL\_CONNECTION trigger [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") for the connection of the current connection object.
-   In static Native SQL, the statements COMMIT WORK and ROLLBACK WORK after EXEC SQL trigger [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") for the current connection.
-   When a database connection is made inactive implicitly at the end of an internal session, a [database commit](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") is triggered.
-   When a database connection is closed explicitly in Native SQL, a [database rollback](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") is triggered.

In addition, there are the statements [COMMIT WORK](javascript:call_link\('abapcommit.htm'\)) and [ROLLBACK WORK](javascript:call_link\('abaprollback.htm'\)), as well as the implicit [database commits](javascript:call_link\('abendb_commit.htm'\)) and [database rollbacks](javascript:call_link\('abendb_rollback.htm'\)), that act on all active connections.

A secondary connection or service connection is always set to inactive when its database changes are committed or rolled back. A connection deactivated in this way can, however, still be used in the same internal session without being opened explicitly, not just in ABAP SQL, but also in Native SQL or AMDP. The first time an inactive secondary connection or service connection previously active in the current internal session is reused, it is made active again and a new database LUW is opened.

Warning

Extreme care must be taken when using SQL SET TRANSACTION statements to set the transaction behavior of the current database connection. The transaction behavior set using these statements is preserved across the entire current database LUW, which can cause unexpected or critical situations when the database connection is reused. The default behavior of the transactions must be restored before the end of the database LUW. When the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is accessed, special methods must be called for [setting the transaction behavior](javascript:call_link\('abenhana_set_transaction.htm'\)) instead of using the SQL SET TRANSACTION statements directly. In this case, the default transaction behavior is restored automatically at the end of the database LUW. No automatic resets can currently be performed for other database platforms.

Hints

-   All ABAP SQL, Native SQL, and AMDP reads made on a active shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") of an internal session work in the same database LUW.
-   The static Native SQL statement [SET CONNECTION](javascript:call_link\('abapexec_connection.htm'\)) is ignored by the database LUWs of the connections involved.
-   Secondary connections and service connections in an internal session cannot be used in called programs, which means that a called program always activates its own connection and hence its own database LUW, even if the same connection name is used.
-   Secondary connections, more specifically service connections, can be used to implement independent database LUWs on a secondary database or on the standard database. Care must be taken to avoid lock situations here.
-   Working with multiple database connections, namely independent database LUWs, can produce lock situations in which only one work process is involved: a program changes a database row on the first connection and tries to change the same row on a second connection. This results in the program waiting for the lock of the first database LUW, without this first LUW ever being able to continue. This situation can only be resolved by ending the work process. This is done automatically for dialog processes, but it must be done manually for background jobs. It is therefore not advisable to change the same table within the a single program using multiple database connections.

Example

If the statement COMMIT CONNECTION default were not used, the following program section would produce a lock situation because the standard connection (ABAP SQL here) and a service connection (Native SQL here) would be used in independent database LUWs to access the same row of a database table.

INSERT demo\_update FROM @( VALUE #( id = 'X' ) ).
DELETE FROM demo\_update.
COMMIT CONNECTION default.
DATA conn TYPE dbcon-con\_name VALUE 'R/3\*DEMO'.
EXEC SQL.
¬†¬†CONNECT TO :conn
ENDEXEC.
EXEC SQL.
¬†¬†INSERT INTO demo\_update VALUES( :sy-mandt, 'X', 1, 2, 3, 4 )
ENDEXEC.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Data Consistency / SAP LUW / SAP LUW, Examples

**Files**: 4 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Database Connections

Included pages: 5



**üìñ Source**: [abendb_connections_trans.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_trans.htm)

### abendb_connections.htm

> **üìñ Official SAP Documentation**: [abendb_connections.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Connections%2C%20ABENDB_CONNECTIONS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Database Connections

An [AS ABAP](javascript:call_link\('abenas_abap_glosry.htm'\) "Glossary Entry") uses database connections to access databases. A database connection defines the address of the database system (database host), the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry"), and hence the assigned [database schema](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") that is accessed. The [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") and [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") statements of an ABAP program and the [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry") Framework use a database connection of the current [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") to access a database. By default, the [standard connection](javascript:call_link\('abenstandard_db_connection_glosry.htm'\) "Glossary Entry") is used to access the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry") of the [standard AS ABAP database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry"). By opening a [secondary connection](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry"), it is also possible to access databases or database schemas other than the [standard database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry"). This makes possible a number of options, for example, data can be passed to and committed in other databases or in other database schemas. The [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") does not need to be part of an AS ABAP here, but it must be supported by SAP. Connections called [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") can also be used to access the standard database.

-   [Possible Database Connections](javascript:call_link\('abendb_connections_types.htm'\))
-   [Management of Database Connections](javascript:call_link\('abendb_connections_mngmnt.htm'\))
-   [Database Access Using Secondary Connections](javascript:call_link\('abendb_connections_using.htm'\))
-   [Database Connections and Transactions](javascript:call_link\('abendb_connections_trans.htm'\))

Continue
[Possible Database Connections](javascript:call_link\('abendb_connections_types.htm'\))
[Management of Database Connections](javascript:call_link\('abendb_connections_mngmnt.htm'\))
[Database Access Using Secondary Connections and Service Connections](javascript:call_link\('abendb_connections_using.htm'\))
[Database Connections and Transactions](javascript:call_link\('abendb_connections_trans.htm'\))



**üìñ Source**: [abendb_connections.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections.htm)

### abendb_connections_types.htm

> **üìñ Official SAP Documentation**: [abendb_connections_types.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_types.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Possible%20Database%20Connections%2C%20ABENDB_CONNECTIONS_TYPES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Possible Database Connections

When ABAP SQL, Native SQL, or AMDP is used in an ABAP program, the [database interface](javascript:call_link\('abendatabase_interface_glosry.htm'\) "Glossary Entry") uses a [database connection](javascript:call_link\('abendatabase_connection_glosry.htm'\) "Glossary Entry") of the current [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") to access a database. Every work process always has a standard connection to the standard database. In addition, secondary connections to other databases or database schemas can be defined. Service connections can also still be opened to the standard database.

-   [Standard Connection](#abendb-connections-types-1-------secondary-connections---@ITOC@@ABENDB_CONNECTIONS_TYPES_2)
-   [Service Connections to the Standard Database](#abendb-connections-types-3---standard-connection-----each-as-abap-work-process-always-has-a-standard-connection-to-the--standard-database--javascript-call-link---abenstandard-db-glosry-htm-----glossary-entry---and-this-connection-cannot-be-closed--it-is-shared-by-all--internal-sessions--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----if-the-standard-connection-is-used--the-work-process-acts-as-a--database-user--javascript-call-link---abendatabase-user-glosry-htm-----glossary-entry---to-which-the--abap-database-schema--javascript-call-link---abenabap-db-schema-glosry-htm-----glossary-entry---is-assigned-------by-default---abap-sql--javascript-call-link---abenabap-sql-glosry-htm-----glossary-entry-----native-sql--javascript-call-link---abenabap-sql-glosry-htm-----glossary-entry----and--amdp--javascript-call-link---abenamdp-glosry-htm-----glossary-entry---all-use-the-standard-connection-to-access-the-abap-database-schema-of-the-standard-as-abap-database------in-all-places-where-a-database-connection-can-be-specified-explicitly-in-abap--the-standard-connection-can-also-be-specified-using-the-predefined-name-default---example--specifies-the-standard-connection-explicitly-in-abap-sql--it-would-not-be-necessary-to-specify-the-connection-in-the-statements-delete-and-insert--the-statement--commit-connection--javascript-call-link---abapcommit-rollback-connection-htm------however--makes-an-explicit--database-commit--javascript-call-link---abendatabase-commit-glosry-htm-----glossary-entry---possible-on-the-standard-connection---delete-from-demo--update-connection-default--insert-demo--update-connection-default---from-( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION default.

Secondary Connections ¬† 

A secondary connection is a database connection to a [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") defined by an entry in the database table DBCON. The table key CON\_NAME of the table DBCON is the name of the secondary connection in uppercase letters under which it can be specified explicitly in ABAP. The remaining columns describe the properties of the secondary connection, such as the [database system](javascript:call_link\('abendatabase_system_glosry.htm'\) "Glossary Entry"), the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry"), and the physical address.

Entries in the database table DBCON are created and modified using the central [DBA Cockpit](javascript:call_link\('abendba_cockpit_glosry.htm'\) "Glossary Entry") tool. If the DBA Cockpit tool is not available in a system for some reason, transaction DBCO can be used instead, but this requires some expertise. DBCON should not be accessed in any other way. More specifically, the table DBCON cannot be displayed using the [Data Browser](javascript:call_link\('abendata_browser_glosry.htm'\) "Glossary Entry") tool.

The [database user name](javascript:call_link\('abendatabase_user_name_glosry.htm'\) "Glossary Entry") of the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry") used to log on the database connection to the database system is part of the definition of a secondary connection in the table DBCON. An ABAP SQL statement that uses a secondary connection accesses only that [database schema](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") that is assigned to this user.

A secondary connection must be specified explicitly before it can be used in [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") or [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"). If possible, the secondary connection is opened for the current work process or an existing inactive secondary connection with the same name is reused. Secondary connections cannot be used in [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry").

Secondary connections between an AS ABAP that has a SAP HANA database as its standard database and other non-SAP HANA secondary databases are now obsolete. [SAP HANA Smart Data Access (SDA)](https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/a07c7ff25997460bbcb73099fb59007d) should be used instead (see [SAP Note 2626805](https://launchpad.support.sap.com/#/notes/2626805)). In SDA, secondary databases are addressed from the SAP HANA database using special qualified names or by using virtual tables. If a SAP HANA database is used as a standard AS ABAP database, ABAP programs can use these names via the standard connection. This is only possible using AMDP and Native SQL, since no qualified names can be specified in ABAP SQL.

Hints

-   Secondary connections can address any number of [database schemas](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") in the [standard database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry") or databases other than the standard database as [secondary databases](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry"). An AS ABAP can, for example, access the SAP HANA database of an independently operated SAP HANA appliance.
-   The prerequisite for a [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") is that it must be a database system supported by SAP. Only this system has software for ABAP SQL and Native SQL access as a shared library.
-   If the [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") is a database system other than the standard database of the current AS ABAP, the Database Shared Library (DBSL) provided for this database by SAP and client software provided by the database vendor must be installed here before an access using a secondary connection from the table DBCON. Information about creating the DBCON entry and installing the additional software is described in the standard SAP Notes for every supported database system.
-   Once all reads on secondary database, except SAP HANA databases, have been replaced by [SDA](https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/a07c7ff25997460bbcb73099fb59007d), Shared Libraries (DBSL) are no longer required.

Example

Use of a secondary connection in ABAP SQL. The connection can be entered, and a check is made to see whether it exists in the database table DBCON. If no secondary connection exists in ABAP SQL, the uncatchable exception DBSQL\_UNKNOWN\_CONNECTION is raised.

DATA conn TYPE dbcon-con\_name.
cl\_demo\_input=>request( CHANGING field = conn ).
SELECT SINGLE @abap\_true
¬†¬†¬†¬†¬†¬† FROM dbcon
¬†¬†¬†¬†¬†¬† WHERE con\_name = @conn
¬†¬†¬†¬†¬†¬† INTO @FINAL(dbtype).
IF sy-subrc <> 0.
¬†¬†cl\_demo\_output=>display( 'Connection not in DBCON' ).
¬†¬†RETURN.
ENDIF.
DELETE FROM demo\_update CONNECTION (conn).
INSERT demo\_update CONNECTION (conn)
¬†¬†FROM @( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION (conn).

Service Connections to the Standard Database ¬† 

A service connection is a database connection defined by specifying its name in an ABAP program. The name of a service connection is R/3\*name and consists of the prefix R/3\* in uppercase letters and a definable case-sensitive name that can have between 1 and 26 alphanumeric characters.

A service connection is always a database connection to the standard database and inherits all settings from the standard connection automatically.

When a service connection is requested in [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"), [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"), or [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry"), it is opened for the current work process if possible or an existing inactive service connection with the same name is reused.

Hints

-   The freely definable name is not associated with the entries in the database table DBCON and is used only to identify a service connection. Hence, specifying a database connection from the database table DBCON for name does not mean that this database connection is used.
-   Service connections to the standard SAP database are useful for performing operations in a [database LUW](javascript:call_link\('abendb_transaction.htm'\)) that are independent of the LUW of the standard connection. It should be noted that the current [isolation level](javascript:call_link\('abendb_isolation.htm'\)) is responsible for determining whether a read from a database LUW can access data modified in a different database LUW, before this data is committed using a database commit.
-   Like secondary connections, service connections add to the number of open connections of the current work process. There can be a maximum of 16 open connections, including the standard connection itself.

Example

Use of a service connection called R/3\*service\_conn in ABAP SQL.

DELETE FROM demo\_update CONNECTION R/3\*service\_conn.
INSERT demo\_update CONNECTION R/3\*service\_conn
¬†¬†FROM @( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION R/3\*service\_conn.



**üìñ Source**: [abendb_connections_types.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_types.htm)

### abendb_connections_mngmnt.htm

> **üìñ Official SAP Documentation**: [abendb_connections_mngmnt.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_mngmnt.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Management%20of%20Database%20Connections%2C%20ABENDB_CONNECTIONS_MNGMNT%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Management of Database Connections

Database connections are managed by the ABAP runtime framework. This is done at the [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") level and the [internal session](javascript:call_link\('abeninternal_session_glosry.htm'\) "Glossary Entry") level. Each time an AS ABAP is started, a [standard connection](javascript:call_link\('abenstandard_db_connection_glosry.htm'\) "Glossary Entry") is opened for every [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") and this connection cannot be closed. In addition to the standard connection, 15 further [secondary connections](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry") or [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") can be opened for each work process. A maximum of 16 database connections can be open for each work process. On certain databases, it may not be possible to reach this number. If more than 16 database connections are opened, the runtime error DBSQL\_NO\_MORE\_CONNECTION occurs.

-   [Opening and Closing Secondary Connections and Service Connections](#abendb-connections-mngmnt-1-------active-and-inactive-secondary-connections-and-service-connections---@ITOC@@ABENDB_CONNECTIONS_MNGMNT_2)
-   [Secondary Connections and Service Connections in the Internal Session](#abendb-connections-mngmnt-3-------displaying-secondary-connections-and-service-connections---@ITOC@@ABENDB_CONNECTIONS_MNGMNT_4)

Opening and Closing Secondary Connections and Service Connections ¬† 

ABAP SQL and Native SQL can request secondary connections or service connections. AMDP can only request service connections. A secondary connection or a service connection is requested as follows:

-   Implicitly in ABAP SQL by specifying the name of the connection after the addition [CONNECTION](javascript:call_link\('abapselect_connection.htm'\))
-   Explicitly and implicitly in Native SQL using one of the following:
    -   The methods [GET\_ABAP\_CONNECTION](javascript:call_link\('abencl_sql_connection.htm'\)) and [GET\_CONNECTION](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION
    -   The statement [CONNECT TO](javascript:call_link\('abapexec_connection.htm'\)) after [EXEC SQL](javascript:call_link\('abapexec.htm'\))
-   The input parameter [CONNECTION](javascript:call_link\('abenamdp_db_connections.htm'\)) of [AMDP procedure implementations](javascript:call_link\('abenamdp_procedure_method_glosry.htm'\) "Glossary Entry") (for service connections only)

If no inactive database connection can be activated after the specified name, it is opened for the current work process and activated for the current internal session.

A secondary connection or service connection is closed explicitly in Native SQL using the following:

-   The method [CLOSE](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION
-   The statement [DISCONNECT](javascript:call_link\('abapexec_connection.htm'\)) after [EXEC SQL](javascript:call_link\('abapexec.htm'\))

If closed explicitly in Native SQL, all database changes in the current database LUW of the connection that were not yet [committed on the database](javascript:call_link\('abendb_commit.htm'\)) are discarded.

ABAP SQL does not have a statement that closes a database connection explicitly. Any secondary connection or service connection that is inactive for a specific period of time (approximately 15 minutes by default) is closed by the ABAP runtime framework implicitly.

Hints

-   Generally speaking, database connections should only be closed implicitly by the ABAP runtime framework. Since it takes a significant amount of resources to restore a connection, database connections should only be closed explicitly in the following cases:
    -   A database connection was used in such a way that unwanted side effects occur when reusing it.
    -   They are not required for a long time in the current process,
-   The method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC does not actually close a connection but makes it inactive (see below). The connection is not available via the respective connection object any more, but it can be activated again.
-   A closed connection has the status DISCONNECTED in the output of program DBCONINFO.

Example

Opening of three service connections with ABAP SQL, ADBC, and after EXEC SQL. The connection opened using ABAP SQL is closed again using Native SQL, which requires its name to be specified in uppercase letters.

TRY.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM scarr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(itab)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONNECTION r/3\*demo1.
¬†¬†¬†¬†FINAL(con) = cl\_sql\_connection=>get\_abap\_connection( \`R/3\*Demo2\` ).
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†CONNECT TO 'R/3\*Demo3'
¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†DISCONNECT 'R/3\*DEMO1'
¬†¬†¬†¬†ENDEXEC.
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.

Active and Inactive Secondary Connections and Service Connections ¬† 

An open secondary connection or service connection can be active or inactive. Once opened in ABAP SQL, Native SQL, or AMDP, a database connection is active and can be used by ABAP SQL, Native SQL, or AMDP. The secondary connection or service connection becomes inactive as soon as the current database LUW of this connection is ended. This can occur as follows:

-   Using the statements [COMMIT CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) or [ROLLBACK CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) for this connection.
-   Using the Native SQL statements COMMIT WORK or ROLLBACK WORK after [EXEC SQL](javascript:call_link\('abapexec.htm'\)) for this connection
-   Using the methods [COMMIT](javascript:call_link\('abenadbc_transaction.htm'\)) and [ROLLBACK](javascript:call_link\('abenadbc_transaction.htm'\)) of the ADBC class CL\_SQL\_CONNECTION for this connection.
-   Using the method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION for this connection. This method ends the current database LUW with a database rollback and also closes the connection for the respective ADBC connection object.
-   Using the statements [COMMIT WORK](javascript:call_link\('abapcommit.htm'\)) and [ROLLBACK WORK](javascript:call_link\('abaprollback.htm'\)) for all connections
-   In an implicit [database commit](javascript:call_link\('abendb_commit.htm'\)) or [database rollback](javascript:call_link\('abendb_rollback.htm'\)) for all connections
-   When closing the internal session in which the connection was opened, where a COMMIT CONNECTION is executed for the connection implicitly.

An inactive open secondary connection or service connection is reused by the ABAP runtime framework if it is to be reopened for its work process. Once activated in an internal session, a secondary connection or service connection can be reused here regardless of whether it is active or inactive. It is not necessary to open it again explicitly in Native SQL. When an inactive connection is reused, it is activated implicitly and a new database LUW is opened. For a shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry"), the usage can be ABAP SQL, Native SQL or ADBC, An exception to this rule are connections closed by method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC. They cannot be used via the connection object any longer.

Hints

-   When a database connection is closed explicitly in Native SQL it is actually closed and not just set to inactive. The next request must then reopen the connection for the current work process.
-   The method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC does not fully close a connection but makes it inactive. A shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") closed in such a way can be implicitly reopened as any inactive ABAP connection.
-   Active and inactive connections have the status ACTIVE and INACTIVE in the output of program DBCONINFO respectively.

Example

A service connection R/3\*DEMO is requested using ADBC and used for an SQL statement. The statement COMMIT CONNECTION ends the database LUW of the connection and sets it from active to inactive. Since the connection is a shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") and the connection name does not contain any lowercase letters, it is reused by being specified in the ABAP SQL statement INSERT. The connection is reactivated here and a new database LUW is started. A further COMMIT CONNECTION statement ends this LUW and deactivates the connection.

FINAL(conn) = CONV dbcon-con\_name( \`R/3\*DEMO\` ).
TRY.
¬†¬†¬†¬†NEW cl\_sql\_statement(
¬†¬†¬†¬†¬†¬†con\_ref =
¬†¬†¬†¬†¬†¬†¬†¬†cl\_sql\_connection=>get\_abap\_connection( con\_name = conn )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->execute\_update( \`DELETE FROM demo\_update\` ).
¬†¬†¬†¬†COMMIT CONNECTION (conn).
¬†¬†¬†¬†INSERT demo\_update CONNECTION (conn)
¬†¬†¬†¬†¬†¬†FROM @( VALUE #( id = 'X' col1 = 1
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col2 = 2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col3 = 3
¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col4 = 4 ) ).
¬†¬†¬†¬†COMMIT CONNECTION (conn).
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.

Secondary Connections and Service Connections in the Internal Session ¬† 

Active open secondary connections or service connections can only be used within the [internal session](javascript:call_link\('abeninternal_session_glosry.htm'\) "Glossary Entry") in which they are opened. An active open secondary connection or service connection is usually an [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") that can be shared by ABAP SQL, Native SQL, and AMDP within an internal session. Exceptions from this rule are connections opened in Native SQL or AMDP with lowercase letters in the name or exclusive connections opened in ADBC with method GET\_CONNECTION instead of GET\_ABAP\_CONNECTION of class CL\_SQL\_CONNECTION.

When the internal session is closed, any changes made using the connections are committed and the connections are set to inactive. When an ABAP program is called that returns to the called program (SUBMIT AND RETURN or CALL TRANSACTION), the states of any secondary connections or service connections opened here are preserved as active or inactive. They are not, however, passed to the called program. If a secondary connection or service connection with the same name is requested here, a further connection of the same type is opened.

Any shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") that becomes inactive within an internal session when its database LUW is ended can be reused in the same session without being requested explicitly, not just in ABAP SQL, but also in Native SQL or AMDP.

Example

An ABAP SQL statement requests a service connection R/3\*DEMO and then calls a further program. The called program requests a service connection with the same name. After this, two service connections with the same name are open and active for the current work process until the end of the internal session of the called program. When a return is made from the called program, its service connection is deactivated, just as the service connection of the calling program is deactivated when it is exited. No database commit was made before the call, which means that the [isolation level](javascript:call_link\('abendb_isolation.htm'\)) of the database determines whether the change made in the caller is visible in the called program.

Calling Program

DELETE FROM demo\_update CONNECTION r/3\*demo.
SUBMIT ... AND RETURN.

Called Program

SELECT \*
¬†¬†¬†¬†¬†¬† FROM demo\_update
¬†¬†¬†¬†¬†¬† INTO TABLE @DATA(itab)
¬†¬†¬†¬†¬†¬† CONNECTION r/3\*demo.

Displaying Secondary Connections and Service Connections ¬† 

The program DBCONINFO shows all database connection of all work processes in the current AS ABAP. The name R/3 in the column ConName identifies the standard connection. Other names indicate the secondary connections and service connections. The column ConState shows the states ACTIVE, INACTIVE, and DISCONNECTED. The column Hdl indicates whether a connection is a secondary connection or a service connection. Identically named secondary and service connections can occur for the following reasons:

-   Identically named connections are opened in called programs
-   Connections are opened using the method GET\_CONNECTION of the class CL\_SQL\_CONNECTION in ADBC, where the value abap\_false is used for the parameter SHARABLE
-   Connections are opened using CONNECT TO after EXEC SQL, where AS is used to specify an explicit name

Example

The program DBCONINFO can be used to explore the examples shown in this section while they are being executed step by step in the ABAP Debugger.



**üìñ Source**: [abendb_connections_mngmnt.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_mngmnt.htm)

### abendb_connections_using.htm

> **üìñ Official SAP Documentation**: [abendb_connections_using.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_using.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Access%20Using%20Secondary%20Connections%20and%20Service%20Connections%2C%20ABENDB_CONNECTIONS_USING%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%
0D%0ASuggestion%20for%20improvement:)

Database Access Using Secondary Connections and Service Connections

Secondary connections and service connections are opened and used in different ways in ABAP SQL, Native SQL, and AMDP. A secondary or service connection active for an internal session can be shared by ABAP SQL, Native SQL, or AMDP. Connections used by ABAP SQL, however, cannot have any lowercase letters in their names and ADBC can reserve connections for itself exclusively.

-   [ABAP SQL](#abendb-connections-using-1-------native-sql---adbc---@ITOC@@ABENDB_CONNECTIONS_USING_2)
-   [Native SQL - EXEC SQL](#abendb-connections-using-3-------amdp---@ITOC@@ABENDB_CONNECTIONS_USING_4)
-   [Shared ABAP Connections](#abendb-connections-using-5---abap-sql-----the-following-additions-can-be-used-to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in-abap-sql-------the-addition--connection--javascript-call-link---abapselect-connection-htm-----for-read-statements-----the-identical-addition--connection--javascript-call-link---abapiumd-conn-htm-----for-write-statements--if-the-addition-connection-is-specified-using-the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---from-the-database-table-dbcon-or-using-the-name-of-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---in-an-abap-sql-statement--the-following-applies-------if-the-specified-connection-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-given-the-state-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--or-amdp------if-the-specified-connection-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----the-abap-sql-statement-uses-this-connection-and-works-in-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry----the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp---when-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---is-used--an-abap-sql-statement-only-accesses-the--database-schema--javascript-call-link---abendatabase-schema-glosry-htm-----glossary-entry---assigned-to-the--database-user-name--javascript-call-link---abendatabase-user-name-glosry-htm-----glossary-entry---assigned-to-the-secondary-connection--abap-sql-can-only-access-database-tables-and-views-that-are-defined-in-the--abap-dictionary--javascript-call-link---abenabap-dictionary-glosry-htm-----glossary-entry---in-the-current-as-abap--which-means-that-every-database-table-or-view-accessed-using-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---must-exist-and-be-active-as-a-database-or-view-with-the-same-name-and-matching-ddic-structure-in-the-current-as-abap--regardless-of-the--secondary-database--javascript-call-link---abensecondary-db-glosry-htm-----glossary-entry---and-database-schema--for-the-database-tables-or-views-of-the-secondary-database--abap-sql-assumes-that-their--table-category--javascript-call-link---abenddic-database-tables-tab-cat-htm-----and-type-information-matches-the-local-definition-exactly--this-prerequisite-is-essential--for-example--for-the-correct-interpretation-of-the-database-content-and--if-necessary--their-conversion-with-respect-to-the-abap-types-of-the-target-fields--if-this-prerequisite-is-not-met--incorrect-data-or-runtime-errors-can-be-caused-by-reads-or-writes-depending-on-the-database-system--because-the-abap-runtime-framework-cannot-ensure-the-consistency-of-the-type-descriptions-in-the-local-and-remote-databases--the-consistency-must-be-guaranteed-by-the-relevant-application-program---the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---or--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---specified-after-connection-is-transformed-into-uppercase-letters-internally--this-must-be-respected-when-native-sql-accesses-the-connection-explicitly--conversely--an-abap-sql-statement-can-reuse-database-connections-active-in-native-sql-or-amdp-only-if-their-names-do-not-contain-any-lowercase-letters---hints------the-type-of-a-database-object-specified-in-an-abap-sql-statement-using-the-addition-connection-does-not-necessarily-need-to-match-the-type-of-the-database-object-with-the-same-name-in-the-secondary-database--for-example--a-view-with-the-same-name-in-the-secondary-database-can-be-accessed-by-specifying-a-database-table-and-vice-versa-if-they-have-the-same-structure------if-a-database-table-specified-using-the-addition-connection-in-an-abap-sql-statement-is-a--global-temporary-table--gtt---javascript-call-link---abenglobal-temporary-table-glosry-htm-----glossary-entry----it-is-handled-like-a-gtt--even-if-it-is-a-regular-transparent-table-in-the-secondary-database--conversely--there-is-no-special-handling-in-abap-sql-if-the-database-is-a-gtt-on-the-secondary-database-only------the-prerequisite-that-an-identically-named-database-object-with-a-suitable-ddic-structure-must-exist-in-the-current-system-for-views-accessed-using-a-secondary-connection-is-particularly-important-for--ddic-external-views--javascript-call-link---abenexternal-view-glosry-htm-----glossary-entry-----example--specification-of-a-database-connection-in-abap-sql---final-conn----conv-dbcon-con--name-------------delete-from-demo--update-connection--conn----native-sql---adbc-----to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in--adbc--javascript-call-link---abenadbc-glosry-htm-----glossary-entry----the-static-method--get--abap--connection--javascript-call-link---abencl-sql-connection-htm-----of-the-class-cl--sql--connection-can-be-used--the-return-value-of-the-method-is-a-reference-to-a-connection-object-that-can-be-passed-to-other-adbc-objects--using-the-input-parameter-con--name--the-method-can-be-passed-the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---from-the-database-table-dbcon-or-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry----these-names-are-case-sensitive--the-activated-connection-is-an--abap-connection--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry---that-can-be-used-in-abap-sql--native-sql--and-amdp--a-further-method--get--connection--javascript-call-link---abencl-sql-connection-htm-----works-in-a-similar-way-to-get--abap--connection--but-has-an-additional-input-parameter-sharable--which-activates-an-exclusive-connection-if-its-default-parameter-abap--false-is-used-------get--abap--connection-or-get--connection-with-abap--true-passed-to-sharable-for-shared--abap-connections--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry------------if-the-connection-passed-to-con--name-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it----------if-the-connection-passed-to-con--name-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-used--the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp------get--connection-with-abap--false-passed-to-sharable--default--for-exclusive-connections-----------a-new-connection-is-always-activated-for-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry---by-opening-a-new-connection-or-activating-an-inactive-connection-of-the-current-work-process--no-existing-active-connection-of-the-name-passed-to-con--name-is-used--a-connection-activated-like-this-can-only-be-used-exclusively-using-the-returned-connection-object-in-adbc--------after-successful-execution--get--connection-gets-a-reference-to-a-connection-object--the-connection-object-represents-the-connection-activated-or-reused-using-get--connection-in-adbc-and-can-be-passed-to-the-instance-constructors-of-the-classes-cl--sql--statement-and-cl--sql--prepared--statement--the-sql-statements-of-these-classes-are-then-executed-on-this-connection-in-its-database-luw---hints------abap--false-can-be-used-for-the-parameter-sharable-of-the-method-get--connection-to-control-the-use-of-a-database-connection-and-its-database-luw-explicitly--database-connections-that-are-activated-differently-are-usually-available-to-all-accesses-in-abap-sql-and-native-sql------if-abap--false-is-passed-to-the-parameter-sharable-of-the-method-get--connection--multiple-database-connections-with-the-same-name-can-be-activated-and-used-within-a-single-internal-session--these-are-indicated-in-the-output-of-the-program-dbconinfo-by-the-different-values-in-the-column-hdl------when-opening-exclusive-connections-for-connection-objects--the-maximum-number-of-connections-for-each-work-process-must-not-be-exceeded--exclusive-connection-should-be-closed-explicitly-once-they-are-no-longer-needed-and-if-there-are-a-large-number-of-connection-objects---example--specification-of-a-database-connection-in-adbc---final-conn----conv-dbcon-con--name-------------try------new-cl--sql--statement--------con--ref---cl--sql--connection--get--abap--connection--------------------con--name---conn----------------------execute--update----delete-from-demo--update--------catch-cx--sql--exception----------endtry---native-sql---exec-sql-----the-following-special-statements-can-be-used-to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in-native-sql-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm-----------connect-to--javascript-call-link---abapexec-connection-htm----------set-connection--javascript-call-link---abapexec-connection-htm------the-statement--connect-to--javascript-call-link---abapexec-connection-htm-----can-be-used-to-activate-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---or-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry----here--the-addition-as-can-be-used-to-open-the-same-connection-more-than-once-under-different-names--the-entries-made-here-are-case-sensitive-------if-no-name-is-specified-using-as--the-following-applies----------if-the-connection-specified-after-connect-to-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--and-amdp----------if-the-connection-specified-after-con--name-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-reused--the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp------if-a-name-is-specified-using-as--the-following-applies----------if-the-connection-specified-after-connect-to-is-not-yet-active-under-this-name-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-given-the-state-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it--a-connection-with-a-name-defined-using-as-is-only-used-by-native-sql-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm------abap-sql-and-other-kinds-of-native-sql-or-amdp-do-not-use-this-type-of-connection----------if-the-connection-specified-after-con--name-is-already-active-under-this-name-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-reused--the-connection-can-only-have-been-activated-using-connect-to---after-the-statement-connect-to--all-subsequent-native-sql-statements-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm-----in-the-current-internal-session-use-the-connection-activated-or-reused-using-connect-to--the-statement--set-connection--javascript-call-link---abapexec-connection-htm-----can-be-used-to-switch-to-the-use-of-the-previously-activated-connection-of-the-current-internal-session--here--a-name-defined-with-as-must-be-specified-using-this-connection--more-specifically--the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---can-be-activated-by-specifying-default--the-statement-set-connection-is-ignored-by-the-database-luws-of-the-connections-involved---hint--when-a-name-is-specified-after-as-in-the-statement-connect-to--multiple-database-connections-with-the-same-original-name-can-be-activated-and-used-in-the-same-internal-session--these-are-indicated-in-the-output-of-the-program-dbconinfo-by-the-different-values-in-the-column-hdl---example--specification-of-a-database-connection-after-exec-sql---final-conn----conv-dbcon-con--name-------------exec-sql----connect-to--conn-endexec--exec-sql----delete-from-demo--update-endexec---amdp-----to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---to-execute-an--amdp-procedure-implementation--javascript-call-link---abenamdp-procedure-method-glosry-htm-----glossary-entry----the-names-of--service-connections--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---can-be-passed-to-the-input-parameter--connection--javascript-call-link---abenamdp-db-connections-htm-----of-the-associated--amdp-method--javascript-call-link---abenamdp-method-glosry-htm-----glossary-entry----the-names-are-case-sensitive-here---secondary-connections--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---cannot-be-used-------if-the-passed-connection-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--and-amdp------if-the-specified-connection-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----the-procedure-implementation-is-called-using-this-connection-and-works-in-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry----the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp---hint--the-service-connections-that-can-be-used-by-amdp-are-also-connections-that-can-be-used-by-abap-sql--native-sql--and-amdp--as-long-as-the-appropriate-conditions-are-met---example--specification-of-a-database-connection-in-amdp---final-conn----conv-dbcon-con--name----r-3-----------try------new-cl--demo--amdp--connection---------------get--scarr--exporting---------------------------connection---conn---------------------------clnt---------sy-mandt-------------------------importing---------------------------carriers---final-result-------catch-cx--amdp--error-into-final-amdp--error-----------endtry---shared-abap-connections-----a-secondary-connection-or-service-connection-active-within-an-internal-session-is-an--abap-connection--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry---that-is-shared-by-abap-sql--native-sql--and-amdp-with-the-following-exceptions-------a-connection-activated-using-adbc-that-uses-the-value-abap--false-for-the-parameter-sharable-of-the-method-get--connection-of-the-class-cl--sql--connection-can-only-be-used-exclusively-using-the-associated-connection-object------a-connection-activated-after-exec-sql-with-connect-to-using-a-name-specified-after-as-can-only-be-used-between-exec-and-endexec------amdp-can-only-use-service-connections---shared-abap-connections-are-activated-as-follows-------using-the-connection-addition-of-abap-sql-statements-to-activate-the-connection-----using-either-the-method-get--abap--connection-of-the-adbc-class-cl--sql--connection-or-the-method-get--connection-with-the-value-abap--true-for-the-parameter-sharable-to-activate-the-connection------passing-the-name-to-the-input-parameter-connection-of-an-amdp-method-to-activate-the-connection------using-the-statement-connect-to-after-exec-sql-to-activate-the-connection--without-specifying-a-name-after-as---after-a-shared-abap-connection-is-activated--it-is-reused-by-all-following-accesses-from-abap-sql--native-sql--and-amdp-within-the-same-internal-session--regardless-of-how-it-was-activated---shared-abap-connections-can-be-closed-using-native-sql--as-described--here--abendb-connections-mngmnt-htm-@ITOC@@ABENDB_CONNECTIONS_MNGMNT_1). The connection can then no longer be used. When a closed connection is specified in ABAP SQL, it is opened again implicitly. If a closed connection is reused in Native SQL or AMDP an exception is raised.

Hint

When sharing database connections, it should be noted that the name of a database connection is always converted to uppercase letters in ABAP SQL. In Native SQL and AMDP, on the other hand, the name is case-sensitive. To access a database connection activated in ABAP SQL in Native SQL or AMDP, the connection must be specified in uppercase letters. Conversely, an ABAP SQL statement cannot use a database connection activated using Native SQL AMDP if its name contains lowercase letters. This mainly affects [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") and names defined using the addition AS of the statement [CONNECT TO](javascript:call_link\('abapexec_connection.htm'\)). [Secondary connections](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry"), on the other hand, must be specified in uppercase letters in Native SQL too in accordance with their spelling in the table DBCON.

Example

Use of a shared service connection in ADBC and ABAP SQL. The modifying statements are executed in a database LUW. If the name of the service connection were to contain lowercase letters or if the method GET\_CONNECTION with the value abap\_false were used for the parameter SHARABLE in ADBC, separate connections with two different database LUWs would be produced. Accessing the same database table would then usually cause a lock situation.

FINAL(conn) = CONV dbcon-con\_name( \`R/3\*DEMO\` ).
TRY.
¬†¬†¬†¬†NEW cl\_sql\_statement(
¬†¬†¬†¬†¬†¬†con\_ref = cl\_sql\_connection=>get\_abap\_connection(
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†con\_name = conn )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->execute\_update( \`DELETE FROM demo\_update\` ).
¬†¬†¬†¬†INSERT demo\_update CONNECTION (conn)
¬†¬†¬†¬†¬†¬†FROM @( VALUE #(
¬†¬†¬†¬†¬†¬†¬†¬†id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.



**üìñ Source**: [abendb_connections_using.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_using.htm)

### abendb_connections_trans.htm

> **üìñ Official SAP Documentation**: [abendb_connections_trans.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_trans.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Connections%20and%20Transactions%2C%20ABENDB_CONNECTIONS_TRANS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Database Connections and Transactions

Every active database connection creates a separate transaction context or is linked with its own [database LUW](javascript:call_link\('abendatabase_luw_glosry.htm'\) "Glossary Entry"). This means that database changes on one connection can be committed or rolled back independently of changes on other database connections. In this way, for example, log data can be stored in and committed on a secondary connection without modifying the database LUW of the standard connection.

Database changes can be committed or rolled back as follows specifically for database connections:

-   The statements [COMMIT CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) and [ROLLBACK CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) trigger targeted [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") on specific connections.
-   In ADBC, the instance methods [COMMIT](javascript:call_link\('abenadbc_transaction.htm'\)) and [ROLLBACK](javascript:call_link\('abenadbc_transaction.htm'\)) as well as [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of the class CL\_SQL\_CONNECTION trigger [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") for the connection of the current connection object.
-   In static Native SQL, the statements COMMIT WORK and ROLLBACK WORK after EXEC SQL trigger [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") for the current connection.
-   When a database connection is made inactive implicitly at the end of an internal session, a [database commit](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") is triggered.
-   When a database connection is closed explicitly in Native SQL, a [database rollback](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") is triggered.

In addition, there are the statements [COMMIT WORK](javascript:call_link\('abapcommit.htm'\)) and [ROLLBACK WORK](javascript:call_link\('abaprollback.htm'\)), as well as the implicit [database commits](javascript:call_link\('abendb_commit.htm'\)) and [database rollbacks](javascript:call_link\('abendb_rollback.htm'\)), that act on all active connections.

A secondary connection or service connection is always set to inactive when its database changes are committed or rolled back. A connection deactivated in this way can, however, still be used in the same internal session without being opened explicitly, not just in ABAP SQL, but also in Native SQL or AMDP. The first time an inactive secondary connection or service connection previously active in the current internal session is reused, it is made active again and a new database LUW is opened.

Warning

Extreme care must be taken when using SQL SET TRANSACTION statements to set the transaction behavior of the current database connection. The transaction behavior set using these statements is preserved across the entire current database LUW, which can cause unexpected or critical situations when the database connection is reused. The default behavior of the transactions must be restored before the end of the database LUW. When the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is accessed, special methods must be called for [setting the transaction behavior](javascript:call_link\('abenhana_set_transaction.htm'\)) instead of using the SQL SET TRANSACTION statements directly. In this case, the default transaction behavior is restored automatically at the end of the database LUW. No automatic resets can currently be performed for other database platforms.

Hints

-   All ABAP SQL, Native SQL, and AMDP reads made on a active shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") of an internal session work in the same database LUW.
-   The static Native SQL statement [SET CONNECTION](javascript:call_link\('abapexec_connection.htm'\)) is ignored by the database LUWs of the connections involved.
-   Secondary connections and service connections in an internal session cannot be used in called programs, which means that a called program always activates its own connection and hence its own database LUW, even if the same connection name is used.
-   Secondary connections, more specifically service connections, can be used to implement independent database LUWs on a secondary database or on the standard database. Care must be taken to avoid lock situations here.
-   Working with multiple database connections, namely independent database LUWs, can produce lock situations in which only one work process is involved: a program changes a database row on the first connection and tries to change the same row on a second connection. This results in the program waiting for the lock of the first database LUW, without this first LUW ever being able to continue. This situation can only be resolved by ending the work process. This is done automatically for dialog processes, but it must be done manually for background jobs. It is therefore not advisable to change the same table within the a single program using multiple database connections.

Example

If the statement COMMIT CONNECTION default were not used, the following program section would produce a lock situation because the standard connection (ABAP SQL here) and a service connection (Native SQL here) would be used in independent database LUWs to access the same row of a database table.

INSERT demo\_update FROM @( VALUE #( id = 'X' ) ).
DELETE FROM demo\_update.
COMMIT CONNECTION default.
DATA conn TYPE dbcon-con\_name VALUE 'R/3\*DEMO'.
EXEC SQL.
¬†¬†CONNECT TO :conn
ENDEXEC.
EXEC SQL.
¬†¬†INSERT INTO demo\_update VALUES( :sy-mandt, 'X', 1, 2, 3, 4 )
ENDEXEC.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Data Consistency / SAP Locks

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Database Connections

Included pages: 5



**üìñ Source**: [abendb_connections_trans.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_trans.htm)

### abendb_connections.htm

> **üìñ Official SAP Documentation**: [abendb_connections.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Connections%2C%20ABENDB_CONNECTIONS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Database Connections

An [AS ABAP](javascript:call_link\('abenas_abap_glosry.htm'\) "Glossary Entry") uses database connections to access databases. A database connection defines the address of the database system (database host), the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry"), and hence the assigned [database schema](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") that is accessed. The [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") and [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") statements of an ABAP program and the [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry") Framework use a database connection of the current [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") to access a database. By default, the [standard connection](javascript:call_link\('abenstandard_db_connection_glosry.htm'\) "Glossary Entry") is used to access the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry") of the [standard AS ABAP database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry"). By opening a [secondary connection](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry"), it is also possible to access databases or database schemas other than the [standard database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry"). This makes possible a number of options, for example, data can be passed to and committed in other databases or in other database schemas. The [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") does not need to be part of an AS ABAP here, but it must be supported by SAP. Connections called [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") can also be used to access the standard database.

-   [Possible Database Connections](javascript:call_link\('abendb_connections_types.htm'\))
-   [Management of Database Connections](javascript:call_link\('abendb_connections_mngmnt.htm'\))
-   [Database Access Using Secondary Connections](javascript:call_link\('abendb_connections_using.htm'\))
-   [Database Connections and Transactions](javascript:call_link\('abendb_connections_trans.htm'\))

Continue
[Possible Database Connections](javascript:call_link\('abendb_connections_types.htm'\))
[Management of Database Connections](javascript:call_link\('abendb_connections_mngmnt.htm'\))
[Database Access Using Secondary Connections and Service Connections](javascript:call_link\('abendb_connections_using.htm'\))
[Database Connections and Transactions](javascript:call_link\('abendb_connections_trans.htm'\))



**üìñ Source**: [abendb_connections.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections.htm)

### abendb_connections_types.htm

> **üìñ Official SAP Documentation**: [abendb_connections_types.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_types.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Possible%20Database%20Connections%2C%20ABENDB_CONNECTIONS_TYPES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Possible Database Connections

When ABAP SQL, Native SQL, or AMDP is used in an ABAP program, the [database interface](javascript:call_link\('abendatabase_interface_glosry.htm'\) "Glossary Entry") uses a [database connection](javascript:call_link\('abendatabase_connection_glosry.htm'\) "Glossary Entry") of the current [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") to access a database. Every work process always has a standard connection to the standard database. In addition, secondary connections to other databases or database schemas can be defined. Service connections can also still be opened to the standard database.

-   [Standard Connection](#abendb-connections-types-1-------secondary-connections---@ITOC@@ABENDB_CONNECTIONS_TYPES_2)
-   [Service Connections to the Standard Database](#abendb-connections-types-3---standard-connection-----each-as-abap-work-process-always-has-a-standard-connection-to-the--standard-database--javascript-call-link---abenstandard-db-glosry-htm-----glossary-entry---and-this-connection-cannot-be-closed--it-is-shared-by-all--internal-sessions--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----if-the-standard-connection-is-used--the-work-process-acts-as-a--database-user--javascript-call-link---abendatabase-user-glosry-htm-----glossary-entry---to-which-the--abap-database-schema--javascript-call-link---abenabap-db-schema-glosry-htm-----glossary-entry---is-assigned-------by-default---abap-sql--javascript-call-link---abenabap-sql-glosry-htm-----glossary-entry-----native-sql--javascript-call-link---abenabap-sql-glosry-htm-----glossary-entry----and--amdp--javascript-call-link---abenamdp-glosry-htm-----glossary-entry---all-use-the-standard-connection-to-access-the-abap-database-schema-of-the-standard-as-abap-database------in-all-places-where-a-database-connection-can-be-specified-explicitly-in-abap--the-standard-connection-can-also-be-specified-using-the-predefined-name-default---example--specifies-the-standard-connection-explicitly-in-abap-sql--it-would-not-be-necessary-to-specify-the-connection-in-the-statements-delete-and-insert--the-statement--commit-connection--javascript-call-link---abapcommit-rollback-connection-htm------however--makes-an-explicit--database-commit--javascript-call-link---abendatabase-commit-glosry-htm-----glossary-entry---possible-on-the-standard-connection---delete-from-demo--update-connection-default--insert-demo--update-connection-default---from-( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION default.

Secondary Connections ¬† 

A secondary connection is a database connection to a [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") defined by an entry in the database table DBCON. The table key CON\_NAME of the table DBCON is the name of the secondary connection in uppercase letters under which it can be specified explicitly in ABAP. The remaining columns describe the properties of the secondary connection, such as the [database system](javascript:call_link\('abendatabase_system_glosry.htm'\) "Glossary Entry"), the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry"), and the physical address.

Entries in the database table DBCON are created and modified using the central [DBA Cockpit](javascript:call_link\('abendba_cockpit_glosry.htm'\) "Glossary Entry") tool. If the DBA Cockpit tool is not available in a system for some reason, transaction DBCO can be used instead, but this requires some expertise. DBCON should not be accessed in any other way. More specifically, the table DBCON cannot be displayed using the [Data Browser](javascript:call_link\('abendata_browser_glosry.htm'\) "Glossary Entry") tool.

The [database user name](javascript:call_link\('abendatabase_user_name_glosry.htm'\) "Glossary Entry") of the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry") used to log on the database connection to the database system is part of the definition of a secondary connection in the table DBCON. An ABAP SQL statement that uses a secondary connection accesses only that [database schema](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") that is assigned to this user.

A secondary connection must be specified explicitly before it can be used in [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") or [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"). If possible, the secondary connection is opened for the current work process or an existing inactive secondary connection with the same name is reused. Secondary connections cannot be used in [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry").

Secondary connections between an AS ABAP that has a SAP HANA database as its standard database and other non-SAP HANA secondary databases are now obsolete. [SAP HANA Smart Data Access (SDA)](https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/a07c7ff25997460bbcb73099fb59007d) should be used instead (see [SAP Note 2626805](https://launchpad.support.sap.com/#/notes/2626805)). In SDA, secondary databases are addressed from the SAP HANA database using special qualified names or by using virtual tables. If a SAP HANA database is used as a standard AS ABAP database, ABAP programs can use these names via the standard connection. This is only possible using AMDP and Native SQL, since no qualified names can be specified in ABAP SQL.

Hints

-   Secondary connections can address any number of [database schemas](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") in the [standard database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry") or databases other than the standard database as [secondary databases](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry"). An AS ABAP can, for example, access the SAP HANA database of an independently operated SAP HANA appliance.
-   The prerequisite for a [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") is that it must be a database system supported by SAP. Only this system has software for ABAP SQL and Native SQL access as a shared library.
-   If the [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") is a database system other than the standard database of the current AS ABAP, the Database Shared Library (DBSL) provided for this database by SAP and client software provided by the database vendor must be installed here before an access using a secondary connection from the table DBCON. Information about creating the DBCON entry and installing the additional software is described in the standard SAP Notes for every supported database system.
-   Once all reads on secondary database, except SAP HANA databases, have been replaced by [SDA](https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/a07c7ff25997460bbcb73099fb59007d), Shared Libraries (DBSL) are no longer required.

Example

Use of a secondary connection in ABAP SQL. The connection can be entered, and a check is made to see whether it exists in the database table DBCON. If no secondary connection exists in ABAP SQL, the uncatchable exception DBSQL\_UNKNOWN\_CONNECTION is raised.

DATA conn TYPE dbcon-con\_name.
cl\_demo\_input=>request( CHANGING field = conn ).
SELECT SINGLE @abap\_true
¬†¬†¬†¬†¬†¬† FROM dbcon
¬†¬†¬†¬†¬†¬† WHERE con\_name = @conn
¬†¬†¬†¬†¬†¬† INTO @FINAL(dbtype).
IF sy-subrc <> 0.
¬†¬†cl\_demo\_output=>display( 'Connection not in DBCON' ).
¬†¬†RETURN.
ENDIF.
DELETE FROM demo\_update CONNECTION (conn).
INSERT demo\_update CONNECTION (conn)
¬†¬†FROM @( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION (conn).

Service Connections to the Standard Database ¬† 

A service connection is a database connection defined by specifying its name in an ABAP program. The name of a service connection is R/3\*name and consists of the prefix R/3\* in uppercase letters and a definable case-sensitive name that can have between 1 and 26 alphanumeric characters.

A service connection is always a database connection to the standard database and inherits all settings from the standard connection automatically.

When a service connection is requested in [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"), [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"), or [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry"), it is opened for the current work process if possible or an existing inactive service connection with the same name is reused.

Hints

-   The freely definable name is not associated with the entries in the database table DBCON and is used only to identify a service connection. Hence, specifying a database connection from the database table DBCON for name does not mean that this database connection is used.
-   Service connections to the standard SAP database are useful for performing operations in a [database LUW](javascript:call_link\('abendb_transaction.htm'\)) that are independent of the LUW of the standard connection. It should be noted that the current [isolation level](javascript:call_link\('abendb_isolation.htm'\)) is responsible for determining whether a read from a database LUW can access data modified in a different database LUW, before this data is committed using a database commit.
-   Like secondary connections, service connections add to the number of open connections of the current work process. There can be a maximum of 16 open connections, including the standard connection itself.

Example

Use of a service connection called R/3\*service\_conn in ABAP SQL.

DELETE FROM demo\_update CONNECTION R/3\*service\_conn.
INSERT demo\_update CONNECTION R/3\*service\_conn
¬†¬†FROM @( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION R/3\*service\_conn.



**üìñ Source**: [abendb_connections_types.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_types.htm)

### abendb_connections_mngmnt.htm

> **üìñ Official SAP Documentation**: [abendb_connections_mngmnt.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_mngmnt.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Management%20of%20Database%20Connections%2C%20ABENDB_CONNECTIONS_MNGMNT%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Management of Database Connections

Database connections are managed by the ABAP runtime framework. This is done at the [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") level and the [internal session](javascript:call_link\('abeninternal_session_glosry.htm'\) "Glossary Entry") level. Each time an AS ABAP is started, a [standard connection](javascript:call_link\('abenstandard_db_connection_glosry.htm'\) "Glossary Entry") is opened for every [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") and this connection cannot be closed. In addition to the standard connection, 15 further [secondary connections](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry") or [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") can be opened for each work process. A maximum of 16 database connections can be open for each work process. On certain databases, it may not be possible to reach this number. If more than 16 database connections are opened, the runtime error DBSQL\_NO\_MORE\_CONNECTION occurs.

-   [Opening and Closing Secondary Connections and Service Connections](#abendb-connections-mngmnt-1-------active-and-inactive-secondary-connections-and-service-connections---@ITOC@@ABENDB_CONNECTIONS_MNGMNT_2)
-   [Secondary Connections and Service Connections in the Internal Session](#abendb-connections-mngmnt-3-------displaying-secondary-connections-and-service-connections---@ITOC@@ABENDB_CONNECTIONS_MNGMNT_4)

Opening and Closing Secondary Connections and Service Connections ¬† 

ABAP SQL and Native SQL can request secondary connections or service connections. AMDP can only request service connections. A secondary connection or a service connection is requested as follows:

-   Implicitly in ABAP SQL by specifying the name of the connection after the addition [CONNECTION](javascript:call_link\('abapselect_connection.htm'\))
-   Explicitly and implicitly in Native SQL using one of the following:
    -   The methods [GET\_ABAP\_CONNECTION](javascript:call_link\('abencl_sql_connection.htm'\)) and [GET\_CONNECTION](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION
    -   The statement [CONNECT TO](javascript:call_link\('abapexec_connection.htm'\)) after [EXEC SQL](javascript:call_link\('abapexec.htm'\))
-   The input parameter [CONNECTION](javascript:call_link\('abenamdp_db_connections.htm'\)) of [AMDP procedure implementations](javascript:call_link\('abenamdp_procedure_method_glosry.htm'\) "Glossary Entry") (for service connections only)

If no inactive database connection can be activated after the specified name, it is opened for the current work process and activated for the current internal session.

A secondary connection or service connection is closed explicitly in Native SQL using the following:

-   The method [CLOSE](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION
-   The statement [DISCONNECT](javascript:call_link\('abapexec_connection.htm'\)) after [EXEC SQL](javascript:call_link\('abapexec.htm'\))

If closed explicitly in Native SQL, all database changes in the current database LUW of the connection that were not yet [committed on the database](javascript:call_link\('abendb_commit.htm'\)) are discarded.

ABAP SQL does not have a statement that closes a database connection explicitly. Any secondary connection or service connection that is inactive for a specific period of time (approximately 15 minutes by default) is closed by the ABAP runtime framework implicitly.

Hints

-   Generally speaking, database connections should only be closed implicitly by the ABAP runtime framework. Since it takes a significant amount of resources to restore a connection, database connections should only be closed explicitly in the following cases:
    -   A database connection was used in such a way that unwanted side effects occur when reusing it.
    -   They are not required for a long time in the current process,
-   The method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC does not actually close a connection but makes it inactive (see below). The connection is not available via the respective connection object any more, but it can be activated again.
-   A closed connection has the status DISCONNECTED in the output of program DBCONINFO.

Example

Opening of three service connections with ABAP SQL, ADBC, and after EXEC SQL. The connection opened using ABAP SQL is closed again using Native SQL, which requires its name to be specified in uppercase letters.

TRY.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM scarr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(itab)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONNECTION r/3\*demo1.
¬†¬†¬†¬†FINAL(con) = cl\_sql\_connection=>get\_abap\_connection( \`R/3\*Demo2\` ).
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†CONNECT TO 'R/3\*Demo3'
¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†DISCONNECT 'R/3\*DEMO1'
¬†¬†¬†¬†ENDEXEC.
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.

Active and Inactive Secondary Connections and Service Connections ¬† 

An open secondary connection or service connection can be active or inactive. Once opened in ABAP SQL, Native SQL, or AMDP, a database connection is active and can be used by ABAP SQL, Native SQL, or AMDP. The secondary connection or service connection becomes inactive as soon as the current database LUW of this connection is ended. This can occur as follows:

-   Using the statements [COMMIT CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) or [ROLLBACK CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) for this connection.
-   Using the Native SQL statements COMMIT WORK or ROLLBACK WORK after [EXEC SQL](javascript:call_link\('abapexec.htm'\)) for this connection
-   Using the methods [COMMIT](javascript:call_link\('abenadbc_transaction.htm'\)) and [ROLLBACK](javascript:call_link\('abenadbc_transaction.htm'\)) of the ADBC class CL\_SQL\_CONNECTION for this connection.
-   Using the method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION for this connection. This method ends the current database LUW with a database rollback and also closes the connection for the respective ADBC connection object.
-   Using the statements [COMMIT WORK](javascript:call_link\('abapcommit.htm'\)) and [ROLLBACK WORK](javascript:call_link\('abaprollback.htm'\)) for all connections
-   In an implicit [database commit](javascript:call_link\('abendb_commit.htm'\)) or [database rollback](javascript:call_link\('abendb_rollback.htm'\)) for all connections
-   When closing the internal session in which the connection was opened, where a COMMIT CONNECTION is executed for the connection implicitly.

An inactive open secondary connection or service connection is reused by the ABAP runtime framework if it is to be reopened for its work process. Once activated in an internal session, a secondary connection or service connection can be reused here regardless of whether it is active or inactive. It is not necessary to open it again explicitly in Native SQL. When an inactive connection is reused, it is activated implicitly and a new database LUW is opened. For a shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry"), the usage can be ABAP SQL, Native SQL or ADBC, An exception to this rule are connections closed by method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC. They cannot be used via the connection object any longer.

Hints

-   When a database connection is closed explicitly in Native SQL it is actually closed and not just set to inactive. The next request must then reopen the connection for the current work process.
-   The method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC does not fully close a connection but makes it inactive. A shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") closed in such a way can be implicitly reopened as any inactive ABAP connection.
-   Active and inactive connections have the status ACTIVE and INACTIVE in the output of program DBCONINFO respectively.

Example

A service connection R/3\*DEMO is requested using ADBC and used for an SQL statement. The statement COMMIT CONNECTION ends the database LUW of the connection and sets it from active to inactive. Since the connection is a shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") and the connection name does not contain any lowercase letters, it is reused by being specified in the ABAP SQL statement INSERT. The connection is reactivated here and a new database LUW is started. A further COMMIT CONNECTION statement ends this LUW and deactivates the connection.

FINAL(conn) = CONV dbcon-con\_name( \`R/3\*DEMO\` ).
TRY.
¬†¬†¬†¬†NEW cl\_sql\_statement(
¬†¬†¬†¬†¬†¬†con\_ref =
¬†¬†¬†¬†¬†¬†¬†¬†cl\_sql\_connection=>get\_abap\_connection( con\_name = conn )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->execute\_update( \`DELETE FROM demo\_update\` ).
¬†¬†¬†¬†COMMIT CONNECTION (conn).
¬†¬†¬†¬†INSERT demo\_update CONNECTION (conn)
¬†¬†¬†¬†¬†¬†FROM @( VALUE #( id = 'X' col1 = 1
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col2 = 2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col3 = 3
¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col4 = 4 ) ).
¬†¬†¬†¬†COMMIT CONNECTION (conn).
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.

Secondary Connections and Service Connections in the Internal Session ¬† 

Active open secondary connections or service connections can only be used within the [internal session](javascript:call_link\('abeninternal_session_glosry.htm'\) "Glossary Entry") in which they are opened. An active open secondary connection or service connection is usually an [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") that can be shared by ABAP SQL, Native SQL, and AMDP within an internal session. Exceptions from this rule are connections opened in Native SQL or AMDP with lowercase letters in the name or exclusive connections opened in ADBC with method GET\_CONNECTION instead of GET\_ABAP\_CONNECTION of class CL\_SQL\_CONNECTION.

When the internal session is closed, any changes made using the connections are committed and the connections are set to inactive. When an ABAP program is called that returns to the called program (SUBMIT AND RETURN or CALL TRANSACTION), the states of any secondary connections or service connections opened here are preserved as active or inactive. They are not, however, passed to the called program. If a secondary connection or service connection with the same name is requested here, a further connection of the same type is opened.

Any shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") that becomes inactive within an internal session when its database LUW is ended can be reused in the same session without being requested explicitly, not just in ABAP SQL, but also in Native SQL or AMDP.

Example

An ABAP SQL statement requests a service connection R/3\*DEMO and then calls a further program. The called program requests a service connection with the same name. After this, two service connections with the same name are open and active for the current work process until the end of the internal session of the called program. When a return is made from the called program, its service connection is deactivated, just as the service connection of the calling program is deactivated when it is exited. No database commit was made before the call, which means that the [isolation level](javascript:call_link\('abendb_isolation.htm'\)) of the database determines whether the change made in the caller is visible in the called program.

Calling Program

DELETE FROM demo\_update CONNECTION r/3\*demo.
SUBMIT ... AND RETURN.

Called Program

SELECT \*
¬†¬†¬†¬†¬†¬† FROM demo\_update
¬†¬†¬†¬†¬†¬† INTO TABLE @DATA(itab)
¬†¬†¬†¬†¬†¬† CONNECTION r/3\*demo.

Displaying Secondary Connections and Service Connections ¬† 

The program DBCONINFO shows all database connection of all work processes in the current AS ABAP. The name R/3 in the column ConName identifies the standard connection. Other names indicate the secondary connections and service connections. The column ConState shows the states ACTIVE, INACTIVE, and DISCONNECTED. The column Hdl indicates whether a connection is a secondary connection or a service connection. Identically named secondary and service connections can occur for the following reasons:

-   Identically named connections are opened in called programs
-   Connections are opened using the method GET\_CONNECTION of the class CL\_SQL\_CONNECTION in ADBC, where the value abap\_false is used for the parameter SHARABLE
-   Connections are opened using CONNECT TO after EXEC SQL, where AS is used to specify an explicit name

Example

The program DBCONINFO can be used to explore the examples shown in this section while they are being executed step by step in the ABAP Debugger.



**üìñ Source**: [abendb_connections_mngmnt.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_mngmnt.htm)

### abendb_connections_using.htm

> **üìñ Official SAP Documentation**: [abendb_connections_using.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_using.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Access%20Using%20Secondary%20Connections%20and%20Service%20Connections%2C%20ABENDB_CONNECTIONS_USING%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%
0D%0ASuggestion%20for%20improvement:)

Database Access Using Secondary Connections and Service Connections

Secondary connections and service connections are opened and used in different ways in ABAP SQL, Native SQL, and AMDP. A secondary or service connection active for an internal session can be shared by ABAP SQL, Native SQL, or AMDP. Connections used by ABAP SQL, however, cannot have any lowercase letters in their names and ADBC can reserve connections for itself exclusively.

-   [ABAP SQL](#abendb-connections-using-1-------native-sql---adbc---@ITOC@@ABENDB_CONNECTIONS_USING_2)
-   [Native SQL - EXEC SQL](#abendb-connections-using-3-------amdp---@ITOC@@ABENDB_CONNECTIONS_USING_4)
-   [Shared ABAP Connections](#abendb-connections-using-5---abap-sql-----the-following-additions-can-be-used-to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in-abap-sql-------the-addition--connection--javascript-call-link---abapselect-connection-htm-----for-read-statements-----the-identical-addition--connection--javascript-call-link---abapiumd-conn-htm-----for-write-statements--if-the-addition-connection-is-specified-using-the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---from-the-database-table-dbcon-or-using-the-name-of-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---in-an-abap-sql-statement--the-following-applies-------if-the-specified-connection-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-given-the-state-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--or-amdp------if-the-specified-connection-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----the-abap-sql-statement-uses-this-connection-and-works-in-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry----the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp---when-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---is-used--an-abap-sql-statement-only-accesses-the--database-schema--javascript-call-link---abendatabase-schema-glosry-htm-----glossary-entry---assigned-to-the--database-user-name--javascript-call-link---abendatabase-user-name-glosry-htm-----glossary-entry---assigned-to-the-secondary-connection--abap-sql-can-only-access-database-tables-and-views-that-are-defined-in-the--abap-dictionary--javascript-call-link---abenabap-dictionary-glosry-htm-----glossary-entry---in-the-current-as-abap--which-means-that-every-database-table-or-view-accessed-using-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---must-exist-and-be-active-as-a-database-or-view-with-the-same-name-and-matching-ddic-structure-in-the-current-as-abap--regardless-of-the--secondary-database--javascript-call-link---abensecondary-db-glosry-htm-----glossary-entry---and-database-schema--for-the-database-tables-or-views-of-the-secondary-database--abap-sql-assumes-that-their--table-category--javascript-call-link---abenddic-database-tables-tab-cat-htm-----and-type-information-matches-the-local-definition-exactly--this-prerequisite-is-essential--for-example--for-the-correct-interpretation-of-the-database-content-and--if-necessary--their-conversion-with-respect-to-the-abap-types-of-the-target-fields--if-this-prerequisite-is-not-met--incorrect-data-or-runtime-errors-can-be-caused-by-reads-or-writes-depending-on-the-database-system--because-the-abap-runtime-framework-cannot-ensure-the-consistency-of-the-type-descriptions-in-the-local-and-remote-databases--the-consistency-must-be-guaranteed-by-the-relevant-application-program---the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---or--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---specified-after-connection-is-transformed-into-uppercase-letters-internally--this-must-be-respected-when-native-sql-accesses-the-connection-explicitly--conversely--an-abap-sql-statement-can-reuse-database-connections-active-in-native-sql-or-amdp-only-if-their-names-do-not-contain-any-lowercase-letters---hints------the-type-of-a-database-object-specified-in-an-abap-sql-statement-using-the-addition-connection-does-not-necessarily-need-to-match-the-type-of-the-database-object-with-the-same-name-in-the-secondary-database--for-example--a-view-with-the-same-name-in-the-secondary-database-can-be-accessed-by-specifying-a-database-table-and-vice-versa-if-they-have-the-same-structure------if-a-database-table-specified-using-the-addition-connection-in-an-abap-sql-statement-is-a--global-temporary-table--gtt---javascript-call-link---abenglobal-temporary-table-glosry-htm-----glossary-entry----it-is-handled-like-a-gtt--even-if-it-is-a-regular-transparent-table-in-the-secondary-database--conversely--there-is-no-special-handling-in-abap-sql-if-the-database-is-a-gtt-on-the-secondary-database-only------the-prerequisite-that-an-identically-named-database-object-with-a-suitable-ddic-structure-must-exist-in-the-current-system-for-views-accessed-using-a-secondary-connection-is-particularly-important-for--ddic-external-views--javascript-call-link---abenexternal-view-glosry-htm-----glossary-entry-----example--specification-of-a-database-connection-in-abap-sql---final-conn----conv-dbcon-con--name-------------delete-from-demo--update-connection--conn----native-sql---adbc-----to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in--adbc--javascript-call-link---abenadbc-glosry-htm-----glossary-entry----the-static-method--get--abap--connection--javascript-call-link---abencl-sql-connection-htm-----of-the-class-cl--sql--connection-can-be-used--the-return-value-of-the-method-is-a-reference-to-a-connection-object-that-can-be-passed-to-other-adbc-objects--using-the-input-parameter-con--name--the-method-can-be-passed-the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---from-the-database-table-dbcon-or-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry----these-names-are-case-sensitive--the-activated-connection-is-an--abap-connection--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry---that-can-be-used-in-abap-sql--native-sql--and-amdp--a-further-method--get--connection--javascript-call-link---abencl-sql-connection-htm-----works-in-a-similar-way-to-get--abap--connection--but-has-an-additional-input-parameter-sharable--which-activates-an-exclusive-connection-if-its-default-parameter-abap--false-is-used-------get--abap--connection-or-get--connection-with-abap--true-passed-to-sharable-for-shared--abap-connections--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry------------if-the-connection-passed-to-con--name-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it----------if-the-connection-passed-to-con--name-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-used--the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp------get--connection-with-abap--false-passed-to-sharable--default--for-exclusive-connections-----------a-new-connection-is-always-activated-for-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry---by-opening-a-new-connection-or-activating-an-inactive-connection-of-the-current-work-process--no-existing-active-connection-of-the-name-passed-to-con--name-is-used--a-connection-activated-like-this-can-only-be-used-exclusively-using-the-returned-connection-object-in-adbc--------after-successful-execution--get--connection-gets-a-reference-to-a-connection-object--the-connection-object-represents-the-connection-activated-or-reused-using-get--connection-in-adbc-and-can-be-passed-to-the-instance-constructors-of-the-classes-cl--sql--statement-and-cl--sql--prepared--statement--the-sql-statements-of-these-classes-are-then-executed-on-this-connection-in-its-database-luw---hints------abap--false-can-be-used-for-the-parameter-sharable-of-the-method-get--connection-to-control-the-use-of-a-database-connection-and-its-database-luw-explicitly--database-connections-that-are-activated-differently-are-usually-available-to-all-accesses-in-abap-sql-and-native-sql------if-abap--false-is-passed-to-the-parameter-sharable-of-the-method-get--connection--multiple-database-connections-with-the-same-name-can-be-activated-and-used-within-a-single-internal-session--these-are-indicated-in-the-output-of-the-program-dbconinfo-by-the-different-values-in-the-column-hdl------when-opening-exclusive-connections-for-connection-objects--the-maximum-number-of-connections-for-each-work-process-must-not-be-exceeded--exclusive-connection-should-be-closed-explicitly-once-they-are-no-longer-needed-and-if-there-are-a-large-number-of-connection-objects---example--specification-of-a-database-connection-in-adbc---final-conn----conv-dbcon-con--name-------------try------new-cl--sql--statement--------con--ref---cl--sql--connection--get--abap--connection--------------------con--name---conn----------------------execute--update----delete-from-demo--update--------catch-cx--sql--exception----------endtry---native-sql---exec-sql-----the-following-special-statements-can-be-used-to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in-native-sql-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm-----------connect-to--javascript-call-link---abapexec-connection-htm----------set-connection--javascript-call-link---abapexec-connection-htm------the-statement--connect-to--javascript-call-link---abapexec-connection-htm-----can-be-used-to-activate-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---or-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry----here--the-addition-as-can-be-used-to-open-the-same-connection-more-than-once-under-different-names--the-entries-made-here-are-case-sensitive-------if-no-name-is-specified-using-as--the-following-applies----------if-the-connection-specified-after-connect-to-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--and-amdp----------if-the-connection-specified-after-con--name-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-reused--the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp------if-a-name-is-specified-using-as--the-following-applies----------if-the-connection-specified-after-connect-to-is-not-yet-active-under-this-name-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-given-the-state-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it--a-connection-with-a-name-defined-using-as-is-only-used-by-native-sql-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm------abap-sql-and-other-kinds-of-native-sql-or-amdp-do-not-use-this-type-of-connection----------if-the-connection-specified-after-con--name-is-already-active-under-this-name-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-reused--the-connection-can-only-have-been-activated-using-connect-to---after-the-statement-connect-to--all-subsequent-native-sql-statements-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm-----in-the-current-internal-session-use-the-connection-activated-or-reused-using-connect-to--the-statement--set-connection--javascript-call-link---abapexec-connection-htm-----can-be-used-to-switch-to-the-use-of-the-previously-activated-connection-of-the-current-internal-session--here--a-name-defined-with-as-must-be-specified-using-this-connection--more-specifically--the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---can-be-activated-by-specifying-default--the-statement-set-connection-is-ignored-by-the-database-luws-of-the-connections-involved---hint--when-a-name-is-specified-after-as-in-the-statement-connect-to--multiple-database-connections-with-the-same-original-name-can-be-activated-and-used-in-the-same-internal-session--these-are-indicated-in-the-output-of-the-program-dbconinfo-by-the-different-values-in-the-column-hdl---example--specification-of-a-database-connection-after-exec-sql---final-conn----conv-dbcon-con--name-------------exec-sql----connect-to--conn-endexec--exec-sql----delete-from-demo--update-endexec---amdp-----to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---to-execute-an--amdp-procedure-implementation--javascript-call-link---abenamdp-procedure-method-glosry-htm-----glossary-entry----the-names-of--service-connections--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---can-be-passed-to-the-input-parameter--connection--javascript-call-link---abenamdp-db-connections-htm-----of-the-associated--amdp-method--javascript-call-link---abenamdp-method-glosry-htm-----glossary-entry----the-names-are-case-sensitive-here---secondary-connections--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---cannot-be-used-------if-the-passed-connection-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--and-amdp------if-the-specified-connection-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----the-procedure-implementation-is-called-using-this-connection-and-works-in-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry----the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp---hint--the-service-connections-that-can-be-used-by-amdp-are-also-connections-that-can-be-used-by-abap-sql--native-sql--and-amdp--as-long-as-the-appropriate-conditions-are-met---example--specification-of-a-database-connection-in-amdp---final-conn----conv-dbcon-con--name----r-3-----------try------new-cl--demo--amdp--connection---------------get--scarr--exporting---------------------------connection---conn---------------------------clnt---------sy-mandt-------------------------importing---------------------------carriers---final-result-------catch-cx--amdp--error-into-final-amdp--error-----------endtry---shared-abap-connections-----a-secondary-connection-or-service-connection-active-within-an-internal-session-is-an--abap-connection--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry---that-is-shared-by-abap-sql--native-sql--and-amdp-with-the-following-exceptions-------a-connection-activated-using-adbc-that-uses-the-value-abap--false-for-the-parameter-sharable-of-the-method-get--connection-of-the-class-cl--sql--connection-can-only-be-used-exclusively-using-the-associated-connection-object------a-connection-activated-after-exec-sql-with-connect-to-using-a-name-specified-after-as-can-only-be-used-between-exec-and-endexec------amdp-can-only-use-service-connections---shared-abap-connections-are-activated-as-follows-------using-the-connection-addition-of-abap-sql-statements-to-activate-the-connection-----using-either-the-method-get--abap--connection-of-the-adbc-class-cl--sql--connection-or-the-method-get--connection-with-the-value-abap--true-for-the-parameter-sharable-to-activate-the-connection------passing-the-name-to-the-input-parameter-connection-of-an-amdp-method-to-activate-the-connection------using-the-statement-connect-to-after-exec-sql-to-activate-the-connection--without-specifying-a-name-after-as---after-a-shared-abap-connection-is-activated--it-is-reused-by-all-following-accesses-from-abap-sql--native-sql--and-amdp-within-the-same-internal-session--regardless-of-how-it-was-activated---shared-abap-connections-can-be-closed-using-native-sql--as-described--here--abendb-connections-mngmnt-htm-@ITOC@@ABENDB_CONNECTIONS_MNGMNT_1). The connection can then no longer be used. When a closed connection is specified in ABAP SQL, it is opened again implicitly. If a closed connection is reused in Native SQL or AMDP an exception is raised.

Hint

When sharing database connections, it should be noted that the name of a database connection is always converted to uppercase letters in ABAP SQL. In Native SQL and AMDP, on the other hand, the name is case-sensitive. To access a database connection activated in ABAP SQL in Native SQL or AMDP, the connection must be specified in uppercase letters. Conversely, an ABAP SQL statement cannot use a database connection activated using Native SQL AMDP if its name contains lowercase letters. This mainly affects [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") and names defined using the addition AS of the statement [CONNECT TO](javascript:call_link\('abapexec_connection.htm'\)). [Secondary connections](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry"), on the other hand, must be specified in uppercase letters in Native SQL too in accordance with their spelling in the table DBCON.

Example

Use of a shared service connection in ADBC and ABAP SQL. The modifying statements are executed in a database LUW. If the name of the service connection were to contain lowercase letters or if the method GET\_CONNECTION with the value abap\_false were used for the parameter SHARABLE in ADBC, separate connections with two different database LUWs would be produced. Accessing the same database table would then usually cause a lock situation.

FINAL(conn) = CONV dbcon-con\_name( \`R/3\*DEMO\` ).
TRY.
¬†¬†¬†¬†NEW cl\_sql\_statement(
¬†¬†¬†¬†¬†¬†con\_ref = cl\_sql\_connection=>get\_abap\_connection(
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†con\_name = conn )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->execute\_update( \`DELETE FROM demo\_update\` ).
¬†¬†¬†¬†INSERT demo\_update CONNECTION (conn)
¬†¬†¬†¬†¬†¬†FROM @( VALUE #(
¬†¬†¬†¬†¬†¬†¬†¬†id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.



**üìñ Source**: [abendb_connections_using.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_using.htm)

### abendb_connections_trans.htm

> **üìñ Official SAP Documentation**: [abendb_connections_trans.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_trans.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Connections%20and%20Transactions%2C%20ABENDB_CONNECTIONS_TRANS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Database Connections and Transactions

Every active database connection creates a separate transaction context or is linked with its own [database LUW](javascript:call_link\('abendatabase_luw_glosry.htm'\) "Glossary Entry"). This means that database changes on one connection can be committed or rolled back independently of changes on other database connections. In this way, for example, log data can be stored in and committed on a secondary connection without modifying the database LUW of the standard connection.

Database changes can be committed or rolled back as follows specifically for database connections:

-   The statements [COMMIT CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) and [ROLLBACK CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) trigger targeted [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") on specific connections.
-   In ADBC, the instance methods [COMMIT](javascript:call_link\('abenadbc_transaction.htm'\)) and [ROLLBACK](javascript:call_link\('abenadbc_transaction.htm'\)) as well as [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of the class CL\_SQL\_CONNECTION trigger [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") for the connection of the current connection object.
-   In static Native SQL, the statements COMMIT WORK and ROLLBACK WORK after EXEC SQL trigger [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") for the current connection.
-   When a database connection is made inactive implicitly at the end of an internal session, a [database commit](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") is triggered.
-   When a database connection is closed explicitly in Native SQL, a [database rollback](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") is triggered.

In addition, there are the statements [COMMIT WORK](javascript:call_link\('abapcommit.htm'\)) and [ROLLBACK WORK](javascript:call_link\('abaprollback.htm'\)), as well as the implicit [database commits](javascript:call_link\('abendb_commit.htm'\)) and [database rollbacks](javascript:call_link\('abendb_rollback.htm'\)), that act on all active connections.

A secondary connection or service connection is always set to inactive when its database changes are committed or rolled back. A connection deactivated in this way can, however, still be used in the same internal session without being opened explicitly, not just in ABAP SQL, but also in Native SQL or AMDP. The first time an inactive secondary connection or service connection previously active in the current internal session is reused, it is made active again and a new database LUW is opened.

Warning

Extreme care must be taken when using SQL SET TRANSACTION statements to set the transaction behavior of the current database connection. The transaction behavior set using these statements is preserved across the entire current database LUW, which can cause unexpected or critical situations when the database connection is reused. The default behavior of the transactions must be restored before the end of the database LUW. When the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is accessed, special methods must be called for [setting the transaction behavior](javascript:call_link\('abenhana_set_transaction.htm'\)) instead of using the SQL SET TRANSACTION statements directly. In this case, the default transaction behavior is restored automatically at the end of the database LUW. No automatic resets can currently be performed for other database platforms.

Hints

-   All ABAP SQL, Native SQL, and AMDP reads made on a active shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") of an internal session work in the same database LUW.
-   The static Native SQL statement [SET CONNECTION](javascript:call_link\('abapexec_connection.htm'\)) is ignored by the database LUWs of the connections involved.
-   Secondary connections and service connections in an internal session cannot be used in called programs, which means that a called program always activates its own connection and hence its own database LUW, even if the same connection name is used.
-   Secondary connections, more specifically service connections, can be used to implement independent database LUWs on a secondary database or on the standard database. Care must be taken to avoid lock situations here.
-   Working with multiple database connections, namely independent database LUWs, can produce lock situations in which only one work process is involved: a program changes a database row on the first connection and tries to change the same row on a second connection. This results in the program waiting for the lock of the first database LUW, without this first LUW ever being able to continue. This situation can only be resolved by ending the work process. This is done automatically for dialog processes, but it must be done manually for background jobs. It is therefore not advisable to change the same table within the a single program using multiple database connections.

Example

If the statement COMMIT CONNECTION default were not used, the following program section would produce a lock situation because the standard connection (ABAP SQL here) and a service connection (Native SQL here) would be used in independent database LUWs to access the same row of a database table.

INSERT demo\_update FROM @( VALUE #( id = 'X' ) ).
DELETE FROM demo\_update.
COMMIT CONNECTION default.
DATA conn TYPE dbcon-con\_name VALUE 'R/3\*DEMO'.
EXEC SQL.
¬†¬†CONNECT TO :conn
ENDEXEC.
EXEC SQL.
¬†¬†INSERT INTO demo\_update VALUES( :sy-mandt, 'X', 1, 2, 3, 4 )
ENDEXEC.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Database Connections

**Files**: 5 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Processing External Data / ABAP Database Access / Database Connections

Included pages: 5



**üìñ Source**: [abendb_connections_trans.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_trans.htm)

### abendb_connections.htm

> **üìñ Official SAP Documentation**: [abendb_connections.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Connections%2C%20ABENDB_CONNECTIONS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Database Connections

An [AS ABAP](javascript:call_link\('abenas_abap_glosry.htm'\) "Glossary Entry") uses database connections to access databases. A database connection defines the address of the database system (database host), the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry"), and hence the assigned [database schema](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") that is accessed. The [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") and [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") statements of an ABAP program and the [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry") Framework use a database connection of the current [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") to access a database. By default, the [standard connection](javascript:call_link\('abenstandard_db_connection_glosry.htm'\) "Glossary Entry") is used to access the [ABAP database schema](javascript:call_link\('abenabap_db_schema_glosry.htm'\) "Glossary Entry") of the [standard AS ABAP database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry"). By opening a [secondary connection](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry"), it is also possible to access databases or database schemas other than the [standard database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry"). This makes possible a number of options, for example, data can be passed to and committed in other databases or in other database schemas. The [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") does not need to be part of an AS ABAP here, but it must be supported by SAP. Connections called [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") can also be used to access the standard database.

-   [Possible Database Connections](javascript:call_link\('abendb_connections_types.htm'\))
-   [Management of Database Connections](javascript:call_link\('abendb_connections_mngmnt.htm'\))
-   [Database Access Using Secondary Connections](javascript:call_link\('abendb_connections_using.htm'\))
-   [Database Connections and Transactions](javascript:call_link\('abendb_connections_trans.htm'\))

Continue
[Possible Database Connections](javascript:call_link\('abendb_connections_types.htm'\))
[Management of Database Connections](javascript:call_link\('abendb_connections_mngmnt.htm'\))
[Database Access Using Secondary Connections and Service Connections](javascript:call_link\('abendb_connections_using.htm'\))
[Database Connections and Transactions](javascript:call_link\('abendb_connections_trans.htm'\))



**üìñ Source**: [abendb_connections.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections.htm)

### abendb_connections_types.htm

> **üìñ Official SAP Documentation**: [abendb_connections_types.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_types.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Possible%20Database%20Connections%2C%20ABENDB_CONNECTIONS_TYPES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Possible Database Connections

When ABAP SQL, Native SQL, or AMDP is used in an ABAP program, the [database interface](javascript:call_link\('abendatabase_interface_glosry.htm'\) "Glossary Entry") uses a [database connection](javascript:call_link\('abendatabase_connection_glosry.htm'\) "Glossary Entry") of the current [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") to access a database. Every work process always has a standard connection to the standard database. In addition, secondary connections to other databases or database schemas can be defined. Service connections can also still be opened to the standard database.

-   [Standard Connection](#abendb-connections-types-1-------secondary-connections---@ITOC@@ABENDB_CONNECTIONS_TYPES_2)
-   [Service Connections to the Standard Database](#abendb-connections-types-3---standard-connection-----each-as-abap-work-process-always-has-a-standard-connection-to-the--standard-database--javascript-call-link---abenstandard-db-glosry-htm-----glossary-entry---and-this-connection-cannot-be-closed--it-is-shared-by-all--internal-sessions--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----if-the-standard-connection-is-used--the-work-process-acts-as-a--database-user--javascript-call-link---abendatabase-user-glosry-htm-----glossary-entry---to-which-the--abap-database-schema--javascript-call-link---abenabap-db-schema-glosry-htm-----glossary-entry---is-assigned-------by-default---abap-sql--javascript-call-link---abenabap-sql-glosry-htm-----glossary-entry-----native-sql--javascript-call-link---abenabap-sql-glosry-htm-----glossary-entry----and--amdp--javascript-call-link---abenamdp-glosry-htm-----glossary-entry---all-use-the-standard-connection-to-access-the-abap-database-schema-of-the-standard-as-abap-database------in-all-places-where-a-database-connection-can-be-specified-explicitly-in-abap--the-standard-connection-can-also-be-specified-using-the-predefined-name-default---example--specifies-the-standard-connection-explicitly-in-abap-sql--it-would-not-be-necessary-to-specify-the-connection-in-the-statements-delete-and-insert--the-statement--commit-connection--javascript-call-link---abapcommit-rollback-connection-htm------however--makes-an-explicit--database-commit--javascript-call-link---abendatabase-commit-glosry-htm-----glossary-entry---possible-on-the-standard-connection---delete-from-demo--update-connection-default--insert-demo--update-connection-default---from-( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION default.

Secondary Connections ¬† 

A secondary connection is a database connection to a [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") defined by an entry in the database table DBCON. The table key CON\_NAME of the table DBCON is the name of the secondary connection in uppercase letters under which it can be specified explicitly in ABAP. The remaining columns describe the properties of the secondary connection, such as the [database system](javascript:call_link\('abendatabase_system_glosry.htm'\) "Glossary Entry"), the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry"), and the physical address.

Entries in the database table DBCON are created and modified using the central [DBA Cockpit](javascript:call_link\('abendba_cockpit_glosry.htm'\) "Glossary Entry") tool. If the DBA Cockpit tool is not available in a system for some reason, transaction DBCO can be used instead, but this requires some expertise. DBCON should not be accessed in any other way. More specifically, the table DBCON cannot be displayed using the [Data Browser](javascript:call_link\('abendata_browser_glosry.htm'\) "Glossary Entry") tool.

The [database user name](javascript:call_link\('abendatabase_user_name_glosry.htm'\) "Glossary Entry") of the [database user](javascript:call_link\('abendatabase_user_glosry.htm'\) "Glossary Entry") used to log on the database connection to the database system is part of the definition of a secondary connection in the table DBCON. An ABAP SQL statement that uses a secondary connection accesses only that [database schema](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") that is assigned to this user.

A secondary connection must be specified explicitly before it can be used in [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry") or [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"). If possible, the secondary connection is opened for the current work process or an existing inactive secondary connection with the same name is reused. Secondary connections cannot be used in [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry").

Secondary connections between an AS ABAP that has a SAP HANA database as its standard database and other non-SAP HANA secondary databases are now obsolete. [SAP HANA Smart Data Access (SDA)](https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/a07c7ff25997460bbcb73099fb59007d) should be used instead (see [SAP Note 2626805](https://launchpad.support.sap.com/#/notes/2626805)). In SDA, secondary databases are addressed from the SAP HANA database using special qualified names or by using virtual tables. If a SAP HANA database is used as a standard AS ABAP database, ABAP programs can use these names via the standard connection. This is only possible using AMDP and Native SQL, since no qualified names can be specified in ABAP SQL.

Hints

-   Secondary connections can address any number of [database schemas](javascript:call_link\('abendatabase_schema_glosry.htm'\) "Glossary Entry") in the [standard database](javascript:call_link\('abenstandard_db_glosry.htm'\) "Glossary Entry") or databases other than the standard database as [secondary databases](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry"). An AS ABAP can, for example, access the SAP HANA database of an independently operated SAP HANA appliance.
-   The prerequisite for a [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") is that it must be a database system supported by SAP. Only this system has software for ABAP SQL and Native SQL access as a shared library.
-   If the [secondary database](javascript:call_link\('abensecondary_db_glosry.htm'\) "Glossary Entry") is a database system other than the standard database of the current AS ABAP, the Database Shared Library (DBSL) provided for this database by SAP and client software provided by the database vendor must be installed here before an access using a secondary connection from the table DBCON. Information about creating the DBCON entry and installing the additional software is described in the standard SAP Notes for every supported database system.
-   Once all reads on secondary database, except SAP HANA databases, have been replaced by [SDA](https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/a07c7ff25997460bbcb73099fb59007d), Shared Libraries (DBSL) are no longer required.

Example

Use of a secondary connection in ABAP SQL. The connection can be entered, and a check is made to see whether it exists in the database table DBCON. If no secondary connection exists in ABAP SQL, the uncatchable exception DBSQL\_UNKNOWN\_CONNECTION is raised.

DATA conn TYPE dbcon-con\_name.
cl\_demo\_input=>request( CHANGING field = conn ).
SELECT SINGLE @abap\_true
¬†¬†¬†¬†¬†¬† FROM dbcon
¬†¬†¬†¬†¬†¬† WHERE con\_name = @conn
¬†¬†¬†¬†¬†¬† INTO @FINAL(dbtype).
IF sy-subrc <> 0.
¬†¬†cl\_demo\_output=>display( 'Connection not in DBCON' ).
¬†¬†RETURN.
ENDIF.
DELETE FROM demo\_update CONNECTION (conn).
INSERT demo\_update CONNECTION (conn)
¬†¬†FROM @( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION (conn).

Service Connections to the Standard Database ¬† 

A service connection is a database connection defined by specifying its name in an ABAP program. The name of a service connection is R/3\*name and consists of the prefix R/3\* in uppercase letters and a definable case-sensitive name that can have between 1 and 26 alphanumeric characters.

A service connection is always a database connection to the standard database and inherits all settings from the standard connection automatically.

When a service connection is requested in [ABAP SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"), [Native SQL](javascript:call_link\('abenabap_sql_glosry.htm'\) "Glossary Entry"), or [AMDP](javascript:call_link\('abenamdp_glosry.htm'\) "Glossary Entry"), it is opened for the current work process if possible or an existing inactive service connection with the same name is reused.

Hints

-   The freely definable name is not associated with the entries in the database table DBCON and is used only to identify a service connection. Hence, specifying a database connection from the database table DBCON for name does not mean that this database connection is used.
-   Service connections to the standard SAP database are useful for performing operations in a [database LUW](javascript:call_link\('abendb_transaction.htm'\)) that are independent of the LUW of the standard connection. It should be noted that the current [isolation level](javascript:call_link\('abendb_isolation.htm'\)) is responsible for determining whether a read from a database LUW can access data modified in a different database LUW, before this data is committed using a database commit.
-   Like secondary connections, service connections add to the number of open connections of the current work process. There can be a maximum of 16 open connections, including the standard connection itself.

Example

Use of a service connection called R/3\*service\_conn in ABAP SQL.

DELETE FROM demo\_update CONNECTION R/3\*service\_conn.
INSERT demo\_update CONNECTION R/3\*service\_conn
¬†¬†FROM @( VALUE #( id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
COMMIT CONNECTION R/3\*service\_conn.



**üìñ Source**: [abendb_connections_types.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_types.htm)

### abendb_connections_mngmnt.htm

> **üìñ Official SAP Documentation**: [abendb_connections_mngmnt.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_mngmnt.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Management%20of%20Database%20Connections%2C%20ABENDB_CONNECTIONS_MNGMNT%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Management of Database Connections

Database connections are managed by the ABAP runtime framework. This is done at the [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") level and the [internal session](javascript:call_link\('abeninternal_session_glosry.htm'\) "Glossary Entry") level. Each time an AS ABAP is started, a [standard connection](javascript:call_link\('abenstandard_db_connection_glosry.htm'\) "Glossary Entry") is opened for every [work process](javascript:call_link\('abenwork_process_glosry.htm'\) "Glossary Entry") and this connection cannot be closed. In addition to the standard connection, 15 further [secondary connections](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry") or [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") can be opened for each work process. A maximum of 16 database connections can be open for each work process. On certain databases, it may not be possible to reach this number. If more than 16 database connections are opened, the runtime error DBSQL\_NO\_MORE\_CONNECTION occurs.

-   [Opening and Closing Secondary Connections and Service Connections](#abendb-connections-mngmnt-1-------active-and-inactive-secondary-connections-and-service-connections---@ITOC@@ABENDB_CONNECTIONS_MNGMNT_2)
-   [Secondary Connections and Service Connections in the Internal Session](#abendb-connections-mngmnt-3-------displaying-secondary-connections-and-service-connections---@ITOC@@ABENDB_CONNECTIONS_MNGMNT_4)

Opening and Closing Secondary Connections and Service Connections ¬† 

ABAP SQL and Native SQL can request secondary connections or service connections. AMDP can only request service connections. A secondary connection or a service connection is requested as follows:

-   Implicitly in ABAP SQL by specifying the name of the connection after the addition [CONNECTION](javascript:call_link\('abapselect_connection.htm'\))
-   Explicitly and implicitly in Native SQL using one of the following:
    -   The methods [GET\_ABAP\_CONNECTION](javascript:call_link\('abencl_sql_connection.htm'\)) and [GET\_CONNECTION](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION
    -   The statement [CONNECT TO](javascript:call_link\('abapexec_connection.htm'\)) after [EXEC SQL](javascript:call_link\('abapexec.htm'\))
-   The input parameter [CONNECTION](javascript:call_link\('abenamdp_db_connections.htm'\)) of [AMDP procedure implementations](javascript:call_link\('abenamdp_procedure_method_glosry.htm'\) "Glossary Entry") (for service connections only)

If no inactive database connection can be activated after the specified name, it is opened for the current work process and activated for the current internal session.

A secondary connection or service connection is closed explicitly in Native SQL using the following:

-   The method [CLOSE](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION
-   The statement [DISCONNECT](javascript:call_link\('abapexec_connection.htm'\)) after [EXEC SQL](javascript:call_link\('abapexec.htm'\))

If closed explicitly in Native SQL, all database changes in the current database LUW of the connection that were not yet [committed on the database](javascript:call_link\('abendb_commit.htm'\)) are discarded.

ABAP SQL does not have a statement that closes a database connection explicitly. Any secondary connection or service connection that is inactive for a specific period of time (approximately 15 minutes by default) is closed by the ABAP runtime framework implicitly.

Hints

-   Generally speaking, database connections should only be closed implicitly by the ABAP runtime framework. Since it takes a significant amount of resources to restore a connection, database connections should only be closed explicitly in the following cases:
    -   A database connection was used in such a way that unwanted side effects occur when reusing it.
    -   They are not required for a long time in the current process,
-   The method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC does not actually close a connection but makes it inactive (see below). The connection is not available via the respective connection object any more, but it can be activated again.
-   A closed connection has the status DISCONNECTED in the output of program DBCONINFO.

Example

Opening of three service connections with ABAP SQL, ADBC, and after EXEC SQL. The connection opened using ABAP SQL is closed again using Native SQL, which requires its name to be specified in uppercase letters.

TRY.
¬†¬†¬†¬†SELECT \*
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† FROM scarr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO TABLE @FINAL(itab)
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† CONNECTION r/3\*demo1.
¬†¬†¬†¬†FINAL(con) = cl\_sql\_connection=>get\_abap\_connection( \`R/3\*Demo2\` ).
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†CONNECT TO 'R/3\*Demo3'
¬†¬†¬†¬†ENDEXEC.
¬†¬†¬†¬†EXEC SQL.
¬†¬†¬†¬†¬†¬†DISCONNECT 'R/3\*DEMO1'
¬†¬†¬†¬†ENDEXEC.
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.

Active and Inactive Secondary Connections and Service Connections ¬† 

An open secondary connection or service connection can be active or inactive. Once opened in ABAP SQL, Native SQL, or AMDP, a database connection is active and can be used by ABAP SQL, Native SQL, or AMDP. The secondary connection or service connection becomes inactive as soon as the current database LUW of this connection is ended. This can occur as follows:

-   Using the statements [COMMIT CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) or [ROLLBACK CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) for this connection.
-   Using the Native SQL statements COMMIT WORK or ROLLBACK WORK after [EXEC SQL](javascript:call_link\('abapexec.htm'\)) for this connection
-   Using the methods [COMMIT](javascript:call_link\('abenadbc_transaction.htm'\)) and [ROLLBACK](javascript:call_link\('abenadbc_transaction.htm'\)) of the ADBC class CL\_SQL\_CONNECTION for this connection.
-   Using the method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of the ADBC class CL\_SQL\_CONNECTION for this connection. This method ends the current database LUW with a database rollback and also closes the connection for the respective ADBC connection object.
-   Using the statements [COMMIT WORK](javascript:call_link\('abapcommit.htm'\)) and [ROLLBACK WORK](javascript:call_link\('abaprollback.htm'\)) for all connections
-   In an implicit [database commit](javascript:call_link\('abendb_commit.htm'\)) or [database rollback](javascript:call_link\('abendb_rollback.htm'\)) for all connections
-   When closing the internal session in which the connection was opened, where a COMMIT CONNECTION is executed for the connection implicitly.

An inactive open secondary connection or service connection is reused by the ABAP runtime framework if it is to be reopened for its work process. Once activated in an internal session, a secondary connection or service connection can be reused here regardless of whether it is active or inactive. It is not necessary to open it again explicitly in Native SQL. When an inactive connection is reused, it is activated implicitly and a new database LUW is opened. For a shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry"), the usage can be ABAP SQL, Native SQL or ADBC, An exception to this rule are connections closed by method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC. They cannot be used via the connection object any longer.

Hints

-   When a database connection is closed explicitly in Native SQL it is actually closed and not just set to inactive. The next request must then reopen the connection for the current work process.
-   The method [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of ADBC does not fully close a connection but makes it inactive. A shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") closed in such a way can be implicitly reopened as any inactive ABAP connection.
-   Active and inactive connections have the status ACTIVE and INACTIVE in the output of program DBCONINFO respectively.

Example

A service connection R/3\*DEMO is requested using ADBC and used for an SQL statement. The statement COMMIT CONNECTION ends the database LUW of the connection and sets it from active to inactive. Since the connection is a shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") and the connection name does not contain any lowercase letters, it is reused by being specified in the ABAP SQL statement INSERT. The connection is reactivated here and a new database LUW is started. A further COMMIT CONNECTION statement ends this LUW and deactivates the connection.

FINAL(conn) = CONV dbcon-con\_name( \`R/3\*DEMO\` ).
TRY.
¬†¬†¬†¬†NEW cl\_sql\_statement(
¬†¬†¬†¬†¬†¬†con\_ref =
¬†¬†¬†¬†¬†¬†¬†¬†cl\_sql\_connection=>get\_abap\_connection( con\_name = conn )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->execute\_update( \`DELETE FROM demo\_update\` ).
¬†¬†¬†¬†COMMIT CONNECTION (conn).
¬†¬†¬†¬†INSERT demo\_update CONNECTION (conn)
¬†¬†¬†¬†¬†¬†FROM @( VALUE #( id = 'X' col1 = 1
¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col2 = 2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col3 = 3
¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†col4 = 4 ) ).
¬†¬†¬†¬†COMMIT CONNECTION (conn).
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.

Secondary Connections and Service Connections in the Internal Session ¬† 

Active open secondary connections or service connections can only be used within the [internal session](javascript:call_link\('abeninternal_session_glosry.htm'\) "Glossary Entry") in which they are opened. An active open secondary connection or service connection is usually an [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") that can be shared by ABAP SQL, Native SQL, and AMDP within an internal session. Exceptions from this rule are connections opened in Native SQL or AMDP with lowercase letters in the name or exclusive connections opened in ADBC with method GET\_CONNECTION instead of GET\_ABAP\_CONNECTION of class CL\_SQL\_CONNECTION.

When the internal session is closed, any changes made using the connections are committed and the connections are set to inactive. When an ABAP program is called that returns to the called program (SUBMIT AND RETURN or CALL TRANSACTION), the states of any secondary connections or service connections opened here are preserved as active or inactive. They are not, however, passed to the called program. If a secondary connection or service connection with the same name is requested here, a further connection of the same type is opened.

Any shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") that becomes inactive within an internal session when its database LUW is ended can be reused in the same session without being requested explicitly, not just in ABAP SQL, but also in Native SQL or AMDP.

Example

An ABAP SQL statement requests a service connection R/3\*DEMO and then calls a further program. The called program requests a service connection with the same name. After this, two service connections with the same name are open and active for the current work process until the end of the internal session of the called program. When a return is made from the called program, its service connection is deactivated, just as the service connection of the calling program is deactivated when it is exited. No database commit was made before the call, which means that the [isolation level](javascript:call_link\('abendb_isolation.htm'\)) of the database determines whether the change made in the caller is visible in the called program.

Calling Program

DELETE FROM demo\_update CONNECTION r/3\*demo.
SUBMIT ... AND RETURN.

Called Program

SELECT \*
¬†¬†¬†¬†¬†¬† FROM demo\_update
¬†¬†¬†¬†¬†¬† INTO TABLE @DATA(itab)
¬†¬†¬†¬†¬†¬† CONNECTION r/3\*demo.

Displaying Secondary Connections and Service Connections ¬† 

The program DBCONINFO shows all database connection of all work processes in the current AS ABAP. The name R/3 in the column ConName identifies the standard connection. Other names indicate the secondary connections and service connections. The column ConState shows the states ACTIVE, INACTIVE, and DISCONNECTED. The column Hdl indicates whether a connection is a secondary connection or a service connection. Identically named secondary and service connections can occur for the following reasons:

-   Identically named connections are opened in called programs
-   Connections are opened using the method GET\_CONNECTION of the class CL\_SQL\_CONNECTION in ADBC, where the value abap\_false is used for the parameter SHARABLE
-   Connections are opened using CONNECT TO after EXEC SQL, where AS is used to specify an explicit name

Example

The program DBCONINFO can be used to explore the examples shown in this section while they are being executed step by step in the ABAP Debugger.



**üìñ Source**: [abendb_connections_mngmnt.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_mngmnt.htm)

### abendb_connections_using.htm

> **üìñ Official SAP Documentation**: [abendb_connections_using.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_using.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Access%20Using%20Secondary%20Connections%20and%20Service%20Connections%2C%20ABENDB_CONNECTIONS_USING%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%
0D%0ASuggestion%20for%20improvement:)

Database Access Using Secondary Connections and Service Connections

Secondary connections and service connections are opened and used in different ways in ABAP SQL, Native SQL, and AMDP. A secondary or service connection active for an internal session can be shared by ABAP SQL, Native SQL, or AMDP. Connections used by ABAP SQL, however, cannot have any lowercase letters in their names and ADBC can reserve connections for itself exclusively.

-   [ABAP SQL](#abendb-connections-using-1-------native-sql---adbc---@ITOC@@ABENDB_CONNECTIONS_USING_2)
-   [Native SQL - EXEC SQL](#abendb-connections-using-3-------amdp---@ITOC@@ABENDB_CONNECTIONS_USING_4)
-   [Shared ABAP Connections](#abendb-connections-using-5---abap-sql-----the-following-additions-can-be-used-to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in-abap-sql-------the-addition--connection--javascript-call-link---abapselect-connection-htm-----for-read-statements-----the-identical-addition--connection--javascript-call-link---abapiumd-conn-htm-----for-write-statements--if-the-addition-connection-is-specified-using-the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---from-the-database-table-dbcon-or-using-the-name-of-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---in-an-abap-sql-statement--the-following-applies-------if-the-specified-connection-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-given-the-state-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--or-amdp------if-the-specified-connection-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----the-abap-sql-statement-uses-this-connection-and-works-in-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry----the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp---when-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---is-used--an-abap-sql-statement-only-accesses-the--database-schema--javascript-call-link---abendatabase-schema-glosry-htm-----glossary-entry---assigned-to-the--database-user-name--javascript-call-link---abendatabase-user-name-glosry-htm-----glossary-entry---assigned-to-the-secondary-connection--abap-sql-can-only-access-database-tables-and-views-that-are-defined-in-the--abap-dictionary--javascript-call-link---abenabap-dictionary-glosry-htm-----glossary-entry---in-the-current-as-abap--which-means-that-every-database-table-or-view-accessed-using-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---must-exist-and-be-active-as-a-database-or-view-with-the-same-name-and-matching-ddic-structure-in-the-current-as-abap--regardless-of-the--secondary-database--javascript-call-link---abensecondary-db-glosry-htm-----glossary-entry---and-database-schema--for-the-database-tables-or-views-of-the-secondary-database--abap-sql-assumes-that-their--table-category--javascript-call-link---abenddic-database-tables-tab-cat-htm-----and-type-information-matches-the-local-definition-exactly--this-prerequisite-is-essential--for-example--for-the-correct-interpretation-of-the-database-content-and--if-necessary--their-conversion-with-respect-to-the-abap-types-of-the-target-fields--if-this-prerequisite-is-not-met--incorrect-data-or-runtime-errors-can-be-caused-by-reads-or-writes-depending-on-the-database-system--because-the-abap-runtime-framework-cannot-ensure-the-consistency-of-the-type-descriptions-in-the-local-and-remote-databases--the-consistency-must-be-guaranteed-by-the-relevant-application-program---the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---or--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---specified-after-connection-is-transformed-into-uppercase-letters-internally--this-must-be-respected-when-native-sql-accesses-the-connection-explicitly--conversely--an-abap-sql-statement-can-reuse-database-connections-active-in-native-sql-or-amdp-only-if-their-names-do-not-contain-any-lowercase-letters---hints------the-type-of-a-database-object-specified-in-an-abap-sql-statement-using-the-addition-connection-does-not-necessarily-need-to-match-the-type-of-the-database-object-with-the-same-name-in-the-secondary-database--for-example--a-view-with-the-same-name-in-the-secondary-database-can-be-accessed-by-specifying-a-database-table-and-vice-versa-if-they-have-the-same-structure------if-a-database-table-specified-using-the-addition-connection-in-an-abap-sql-statement-is-a--global-temporary-table--gtt---javascript-call-link---abenglobal-temporary-table-glosry-htm-----glossary-entry----it-is-handled-like-a-gtt--even-if-it-is-a-regular-transparent-table-in-the-secondary-database--conversely--there-is-no-special-handling-in-abap-sql-if-the-database-is-a-gtt-on-the-secondary-database-only------the-prerequisite-that-an-identically-named-database-object-with-a-suitable-ddic-structure-must-exist-in-the-current-system-for-views-accessed-using-a-secondary-connection-is-particularly-important-for--ddic-external-views--javascript-call-link---abenexternal-view-glosry-htm-----glossary-entry-----example--specification-of-a-database-connection-in-abap-sql---final-conn----conv-dbcon-con--name-------------delete-from-demo--update-connection--conn----native-sql---adbc-----to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in--adbc--javascript-call-link---abenadbc-glosry-htm-----glossary-entry----the-static-method--get--abap--connection--javascript-call-link---abencl-sql-connection-htm-----of-the-class-cl--sql--connection-can-be-used--the-return-value-of-the-method-is-a-reference-to-a-connection-object-that-can-be-passed-to-other-adbc-objects--using-the-input-parameter-con--name--the-method-can-be-passed-the-name-of-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---from-the-database-table-dbcon-or-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry----these-names-are-case-sensitive--the-activated-connection-is-an--abap-connection--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry---that-can-be-used-in-abap-sql--native-sql--and-amdp--a-further-method--get--connection--javascript-call-link---abencl-sql-connection-htm-----works-in-a-similar-way-to-get--abap--connection--but-has-an-additional-input-parameter-sharable--which-activates-an-exclusive-connection-if-its-default-parameter-abap--false-is-used-------get--abap--connection-or-get--connection-with-abap--true-passed-to-sharable-for-shared--abap-connections--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry------------if-the-connection-passed-to-con--name-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it----------if-the-connection-passed-to-con--name-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-used--the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp------get--connection-with-abap--false-passed-to-sharable--default--for-exclusive-connections-----------a-new-connection-is-always-activated-for-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry---by-opening-a-new-connection-or-activating-an-inactive-connection-of-the-current-work-process--no-existing-active-connection-of-the-name-passed-to-con--name-is-used--a-connection-activated-like-this-can-only-be-used-exclusively-using-the-returned-connection-object-in-adbc--------after-successful-execution--get--connection-gets-a-reference-to-a-connection-object--the-connection-object-represents-the-connection-activated-or-reused-using-get--connection-in-adbc-and-can-be-passed-to-the-instance-constructors-of-the-classes-cl--sql--statement-and-cl--sql--prepared--statement--the-sql-statements-of-these-classes-are-then-executed-on-this-connection-in-its-database-luw---hints------abap--false-can-be-used-for-the-parameter-sharable-of-the-method-get--connection-to-control-the-use-of-a-database-connection-and-its-database-luw-explicitly--database-connections-that-are-activated-differently-are-usually-available-to-all-accesses-in-abap-sql-and-native-sql------if-abap--false-is-passed-to-the-parameter-sharable-of-the-method-get--connection--multiple-database-connections-with-the-same-name-can-be-activated-and-used-within-a-single-internal-session--these-are-indicated-in-the-output-of-the-program-dbconinfo-by-the-different-values-in-the-column-hdl------when-opening-exclusive-connections-for-connection-objects--the-maximum-number-of-connections-for-each-work-process-must-not-be-exceeded--exclusive-connection-should-be-closed-explicitly-once-they-are-no-longer-needed-and-if-there-are-a-large-number-of-connection-objects---example--specification-of-a-database-connection-in-adbc---final-conn----conv-dbcon-con--name-------------try------new-cl--sql--statement--------con--ref---cl--sql--connection--get--abap--connection--------------------con--name---conn----------------------execute--update----delete-from-demo--update--------catch-cx--sql--exception----------endtry---native-sql---exec-sql-----the-following-special-statements-can-be-used-to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---in-native-sql-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm-----------connect-to--javascript-call-link---abapexec-connection-htm----------set-connection--javascript-call-link---abapexec-connection-htm------the-statement--connect-to--javascript-call-link---abapexec-connection-htm-----can-be-used-to-activate-a--secondary-connection--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---or-a--service-connection--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry----here--the-addition-as-can-be-used-to-open-the-same-connection-more-than-once-under-different-names--the-entries-made-here-are-case-sensitive-------if-no-name-is-specified-using-as--the-following-applies----------if-the-connection-specified-after-connect-to-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--and-amdp----------if-the-connection-specified-after-con--name-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-reused--the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp------if-a-name-is-specified-using-as--the-following-applies----------if-the-connection-specified-after-connect-to-is-not-yet-active-under-this-name-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-given-the-state-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it--a-connection-with-a-name-defined-using-as-is-only-used-by-native-sql-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm------abap-sql-and-other-kinds-of-native-sql-or-amdp-do-not-use-this-type-of-connection----------if-the-connection-specified-after-con--name-is-already-active-under-this-name-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----this-connection-and-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---are-reused--the-connection-can-only-have-been-activated-using-connect-to---after-the-statement-connect-to--all-subsequent-native-sql-statements-embedded-between--exec-sql--javascript-call-link---abapexec-htm-----and--endexec--javascript-call-link---abapendexec-htm-----in-the-current-internal-session-use-the-connection-activated-or-reused-using-connect-to--the-statement--set-connection--javascript-call-link---abapexec-connection-htm-----can-be-used-to-switch-to-the-use-of-the-previously-activated-connection-of-the-current-internal-session--here--a-name-defined-with-as-must-be-specified-using-this-connection--more-specifically--the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---can-be-activated-by-specifying-default--the-statement-set-connection-is-ignored-by-the-database-luws-of-the-connections-involved---hint--when-a-name-is-specified-after-as-in-the-statement-connect-to--multiple-database-connections-with-the-same-original-name-can-be-activated-and-used-in-the-same-internal-session--these-are-indicated-in-the-output-of-the-program-dbconinfo-by-the-different-values-in-the-column-hdl---example--specification-of-a-database-connection-after-exec-sql---final-conn----conv-dbcon-con--name-------------exec-sql----connect-to--conn-endexec--exec-sql----delete-from-demo--update-endexec---amdp-----to-use-a-database-connection-other-than-the--standard-connection--javascript-call-link---abenstandard-db-connection-glosry-htm-----glossary-entry---to-execute-an--amdp-procedure-implementation--javascript-call-link---abenamdp-procedure-method-glosry-htm-----glossary-entry----the-names-of--service-connections--javascript-call-link---abenservice-connection-glosry-htm-----glossary-entry---can-be-passed-to-the-input-parameter--connection--javascript-call-link---abenamdp-db-connections-htm-----of-the-associated--amdp-method--javascript-call-link---abenamdp-method-glosry-htm-----glossary-entry----the-names-are-case-sensitive-here---secondary-connections--javascript-call-link---abensecondary-db-connection-glosry-htm-----glossary-entry---cannot-be-used-------if-the-passed-connection-is-not-yet-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----it-is-either-opened-and-set-to-active-or--if-an-open-inactive-connection-exists-for-the-current-work-process--it-is-reused-and-set-to-active--when-the-connection-is-activated--a--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry---is-opened-for-it-and-this-can-be-used-by-abap-sql--native-sql--and-amdp------if-the-specified-connection-is-already-active-in-the-current--internal-session--javascript-call-link---abeninternal-session-glosry-htm-----glossary-entry----the-procedure-implementation-is-called-using-this-connection-and-works-in-its--database-luw--javascript-call-link---abendatabase-luw-glosry-htm-----glossary-entry----the-connection-can-be-activated-using-abap-sql--native-sql--or-amdp---hint--the-service-connections-that-can-be-used-by-amdp-are-also-connections-that-can-be-used-by-abap-sql--native-sql--and-amdp--as-long-as-the-appropriate-conditions-are-met---example--specification-of-a-database-connection-in-amdp---final-conn----conv-dbcon-con--name----r-3-----------try------new-cl--demo--amdp--connection---------------get--scarr--exporting---------------------------connection---conn---------------------------clnt---------sy-mandt-------------------------importing---------------------------carriers---final-result-------catch-cx--amdp--error-into-final-amdp--error-----------endtry---shared-abap-connections-----a-secondary-connection-or-service-connection-active-within-an-internal-session-is-an--abap-connection--javascript-call-link---abenabap-connection-glosry-htm-----glossary-entry---that-is-shared-by-abap-sql--native-sql--and-amdp-with-the-following-exceptions-------a-connection-activated-using-adbc-that-uses-the-value-abap--false-for-the-parameter-sharable-of-the-method-get--connection-of-the-class-cl--sql--connection-can-only-be-used-exclusively-using-the-associated-connection-object------a-connection-activated-after-exec-sql-with-connect-to-using-a-name-specified-after-as-can-only-be-used-between-exec-and-endexec------amdp-can-only-use-service-connections---shared-abap-connections-are-activated-as-follows-------using-the-connection-addition-of-abap-sql-statements-to-activate-the-connection-----using-either-the-method-get--abap--connection-of-the-adbc-class-cl--sql--connection-or-the-method-get--connection-with-the-value-abap--true-for-the-parameter-sharable-to-activate-the-connection------passing-the-name-to-the-input-parameter-connection-of-an-amdp-method-to-activate-the-connection------using-the-statement-connect-to-after-exec-sql-to-activate-the-connection--without-specifying-a-name-after-as---after-a-shared-abap-connection-is-activated--it-is-reused-by-all-following-accesses-from-abap-sql--native-sql--and-amdp-within-the-same-internal-session--regardless-of-how-it-was-activated---shared-abap-connections-can-be-closed-using-native-sql--as-described--here--abendb-connections-mngmnt-htm-@ITOC@@ABENDB_CONNECTIONS_MNGMNT_1). The connection can then no longer be used. When a closed connection is specified in ABAP SQL, it is opened again implicitly. If a closed connection is reused in Native SQL or AMDP an exception is raised.

Hint

When sharing database connections, it should be noted that the name of a database connection is always converted to uppercase letters in ABAP SQL. In Native SQL and AMDP, on the other hand, the name is case-sensitive. To access a database connection activated in ABAP SQL in Native SQL or AMDP, the connection must be specified in uppercase letters. Conversely, an ABAP SQL statement cannot use a database connection activated using Native SQL AMDP if its name contains lowercase letters. This mainly affects [service connections](javascript:call_link\('abenservice_connection_glosry.htm'\) "Glossary Entry") and names defined using the addition AS of the statement [CONNECT TO](javascript:call_link\('abapexec_connection.htm'\)). [Secondary connections](javascript:call_link\('abensecondary_db_connection_glosry.htm'\) "Glossary Entry"), on the other hand, must be specified in uppercase letters in Native SQL too in accordance with their spelling in the table DBCON.

Example

Use of a shared service connection in ADBC and ABAP SQL. The modifying statements are executed in a database LUW. If the name of the service connection were to contain lowercase letters or if the method GET\_CONNECTION with the value abap\_false were used for the parameter SHARABLE in ADBC, separate connections with two different database LUWs would be produced. Accessing the same database table would then usually cause a lock situation.

FINAL(conn) = CONV dbcon-con\_name( \`R/3\*DEMO\` ).
TRY.
¬†¬†¬†¬†NEW cl\_sql\_statement(
¬†¬†¬†¬†¬†¬†con\_ref = cl\_sql\_connection=>get\_abap\_connection(
¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†con\_name = conn )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†)->execute\_update( \`DELETE FROM demo\_update\` ).
¬†¬†¬†¬†INSERT demo\_update CONNECTION (conn)
¬†¬†¬†¬†¬†¬†FROM @( VALUE #(
¬†¬†¬†¬†¬†¬†¬†¬†id = 'X'¬†¬†col1 = 1 col2 = 2 col3 = 3 col4 = 4 ) ).
¬†¬†CATCH cx\_sql\_exception.
¬†¬†¬†¬†...
ENDTRY.



**üìñ Source**: [abendb_connections_using.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_using.htm)

### abendb_connections_trans.htm

> **üìñ Official SAP Documentation**: [abendb_connections_trans.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_trans.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Processing External Data](javascript:call_link\('abenabap_language_external_data.htm'\))¬†‚Üí¬† [ABAP Database Access](javascript:call_link\('abendb_access.htm'\))¬†‚Üí¬† [Database Connections](javascript:call_link\('abendb_connections.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Database%20Connections%20and%20Transactions%2C%20ABENDB_CONNECTIONS_TRANS%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

Database Connections and Transactions

Every active database connection creates a separate transaction context or is linked with its own [database LUW](javascript:call_link\('abendatabase_luw_glosry.htm'\) "Glossary Entry"). This means that database changes on one connection can be committed or rolled back independently of changes on other database connections. In this way, for example, log data can be stored in and committed on a secondary connection without modifying the database LUW of the standard connection.

Database changes can be committed or rolled back as follows specifically for database connections:

-   The statements [COMMIT CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) and [ROLLBACK CONNECTION](javascript:call_link\('abapcommit_rollback_connection.htm'\)) trigger targeted [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") on specific connections.
-   In ADBC, the instance methods [COMMIT](javascript:call_link\('abenadbc_transaction.htm'\)) and [ROLLBACK](javascript:call_link\('abenadbc_transaction.htm'\)) as well as [CLOSE\_NO\_DISCONNECT](javascript:call_link\('abencl_sql_connection.htm'\)) of the class CL\_SQL\_CONNECTION trigger [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") for the connection of the current connection object.
-   In static Native SQL, the statements COMMIT WORK and ROLLBACK WORK after EXEC SQL trigger [database commits](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") or [database rollbacks](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") for the current connection.
-   When a database connection is made inactive implicitly at the end of an internal session, a [database commit](javascript:call_link\('abendatabase_commit_glosry.htm'\) "Glossary Entry") is triggered.
-   When a database connection is closed explicitly in Native SQL, a [database rollback](javascript:call_link\('abendatabase_rollback_glosry.htm'\) "Glossary Entry") is triggered.

In addition, there are the statements [COMMIT WORK](javascript:call_link\('abapcommit.htm'\)) and [ROLLBACK WORK](javascript:call_link\('abaprollback.htm'\)), as well as the implicit [database commits](javascript:call_link\('abendb_commit.htm'\)) and [database rollbacks](javascript:call_link\('abendb_rollback.htm'\)), that act on all active connections.

A secondary connection or service connection is always set to inactive when its database changes are committed or rolled back. A connection deactivated in this way can, however, still be used in the same internal session without being opened explicitly, not just in ABAP SQL, but also in Native SQL or AMDP. The first time an inactive secondary connection or service connection previously active in the current internal session is reused, it is made active again and a new database LUW is opened.

Warning

Extreme care must be taken when using SQL SET TRANSACTION statements to set the transaction behavior of the current database connection. The transaction behavior set using these statements is preserved across the entire current database LUW, which can cause unexpected or critical situations when the database connection is reused. The default behavior of the transactions must be restored before the end of the database LUW. When the [SAP HANA database](javascript:call_link\('abenhana_database_glosry.htm'\) "Glossary Entry") is accessed, special methods must be called for [setting the transaction behavior](javascript:call_link\('abenhana_set_transaction.htm'\)) instead of using the SQL SET TRANSACTION statements directly. In this case, the default transaction behavior is restored automatically at the end of the database LUW. No automatic resets can currently be performed for other database platforms.

Hints

-   All ABAP SQL, Native SQL, and AMDP reads made on a active shared [ABAP connection](javascript:call_link\('abenabap_connection_glosry.htm'\) "Glossary Entry") of an internal session work in the same database LUW.
-   The static Native SQL statement [SET CONNECTION](javascript:call_link\('abapexec_connection.htm'\)) is ignored by the database LUWs of the connections involved.
-   Secondary connections and service connections in an internal session cannot be used in called programs, which means that a called program always activates its own connection and hence its own database LUW, even if the same connection name is used.
-   Secondary connections, more specifically service connections, can be used to implement independent database LUWs on a secondary database or on the standard database. Care must be taken to avoid lock situations here.
-   Working with multiple database connections, namely independent database LUWs, can produce lock situations in which only one work process is involved: a program changes a database row on the first connection and tries to change the same row on a second connection. This results in the program waiting for the lock of the first database LUW, without this first LUW ever being able to continue. This situation can only be resolved by ending the work process. This is done automatically for dialog processes, but it must be done manually for background jobs. It is therefore not advisable to change the same table within the a single program using multiple database connections.

Example

If the statement COMMIT CONNECTION default were not used, the following program section would produce a lock situation because the standard connection (ABAP SQL here) and a service connection (Native SQL here) would be used in independent database LUWs to access the same row of a database table.

INSERT demo\_update FROM @( VALUE #( id = 'X' ) ).
DELETE FROM demo\_update.
COMMIT CONNECTION default.
DATA conn TYPE dbcon-con\_name VALUE 'R/3\*DEMO'.
EXEC SQL.
¬†¬†CONNECT TO :conn
ENDEXEC.
EXEC SQL.
¬†¬†INSERT INTO demo\_update VALUES( :sy-mandt, 'X', 1, 2, 3, 4 )
ENDEXEC.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Obsolete Database Access / Obsolete ABAP SQL

**Files**: 15 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Examples

Included pages: 6



**üìñ Source**: [abendb_connections_trans.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abendb_connections_trans.htm)

### abenldb_examples.htm

> **üìñ Official SAP Documentation**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Examples%2C%20ABENLDB_EXAMPLES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Examples

-   [Example of a logical database](javascript:call_link\('abenldb_example.htm'\))
-   [Example of selection include](javascript:call_link\('abenldb_selections_example.htm'\))
-   [Example of a database program](javascript:call_link\('abenldb_program_example.htm'\))
-   [Logical database, linked with a program](javascript:call_link\('abenreport_abexa.htm'\))
-   [Logical database, called by function module](javascript:call_link\('abenlogical_database_abexa.htm'\))

Continue
[LDB - Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\))
[LDB - Example of a Selection Include](javascript:call_link\('abenldb_selections_example.htm'\))
[LDB - Example of a Database Program](javascript:call_link\('abenldb_program_example.htm'\))
![Example](exa.gif "Example") [LDB - Linkage with a Program](javascript:call_link\('abenreport_abexa.htm'\))
![Example](exa.gif "Example") [LDB - Calls Using a Function Module](javascript:call_link\('abenlogical_database_abexa.htm'\))



**üìñ Source**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)

### abenldb_example.htm

> **üìñ Official SAP Documentation**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Logical%20Database%2C%20ABENLDB_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Example of a Logical Database

This example demonstrates all significant components of the imaginary logical database TEST\_LDB.

-   [Structure](#abenldb-example-1-------selections-in-the-selection-include---@ITOC@@ABENLDB_EXAMPLE_2)
-   [Database Program](#abenldb-example-3---structure-----lfa1------------lfb1--------------------------lfc1--------------------------bkpf--selections-in-the-selection-include-----select-options--slifnr---for-lfa1-lifnr------------------sbukrs---for-lfb1-bukrs------------------sgjahr---for-lfc1-gjahr------------------sbelnr---for-bkpf-belnr---database-program--------------------------------------------------------------------database-program-of-logical-database-test--ldb-------------------------------------------------------------program-sapdbtest--ldb-defining-database-test--ldb--nodes--lfa1---------lfb1---------lfc1---------bkpf-----------------------------------------------------------------initialize-selection-screen--processed-before-pbo--------------------------------------------------------------form-init-------endform-----------------------------------------------------------------pbo-of-selection-screen-------------------------------------------------------------form-pbo-------endform-----------------------------------------------------------------pai-of-selection-screen-------------------------------------------------------------form-pai-using-fname-mark----case-fname------when--slifnr-----------------when--sbukrs-----------------when--sgjahr-----------------when--sbelnr---------------endcase--endform-----------------------------------------------------------------raise-event-get-lfa1-------------------------------------------------------------form-put--lfa1----select----from-lfa1------------where-lifnr-in-slifnr INTO @lfa1.
¬†¬†¬†¬†PUT lfa1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfb1
\*-------------------------------------------------------\*
FORM put\_lfb1.
¬†¬†SELECT \* FROM lfb1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs IN @sbulrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @lfb1.
¬†¬†¬†¬†PUT lfb1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfc1
\*-------------------------------------------------------\*
FORM put\_lfc1.
¬†¬†SELECT \* FROM lfc1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO lfc1.
¬†¬†¬†¬†PUT lfc1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET bkpf
\*-------------------------------------------------------\*
FORM put\_bkpf.
¬†¬†SELECT \* FROM bkpf
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND belnr¬†¬†¬†¬†¬†¬†IN @sbelnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @bkpf.
¬†¬†¬†¬†PUT bkpf.
¬†¬†ENDSELECT.
ENDFORM.

The PROGRAM statement has the addition [DEFINING DATABASE test\_ldb](javascript:call_link\('abapreport_defining.htm'\)). This defines the link of the database program with the logical database TEST\_LDB.

The nodes of the structure are declared using the [NODES statement](javascript:call_link\('abapnodes.htm'\)). This creates the required interface work areas as table work areas. The statement [TABLES](javascript:call_link\('abaptables.htm'\)) can be used as a node in the same way for database tables. If the nodes are not database tables, they must be declared using NODES. The interface work areas are shared by the database program and a linked executable program or the function module LDB\_PROCESS and therefore become the interface used for passing data.

The selection screen can be initialized in the subroutines init and pbo.

The user input on the selection screen can be, for example, checked for authorizations in the subroutine pai. Other checks, such as plausibility or value range checks, are also possible here. If a check is negative, an error dialog can be programmed and the corresponding field can be initialized again.

The database tables are read in accordance with the selection criteria of the user and the associated GET events are raised in the subroutines put\_....

This program is only intended to demonstrate the principles of the structure of a logical database. It does not contain any methods for optimizing response times. The chronological order of the subroutine calls is determined by the structure of the logical database.



**üìñ Source**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)

### abenldb_selections_example.htm

> **üìñ Official SAP Documentation**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Selection%20Include%2C%20ABENLDB_SELECTIONS_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improve
ment:)

LDB - Example of a Selection Include

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). The generated proposal for the selection include is then as follows:

\*-----------------------------------------------------------\*
\* Include DBTEST\_LDBSEL
\* It will be automatically included into the database program
\*-----------------------------------------------------------\*
\* If the source is automatically generated,
\* perform the following steps:
\* 1. Replace ? by suitable names (at most 8 characters).
\* 2. Activate SELECT-OPTIONS and PARAMETERS (delete stars).
\* 3. Save source code.
\* 4. Edit database program.
\*
\* Hint : Syntax check is not possible within this include!
\* It will be checked during syntax check of database program.
\*-----------------------------------------------------------\*
\* SELECT-OPTIONS :¬†¬†?¬†¬†FOR LFA1-LIFNR.
\* Parameter for search pattern selection:
\* PARAMETERS p\_sp AS SEARCH PATTERN FOR TABLE LFA1.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-BUKRS.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-GJAHR.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BELNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-GJAHR.
\* Enable DYNAMIC SELECTIONS for selected nodes :
\* Enable FIELD SELECTION for selected nodes :

If the nodes LFA1 and LFB1 are defined for dynamic selections and the node LFC1 defined for field selections, the following additional program lines are generated:

SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFA1.
SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFB1.
SELECTION-SCREEN FIELD SELECTION FOR TABLE LFC1.

This automatically created selection include can be completed, for example, as follows:

\* Selection criteria:
¬†¬†SELECT-OPTIONS slifnr¬†¬†FOR lfa1-lifnr.
¬†¬†SELECT-OPTIONS sbukrs¬†¬†FOR lfb1-bukrs.
¬†¬†SELECT-OPTIONS sgjahr¬†¬†FOR flc1-gjahr.
¬†¬†SELECT-OPTIONS sbelnr¬†¬†FOR bkpf-belnr.
\* User-defined parameters:
¬†¬†PARAMETERS pstida LIKE sy-datum FOR NODE bkpf.
\* Dynamic selections for LFA1 and LFB1:
¬†¬†SELECTION-SCREEN DYNAMIC SELECTIONS FOR NODE: lfa1, lfb1.
\* Field selection for LFB1 and LFC1:
¬†¬†SELECTION-SCREEN FIELD SELECTION FOR NODE: lfb1, lfc1.

A selection is made from the available selection criteria and is given a name. The additional parameter pstida is declared and connected to the node BKPF. Dynamic selections are defined for the tablesLFA1 and LFB1. The tables LFB1 and LFC1 are defined for field selections.



**üìñ Source**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)

### abenldb_program_example.htm

> **üìñ Official SAP Documentation**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Database%20Program%2C%20ABENLDB_PROGRAM_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

LDB - Example of a Database Program

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). All nodes are database tables. Selections are defined in the selection include:

SELECT-OPTIONS SLIFNR¬†¬†FOR LFA1-LIFNR.
SELECT-OPTIONS SBUKRS¬†¬†FOR LFB1-BUKRS.
SELECT-OPTIONS SGJAHR¬†¬†FOR LFC1-GJAHR.
SELECT-OPTIONS SBELNR¬†¬†FOR BKPF-BELNR.

The generated proposal for the database program is then as follows:

Master Program SAPDBTEST\_LDB

\*----------------------------------------------------------\*
\*¬†¬†¬†¬†¬†¬†DATABASE PROGRAM OF LOGICAL DATABASE TEST\_LDB
\*----------------------------------------------------------\*
INCLUDE DBTEST\_LDBTOP.¬†¬†¬†¬† " header
INCLUDE DBTEST\_LDBXXX.¬†¬†¬†¬† " all system routines
\* INCLUDE DBTEST\_LDBF001.¬†¬†" user defined include

Include Program DBTEST\_LDBTOP

PROGRAM SAPDBTEST\_LDB DEFINING DATABASE TEST\_LDB.
TABLES: LFA1,
¬†¬†¬†¬†¬†¬†¬†¬† LFB1,
¬†¬†¬†¬†¬†¬†¬†¬† LFC1,
¬†¬†¬†¬†¬†¬†¬†¬† BKPF.
\* DATA: ...¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"user defined variables

Include Program DBTEST\_LDB001

\*----------------------------------------------------------\*
\* Call event GET LFA1
\*----------------------------------------------------------\*
FORM PUT\_LFA1.
\* SELECT \* FROM LFA1
\*¬†¬† INTO LFA1
\*¬†¬† INTO TABLE ? (choose one!)
\*¬†¬† WHERE LIFNR = ?.
¬†¬†¬†¬†PUT LFA1.
\* ENDSELECT.
ENDFORM.¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_LFA1
\*----------------------------------------------------------\*
\* Authority Check for node LFA1
\*----------------------------------------------------------\*
\* FORM AUTHORITY\_CHECK\_LFA1.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM.

Include Programs DBTEST\_LDB002 and DBTEST\_LDB003

Like DBTEST\_LDB001 for the nodes LFB1 and LFC1

Include Program DBTEST\_LDB004

\*----------------------------------------------------------\*
\* Call event GET BKPF
\*----------------------------------------------------------\*
FORM PUT\_BKPF.
\* STATICS FLAG.
\* IF FLAG = SPACE.
\*¬†¬† FLAG = 'X'.
\*\*\* Declarations for field selection for node BKPF \*\*\*
\*¬†¬† STATICS BKPF\_FIELDS TYPE RSFS\_TAB\_FIELDS.
\*¬†¬† MOVE 'BKPF' TO BKPF\_FIELDS-TABLENAME.
\*¬†¬† READ TABLE SELECT\_FIELDS WITH KEY BKPF\_FIELDS-TABLENAME
\*¬†¬†¬†¬† INTO BKPF\_FIELDS.
\* ENDIF.
\* SELECT (BKPF\_FIELDS-FIELDS) INTO CORRESPONDING FIELDS OF
\*¬†¬†¬†¬† BKPF / TABLE ? " (choose one of them)
\*¬†¬†¬†¬† FROM BKPF
\*¬†¬† WHERE BUKRS = LFB1-BUKRS
\*¬†¬†¬†¬† AND BELNR IN SBELNR
\*¬†¬†¬†¬† AND GJAHR = ?.
¬†¬†¬†¬†PUT BKPF.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_BKPF
\*----------------------------------------------------------\*
\* Authority Check for node BKPF
\*----------------------------------------------------------\*
\* FORM AUTHORITYCHECK\_BKPF.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AUTHORITY\_CHECK\_BKPF

Include Program DBTEST\_LDBFXXX

\*----------------------------------------------------------\*
\* BEFORE\_EVENT will be called before event EVENT
\* Possible values for EVENT: 'START-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM BEFORE\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'START-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "BEFORE\_EVENT
\*----------------------------------------------------------\*
\* AFTER\_EVENT will be called after event EVENT
\* Possible values for EVENT: 'END-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM AFTER\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'END-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AFTER\_EVENT
\*-----------------------------------------------------------\*
\* Initialize global data for multiple processing of
\* one logical database.
\* Set returncode:
\*¬†¬†¬†¬†¬†¬†0 -> all data are initialized, multiple processing o.k.
\*¬†¬†other -> no multiple processing allowed
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_INIT CHANGING SUBRC LIKE SY-SUBRC.
ENDFORM.¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_INIT
\*------------------------------------------------------------\*
\* LDB\_PROCESS\_CHECK\_SELECTIONS is called
\* after select-options and parameters are filled
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_CHECK\_SELECTIONS CHANGING SUBRC LIKE SY-SUBRC
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MSG LIKE SYMSG.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_CHECK\_SELECTIONS
\*----------------------------------------------------------\*
\* Initialize selection screen (processed before PBO)
\*----------------------------------------------------------\*
FORM INIT.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "INIT.
\*----------------------------------------------------------\*
\* PBO of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PBO.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PBO.
\*----------------------------------------------------------\*
\* PAI of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PAI USING FNAME MARK.
\* CASE FNAME.
\*¬†¬† WHEN 'SLIFNR¬†¬†'.
\*¬†¬† WHEN 'SBUKRS¬†¬†'.
\*¬†¬† WHEN 'SBELNR¬†¬†'.
\*¬†¬† WHEN 'SGJAHR¬†¬†'.
\*¬†¬† WHEN '\*'.
\*¬†¬† ENDCASE.
ENDFORM.¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PAI

Include Program DBTEST\_LDBSXXX

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (BEGIN OF BLOCK) !!!!!! \*
\*-----------------------------------------------------------\*
\* Data structures for search pattern selection
\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (END OF BLOCK) !!!!!!!! \*
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\*-----------------------------------------------------------\*
\* PUT\_TEST\_LDB\_SP.
\* Processed when search pattern selection is used,
\* i.e. user input into PARAMETERS p\_sp AS SEARCH PATTERN
\* STRUCTURE.
\*-----------------------------------------------------------\*
\* FORM PUT\_TEST\_LDB\_SP.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_EXAMPLE\_SP

The comment characters in front of ABAP statements that are to be used in addition to the mandatory statements can be deleted and the question marks can be replaced by appropriate expressions. The syntax check checks all include programs that match the naming conventions and also the selection include.

When the database is accessed in the subroutines put\_node, SELECT statements with conditions for the primary key fields in the WHERE clauses are generated. The performance of these statements is, however, not yet optimized. In particular, the subroutines put\_node of a subtree of the structure represent nested SELECT loops, which should generally be avoided. Instead, the data read can be buffered in internal tables, for example, and passed from here to the application program using the PUT statement. The statement PUT node, however, should always be in a subroutine whose name starts with put\_node for technical reasons.

If the selections specify [dynamic selections](javascript:call_link\('abenldb_free_selections.htm'\)) or [field selections](javascript:call_link\('abenldb_field_selections.htm'\)) for a node, corresponding statements are generated in the subroutine put\_node and the SELECT statement created automatically is modified, as shown in the example for the node BKPF.

The subroutines before\_event, after\_event, and put\_ldb\_sp are created as a comment in the database program and can be modified and activated by deleting the asterisks. before\_event is called before the event specified in the parameter event is processed. after\_event is called after the event specified in the parameter event is processed. When a search help selection is made, put\_ldb\_sp is called to process the return values instead of put\_node for the root node.



**üìñ Source**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)

### abenreport_abexa.htm

> **üìñ Official SAP Documentation**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Linkage%20with%20a%20Program%2C%20ABENREPORT_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Linkage with a Program

This example demonstrates how a logical database is linked with an executable program.

Source Code ¬† 

REPORT demo\_report.
NODES: spfli, sflight, sbook.
DATA: weight¬†¬†¬†¬†¬†¬† TYPE p LENGTH 8 DECIMALS 4,
¬†¬†¬†¬†¬†¬†total\_weight TYPE p LENGTH 8 DECIMALS 4.
INITIALIZATION.
¬†¬†carrid-sign = 'I'.
¬†¬†carrid-option = 'EQ'.
¬†¬†carrid-low = 'AA'.
¬†¬†carrid-high = 'LH'.
¬†¬†APPEND carrid TO carrid.
START-OF-SELECTION.
¬†¬†WRITE 'Luggage weight of flights'.
GET spfli FIELDS carrid connid cityfrom cityto.
¬†¬†SKIP.
¬†¬†ULINE.
¬†¬†WRITE: / 'Carrid:', spfli-carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'Connid:', spfli-connid,
¬†¬†¬†¬†¬†¬†¬†¬† / 'From:¬†¬†', spfli-cityfrom,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'To:¬†¬†¬†¬†', spfli-cityto.
¬†¬†ULINE.
GET sflight FIELDS fldate.
¬†¬†SKIP.
¬†¬†WRITE: / 'Date:', sflight-fldate.
GET sbook FIELDS luggweight.
¬†¬†weight += sbook-luggweight.
GET sflight LATE FIELDS carrid .
¬†¬†WRITE: / 'Luggage weight =', weight.
¬†¬†total\_weight += weight.
¬†¬†weight = 0.
END-OF-SELECTION.
¬†¬†ULINE.
¬†¬†WRITE: / 'Sum of luggage weights =', total\_weight.

Description ¬† 

This example shows a typical report where the [logical database](javascript:call_link\('abenlogical_data_base_glosry.htm'\) "Glossary Entry") F1S is assigned to its properties.



**üìñ Source**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)

### abenlogical_database_abexa.htm

> **üìñ Official SAP Documentation**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Calls%20Using%20a%20Function%20Module%2C%20ABENLOGICAL_DATABASE_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvem
ent:)

LDB - Calls Using a Function Module

This example demonstrates calling a logical database using the function module LDB\_PROCESS.

Source Code ¬† 

REPORT demo\_logical\_database.
DATA wa\_spfli TYPE spfli.
SELECTION-SCREEN BEGIN OF SCREEN 1100.
SELECT-OPTIONS s\_carr FOR wa\_spfli-carrid.
SELECTION-SCREEN END OF SCREEN 1100.
CLASS demo DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
ENDCLASS.
CLASS demo IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA callback¬†¬†¬†¬†TYPE TABLE OF ldbcb.
¬†¬†¬†¬†DATA: seltab¬†¬†¬†¬†TYPE TABLE OF rsparams,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†seltab\_wa LIKE LINE OF seltab,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†scarr\_wa¬†¬†LIKE LINE OF s\_carr.
¬†¬†¬†¬†CALL SELECTION-SCREEN 1100 STARTING AT 10 10.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†callback = VALUE #( ( ldbnode¬†¬†¬†¬† = 'SPFLI'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get\_late¬†¬†¬†¬†= 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SPFLI' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( ldbnode¬†¬†¬†¬† = 'SFLIGHT'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SFLIGHT' ) ).
¬†¬†¬†¬†seltab\_wa-kind = 'S'.
¬†¬†¬†¬†seltab\_wa-selname = 'CARRID'.
¬†¬†¬†¬†LOOP AT s\_carr INTO scarr\_wa.
¬†¬†¬†¬†¬†¬†MOVE-CORRESPONDING scarr\_wa TO seltab\_wa.
¬†¬†¬†¬†¬†¬†APPEND seltab\_wa TO seltab.
¬†¬†¬†¬†ENDLOOP.
¬†¬†¬†¬†CALL FUNCTION 'LDB\_PROCESS'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†ldbname¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 'F1S'
¬†¬†¬†¬†¬†¬†¬†¬†variant¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = ' '
¬†¬†¬†¬†¬†¬†TABLES
¬†¬†¬†¬†¬†¬†¬†¬†callback¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= callback
¬†¬†¬†¬†¬†¬†¬†¬†selections¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= seltab
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Exception with SY-SUBRC', sy-subrc.
¬†¬†¬†¬†ENDIF.¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†demo=>main( ).
FORM callback\_spfli USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE spfli
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†CASE evt.
¬†¬†¬†¬†WHEN 'G'.
¬†¬†¬†¬†¬†¬†WRITE: / wa-carrid, wa-connid, wa-cityfrom, wa-cityto.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†¬†¬†WHEN 'L'.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†ENDCASE.
ENDFORM.
FORM callback\_sflight USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†WRITE: / wa-fldate, wa-seatsocc, wa-seatsmax.
ENDFORM.

Description ¬† 

The program reads data using the logical database F1S. First a program-specific selection screen is defined. The data object wa\_spfli is only required here. Next, suitable variables for the interface are declared.

The internal table callback is filled in such a way that, for the two nodes SPFLI and SFLIGHT, different callback routines in the calling program are called. For the node SPFLI, the corresponding routine for GET and GET LATE is only to be called for GET in the case of SFLIGHT.

The internal table seltab is filled with values from the selection table s\_carr of the standalone selection screen 1100 for the selections of node SPFLI.

The function module LDB\_PROCESS is called with these parameters.

The subroutines callback\_spfli and callback\_sflight are used as callback routines. Since the interface parameter wa is completely typed, the individual components of the work area can be accessed. In callback\_spfli, the events GET and GET LATE are handled differently.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Obsolete Database Access / Obsolete Native SQL

**Files**: 5 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Examples

Included pages: 6



**üìñ Source**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)

### abenldb_examples.htm

> **üìñ Official SAP Documentation**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Examples%2C%20ABENLDB_EXAMPLES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Examples

-   [Example of a logical database](javascript:call_link\('abenldb_example.htm'\))
-   [Example of selection include](javascript:call_link\('abenldb_selections_example.htm'\))
-   [Example of a database program](javascript:call_link\('abenldb_program_example.htm'\))
-   [Logical database, linked with a program](javascript:call_link\('abenreport_abexa.htm'\))
-   [Logical database, called by function module](javascript:call_link\('abenlogical_database_abexa.htm'\))

Continue
[LDB - Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\))
[LDB - Example of a Selection Include](javascript:call_link\('abenldb_selections_example.htm'\))
[LDB - Example of a Database Program](javascript:call_link\('abenldb_program_example.htm'\))
![Example](exa.gif "Example") [LDB - Linkage with a Program](javascript:call_link\('abenreport_abexa.htm'\))
![Example](exa.gif "Example") [LDB - Calls Using a Function Module](javascript:call_link\('abenlogical_database_abexa.htm'\))



**üìñ Source**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)

### abenldb_example.htm

> **üìñ Official SAP Documentation**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Logical%20Database%2C%20ABENLDB_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Example of a Logical Database

This example demonstrates all significant components of the imaginary logical database TEST\_LDB.

-   [Structure](#abenldb-example-1-------selections-in-the-selection-include---@ITOC@@ABENLDB_EXAMPLE_2)
-   [Database Program](#abenldb-example-3---structure-----lfa1------------lfb1--------------------------lfc1--------------------------bkpf--selections-in-the-selection-include-----select-options--slifnr---for-lfa1-lifnr------------------sbukrs---for-lfb1-bukrs------------------sgjahr---for-lfc1-gjahr------------------sbelnr---for-bkpf-belnr---database-program--------------------------------------------------------------------database-program-of-logical-database-test--ldb-------------------------------------------------------------program-sapdbtest--ldb-defining-database-test--ldb--nodes--lfa1---------lfb1---------lfc1---------bkpf-----------------------------------------------------------------initialize-selection-screen--processed-before-pbo--------------------------------------------------------------form-init-------endform-----------------------------------------------------------------pbo-of-selection-screen-------------------------------------------------------------form-pbo-------endform-----------------------------------------------------------------pai-of-selection-screen-------------------------------------------------------------form-pai-using-fname-mark----case-fname------when--slifnr-----------------when--sbukrs-----------------when--sgjahr-----------------when--sbelnr---------------endcase--endform-----------------------------------------------------------------raise-event-get-lfa1-------------------------------------------------------------form-put--lfa1----select----from-lfa1------------where-lifnr-in-slifnr INTO @lfa1.
¬†¬†¬†¬†PUT lfa1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfb1
\*-------------------------------------------------------\*
FORM put\_lfb1.
¬†¬†SELECT \* FROM lfb1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs IN @sbulrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @lfb1.
¬†¬†¬†¬†PUT lfb1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfc1
\*-------------------------------------------------------\*
FORM put\_lfc1.
¬†¬†SELECT \* FROM lfc1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO lfc1.
¬†¬†¬†¬†PUT lfc1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET bkpf
\*-------------------------------------------------------\*
FORM put\_bkpf.
¬†¬†SELECT \* FROM bkpf
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND belnr¬†¬†¬†¬†¬†¬†IN @sbelnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @bkpf.
¬†¬†¬†¬†PUT bkpf.
¬†¬†ENDSELECT.
ENDFORM.

The PROGRAM statement has the addition [DEFINING DATABASE test\_ldb](javascript:call_link\('abapreport_defining.htm'\)). This defines the link of the database program with the logical database TEST\_LDB.

The nodes of the structure are declared using the [NODES statement](javascript:call_link\('abapnodes.htm'\)). This creates the required interface work areas as table work areas. The statement [TABLES](javascript:call_link\('abaptables.htm'\)) can be used as a node in the same way for database tables. If the nodes are not database tables, they must be declared using NODES. The interface work areas are shared by the database program and a linked executable program or the function module LDB\_PROCESS and therefore become the interface used for passing data.

The selection screen can be initialized in the subroutines init and pbo.

The user input on the selection screen can be, for example, checked for authorizations in the subroutine pai. Other checks, such as plausibility or value range checks, are also possible here. If a check is negative, an error dialog can be programmed and the corresponding field can be initialized again.

The database tables are read in accordance with the selection criteria of the user and the associated GET events are raised in the subroutines put\_....

This program is only intended to demonstrate the principles of the structure of a logical database. It does not contain any methods for optimizing response times. The chronological order of the subroutine calls is determined by the structure of the logical database.



**üìñ Source**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)

### abenldb_selections_example.htm

> **üìñ Official SAP Documentation**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Selection%20Include%2C%20ABENLDB_SELECTIONS_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improve
ment:)

LDB - Example of a Selection Include

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). The generated proposal for the selection include is then as follows:

\*-----------------------------------------------------------\*
\* Include DBTEST\_LDBSEL
\* It will be automatically included into the database program
\*-----------------------------------------------------------\*
\* If the source is automatically generated,
\* perform the following steps:
\* 1. Replace ? by suitable names (at most 8 characters).
\* 2. Activate SELECT-OPTIONS and PARAMETERS (delete stars).
\* 3. Save source code.
\* 4. Edit database program.
\*
\* Hint : Syntax check is not possible within this include!
\* It will be checked during syntax check of database program.
\*-----------------------------------------------------------\*
\* SELECT-OPTIONS :¬†¬†?¬†¬†FOR LFA1-LIFNR.
\* Parameter for search pattern selection:
\* PARAMETERS p\_sp AS SEARCH PATTERN FOR TABLE LFA1.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-BUKRS.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-GJAHR.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BELNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-GJAHR.
\* Enable DYNAMIC SELECTIONS for selected nodes :
\* Enable FIELD SELECTION for selected nodes :

If the nodes LFA1 and LFB1 are defined for dynamic selections and the node LFC1 defined for field selections, the following additional program lines are generated:

SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFA1.
SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFB1.
SELECTION-SCREEN FIELD SELECTION FOR TABLE LFC1.

This automatically created selection include can be completed, for example, as follows:

\* Selection criteria:
¬†¬†SELECT-OPTIONS slifnr¬†¬†FOR lfa1-lifnr.
¬†¬†SELECT-OPTIONS sbukrs¬†¬†FOR lfb1-bukrs.
¬†¬†SELECT-OPTIONS sgjahr¬†¬†FOR flc1-gjahr.
¬†¬†SELECT-OPTIONS sbelnr¬†¬†FOR bkpf-belnr.
\* User-defined parameters:
¬†¬†PARAMETERS pstida LIKE sy-datum FOR NODE bkpf.
\* Dynamic selections for LFA1 and LFB1:
¬†¬†SELECTION-SCREEN DYNAMIC SELECTIONS FOR NODE: lfa1, lfb1.
\* Field selection for LFB1 and LFC1:
¬†¬†SELECTION-SCREEN FIELD SELECTION FOR NODE: lfb1, lfc1.

A selection is made from the available selection criteria and is given a name. The additional parameter pstida is declared and connected to the node BKPF. Dynamic selections are defined for the tablesLFA1 and LFB1. The tables LFB1 and LFC1 are defined for field selections.



**üìñ Source**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)

### abenldb_program_example.htm

> **üìñ Official SAP Documentation**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Database%20Program%2C%20ABENLDB_PROGRAM_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

LDB - Example of a Database Program

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). All nodes are database tables. Selections are defined in the selection include:

SELECT-OPTIONS SLIFNR¬†¬†FOR LFA1-LIFNR.
SELECT-OPTIONS SBUKRS¬†¬†FOR LFB1-BUKRS.
SELECT-OPTIONS SGJAHR¬†¬†FOR LFC1-GJAHR.
SELECT-OPTIONS SBELNR¬†¬†FOR BKPF-BELNR.

The generated proposal for the database program is then as follows:

Master Program SAPDBTEST\_LDB

\*----------------------------------------------------------\*
\*¬†¬†¬†¬†¬†¬†DATABASE PROGRAM OF LOGICAL DATABASE TEST\_LDB
\*----------------------------------------------------------\*
INCLUDE DBTEST\_LDBTOP.¬†¬†¬†¬† " header
INCLUDE DBTEST\_LDBXXX.¬†¬†¬†¬† " all system routines
\* INCLUDE DBTEST\_LDBF001.¬†¬†" user defined include

Include Program DBTEST\_LDBTOP

PROGRAM SAPDBTEST\_LDB DEFINING DATABASE TEST\_LDB.
TABLES: LFA1,
¬†¬†¬†¬†¬†¬†¬†¬† LFB1,
¬†¬†¬†¬†¬†¬†¬†¬† LFC1,
¬†¬†¬†¬†¬†¬†¬†¬† BKPF.
\* DATA: ...¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"user defined variables

Include Program DBTEST\_LDB001

\*----------------------------------------------------------\*
\* Call event GET LFA1
\*----------------------------------------------------------\*
FORM PUT\_LFA1.
\* SELECT \* FROM LFA1
\*¬†¬† INTO LFA1
\*¬†¬† INTO TABLE ? (choose one!)
\*¬†¬† WHERE LIFNR = ?.
¬†¬†¬†¬†PUT LFA1.
\* ENDSELECT.
ENDFORM.¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_LFA1
\*----------------------------------------------------------\*
\* Authority Check for node LFA1
\*----------------------------------------------------------\*
\* FORM AUTHORITY\_CHECK\_LFA1.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM.

Include Programs DBTEST\_LDB002 and DBTEST\_LDB003

Like DBTEST\_LDB001 for the nodes LFB1 and LFC1

Include Program DBTEST\_LDB004

\*----------------------------------------------------------\*
\* Call event GET BKPF
\*----------------------------------------------------------\*
FORM PUT\_BKPF.
\* STATICS FLAG.
\* IF FLAG = SPACE.
\*¬†¬† FLAG = 'X'.
\*\*\* Declarations for field selection for node BKPF \*\*\*
\*¬†¬† STATICS BKPF\_FIELDS TYPE RSFS\_TAB\_FIELDS.
\*¬†¬† MOVE 'BKPF' TO BKPF\_FIELDS-TABLENAME.
\*¬†¬† READ TABLE SELECT\_FIELDS WITH KEY BKPF\_FIELDS-TABLENAME
\*¬†¬†¬†¬† INTO BKPF\_FIELDS.
\* ENDIF.
\* SELECT (BKPF\_FIELDS-FIELDS) INTO CORRESPONDING FIELDS OF
\*¬†¬†¬†¬† BKPF / TABLE ? " (choose one of them)
\*¬†¬†¬†¬† FROM BKPF
\*¬†¬† WHERE BUKRS = LFB1-BUKRS
\*¬†¬†¬†¬† AND BELNR IN SBELNR
\*¬†¬†¬†¬† AND GJAHR = ?.
¬†¬†¬†¬†PUT BKPF.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_BKPF
\*----------------------------------------------------------\*
\* Authority Check for node BKPF
\*----------------------------------------------------------\*
\* FORM AUTHORITYCHECK\_BKPF.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AUTHORITY\_CHECK\_BKPF

Include Program DBTEST\_LDBFXXX

\*----------------------------------------------------------\*
\* BEFORE\_EVENT will be called before event EVENT
\* Possible values for EVENT: 'START-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM BEFORE\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'START-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "BEFORE\_EVENT
\*----------------------------------------------------------\*
\* AFTER\_EVENT will be called after event EVENT
\* Possible values for EVENT: 'END-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM AFTER\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'END-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AFTER\_EVENT
\*-----------------------------------------------------------\*
\* Initialize global data for multiple processing of
\* one logical database.
\* Set returncode:
\*¬†¬†¬†¬†¬†¬†0 -> all data are initialized, multiple processing o.k.
\*¬†¬†other -> no multiple processing allowed
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_INIT CHANGING SUBRC LIKE SY-SUBRC.
ENDFORM.¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_INIT
\*------------------------------------------------------------\*
\* LDB\_PROCESS\_CHECK\_SELECTIONS is called
\* after select-options and parameters are filled
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_CHECK\_SELECTIONS CHANGING SUBRC LIKE SY-SUBRC
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MSG LIKE SYMSG.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_CHECK\_SELECTIONS
\*----------------------------------------------------------\*
\* Initialize selection screen (processed before PBO)
\*----------------------------------------------------------\*
FORM INIT.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "INIT.
\*----------------------------------------------------------\*
\* PBO of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PBO.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PBO.
\*----------------------------------------------------------\*
\* PAI of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PAI USING FNAME MARK.
\* CASE FNAME.
\*¬†¬† WHEN 'SLIFNR¬†¬†'.
\*¬†¬† WHEN 'SBUKRS¬†¬†'.
\*¬†¬† WHEN 'SBELNR¬†¬†'.
\*¬†¬† WHEN 'SGJAHR¬†¬†'.
\*¬†¬† WHEN '\*'.
\*¬†¬† ENDCASE.
ENDFORM.¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PAI

Include Program DBTEST\_LDBSXXX

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (BEGIN OF BLOCK) !!!!!! \*
\*-----------------------------------------------------------\*
\* Data structures for search pattern selection
\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (END OF BLOCK) !!!!!!!! \*
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\*-----------------------------------------------------------\*
\* PUT\_TEST\_LDB\_SP.
\* Processed when search pattern selection is used,
\* i.e. user input into PARAMETERS p\_sp AS SEARCH PATTERN
\* STRUCTURE.
\*-----------------------------------------------------------\*
\* FORM PUT\_TEST\_LDB\_SP.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_EXAMPLE\_SP

The comment characters in front of ABAP statements that are to be used in addition to the mandatory statements can be deleted and the question marks can be replaced by appropriate expressions. The syntax check checks all include programs that match the naming conventions and also the selection include.

When the database is accessed in the subroutines put\_node, SELECT statements with conditions for the primary key fields in the WHERE clauses are generated. The performance of these statements is, however, not yet optimized. In particular, the subroutines put\_node of a subtree of the structure represent nested SELECT loops, which should generally be avoided. Instead, the data read can be buffered in internal tables, for example, and passed from here to the application program using the PUT statement. The statement PUT node, however, should always be in a subroutine whose name starts with put\_node for technical reasons.

If the selections specify [dynamic selections](javascript:call_link\('abenldb_free_selections.htm'\)) or [field selections](javascript:call_link\('abenldb_field_selections.htm'\)) for a node, corresponding statements are generated in the subroutine put\_node and the SELECT statement created automatically is modified, as shown in the example for the node BKPF.

The subroutines before\_event, after\_event, and put\_ldb\_sp are created as a comment in the database program and can be modified and activated by deleting the asterisks. before\_event is called before the event specified in the parameter event is processed. after\_event is called after the event specified in the parameter event is processed. When a search help selection is made, put\_ldb\_sp is called to process the return values instead of put\_node for the root node.



**üìñ Source**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)

### abenreport_abexa.htm

> **üìñ Official SAP Documentation**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Linkage%20with%20a%20Program%2C%20ABENREPORT_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Linkage with a Program

This example demonstrates how a logical database is linked with an executable program.

Source Code ¬† 

REPORT demo\_report.
NODES: spfli, sflight, sbook.
DATA: weight¬†¬†¬†¬†¬†¬† TYPE p LENGTH 8 DECIMALS 4,
¬†¬†¬†¬†¬†¬†total\_weight TYPE p LENGTH 8 DECIMALS 4.
INITIALIZATION.
¬†¬†carrid-sign = 'I'.
¬†¬†carrid-option = 'EQ'.
¬†¬†carrid-low = 'AA'.
¬†¬†carrid-high = 'LH'.
¬†¬†APPEND carrid TO carrid.
START-OF-SELECTION.
¬†¬†WRITE 'Luggage weight of flights'.
GET spfli FIELDS carrid connid cityfrom cityto.
¬†¬†SKIP.
¬†¬†ULINE.
¬†¬†WRITE: / 'Carrid:', spfli-carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'Connid:', spfli-connid,
¬†¬†¬†¬†¬†¬†¬†¬† / 'From:¬†¬†', spfli-cityfrom,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'To:¬†¬†¬†¬†', spfli-cityto.
¬†¬†ULINE.
GET sflight FIELDS fldate.
¬†¬†SKIP.
¬†¬†WRITE: / 'Date:', sflight-fldate.
GET sbook FIELDS luggweight.
¬†¬†weight += sbook-luggweight.
GET sflight LATE FIELDS carrid .
¬†¬†WRITE: / 'Luggage weight =', weight.
¬†¬†total\_weight += weight.
¬†¬†weight = 0.
END-OF-SELECTION.
¬†¬†ULINE.
¬†¬†WRITE: / 'Sum of luggage weights =', total\_weight.

Description ¬† 

This example shows a typical report where the [logical database](javascript:call_link\('abenlogical_data_base_glosry.htm'\) "Glossary Entry") F1S is assigned to its properties.



**üìñ Source**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)

### abenlogical_database_abexa.htm

> **üìñ Official SAP Documentation**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Calls%20Using%20a%20Function%20Module%2C%20ABENLOGICAL_DATABASE_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvem
ent:)

LDB - Calls Using a Function Module

This example demonstrates calling a logical database using the function module LDB\_PROCESS.

Source Code ¬† 

REPORT demo\_logical\_database.
DATA wa\_spfli TYPE spfli.
SELECTION-SCREEN BEGIN OF SCREEN 1100.
SELECT-OPTIONS s\_carr FOR wa\_spfli-carrid.
SELECTION-SCREEN END OF SCREEN 1100.
CLASS demo DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
ENDCLASS.
CLASS demo IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA callback¬†¬†¬†¬†TYPE TABLE OF ldbcb.
¬†¬†¬†¬†DATA: seltab¬†¬†¬†¬†TYPE TABLE OF rsparams,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†seltab\_wa LIKE LINE OF seltab,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†scarr\_wa¬†¬†LIKE LINE OF s\_carr.
¬†¬†¬†¬†CALL SELECTION-SCREEN 1100 STARTING AT 10 10.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†callback = VALUE #( ( ldbnode¬†¬†¬†¬† = 'SPFLI'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get\_late¬†¬†¬†¬†= 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SPFLI' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( ldbnode¬†¬†¬†¬† = 'SFLIGHT'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SFLIGHT' ) ).
¬†¬†¬†¬†seltab\_wa-kind = 'S'.
¬†¬†¬†¬†seltab\_wa-selname = 'CARRID'.
¬†¬†¬†¬†LOOP AT s\_carr INTO scarr\_wa.
¬†¬†¬†¬†¬†¬†MOVE-CORRESPONDING scarr\_wa TO seltab\_wa.
¬†¬†¬†¬†¬†¬†APPEND seltab\_wa TO seltab.
¬†¬†¬†¬†ENDLOOP.
¬†¬†¬†¬†CALL FUNCTION 'LDB\_PROCESS'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†ldbname¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 'F1S'
¬†¬†¬†¬†¬†¬†¬†¬†variant¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = ' '
¬†¬†¬†¬†¬†¬†TABLES
¬†¬†¬†¬†¬†¬†¬†¬†callback¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= callback
¬†¬†¬†¬†¬†¬†¬†¬†selections¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= seltab
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Exception with SY-SUBRC', sy-subrc.
¬†¬†¬†¬†ENDIF.¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†demo=>main( ).
FORM callback\_spfli USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE spfli
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†CASE evt.
¬†¬†¬†¬†WHEN 'G'.
¬†¬†¬†¬†¬†¬†WRITE: / wa-carrid, wa-connid, wa-cityfrom, wa-cityto.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†¬†¬†WHEN 'L'.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†ENDCASE.
ENDFORM.
FORM callback\_sflight USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†WRITE: / wa-fldate, wa-seatsocc, wa-seatsmax.
ENDFORM.

Description ¬† 

The program reads data using the logical database F1S. First a program-specific selection screen is defined. The data object wa\_spfli is only required here. Next, suitable variables for the interface are declared.

The internal table callback is filled in such a way that, for the two nodes SPFLI and SFLIGHT, different callback routines in the calling program are called. For the node SPFLI, the corresponding routine for GET and GET LATE is only to be called for GET in the case of SFLIGHT.

The internal table seltab is filled with values from the selection table s\_carr of the standalone selection screen 1100 for the selections of node SPFLI.

The function module LDB\_PROCESS is called with these parameters.

The subroutines callback\_spfli and callback\_sflight are used as callback routines. Since the interface parameter wa is completely typed, the individual components of the work area can be accessed. In callback\_spfli, the events GET and GET LATE are handled differently.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Obsolete Database Access / Obsolete Access Statements

**Files**: 6 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Examples

Included pages: 6



**üìñ Source**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)

### abenldb_examples.htm

> **üìñ Official SAP Documentation**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Examples%2C%20ABENLDB_EXAMPLES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Examples

-   [Example of a logical database](javascript:call_link\('abenldb_example.htm'\))
-   [Example of selection include](javascript:call_link\('abenldb_selections_example.htm'\))
-   [Example of a database program](javascript:call_link\('abenldb_program_example.htm'\))
-   [Logical database, linked with a program](javascript:call_link\('abenreport_abexa.htm'\))
-   [Logical database, called by function module](javascript:call_link\('abenlogical_database_abexa.htm'\))

Continue
[LDB - Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\))
[LDB - Example of a Selection Include](javascript:call_link\('abenldb_selections_example.htm'\))
[LDB - Example of a Database Program](javascript:call_link\('abenldb_program_example.htm'\))
![Example](exa.gif "Example") [LDB - Linkage with a Program](javascript:call_link\('abenreport_abexa.htm'\))
![Example](exa.gif "Example") [LDB - Calls Using a Function Module](javascript:call_link\('abenlogical_database_abexa.htm'\))



**üìñ Source**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)

### abenldb_example.htm

> **üìñ Official SAP Documentation**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Logical%20Database%2C%20ABENLDB_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Example of a Logical Database

This example demonstrates all significant components of the imaginary logical database TEST\_LDB.

-   [Structure](#abenldb-example-1-------selections-in-the-selection-include---@ITOC@@ABENLDB_EXAMPLE_2)
-   [Database Program](#abenldb-example-3---structure-----lfa1------------lfb1--------------------------lfc1--------------------------bkpf--selections-in-the-selection-include-----select-options--slifnr---for-lfa1-lifnr------------------sbukrs---for-lfb1-bukrs------------------sgjahr---for-lfc1-gjahr------------------sbelnr---for-bkpf-belnr---database-program--------------------------------------------------------------------database-program-of-logical-database-test--ldb-------------------------------------------------------------program-sapdbtest--ldb-defining-database-test--ldb--nodes--lfa1---------lfb1---------lfc1---------bkpf-----------------------------------------------------------------initialize-selection-screen--processed-before-pbo--------------------------------------------------------------form-init-------endform-----------------------------------------------------------------pbo-of-selection-screen-------------------------------------------------------------form-pbo-------endform-----------------------------------------------------------------pai-of-selection-screen-------------------------------------------------------------form-pai-using-fname-mark----case-fname------when--slifnr-----------------when--sbukrs-----------------when--sgjahr-----------------when--sbelnr---------------endcase--endform-----------------------------------------------------------------raise-event-get-lfa1-------------------------------------------------------------form-put--lfa1----select----from-lfa1------------where-lifnr-in-slifnr INTO @lfa1.
¬†¬†¬†¬†PUT lfa1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfb1
\*-------------------------------------------------------\*
FORM put\_lfb1.
¬†¬†SELECT \* FROM lfb1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs IN @sbulrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @lfb1.
¬†¬†¬†¬†PUT lfb1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfc1
\*-------------------------------------------------------\*
FORM put\_lfc1.
¬†¬†SELECT \* FROM lfc1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO lfc1.
¬†¬†¬†¬†PUT lfc1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET bkpf
\*-------------------------------------------------------\*
FORM put\_bkpf.
¬†¬†SELECT \* FROM bkpf
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND belnr¬†¬†¬†¬†¬†¬†IN @sbelnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @bkpf.
¬†¬†¬†¬†PUT bkpf.
¬†¬†ENDSELECT.
ENDFORM.

The PROGRAM statement has the addition [DEFINING DATABASE test\_ldb](javascript:call_link\('abapreport_defining.htm'\)). This defines the link of the database program with the logical database TEST\_LDB.

The nodes of the structure are declared using the [NODES statement](javascript:call_link\('abapnodes.htm'\)). This creates the required interface work areas as table work areas. The statement [TABLES](javascript:call_link\('abaptables.htm'\)) can be used as a node in the same way for database tables. If the nodes are not database tables, they must be declared using NODES. The interface work areas are shared by the database program and a linked executable program or the function module LDB\_PROCESS and therefore become the interface used for passing data.

The selection screen can be initialized in the subroutines init and pbo.

The user input on the selection screen can be, for example, checked for authorizations in the subroutine pai. Other checks, such as plausibility or value range checks, are also possible here. If a check is negative, an error dialog can be programmed and the corresponding field can be initialized again.

The database tables are read in accordance with the selection criteria of the user and the associated GET events are raised in the subroutines put\_....

This program is only intended to demonstrate the principles of the structure of a logical database. It does not contain any methods for optimizing response times. The chronological order of the subroutine calls is determined by the structure of the logical database.



**üìñ Source**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)

### abenldb_selections_example.htm

> **üìñ Official SAP Documentation**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Selection%20Include%2C%20ABENLDB_SELECTIONS_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improve
ment:)

LDB - Example of a Selection Include

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). The generated proposal for the selection include is then as follows:

\*-----------------------------------------------------------\*
\* Include DBTEST\_LDBSEL
\* It will be automatically included into the database program
\*-----------------------------------------------------------\*
\* If the source is automatically generated,
\* perform the following steps:
\* 1. Replace ? by suitable names (at most 8 characters).
\* 2. Activate SELECT-OPTIONS and PARAMETERS (delete stars).
\* 3. Save source code.
\* 4. Edit database program.
\*
\* Hint : Syntax check is not possible within this include!
\* It will be checked during syntax check of database program.
\*-----------------------------------------------------------\*
\* SELECT-OPTIONS :¬†¬†?¬†¬†FOR LFA1-LIFNR.
\* Parameter for search pattern selection:
\* PARAMETERS p\_sp AS SEARCH PATTERN FOR TABLE LFA1.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-BUKRS.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-GJAHR.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BELNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-GJAHR.
\* Enable DYNAMIC SELECTIONS for selected nodes :
\* Enable FIELD SELECTION for selected nodes :

If the nodes LFA1 and LFB1 are defined for dynamic selections and the node LFC1 defined for field selections, the following additional program lines are generated:

SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFA1.
SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFB1.
SELECTION-SCREEN FIELD SELECTION FOR TABLE LFC1.

This automatically created selection include can be completed, for example, as follows:

\* Selection criteria:
¬†¬†SELECT-OPTIONS slifnr¬†¬†FOR lfa1-lifnr.
¬†¬†SELECT-OPTIONS sbukrs¬†¬†FOR lfb1-bukrs.
¬†¬†SELECT-OPTIONS sgjahr¬†¬†FOR flc1-gjahr.
¬†¬†SELECT-OPTIONS sbelnr¬†¬†FOR bkpf-belnr.
\* User-defined parameters:
¬†¬†PARAMETERS pstida LIKE sy-datum FOR NODE bkpf.
\* Dynamic selections for LFA1 and LFB1:
¬†¬†SELECTION-SCREEN DYNAMIC SELECTIONS FOR NODE: lfa1, lfb1.
\* Field selection for LFB1 and LFC1:
¬†¬†SELECTION-SCREEN FIELD SELECTION FOR NODE: lfb1, lfc1.

A selection is made from the available selection criteria and is given a name. The additional parameter pstida is declared and connected to the node BKPF. Dynamic selections are defined for the tablesLFA1 and LFB1. The tables LFB1 and LFC1 are defined for field selections.



**üìñ Source**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)

### abenldb_program_example.htm

> **üìñ Official SAP Documentation**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Database%20Program%2C%20ABENLDB_PROGRAM_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

LDB - Example of a Database Program

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). All nodes are database tables. Selections are defined in the selection include:

SELECT-OPTIONS SLIFNR¬†¬†FOR LFA1-LIFNR.
SELECT-OPTIONS SBUKRS¬†¬†FOR LFB1-BUKRS.
SELECT-OPTIONS SGJAHR¬†¬†FOR LFC1-GJAHR.
SELECT-OPTIONS SBELNR¬†¬†FOR BKPF-BELNR.

The generated proposal for the database program is then as follows:

Master Program SAPDBTEST\_LDB

\*----------------------------------------------------------\*
\*¬†¬†¬†¬†¬†¬†DATABASE PROGRAM OF LOGICAL DATABASE TEST\_LDB
\*----------------------------------------------------------\*
INCLUDE DBTEST\_LDBTOP.¬†¬†¬†¬† " header
INCLUDE DBTEST\_LDBXXX.¬†¬†¬†¬† " all system routines
\* INCLUDE DBTEST\_LDBF001.¬†¬†" user defined include

Include Program DBTEST\_LDBTOP

PROGRAM SAPDBTEST\_LDB DEFINING DATABASE TEST\_LDB.
TABLES: LFA1,
¬†¬†¬†¬†¬†¬†¬†¬† LFB1,
¬†¬†¬†¬†¬†¬†¬†¬† LFC1,
¬†¬†¬†¬†¬†¬†¬†¬† BKPF.
\* DATA: ...¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"user defined variables

Include Program DBTEST\_LDB001

\*----------------------------------------------------------\*
\* Call event GET LFA1
\*----------------------------------------------------------\*
FORM PUT\_LFA1.
\* SELECT \* FROM LFA1
\*¬†¬† INTO LFA1
\*¬†¬† INTO TABLE ? (choose one!)
\*¬†¬† WHERE LIFNR = ?.
¬†¬†¬†¬†PUT LFA1.
\* ENDSELECT.
ENDFORM.¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_LFA1
\*----------------------------------------------------------\*
\* Authority Check for node LFA1
\*----------------------------------------------------------\*
\* FORM AUTHORITY\_CHECK\_LFA1.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM.

Include Programs DBTEST\_LDB002 and DBTEST\_LDB003

Like DBTEST\_LDB001 for the nodes LFB1 and LFC1

Include Program DBTEST\_LDB004

\*----------------------------------------------------------\*
\* Call event GET BKPF
\*----------------------------------------------------------\*
FORM PUT\_BKPF.
\* STATICS FLAG.
\* IF FLAG = SPACE.
\*¬†¬† FLAG = 'X'.
\*\*\* Declarations for field selection for node BKPF \*\*\*
\*¬†¬† STATICS BKPF\_FIELDS TYPE RSFS\_TAB\_FIELDS.
\*¬†¬† MOVE 'BKPF' TO BKPF\_FIELDS-TABLENAME.
\*¬†¬† READ TABLE SELECT\_FIELDS WITH KEY BKPF\_FIELDS-TABLENAME
\*¬†¬†¬†¬† INTO BKPF\_FIELDS.
\* ENDIF.
\* SELECT (BKPF\_FIELDS-FIELDS) INTO CORRESPONDING FIELDS OF
\*¬†¬†¬†¬† BKPF / TABLE ? " (choose one of them)
\*¬†¬†¬†¬† FROM BKPF
\*¬†¬† WHERE BUKRS = LFB1-BUKRS
\*¬†¬†¬†¬† AND BELNR IN SBELNR
\*¬†¬†¬†¬† AND GJAHR = ?.
¬†¬†¬†¬†PUT BKPF.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_BKPF
\*----------------------------------------------------------\*
\* Authority Check for node BKPF
\*----------------------------------------------------------\*
\* FORM AUTHORITYCHECK\_BKPF.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AUTHORITY\_CHECK\_BKPF

Include Program DBTEST\_LDBFXXX

\*----------------------------------------------------------\*
\* BEFORE\_EVENT will be called before event EVENT
\* Possible values for EVENT: 'START-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM BEFORE\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'START-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "BEFORE\_EVENT
\*----------------------------------------------------------\*
\* AFTER\_EVENT will be called after event EVENT
\* Possible values for EVENT: 'END-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM AFTER\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'END-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AFTER\_EVENT
\*-----------------------------------------------------------\*
\* Initialize global data for multiple processing of
\* one logical database.
\* Set returncode:
\*¬†¬†¬†¬†¬†¬†0 -> all data are initialized, multiple processing o.k.
\*¬†¬†other -> no multiple processing allowed
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_INIT CHANGING SUBRC LIKE SY-SUBRC.
ENDFORM.¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_INIT
\*------------------------------------------------------------\*
\* LDB\_PROCESS\_CHECK\_SELECTIONS is called
\* after select-options and parameters are filled
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_CHECK\_SELECTIONS CHANGING SUBRC LIKE SY-SUBRC
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MSG LIKE SYMSG.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_CHECK\_SELECTIONS
\*----------------------------------------------------------\*
\* Initialize selection screen (processed before PBO)
\*----------------------------------------------------------\*
FORM INIT.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "INIT.
\*----------------------------------------------------------\*
\* PBO of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PBO.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PBO.
\*----------------------------------------------------------\*
\* PAI of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PAI USING FNAME MARK.
\* CASE FNAME.
\*¬†¬† WHEN 'SLIFNR¬†¬†'.
\*¬†¬† WHEN 'SBUKRS¬†¬†'.
\*¬†¬† WHEN 'SBELNR¬†¬†'.
\*¬†¬† WHEN 'SGJAHR¬†¬†'.
\*¬†¬† WHEN '\*'.
\*¬†¬† ENDCASE.
ENDFORM.¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PAI

Include Program DBTEST\_LDBSXXX

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (BEGIN OF BLOCK) !!!!!! \*
\*-----------------------------------------------------------\*
\* Data structures for search pattern selection
\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (END OF BLOCK) !!!!!!!! \*
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\*-----------------------------------------------------------\*
\* PUT\_TEST\_LDB\_SP.
\* Processed when search pattern selection is used,
\* i.e. user input into PARAMETERS p\_sp AS SEARCH PATTERN
\* STRUCTURE.
\*-----------------------------------------------------------\*
\* FORM PUT\_TEST\_LDB\_SP.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_EXAMPLE\_SP

The comment characters in front of ABAP statements that are to be used in addition to the mandatory statements can be deleted and the question marks can be replaced by appropriate expressions. The syntax check checks all include programs that match the naming conventions and also the selection include.

When the database is accessed in the subroutines put\_node, SELECT statements with conditions for the primary key fields in the WHERE clauses are generated. The performance of these statements is, however, not yet optimized. In particular, the subroutines put\_node of a subtree of the structure represent nested SELECT loops, which should generally be avoided. Instead, the data read can be buffered in internal tables, for example, and passed from here to the application program using the PUT statement. The statement PUT node, however, should always be in a subroutine whose name starts with put\_node for technical reasons.

If the selections specify [dynamic selections](javascript:call_link\('abenldb_free_selections.htm'\)) or [field selections](javascript:call_link\('abenldb_field_selections.htm'\)) for a node, corresponding statements are generated in the subroutine put\_node and the SELECT statement created automatically is modified, as shown in the example for the node BKPF.

The subroutines before\_event, after\_event, and put\_ldb\_sp are created as a comment in the database program and can be modified and activated by deleting the asterisks. before\_event is called before the event specified in the parameter event is processed. after\_event is called after the event specified in the parameter event is processed. When a search help selection is made, put\_ldb\_sp is called to process the return values instead of put\_node for the root node.



**üìñ Source**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)

### abenreport_abexa.htm

> **üìñ Official SAP Documentation**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Linkage%20with%20a%20Program%2C%20ABENREPORT_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Linkage with a Program

This example demonstrates how a logical database is linked with an executable program.

Source Code ¬† 

REPORT demo\_report.
NODES: spfli, sflight, sbook.
DATA: weight¬†¬†¬†¬†¬†¬† TYPE p LENGTH 8 DECIMALS 4,
¬†¬†¬†¬†¬†¬†total\_weight TYPE p LENGTH 8 DECIMALS 4.
INITIALIZATION.
¬†¬†carrid-sign = 'I'.
¬†¬†carrid-option = 'EQ'.
¬†¬†carrid-low = 'AA'.
¬†¬†carrid-high = 'LH'.
¬†¬†APPEND carrid TO carrid.
START-OF-SELECTION.
¬†¬†WRITE 'Luggage weight of flights'.
GET spfli FIELDS carrid connid cityfrom cityto.
¬†¬†SKIP.
¬†¬†ULINE.
¬†¬†WRITE: / 'Carrid:', spfli-carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'Connid:', spfli-connid,
¬†¬†¬†¬†¬†¬†¬†¬† / 'From:¬†¬†', spfli-cityfrom,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'To:¬†¬†¬†¬†', spfli-cityto.
¬†¬†ULINE.
GET sflight FIELDS fldate.
¬†¬†SKIP.
¬†¬†WRITE: / 'Date:', sflight-fldate.
GET sbook FIELDS luggweight.
¬†¬†weight += sbook-luggweight.
GET sflight LATE FIELDS carrid .
¬†¬†WRITE: / 'Luggage weight =', weight.
¬†¬†total\_weight += weight.
¬†¬†weight = 0.
END-OF-SELECTION.
¬†¬†ULINE.
¬†¬†WRITE: / 'Sum of luggage weights =', total\_weight.

Description ¬† 

This example shows a typical report where the [logical database](javascript:call_link\('abenlogical_data_base_glosry.htm'\) "Glossary Entry") F1S is assigned to its properties.



**üìñ Source**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)

### abenlogical_database_abexa.htm

> **üìñ Official SAP Documentation**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Calls%20Using%20a%20Function%20Module%2C%20ABENLOGICAL_DATABASE_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvem
ent:)

LDB - Calls Using a Function Module

This example demonstrates calling a logical database using the function module LDB\_PROCESS.

Source Code ¬† 

REPORT demo\_logical\_database.
DATA wa\_spfli TYPE spfli.
SELECTION-SCREEN BEGIN OF SCREEN 1100.
SELECT-OPTIONS s\_carr FOR wa\_spfli-carrid.
SELECTION-SCREEN END OF SCREEN 1100.
CLASS demo DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
ENDCLASS.
CLASS demo IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA callback¬†¬†¬†¬†TYPE TABLE OF ldbcb.
¬†¬†¬†¬†DATA: seltab¬†¬†¬†¬†TYPE TABLE OF rsparams,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†seltab\_wa LIKE LINE OF seltab,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†scarr\_wa¬†¬†LIKE LINE OF s\_carr.
¬†¬†¬†¬†CALL SELECTION-SCREEN 1100 STARTING AT 10 10.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†callback = VALUE #( ( ldbnode¬†¬†¬†¬† = 'SPFLI'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get\_late¬†¬†¬†¬†= 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SPFLI' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( ldbnode¬†¬†¬†¬† = 'SFLIGHT'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SFLIGHT' ) ).
¬†¬†¬†¬†seltab\_wa-kind = 'S'.
¬†¬†¬†¬†seltab\_wa-selname = 'CARRID'.
¬†¬†¬†¬†LOOP AT s\_carr INTO scarr\_wa.
¬†¬†¬†¬†¬†¬†MOVE-CORRESPONDING scarr\_wa TO seltab\_wa.
¬†¬†¬†¬†¬†¬†APPEND seltab\_wa TO seltab.
¬†¬†¬†¬†ENDLOOP.
¬†¬†¬†¬†CALL FUNCTION 'LDB\_PROCESS'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†ldbname¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 'F1S'
¬†¬†¬†¬†¬†¬†¬†¬†variant¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = ' '
¬†¬†¬†¬†¬†¬†TABLES
¬†¬†¬†¬†¬†¬†¬†¬†callback¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= callback
¬†¬†¬†¬†¬†¬†¬†¬†selections¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= seltab
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Exception with SY-SUBRC', sy-subrc.
¬†¬†¬†¬†ENDIF.¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†demo=>main( ).
FORM callback\_spfli USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE spfli
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†CASE evt.
¬†¬†¬†¬†WHEN 'G'.
¬†¬†¬†¬†¬†¬†WRITE: / wa-carrid, wa-connid, wa-cityfrom, wa-cityto.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†¬†¬†WHEN 'L'.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†ENDCASE.
ENDFORM.
FORM callback\_sflight USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†WRITE: / wa-fldate, wa-seatsocc, wa-seatsmax.
ENDFORM.

Description ¬† 

The program reads data using the logical database F1S. First a program-specific selection screen is defined. The data object wa\_spfli is only required here. Next, suitable variables for the interface are declared.

The internal table callback is filled in such a way that, for the two nodes SPFLI and SFLIGHT, different callback routines in the calling program are called. For the node SPFLI, the corresponding routine for GET and GET LATE is only to be called for GET in the case of SFLIGHT.

The internal table seltab is filled with values from the selection table s\_carr of the standalone selection screen 1100 for the selections of node SPFLI.

The function module LDB\_PROCESS is called with these parameters.

The subroutines callback\_spfli and callback\_sflight are used as callback routines. Since the interface parameter wa is completely typed, the individual components of the work area can be accessed. In callback\_spfli, the events GET and GET LATE are handled differently.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Obsolete Database Access / Obsolete Access to Objects in HANA XS / Access to SAP HANA XSC Objects (Obsolete) / Database Procedure Proxies for SQLScript Procedures in the SAP HANA Repository (Obsolete)

**Files**: 7 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Examples

Included pages: 6



**üìñ Source**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)

### abenldb_examples.htm

> **üìñ Official SAP Documentation**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Examples%2C%20ABENLDB_EXAMPLES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Examples

-   [Example of a logical database](javascript:call_link\('abenldb_example.htm'\))
-   [Example of selection include](javascript:call_link\('abenldb_selections_example.htm'\))
-   [Example of a database program](javascript:call_link\('abenldb_program_example.htm'\))
-   [Logical database, linked with a program](javascript:call_link\('abenreport_abexa.htm'\))
-   [Logical database, called by function module](javascript:call_link\('abenlogical_database_abexa.htm'\))

Continue
[LDB - Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\))
[LDB - Example of a Selection Include](javascript:call_link\('abenldb_selections_example.htm'\))
[LDB - Example of a Database Program](javascript:call_link\('abenldb_program_example.htm'\))
![Example](exa.gif "Example") [LDB - Linkage with a Program](javascript:call_link\('abenreport_abexa.htm'\))
![Example](exa.gif "Example") [LDB - Calls Using a Function Module](javascript:call_link\('abenlogical_database_abexa.htm'\))



**üìñ Source**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)

### abenldb_example.htm

> **üìñ Official SAP Documentation**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Logical%20Database%2C%20ABENLDB_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Example of a Logical Database

This example demonstrates all significant components of the imaginary logical database TEST\_LDB.

-   [Structure](#abenldb-example-1-------selections-in-the-selection-include---@ITOC@@ABENLDB_EXAMPLE_2)
-   [Database Program](#abenldb-example-3---structure-----lfa1------------lfb1--------------------------lfc1--------------------------bkpf--selections-in-the-selection-include-----select-options--slifnr---for-lfa1-lifnr------------------sbukrs---for-lfb1-bukrs------------------sgjahr---for-lfc1-gjahr------------------sbelnr---for-bkpf-belnr---database-program--------------------------------------------------------------------database-program-of-logical-database-test--ldb-------------------------------------------------------------program-sapdbtest--ldb-defining-database-test--ldb--nodes--lfa1---------lfb1---------lfc1---------bkpf-----------------------------------------------------------------initialize-selection-screen--processed-before-pbo--------------------------------------------------------------form-init-------endform-----------------------------------------------------------------pbo-of-selection-screen-------------------------------------------------------------form-pbo-------endform-----------------------------------------------------------------pai-of-selection-screen-------------------------------------------------------------form-pai-using-fname-mark----case-fname------when--slifnr-----------------when--sbukrs-----------------when--sgjahr-----------------when--sbelnr---------------endcase--endform-----------------------------------------------------------------raise-event-get-lfa1-------------------------------------------------------------form-put--lfa1----select----from-lfa1------------where-lifnr-in-slifnr INTO @lfa1.
¬†¬†¬†¬†PUT lfa1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfb1
\*-------------------------------------------------------\*
FORM put\_lfb1.
¬†¬†SELECT \* FROM lfb1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs IN @sbulrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @lfb1.
¬†¬†¬†¬†PUT lfb1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfc1
\*-------------------------------------------------------\*
FORM put\_lfc1.
¬†¬†SELECT \* FROM lfc1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO lfc1.
¬†¬†¬†¬†PUT lfc1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET bkpf
\*-------------------------------------------------------\*
FORM put\_bkpf.
¬†¬†SELECT \* FROM bkpf
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND belnr¬†¬†¬†¬†¬†¬†IN @sbelnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @bkpf.
¬†¬†¬†¬†PUT bkpf.
¬†¬†ENDSELECT.
ENDFORM.

The PROGRAM statement has the addition [DEFINING DATABASE test\_ldb](javascript:call_link\('abapreport_defining.htm'\)). This defines the link of the database program with the logical database TEST\_LDB.

The nodes of the structure are declared using the [NODES statement](javascript:call_link\('abapnodes.htm'\)). This creates the required interface work areas as table work areas. The statement [TABLES](javascript:call_link\('abaptables.htm'\)) can be used as a node in the same way for database tables. If the nodes are not database tables, they must be declared using NODES. The interface work areas are shared by the database program and a linked executable program or the function module LDB\_PROCESS and therefore become the interface used for passing data.

The selection screen can be initialized in the subroutines init and pbo.

The user input on the selection screen can be, for example, checked for authorizations in the subroutine pai. Other checks, such as plausibility or value range checks, are also possible here. If a check is negative, an error dialog can be programmed and the corresponding field can be initialized again.

The database tables are read in accordance with the selection criteria of the user and the associated GET events are raised in the subroutines put\_....

This program is only intended to demonstrate the principles of the structure of a logical database. It does not contain any methods for optimizing response times. The chronological order of the subroutine calls is determined by the structure of the logical database.



**üìñ Source**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)

### abenldb_selections_example.htm

> **üìñ Official SAP Documentation**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Selection%20Include%2C%20ABENLDB_SELECTIONS_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improve
ment:)

LDB - Example of a Selection Include

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). The generated proposal for the selection include is then as follows:

\*-----------------------------------------------------------\*
\* Include DBTEST\_LDBSEL
\* It will be automatically included into the database program
\*-----------------------------------------------------------\*
\* If the source is automatically generated,
\* perform the following steps:
\* 1. Replace ? by suitable names (at most 8 characters).
\* 2. Activate SELECT-OPTIONS and PARAMETERS (delete stars).
\* 3. Save source code.
\* 4. Edit database program.
\*
\* Hint : Syntax check is not possible within this include!
\* It will be checked during syntax check of database program.
\*-----------------------------------------------------------\*
\* SELECT-OPTIONS :¬†¬†?¬†¬†FOR LFA1-LIFNR.
\* Parameter for search pattern selection:
\* PARAMETERS p\_sp AS SEARCH PATTERN FOR TABLE LFA1.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-BUKRS.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-GJAHR.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BELNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-GJAHR.
\* Enable DYNAMIC SELECTIONS for selected nodes :
\* Enable FIELD SELECTION for selected nodes :

If the nodes LFA1 and LFB1 are defined for dynamic selections and the node LFC1 defined for field selections, the following additional program lines are generated:

SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFA1.
SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFB1.
SELECTION-SCREEN FIELD SELECTION FOR TABLE LFC1.

This automatically created selection include can be completed, for example, as follows:

\* Selection criteria:
¬†¬†SELECT-OPTIONS slifnr¬†¬†FOR lfa1-lifnr.
¬†¬†SELECT-OPTIONS sbukrs¬†¬†FOR lfb1-bukrs.
¬†¬†SELECT-OPTIONS sgjahr¬†¬†FOR flc1-gjahr.
¬†¬†SELECT-OPTIONS sbelnr¬†¬†FOR bkpf-belnr.
\* User-defined parameters:
¬†¬†PARAMETERS pstida LIKE sy-datum FOR NODE bkpf.
\* Dynamic selections for LFA1 and LFB1:
¬†¬†SELECTION-SCREEN DYNAMIC SELECTIONS FOR NODE: lfa1, lfb1.
\* Field selection for LFB1 and LFC1:
¬†¬†SELECTION-SCREEN FIELD SELECTION FOR NODE: lfb1, lfc1.

A selection is made from the available selection criteria and is given a name. The additional parameter pstida is declared and connected to the node BKPF. Dynamic selections are defined for the tablesLFA1 and LFB1. The tables LFB1 and LFC1 are defined for field selections.



**üìñ Source**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)

### abenldb_program_example.htm

> **üìñ Official SAP Documentation**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Database%20Program%2C%20ABENLDB_PROGRAM_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

LDB - Example of a Database Program

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). All nodes are database tables. Selections are defined in the selection include:

SELECT-OPTIONS SLIFNR¬†¬†FOR LFA1-LIFNR.
SELECT-OPTIONS SBUKRS¬†¬†FOR LFB1-BUKRS.
SELECT-OPTIONS SGJAHR¬†¬†FOR LFC1-GJAHR.
SELECT-OPTIONS SBELNR¬†¬†FOR BKPF-BELNR.

The generated proposal for the database program is then as follows:

Master Program SAPDBTEST\_LDB

\*----------------------------------------------------------\*
\*¬†¬†¬†¬†¬†¬†DATABASE PROGRAM OF LOGICAL DATABASE TEST\_LDB
\*----------------------------------------------------------\*
INCLUDE DBTEST\_LDBTOP.¬†¬†¬†¬† " header
INCLUDE DBTEST\_LDBXXX.¬†¬†¬†¬† " all system routines
\* INCLUDE DBTEST\_LDBF001.¬†¬†" user defined include

Include Program DBTEST\_LDBTOP

PROGRAM SAPDBTEST\_LDB DEFINING DATABASE TEST\_LDB.
TABLES: LFA1,
¬†¬†¬†¬†¬†¬†¬†¬† LFB1,
¬†¬†¬†¬†¬†¬†¬†¬† LFC1,
¬†¬†¬†¬†¬†¬†¬†¬† BKPF.
\* DATA: ...¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"user defined variables

Include Program DBTEST\_LDB001

\*----------------------------------------------------------\*
\* Call event GET LFA1
\*----------------------------------------------------------\*
FORM PUT\_LFA1.
\* SELECT \* FROM LFA1
\*¬†¬† INTO LFA1
\*¬†¬† INTO TABLE ? (choose one!)
\*¬†¬† WHERE LIFNR = ?.
¬†¬†¬†¬†PUT LFA1.
\* ENDSELECT.
ENDFORM.¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_LFA1
\*----------------------------------------------------------\*
\* Authority Check for node LFA1
\*----------------------------------------------------------\*
\* FORM AUTHORITY\_CHECK\_LFA1.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM.

Include Programs DBTEST\_LDB002 and DBTEST\_LDB003

Like DBTEST\_LDB001 for the nodes LFB1 and LFC1

Include Program DBTEST\_LDB004

\*----------------------------------------------------------\*
\* Call event GET BKPF
\*----------------------------------------------------------\*
FORM PUT\_BKPF.
\* STATICS FLAG.
\* IF FLAG = SPACE.
\*¬†¬† FLAG = 'X'.
\*\*\* Declarations for field selection for node BKPF \*\*\*
\*¬†¬† STATICS BKPF\_FIELDS TYPE RSFS\_TAB\_FIELDS.
\*¬†¬† MOVE 'BKPF' TO BKPF\_FIELDS-TABLENAME.
\*¬†¬† READ TABLE SELECT\_FIELDS WITH KEY BKPF\_FIELDS-TABLENAME
\*¬†¬†¬†¬† INTO BKPF\_FIELDS.
\* ENDIF.
\* SELECT (BKPF\_FIELDS-FIELDS) INTO CORRESPONDING FIELDS OF
\*¬†¬†¬†¬† BKPF / TABLE ? " (choose one of them)
\*¬†¬†¬†¬† FROM BKPF
\*¬†¬† WHERE BUKRS = LFB1-BUKRS
\*¬†¬†¬†¬† AND BELNR IN SBELNR
\*¬†¬†¬†¬† AND GJAHR = ?.
¬†¬†¬†¬†PUT BKPF.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_BKPF
\*----------------------------------------------------------\*
\* Authority Check for node BKPF
\*----------------------------------------------------------\*
\* FORM AUTHORITYCHECK\_BKPF.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AUTHORITY\_CHECK\_BKPF

Include Program DBTEST\_LDBFXXX

\*----------------------------------------------------------\*
\* BEFORE\_EVENT will be called before event EVENT
\* Possible values for EVENT: 'START-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM BEFORE\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'START-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "BEFORE\_EVENT
\*----------------------------------------------------------\*
\* AFTER\_EVENT will be called after event EVENT
\* Possible values for EVENT: 'END-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM AFTER\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'END-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AFTER\_EVENT
\*-----------------------------------------------------------\*
\* Initialize global data for multiple processing of
\* one logical database.
\* Set returncode:
\*¬†¬†¬†¬†¬†¬†0 -> all data are initialized, multiple processing o.k.
\*¬†¬†other -> no multiple processing allowed
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_INIT CHANGING SUBRC LIKE SY-SUBRC.
ENDFORM.¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_INIT
\*------------------------------------------------------------\*
\* LDB\_PROCESS\_CHECK\_SELECTIONS is called
\* after select-options and parameters are filled
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_CHECK\_SELECTIONS CHANGING SUBRC LIKE SY-SUBRC
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MSG LIKE SYMSG.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_CHECK\_SELECTIONS
\*----------------------------------------------------------\*
\* Initialize selection screen (processed before PBO)
\*----------------------------------------------------------\*
FORM INIT.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "INIT.
\*----------------------------------------------------------\*
\* PBO of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PBO.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PBO.
\*----------------------------------------------------------\*
\* PAI of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PAI USING FNAME MARK.
\* CASE FNAME.
\*¬†¬† WHEN 'SLIFNR¬†¬†'.
\*¬†¬† WHEN 'SBUKRS¬†¬†'.
\*¬†¬† WHEN 'SBELNR¬†¬†'.
\*¬†¬† WHEN 'SGJAHR¬†¬†'.
\*¬†¬† WHEN '\*'.
\*¬†¬† ENDCASE.
ENDFORM.¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PAI

Include Program DBTEST\_LDBSXXX

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (BEGIN OF BLOCK) !!!!!! \*
\*-----------------------------------------------------------\*
\* Data structures for search pattern selection
\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (END OF BLOCK) !!!!!!!! \*
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\*-----------------------------------------------------------\*
\* PUT\_TEST\_LDB\_SP.
\* Processed when search pattern selection is used,
\* i.e. user input into PARAMETERS p\_sp AS SEARCH PATTERN
\* STRUCTURE.
\*-----------------------------------------------------------\*
\* FORM PUT\_TEST\_LDB\_SP.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_EXAMPLE\_SP

The comment characters in front of ABAP statements that are to be used in addition to the mandatory statements can be deleted and the question marks can be replaced by appropriate expressions. The syntax check checks all include programs that match the naming conventions and also the selection include.

When the database is accessed in the subroutines put\_node, SELECT statements with conditions for the primary key fields in the WHERE clauses are generated. The performance of these statements is, however, not yet optimized. In particular, the subroutines put\_node of a subtree of the structure represent nested SELECT loops, which should generally be avoided. Instead, the data read can be buffered in internal tables, for example, and passed from here to the application program using the PUT statement. The statement PUT node, however, should always be in a subroutine whose name starts with put\_node for technical reasons.

If the selections specify [dynamic selections](javascript:call_link\('abenldb_free_selections.htm'\)) or [field selections](javascript:call_link\('abenldb_field_selections.htm'\)) for a node, corresponding statements are generated in the subroutine put\_node and the SELECT statement created automatically is modified, as shown in the example for the node BKPF.

The subroutines before\_event, after\_event, and put\_ldb\_sp are created as a comment in the database program and can be modified and activated by deleting the asterisks. before\_event is called before the event specified in the parameter event is processed. after\_event is called after the event specified in the parameter event is processed. When a search help selection is made, put\_ldb\_sp is called to process the return values instead of put\_node for the root node.



**üìñ Source**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)

### abenreport_abexa.htm

> **üìñ Official SAP Documentation**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Linkage%20with%20a%20Program%2C%20ABENREPORT_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Linkage with a Program

This example demonstrates how a logical database is linked with an executable program.

Source Code ¬† 

REPORT demo\_report.
NODES: spfli, sflight, sbook.
DATA: weight¬†¬†¬†¬†¬†¬† TYPE p LENGTH 8 DECIMALS 4,
¬†¬†¬†¬†¬†¬†total\_weight TYPE p LENGTH 8 DECIMALS 4.
INITIALIZATION.
¬†¬†carrid-sign = 'I'.
¬†¬†carrid-option = 'EQ'.
¬†¬†carrid-low = 'AA'.
¬†¬†carrid-high = 'LH'.
¬†¬†APPEND carrid TO carrid.
START-OF-SELECTION.
¬†¬†WRITE 'Luggage weight of flights'.
GET spfli FIELDS carrid connid cityfrom cityto.
¬†¬†SKIP.
¬†¬†ULINE.
¬†¬†WRITE: / 'Carrid:', spfli-carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'Connid:', spfli-connid,
¬†¬†¬†¬†¬†¬†¬†¬† / 'From:¬†¬†', spfli-cityfrom,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'To:¬†¬†¬†¬†', spfli-cityto.
¬†¬†ULINE.
GET sflight FIELDS fldate.
¬†¬†SKIP.
¬†¬†WRITE: / 'Date:', sflight-fldate.
GET sbook FIELDS luggweight.
¬†¬†weight += sbook-luggweight.
GET sflight LATE FIELDS carrid .
¬†¬†WRITE: / 'Luggage weight =', weight.
¬†¬†total\_weight += weight.
¬†¬†weight = 0.
END-OF-SELECTION.
¬†¬†ULINE.
¬†¬†WRITE: / 'Sum of luggage weights =', total\_weight.

Description ¬† 

This example shows a typical report where the [logical database](javascript:call_link\('abenlogical_data_base_glosry.htm'\) "Glossary Entry") F1S is assigned to its properties.



**üìñ Source**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)

### abenlogical_database_abexa.htm

> **üìñ Official SAP Documentation**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Calls%20Using%20a%20Function%20Module%2C%20ABENLOGICAL_DATABASE_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvem
ent:)

LDB - Calls Using a Function Module

This example demonstrates calling a logical database using the function module LDB\_PROCESS.

Source Code ¬† 

REPORT demo\_logical\_database.
DATA wa\_spfli TYPE spfli.
SELECTION-SCREEN BEGIN OF SCREEN 1100.
SELECT-OPTIONS s\_carr FOR wa\_spfli-carrid.
SELECTION-SCREEN END OF SCREEN 1100.
CLASS demo DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
ENDCLASS.
CLASS demo IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA callback¬†¬†¬†¬†TYPE TABLE OF ldbcb.
¬†¬†¬†¬†DATA: seltab¬†¬†¬†¬†TYPE TABLE OF rsparams,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†seltab\_wa LIKE LINE OF seltab,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†scarr\_wa¬†¬†LIKE LINE OF s\_carr.
¬†¬†¬†¬†CALL SELECTION-SCREEN 1100 STARTING AT 10 10.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†callback = VALUE #( ( ldbnode¬†¬†¬†¬† = 'SPFLI'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get\_late¬†¬†¬†¬†= 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SPFLI' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( ldbnode¬†¬†¬†¬† = 'SFLIGHT'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SFLIGHT' ) ).
¬†¬†¬†¬†seltab\_wa-kind = 'S'.
¬†¬†¬†¬†seltab\_wa-selname = 'CARRID'.
¬†¬†¬†¬†LOOP AT s\_carr INTO scarr\_wa.
¬†¬†¬†¬†¬†¬†MOVE-CORRESPONDING scarr\_wa TO seltab\_wa.
¬†¬†¬†¬†¬†¬†APPEND seltab\_wa TO seltab.
¬†¬†¬†¬†ENDLOOP.
¬†¬†¬†¬†CALL FUNCTION 'LDB\_PROCESS'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†ldbname¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 'F1S'
¬†¬†¬†¬†¬†¬†¬†¬†variant¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = ' '
¬†¬†¬†¬†¬†¬†TABLES
¬†¬†¬†¬†¬†¬†¬†¬†callback¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= callback
¬†¬†¬†¬†¬†¬†¬†¬†selections¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= seltab
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Exception with SY-SUBRC', sy-subrc.
¬†¬†¬†¬†ENDIF.¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†demo=>main( ).
FORM callback\_spfli USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE spfli
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†CASE evt.
¬†¬†¬†¬†WHEN 'G'.
¬†¬†¬†¬†¬†¬†WRITE: / wa-carrid, wa-connid, wa-cityfrom, wa-cityto.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†¬†¬†WHEN 'L'.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†ENDCASE.
ENDFORM.
FORM callback\_sflight USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†WRITE: / wa-fldate, wa-seatsocc, wa-seatsmax.
ENDFORM.

Description ¬† 

The program reads data using the logical database F1S. First a program-specific selection screen is defined. The data object wa\_spfli is only required here. Next, suitable variables for the interface are declared.

The internal table callback is filled in such a way that, for the two nodes SPFLI and SFLIGHT, different callback routines in the calling program are called. For the node SPFLI, the corresponding routine for GET and GET LATE is only to be called for GET in the case of SFLIGHT.

The internal table seltab is filled with values from the selection table s\_carr of the standalone selection screen 1100 for the selections of node SPFLI.

The function module LDB\_PROCESS is called with these parameters.

The subroutines callback\_spfli and callback\_sflight are used as callback routines. Since the interface parameter wa is completely typed, the individual components of the work area can be accessed. In callback\_spfli, the events GET and GET LATE are handled differently.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Components

**Files**: 10 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Examples

Included pages: 6



**üìñ Source**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)

### abenldb_examples.htm

> **üìñ Official SAP Documentation**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Examples%2C%20ABENLDB_EXAMPLES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Examples

-   [Example of a logical database](javascript:call_link\('abenldb_example.htm'\))
-   [Example of selection include](javascript:call_link\('abenldb_selections_example.htm'\))
-   [Example of a database program](javascript:call_link\('abenldb_program_example.htm'\))
-   [Logical database, linked with a program](javascript:call_link\('abenreport_abexa.htm'\))
-   [Logical database, called by function module](javascript:call_link\('abenlogical_database_abexa.htm'\))

Continue
[LDB - Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\))
[LDB - Example of a Selection Include](javascript:call_link\('abenldb_selections_example.htm'\))
[LDB - Example of a Database Program](javascript:call_link\('abenldb_program_example.htm'\))
![Example](exa.gif "Example") [LDB - Linkage with a Program](javascript:call_link\('abenreport_abexa.htm'\))
![Example](exa.gif "Example") [LDB - Calls Using a Function Module](javascript:call_link\('abenlogical_database_abexa.htm'\))



**üìñ Source**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)

### abenldb_example.htm

> **üìñ Official SAP Documentation**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Logical%20Database%2C%20ABENLDB_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Example of a Logical Database

This example demonstrates all significant components of the imaginary logical database TEST\_LDB.

-   [Structure](#abenldb-example-1-------selections-in-the-selection-include---@ITOC@@ABENLDB_EXAMPLE_2)
-   [Database Program](#abenldb-example-3---structure-----lfa1------------lfb1--------------------------lfc1--------------------------bkpf--selections-in-the-selection-include-----select-options--slifnr---for-lfa1-lifnr------------------sbukrs---for-lfb1-bukrs------------------sgjahr---for-lfc1-gjahr------------------sbelnr---for-bkpf-belnr---database-program--------------------------------------------------------------------database-program-of-logical-database-test--ldb-------------------------------------------------------------program-sapdbtest--ldb-defining-database-test--ldb--nodes--lfa1---------lfb1---------lfc1---------bkpf-----------------------------------------------------------------initialize-selection-screen--processed-before-pbo--------------------------------------------------------------form-init-------endform-----------------------------------------------------------------pbo-of-selection-screen-------------------------------------------------------------form-pbo-------endform-----------------------------------------------------------------pai-of-selection-screen-------------------------------------------------------------form-pai-using-fname-mark----case-fname------when--slifnr-----------------when--sbukrs-----------------when--sgjahr-----------------when--sbelnr---------------endcase--endform-----------------------------------------------------------------raise-event-get-lfa1-------------------------------------------------------------form-put--lfa1----select----from-lfa1------------where-lifnr-in-slifnr INTO @lfa1.
¬†¬†¬†¬†PUT lfa1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfb1
\*-------------------------------------------------------\*
FORM put\_lfb1.
¬†¬†SELECT \* FROM lfb1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs IN @sbulrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @lfb1.
¬†¬†¬†¬†PUT lfb1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfc1
\*-------------------------------------------------------\*
FORM put\_lfc1.
¬†¬†SELECT \* FROM lfc1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO lfc1.
¬†¬†¬†¬†PUT lfc1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET bkpf
\*-------------------------------------------------------\*
FORM put\_bkpf.
¬†¬†SELECT \* FROM bkpf
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND belnr¬†¬†¬†¬†¬†¬†IN @sbelnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @bkpf.
¬†¬†¬†¬†PUT bkpf.
¬†¬†ENDSELECT.
ENDFORM.

The PROGRAM statement has the addition [DEFINING DATABASE test\_ldb](javascript:call_link\('abapreport_defining.htm'\)). This defines the link of the database program with the logical database TEST\_LDB.

The nodes of the structure are declared using the [NODES statement](javascript:call_link\('abapnodes.htm'\)). This creates the required interface work areas as table work areas. The statement [TABLES](javascript:call_link\('abaptables.htm'\)) can be used as a node in the same way for database tables. If the nodes are not database tables, they must be declared using NODES. The interface work areas are shared by the database program and a linked executable program or the function module LDB\_PROCESS and therefore become the interface used for passing data.

The selection screen can be initialized in the subroutines init and pbo.

The user input on the selection screen can be, for example, checked for authorizations in the subroutine pai. Other checks, such as plausibility or value range checks, are also possible here. If a check is negative, an error dialog can be programmed and the corresponding field can be initialized again.

The database tables are read in accordance with the selection criteria of the user and the associated GET events are raised in the subroutines put\_....

This program is only intended to demonstrate the principles of the structure of a logical database. It does not contain any methods for optimizing response times. The chronological order of the subroutine calls is determined by the structure of the logical database.



**üìñ Source**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)

### abenldb_selections_example.htm

> **üìñ Official SAP Documentation**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Selection%20Include%2C%20ABENLDB_SELECTIONS_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improve
ment:)

LDB - Example of a Selection Include

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). The generated proposal for the selection include is then as follows:

\*-----------------------------------------------------------\*
\* Include DBTEST\_LDBSEL
\* It will be automatically included into the database program
\*-----------------------------------------------------------\*
\* If the source is automatically generated,
\* perform the following steps:
\* 1. Replace ? by suitable names (at most 8 characters).
\* 2. Activate SELECT-OPTIONS and PARAMETERS (delete stars).
\* 3. Save source code.
\* 4. Edit database program.
\*
\* Hint : Syntax check is not possible within this include!
\* It will be checked during syntax check of database program.
\*-----------------------------------------------------------\*
\* SELECT-OPTIONS :¬†¬†?¬†¬†FOR LFA1-LIFNR.
\* Parameter for search pattern selection:
\* PARAMETERS p\_sp AS SEARCH PATTERN FOR TABLE LFA1.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-BUKRS.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-GJAHR.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BELNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-GJAHR.
\* Enable DYNAMIC SELECTIONS for selected nodes :
\* Enable FIELD SELECTION for selected nodes :

If the nodes LFA1 and LFB1 are defined for dynamic selections and the node LFC1 defined for field selections, the following additional program lines are generated:

SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFA1.
SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFB1.
SELECTION-SCREEN FIELD SELECTION FOR TABLE LFC1.

This automatically created selection include can be completed, for example, as follows:

\* Selection criteria:
¬†¬†SELECT-OPTIONS slifnr¬†¬†FOR lfa1-lifnr.
¬†¬†SELECT-OPTIONS sbukrs¬†¬†FOR lfb1-bukrs.
¬†¬†SELECT-OPTIONS sgjahr¬†¬†FOR flc1-gjahr.
¬†¬†SELECT-OPTIONS sbelnr¬†¬†FOR bkpf-belnr.
\* User-defined parameters:
¬†¬†PARAMETERS pstida LIKE sy-datum FOR NODE bkpf.
\* Dynamic selections for LFA1 and LFB1:
¬†¬†SELECTION-SCREEN DYNAMIC SELECTIONS FOR NODE: lfa1, lfb1.
\* Field selection for LFB1 and LFC1:
¬†¬†SELECTION-SCREEN FIELD SELECTION FOR NODE: lfb1, lfc1.

A selection is made from the available selection criteria and is given a name. The additional parameter pstida is declared and connected to the node BKPF. Dynamic selections are defined for the tablesLFA1 and LFB1. The tables LFB1 and LFC1 are defined for field selections.



**üìñ Source**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)

### abenldb_program_example.htm

> **üìñ Official SAP Documentation**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Database%20Program%2C%20ABENLDB_PROGRAM_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

LDB - Example of a Database Program

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). All nodes are database tables. Selections are defined in the selection include:

SELECT-OPTIONS SLIFNR¬†¬†FOR LFA1-LIFNR.
SELECT-OPTIONS SBUKRS¬†¬†FOR LFB1-BUKRS.
SELECT-OPTIONS SGJAHR¬†¬†FOR LFC1-GJAHR.
SELECT-OPTIONS SBELNR¬†¬†FOR BKPF-BELNR.

The generated proposal for the database program is then as follows:

Master Program SAPDBTEST\_LDB

\*----------------------------------------------------------\*
\*¬†¬†¬†¬†¬†¬†DATABASE PROGRAM OF LOGICAL DATABASE TEST\_LDB
\*----------------------------------------------------------\*
INCLUDE DBTEST\_LDBTOP.¬†¬†¬†¬† " header
INCLUDE DBTEST\_LDBXXX.¬†¬†¬†¬† " all system routines
\* INCLUDE DBTEST\_LDBF001.¬†¬†" user defined include

Include Program DBTEST\_LDBTOP

PROGRAM SAPDBTEST\_LDB DEFINING DATABASE TEST\_LDB.
TABLES: LFA1,
¬†¬†¬†¬†¬†¬†¬†¬† LFB1,
¬†¬†¬†¬†¬†¬†¬†¬† LFC1,
¬†¬†¬†¬†¬†¬†¬†¬† BKPF.
\* DATA: ...¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"user defined variables

Include Program DBTEST\_LDB001

\*----------------------------------------------------------\*
\* Call event GET LFA1
\*----------------------------------------------------------\*
FORM PUT\_LFA1.
\* SELECT \* FROM LFA1
\*¬†¬† INTO LFA1
\*¬†¬† INTO TABLE ? (choose one!)
\*¬†¬† WHERE LIFNR = ?.
¬†¬†¬†¬†PUT LFA1.
\* ENDSELECT.
ENDFORM.¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_LFA1
\*----------------------------------------------------------\*
\* Authority Check for node LFA1
\*----------------------------------------------------------\*
\* FORM AUTHORITY\_CHECK\_LFA1.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM.

Include Programs DBTEST\_LDB002 and DBTEST\_LDB003

Like DBTEST\_LDB001 for the nodes LFB1 and LFC1

Include Program DBTEST\_LDB004

\*----------------------------------------------------------\*
\* Call event GET BKPF
\*----------------------------------------------------------\*
FORM PUT\_BKPF.
\* STATICS FLAG.
\* IF FLAG = SPACE.
\*¬†¬† FLAG = 'X'.
\*\*\* Declarations for field selection for node BKPF \*\*\*
\*¬†¬† STATICS BKPF\_FIELDS TYPE RSFS\_TAB\_FIELDS.
\*¬†¬† MOVE 'BKPF' TO BKPF\_FIELDS-TABLENAME.
\*¬†¬† READ TABLE SELECT\_FIELDS WITH KEY BKPF\_FIELDS-TABLENAME
\*¬†¬†¬†¬† INTO BKPF\_FIELDS.
\* ENDIF.
\* SELECT (BKPF\_FIELDS-FIELDS) INTO CORRESPONDING FIELDS OF
\*¬†¬†¬†¬† BKPF / TABLE ? " (choose one of them)
\*¬†¬†¬†¬† FROM BKPF
\*¬†¬† WHERE BUKRS = LFB1-BUKRS
\*¬†¬†¬†¬† AND BELNR IN SBELNR
\*¬†¬†¬†¬† AND GJAHR = ?.
¬†¬†¬†¬†PUT BKPF.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_BKPF
\*----------------------------------------------------------\*
\* Authority Check for node BKPF
\*----------------------------------------------------------\*
\* FORM AUTHORITYCHECK\_BKPF.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AUTHORITY\_CHECK\_BKPF

Include Program DBTEST\_LDBFXXX

\*----------------------------------------------------------\*
\* BEFORE\_EVENT will be called before event EVENT
\* Possible values for EVENT: 'START-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM BEFORE\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'START-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "BEFORE\_EVENT
\*----------------------------------------------------------\*
\* AFTER\_EVENT will be called after event EVENT
\* Possible values for EVENT: 'END-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM AFTER\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'END-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AFTER\_EVENT
\*-----------------------------------------------------------\*
\* Initialize global data for multiple processing of
\* one logical database.
\* Set returncode:
\*¬†¬†¬†¬†¬†¬†0 -> all data are initialized, multiple processing o.k.
\*¬†¬†other -> no multiple processing allowed
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_INIT CHANGING SUBRC LIKE SY-SUBRC.
ENDFORM.¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_INIT
\*------------------------------------------------------------\*
\* LDB\_PROCESS\_CHECK\_SELECTIONS is called
\* after select-options and parameters are filled
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_CHECK\_SELECTIONS CHANGING SUBRC LIKE SY-SUBRC
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MSG LIKE SYMSG.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_CHECK\_SELECTIONS
\*----------------------------------------------------------\*
\* Initialize selection screen (processed before PBO)
\*----------------------------------------------------------\*
FORM INIT.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "INIT.
\*----------------------------------------------------------\*
\* PBO of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PBO.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PBO.
\*----------------------------------------------------------\*
\* PAI of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PAI USING FNAME MARK.
\* CASE FNAME.
\*¬†¬† WHEN 'SLIFNR¬†¬†'.
\*¬†¬† WHEN 'SBUKRS¬†¬†'.
\*¬†¬† WHEN 'SBELNR¬†¬†'.
\*¬†¬† WHEN 'SGJAHR¬†¬†'.
\*¬†¬† WHEN '\*'.
\*¬†¬† ENDCASE.
ENDFORM.¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PAI

Include Program DBTEST\_LDBSXXX

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (BEGIN OF BLOCK) !!!!!! \*
\*-----------------------------------------------------------\*
\* Data structures for search pattern selection
\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (END OF BLOCK) !!!!!!!! \*
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\*-----------------------------------------------------------\*
\* PUT\_TEST\_LDB\_SP.
\* Processed when search pattern selection is used,
\* i.e. user input into PARAMETERS p\_sp AS SEARCH PATTERN
\* STRUCTURE.
\*-----------------------------------------------------------\*
\* FORM PUT\_TEST\_LDB\_SP.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_EXAMPLE\_SP

The comment characters in front of ABAP statements that are to be used in addition to the mandatory statements can be deleted and the question marks can be replaced by appropriate expressions. The syntax check checks all include programs that match the naming conventions and also the selection include.

When the database is accessed in the subroutines put\_node, SELECT statements with conditions for the primary key fields in the WHERE clauses are generated. The performance of these statements is, however, not yet optimized. In particular, the subroutines put\_node of a subtree of the structure represent nested SELECT loops, which should generally be avoided. Instead, the data read can be buffered in internal tables, for example, and passed from here to the application program using the PUT statement. The statement PUT node, however, should always be in a subroutine whose name starts with put\_node for technical reasons.

If the selections specify [dynamic selections](javascript:call_link\('abenldb_free_selections.htm'\)) or [field selections](javascript:call_link\('abenldb_field_selections.htm'\)) for a node, corresponding statements are generated in the subroutine put\_node and the SELECT statement created automatically is modified, as shown in the example for the node BKPF.

The subroutines before\_event, after\_event, and put\_ldb\_sp are created as a comment in the database program and can be modified and activated by deleting the asterisks. before\_event is called before the event specified in the parameter event is processed. after\_event is called after the event specified in the parameter event is processed. When a search help selection is made, put\_ldb\_sp is called to process the return values instead of put\_node for the root node.



**üìñ Source**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)

### abenreport_abexa.htm

> **üìñ Official SAP Documentation**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Linkage%20with%20a%20Program%2C%20ABENREPORT_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Linkage with a Program

This example demonstrates how a logical database is linked with an executable program.

Source Code ¬† 

REPORT demo\_report.
NODES: spfli, sflight, sbook.
DATA: weight¬†¬†¬†¬†¬†¬† TYPE p LENGTH 8 DECIMALS 4,
¬†¬†¬†¬†¬†¬†total\_weight TYPE p LENGTH 8 DECIMALS 4.
INITIALIZATION.
¬†¬†carrid-sign = 'I'.
¬†¬†carrid-option = 'EQ'.
¬†¬†carrid-low = 'AA'.
¬†¬†carrid-high = 'LH'.
¬†¬†APPEND carrid TO carrid.
START-OF-SELECTION.
¬†¬†WRITE 'Luggage weight of flights'.
GET spfli FIELDS carrid connid cityfrom cityto.
¬†¬†SKIP.
¬†¬†ULINE.
¬†¬†WRITE: / 'Carrid:', spfli-carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'Connid:', spfli-connid,
¬†¬†¬†¬†¬†¬†¬†¬† / 'From:¬†¬†', spfli-cityfrom,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'To:¬†¬†¬†¬†', spfli-cityto.
¬†¬†ULINE.
GET sflight FIELDS fldate.
¬†¬†SKIP.
¬†¬†WRITE: / 'Date:', sflight-fldate.
GET sbook FIELDS luggweight.
¬†¬†weight += sbook-luggweight.
GET sflight LATE FIELDS carrid .
¬†¬†WRITE: / 'Luggage weight =', weight.
¬†¬†total\_weight += weight.
¬†¬†weight = 0.
END-OF-SELECTION.
¬†¬†ULINE.
¬†¬†WRITE: / 'Sum of luggage weights =', total\_weight.

Description ¬† 

This example shows a typical report where the [logical database](javascript:call_link\('abenlogical_data_base_glosry.htm'\) "Glossary Entry") F1S is assigned to its properties.



**üìñ Source**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)

### abenlogical_database_abexa.htm

> **üìñ Official SAP Documentation**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Calls%20Using%20a%20Function%20Module%2C%20ABENLOGICAL_DATABASE_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvem
ent:)

LDB - Calls Using a Function Module

This example demonstrates calling a logical database using the function module LDB\_PROCESS.

Source Code ¬† 

REPORT demo\_logical\_database.
DATA wa\_spfli TYPE spfli.
SELECTION-SCREEN BEGIN OF SCREEN 1100.
SELECT-OPTIONS s\_carr FOR wa\_spfli-carrid.
SELECTION-SCREEN END OF SCREEN 1100.
CLASS demo DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
ENDCLASS.
CLASS demo IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA callback¬†¬†¬†¬†TYPE TABLE OF ldbcb.
¬†¬†¬†¬†DATA: seltab¬†¬†¬†¬†TYPE TABLE OF rsparams,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†seltab\_wa LIKE LINE OF seltab,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†scarr\_wa¬†¬†LIKE LINE OF s\_carr.
¬†¬†¬†¬†CALL SELECTION-SCREEN 1100 STARTING AT 10 10.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†callback = VALUE #( ( ldbnode¬†¬†¬†¬† = 'SPFLI'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get\_late¬†¬†¬†¬†= 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SPFLI' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( ldbnode¬†¬†¬†¬† = 'SFLIGHT'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SFLIGHT' ) ).
¬†¬†¬†¬†seltab\_wa-kind = 'S'.
¬†¬†¬†¬†seltab\_wa-selname = 'CARRID'.
¬†¬†¬†¬†LOOP AT s\_carr INTO scarr\_wa.
¬†¬†¬†¬†¬†¬†MOVE-CORRESPONDING scarr\_wa TO seltab\_wa.
¬†¬†¬†¬†¬†¬†APPEND seltab\_wa TO seltab.
¬†¬†¬†¬†ENDLOOP.
¬†¬†¬†¬†CALL FUNCTION 'LDB\_PROCESS'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†ldbname¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 'F1S'
¬†¬†¬†¬†¬†¬†¬†¬†variant¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = ' '
¬†¬†¬†¬†¬†¬†TABLES
¬†¬†¬†¬†¬†¬†¬†¬†callback¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= callback
¬†¬†¬†¬†¬†¬†¬†¬†selections¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= seltab
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Exception with SY-SUBRC', sy-subrc.
¬†¬†¬†¬†ENDIF.¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†demo=>main( ).
FORM callback\_spfli USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE spfli
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†CASE evt.
¬†¬†¬†¬†WHEN 'G'.
¬†¬†¬†¬†¬†¬†WRITE: / wa-carrid, wa-connid, wa-cityfrom, wa-cityto.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†¬†¬†WHEN 'L'.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†ENDCASE.
ENDFORM.
FORM callback\_sflight USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†WRITE: / wa-fldate, wa-seatsocc, wa-seatsmax.
ENDFORM.

Description ¬† 

The program reads data using the logical database F1S. First a program-specific selection screen is defined. The data object wa\_spfli is only required here. Next, suitable variables for the interface are declared.

The internal table callback is filled in such a way that, for the two nodes SPFLI and SFLIGHT, different callback routines in the calling program are called. For the node SPFLI, the corresponding routine for GET and GET LATE is only to be called for GET in the case of SFLIGHT.

The internal table seltab is filled with values from the selection table s\_carr of the standalone selection screen 1100 for the selections of node SPFLI.

The function module LDB\_PROCESS is called with these parameters.

The subroutines callback\_spfli and callback\_sflight are used as callback routines. Since the interface parameter wa is completely typed, the individual components of the work area can be accessed. In callback\_spfli, the events GET and GET LATE are handled differently.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Statements / LDB - Interface Work Areas

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Examples

Included pages: 6



**üìñ Source**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)

### abenldb_examples.htm

> **üìñ Official SAP Documentation**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Examples%2C%20ABENLDB_EXAMPLES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Examples

-   [Example of a logical database](javascript:call_link\('abenldb_example.htm'\))
-   [Example of selection include](javascript:call_link\('abenldb_selections_example.htm'\))
-   [Example of a database program](javascript:call_link\('abenldb_program_example.htm'\))
-   [Logical database, linked with a program](javascript:call_link\('abenreport_abexa.htm'\))
-   [Logical database, called by function module](javascript:call_link\('abenlogical_database_abexa.htm'\))

Continue
[LDB - Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\))
[LDB - Example of a Selection Include](javascript:call_link\('abenldb_selections_example.htm'\))
[LDB - Example of a Database Program](javascript:call_link\('abenldb_program_example.htm'\))
![Example](exa.gif "Example") [LDB - Linkage with a Program](javascript:call_link\('abenreport_abexa.htm'\))
![Example](exa.gif "Example") [LDB - Calls Using a Function Module](javascript:call_link\('abenlogical_database_abexa.htm'\))



**üìñ Source**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)

### abenldb_example.htm

> **üìñ Official SAP Documentation**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Logical%20Database%2C%20ABENLDB_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Example of a Logical Database

This example demonstrates all significant components of the imaginary logical database TEST\_LDB.

-   [Structure](#abenldb-example-1-------selections-in-the-selection-include---@ITOC@@ABENLDB_EXAMPLE_2)
-   [Database Program](#abenldb-example-3---structure-----lfa1------------lfb1--------------------------lfc1--------------------------bkpf--selections-in-the-selection-include-----select-options--slifnr---for-lfa1-lifnr------------------sbukrs---for-lfb1-bukrs------------------sgjahr---for-lfc1-gjahr------------------sbelnr---for-bkpf-belnr---database-program--------------------------------------------------------------------database-program-of-logical-database-test--ldb-------------------------------------------------------------program-sapdbtest--ldb-defining-database-test--ldb--nodes--lfa1---------lfb1---------lfc1---------bkpf-----------------------------------------------------------------initialize-selection-screen--processed-before-pbo--------------------------------------------------------------form-init-------endform-----------------------------------------------------------------pbo-of-selection-screen-------------------------------------------------------------form-pbo-------endform-----------------------------------------------------------------pai-of-selection-screen-------------------------------------------------------------form-pai-using-fname-mark----case-fname------when--slifnr-----------------when--sbukrs-----------------when--sgjahr-----------------when--sbelnr---------------endcase--endform-----------------------------------------------------------------raise-event-get-lfa1-------------------------------------------------------------form-put--lfa1----select----from-lfa1------------where-lifnr-in-slifnr INTO @lfa1.
¬†¬†¬†¬†PUT lfa1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfb1
\*-------------------------------------------------------\*
FORM put\_lfb1.
¬†¬†SELECT \* FROM lfb1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs IN @sbulrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @lfb1.
¬†¬†¬†¬†PUT lfb1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfc1
\*-------------------------------------------------------\*
FORM put\_lfc1.
¬†¬†SELECT \* FROM lfc1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO lfc1.
¬†¬†¬†¬†PUT lfc1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET bkpf
\*-------------------------------------------------------\*
FORM put\_bkpf.
¬†¬†SELECT \* FROM bkpf
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND belnr¬†¬†¬†¬†¬†¬†IN @sbelnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @bkpf.
¬†¬†¬†¬†PUT bkpf.
¬†¬†ENDSELECT.
ENDFORM.

The PROGRAM statement has the addition [DEFINING DATABASE test\_ldb](javascript:call_link\('abapreport_defining.htm'\)). This defines the link of the database program with the logical database TEST\_LDB.

The nodes of the structure are declared using the [NODES statement](javascript:call_link\('abapnodes.htm'\)). This creates the required interface work areas as table work areas. The statement [TABLES](javascript:call_link\('abaptables.htm'\)) can be used as a node in the same way for database tables. If the nodes are not database tables, they must be declared using NODES. The interface work areas are shared by the database program and a linked executable program or the function module LDB\_PROCESS and therefore become the interface used for passing data.

The selection screen can be initialized in the subroutines init and pbo.

The user input on the selection screen can be, for example, checked for authorizations in the subroutine pai. Other checks, such as plausibility or value range checks, are also possible here. If a check is negative, an error dialog can be programmed and the corresponding field can be initialized again.

The database tables are read in accordance with the selection criteria of the user and the associated GET events are raised in the subroutines put\_....

This program is only intended to demonstrate the principles of the structure of a logical database. It does not contain any methods for optimizing response times. The chronological order of the subroutine calls is determined by the structure of the logical database.



**üìñ Source**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)

### abenldb_selections_example.htm

> **üìñ Official SAP Documentation**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Selection%20Include%2C%20ABENLDB_SELECTIONS_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improve
ment:)

LDB - Example of a Selection Include

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). The generated proposal for the selection include is then as follows:

\*-----------------------------------------------------------\*
\* Include DBTEST\_LDBSEL
\* It will be automatically included into the database program
\*-----------------------------------------------------------\*
\* If the source is automatically generated,
\* perform the following steps:
\* 1. Replace ? by suitable names (at most 8 characters).
\* 2. Activate SELECT-OPTIONS and PARAMETERS (delete stars).
\* 3. Save source code.
\* 4. Edit database program.
\*
\* Hint : Syntax check is not possible within this include!
\* It will be checked during syntax check of database program.
\*-----------------------------------------------------------\*
\* SELECT-OPTIONS :¬†¬†?¬†¬†FOR LFA1-LIFNR.
\* Parameter for search pattern selection:
\* PARAMETERS p\_sp AS SEARCH PATTERN FOR TABLE LFA1.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-BUKRS.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-GJAHR.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BELNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-GJAHR.
\* Enable DYNAMIC SELECTIONS for selected nodes :
\* Enable FIELD SELECTION for selected nodes :

If the nodes LFA1 and LFB1 are defined for dynamic selections and the node LFC1 defined for field selections, the following additional program lines are generated:

SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFA1.
SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFB1.
SELECTION-SCREEN FIELD SELECTION FOR TABLE LFC1.

This automatically created selection include can be completed, for example, as follows:

\* Selection criteria:
¬†¬†SELECT-OPTIONS slifnr¬†¬†FOR lfa1-lifnr.
¬†¬†SELECT-OPTIONS sbukrs¬†¬†FOR lfb1-bukrs.
¬†¬†SELECT-OPTIONS sgjahr¬†¬†FOR flc1-gjahr.
¬†¬†SELECT-OPTIONS sbelnr¬†¬†FOR bkpf-belnr.
\* User-defined parameters:
¬†¬†PARAMETERS pstida LIKE sy-datum FOR NODE bkpf.
\* Dynamic selections for LFA1 and LFB1:
¬†¬†SELECTION-SCREEN DYNAMIC SELECTIONS FOR NODE: lfa1, lfb1.
\* Field selection for LFB1 and LFC1:
¬†¬†SELECTION-SCREEN FIELD SELECTION FOR NODE: lfb1, lfc1.

A selection is made from the available selection criteria and is given a name. The additional parameter pstida is declared and connected to the node BKPF. Dynamic selections are defined for the tablesLFA1 and LFB1. The tables LFB1 and LFC1 are defined for field selections.



**üìñ Source**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)

### abenldb_program_example.htm

> **üìñ Official SAP Documentation**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Database%20Program%2C%20ABENLDB_PROGRAM_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

LDB - Example of a Database Program

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). All nodes are database tables. Selections are defined in the selection include:

SELECT-OPTIONS SLIFNR¬†¬†FOR LFA1-LIFNR.
SELECT-OPTIONS SBUKRS¬†¬†FOR LFB1-BUKRS.
SELECT-OPTIONS SGJAHR¬†¬†FOR LFC1-GJAHR.
SELECT-OPTIONS SBELNR¬†¬†FOR BKPF-BELNR.

The generated proposal for the database program is then as follows:

Master Program SAPDBTEST\_LDB

\*----------------------------------------------------------\*
\*¬†¬†¬†¬†¬†¬†DATABASE PROGRAM OF LOGICAL DATABASE TEST\_LDB
\*----------------------------------------------------------\*
INCLUDE DBTEST\_LDBTOP.¬†¬†¬†¬† " header
INCLUDE DBTEST\_LDBXXX.¬†¬†¬†¬† " all system routines
\* INCLUDE DBTEST\_LDBF001.¬†¬†" user defined include

Include Program DBTEST\_LDBTOP

PROGRAM SAPDBTEST\_LDB DEFINING DATABASE TEST\_LDB.
TABLES: LFA1,
¬†¬†¬†¬†¬†¬†¬†¬† LFB1,
¬†¬†¬†¬†¬†¬†¬†¬† LFC1,
¬†¬†¬†¬†¬†¬†¬†¬† BKPF.
\* DATA: ...¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"user defined variables

Include Program DBTEST\_LDB001

\*----------------------------------------------------------\*
\* Call event GET LFA1
\*----------------------------------------------------------\*
FORM PUT\_LFA1.
\* SELECT \* FROM LFA1
\*¬†¬† INTO LFA1
\*¬†¬† INTO TABLE ? (choose one!)
\*¬†¬† WHERE LIFNR = ?.
¬†¬†¬†¬†PUT LFA1.
\* ENDSELECT.
ENDFORM.¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_LFA1
\*----------------------------------------------------------\*
\* Authority Check for node LFA1
\*----------------------------------------------------------\*
\* FORM AUTHORITY\_CHECK\_LFA1.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM.

Include Programs DBTEST\_LDB002 and DBTEST\_LDB003

Like DBTEST\_LDB001 for the nodes LFB1 and LFC1

Include Program DBTEST\_LDB004

\*----------------------------------------------------------\*
\* Call event GET BKPF
\*----------------------------------------------------------\*
FORM PUT\_BKPF.
\* STATICS FLAG.
\* IF FLAG = SPACE.
\*¬†¬† FLAG = 'X'.
\*\*\* Declarations for field selection for node BKPF \*\*\*
\*¬†¬† STATICS BKPF\_FIELDS TYPE RSFS\_TAB\_FIELDS.
\*¬†¬† MOVE 'BKPF' TO BKPF\_FIELDS-TABLENAME.
\*¬†¬† READ TABLE SELECT\_FIELDS WITH KEY BKPF\_FIELDS-TABLENAME
\*¬†¬†¬†¬† INTO BKPF\_FIELDS.
\* ENDIF.
\* SELECT (BKPF\_FIELDS-FIELDS) INTO CORRESPONDING FIELDS OF
\*¬†¬†¬†¬† BKPF / TABLE ? " (choose one of them)
\*¬†¬†¬†¬† FROM BKPF
\*¬†¬† WHERE BUKRS = LFB1-BUKRS
\*¬†¬†¬†¬† AND BELNR IN SBELNR
\*¬†¬†¬†¬† AND GJAHR = ?.
¬†¬†¬†¬†PUT BKPF.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_BKPF
\*----------------------------------------------------------\*
\* Authority Check for node BKPF
\*----------------------------------------------------------\*
\* FORM AUTHORITYCHECK\_BKPF.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AUTHORITY\_CHECK\_BKPF

Include Program DBTEST\_LDBFXXX

\*----------------------------------------------------------\*
\* BEFORE\_EVENT will be called before event EVENT
\* Possible values for EVENT: 'START-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM BEFORE\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'START-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "BEFORE\_EVENT
\*----------------------------------------------------------\*
\* AFTER\_EVENT will be called after event EVENT
\* Possible values for EVENT: 'END-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM AFTER\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'END-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AFTER\_EVENT
\*-----------------------------------------------------------\*
\* Initialize global data for multiple processing of
\* one logical database.
\* Set returncode:
\*¬†¬†¬†¬†¬†¬†0 -> all data are initialized, multiple processing o.k.
\*¬†¬†other -> no multiple processing allowed
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_INIT CHANGING SUBRC LIKE SY-SUBRC.
ENDFORM.¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_INIT
\*------------------------------------------------------------\*
\* LDB\_PROCESS\_CHECK\_SELECTIONS is called
\* after select-options and parameters are filled
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_CHECK\_SELECTIONS CHANGING SUBRC LIKE SY-SUBRC
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MSG LIKE SYMSG.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_CHECK\_SELECTIONS
\*----------------------------------------------------------\*
\* Initialize selection screen (processed before PBO)
\*----------------------------------------------------------\*
FORM INIT.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "INIT.
\*----------------------------------------------------------\*
\* PBO of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PBO.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PBO.
\*----------------------------------------------------------\*
\* PAI of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PAI USING FNAME MARK.
\* CASE FNAME.
\*¬†¬† WHEN 'SLIFNR¬†¬†'.
\*¬†¬† WHEN 'SBUKRS¬†¬†'.
\*¬†¬† WHEN 'SBELNR¬†¬†'.
\*¬†¬† WHEN 'SGJAHR¬†¬†'.
\*¬†¬† WHEN '\*'.
\*¬†¬† ENDCASE.
ENDFORM.¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PAI

Include Program DBTEST\_LDBSXXX

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (BEGIN OF BLOCK) !!!!!! \*
\*-----------------------------------------------------------\*
\* Data structures for search pattern selection
\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (END OF BLOCK) !!!!!!!! \*
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\*-----------------------------------------------------------\*
\* PUT\_TEST\_LDB\_SP.
\* Processed when search pattern selection is used,
\* i.e. user input into PARAMETERS p\_sp AS SEARCH PATTERN
\* STRUCTURE.
\*-----------------------------------------------------------\*
\* FORM PUT\_TEST\_LDB\_SP.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_EXAMPLE\_SP

The comment characters in front of ABAP statements that are to be used in addition to the mandatory statements can be deleted and the question marks can be replaced by appropriate expressions. The syntax check checks all include programs that match the naming conventions and also the selection include.

When the database is accessed in the subroutines put\_node, SELECT statements with conditions for the primary key fields in the WHERE clauses are generated. The performance of these statements is, however, not yet optimized. In particular, the subroutines put\_node of a subtree of the structure represent nested SELECT loops, which should generally be avoided. Instead, the data read can be buffered in internal tables, for example, and passed from here to the application program using the PUT statement. The statement PUT node, however, should always be in a subroutine whose name starts with put\_node for technical reasons.

If the selections specify [dynamic selections](javascript:call_link\('abenldb_free_selections.htm'\)) or [field selections](javascript:call_link\('abenldb_field_selections.htm'\)) for a node, corresponding statements are generated in the subroutine put\_node and the SELECT statement created automatically is modified, as shown in the example for the node BKPF.

The subroutines before\_event, after\_event, and put\_ldb\_sp are created as a comment in the database program and can be modified and activated by deleting the asterisks. before\_event is called before the event specified in the parameter event is processed. after\_event is called after the event specified in the parameter event is processed. When a search help selection is made, put\_ldb\_sp is called to process the return values instead of put\_node for the root node.



**üìñ Source**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)

### abenreport_abexa.htm

> **üìñ Official SAP Documentation**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Linkage%20with%20a%20Program%2C%20ABENREPORT_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Linkage with a Program

This example demonstrates how a logical database is linked with an executable program.

Source Code ¬† 

REPORT demo\_report.
NODES: spfli, sflight, sbook.
DATA: weight¬†¬†¬†¬†¬†¬† TYPE p LENGTH 8 DECIMALS 4,
¬†¬†¬†¬†¬†¬†total\_weight TYPE p LENGTH 8 DECIMALS 4.
INITIALIZATION.
¬†¬†carrid-sign = 'I'.
¬†¬†carrid-option = 'EQ'.
¬†¬†carrid-low = 'AA'.
¬†¬†carrid-high = 'LH'.
¬†¬†APPEND carrid TO carrid.
START-OF-SELECTION.
¬†¬†WRITE 'Luggage weight of flights'.
GET spfli FIELDS carrid connid cityfrom cityto.
¬†¬†SKIP.
¬†¬†ULINE.
¬†¬†WRITE: / 'Carrid:', spfli-carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'Connid:', spfli-connid,
¬†¬†¬†¬†¬†¬†¬†¬† / 'From:¬†¬†', spfli-cityfrom,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'To:¬†¬†¬†¬†', spfli-cityto.
¬†¬†ULINE.
GET sflight FIELDS fldate.
¬†¬†SKIP.
¬†¬†WRITE: / 'Date:', sflight-fldate.
GET sbook FIELDS luggweight.
¬†¬†weight += sbook-luggweight.
GET sflight LATE FIELDS carrid .
¬†¬†WRITE: / 'Luggage weight =', weight.
¬†¬†total\_weight += weight.
¬†¬†weight = 0.
END-OF-SELECTION.
¬†¬†ULINE.
¬†¬†WRITE: / 'Sum of luggage weights =', total\_weight.

Description ¬† 

This example shows a typical report where the [logical database](javascript:call_link\('abenlogical_data_base_glosry.htm'\) "Glossary Entry") F1S is assigned to its properties.



**üìñ Source**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)

### abenlogical_database_abexa.htm

> **üìñ Official SAP Documentation**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Calls%20Using%20a%20Function%20Module%2C%20ABENLOGICAL_DATABASE_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvem
ent:)

LDB - Calls Using a Function Module

This example demonstrates calling a logical database using the function module LDB\_PROCESS.

Source Code ¬† 

REPORT demo\_logical\_database.
DATA wa\_spfli TYPE spfli.
SELECTION-SCREEN BEGIN OF SCREEN 1100.
SELECT-OPTIONS s\_carr FOR wa\_spfli-carrid.
SELECTION-SCREEN END OF SCREEN 1100.
CLASS demo DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
ENDCLASS.
CLASS demo IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA callback¬†¬†¬†¬†TYPE TABLE OF ldbcb.
¬†¬†¬†¬†DATA: seltab¬†¬†¬†¬†TYPE TABLE OF rsparams,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†seltab\_wa LIKE LINE OF seltab,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†scarr\_wa¬†¬†LIKE LINE OF s\_carr.
¬†¬†¬†¬†CALL SELECTION-SCREEN 1100 STARTING AT 10 10.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†callback = VALUE #( ( ldbnode¬†¬†¬†¬† = 'SPFLI'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get\_late¬†¬†¬†¬†= 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SPFLI' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( ldbnode¬†¬†¬†¬† = 'SFLIGHT'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SFLIGHT' ) ).
¬†¬†¬†¬†seltab\_wa-kind = 'S'.
¬†¬†¬†¬†seltab\_wa-selname = 'CARRID'.
¬†¬†¬†¬†LOOP AT s\_carr INTO scarr\_wa.
¬†¬†¬†¬†¬†¬†MOVE-CORRESPONDING scarr\_wa TO seltab\_wa.
¬†¬†¬†¬†¬†¬†APPEND seltab\_wa TO seltab.
¬†¬†¬†¬†ENDLOOP.
¬†¬†¬†¬†CALL FUNCTION 'LDB\_PROCESS'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†ldbname¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 'F1S'
¬†¬†¬†¬†¬†¬†¬†¬†variant¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = ' '
¬†¬†¬†¬†¬†¬†TABLES
¬†¬†¬†¬†¬†¬†¬†¬†callback¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= callback
¬†¬†¬†¬†¬†¬†¬†¬†selections¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= seltab
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Exception with SY-SUBRC', sy-subrc.
¬†¬†¬†¬†ENDIF.¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†demo=>main( ).
FORM callback\_spfli USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE spfli
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†CASE evt.
¬†¬†¬†¬†WHEN 'G'.
¬†¬†¬†¬†¬†¬†WRITE: / wa-carrid, wa-connid, wa-cityfrom, wa-cityto.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†¬†¬†WHEN 'L'.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†ENDCASE.
ENDFORM.
FORM callback\_sflight USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†WRITE: / wa-fldate, wa-seatsocc, wa-seatsmax.
ENDFORM.

Description ¬† 

The program reads data using the logical database F1S. First a program-specific selection screen is defined. The data object wa\_spfli is only required here. Next, suitable variables for the interface are declared.

The internal table callback is filled in such a way that, for the two nodes SPFLI and SFLIGHT, different callback routines in the calling program are called. For the node SPFLI, the corresponding routine for GET and GET LATE is only to be called for GET in the case of SFLIGHT.

The internal table seltab is filled with values from the selection table s\_carr of the standalone selection screen 1100 for the selections of node SPFLI.

The function module LDB\_PROCESS is called with these parameters.

The subroutines callback\_spfli and callback\_sflight are used as callback routines. Since the interface parameter wa is completely typed, the individual components of the work area can be accessed. In callback\_spfli, the events GET and GET LATE are handled differently.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Statements / LDB - Statements in Logical Databases

**Files**: 11 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Examples

Included pages: 6



**üìñ Source**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)

### abenldb_examples.htm

> **üìñ Official SAP Documentation**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Examples%2C%20ABENLDB_EXAMPLES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Examples

-   [Example of a logical database](javascript:call_link\('abenldb_example.htm'\))
-   [Example of selection include](javascript:call_link\('abenldb_selections_example.htm'\))
-   [Example of a database program](javascript:call_link\('abenldb_program_example.htm'\))
-   [Logical database, linked with a program](javascript:call_link\('abenreport_abexa.htm'\))
-   [Logical database, called by function module](javascript:call_link\('abenlogical_database_abexa.htm'\))

Continue
[LDB - Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\))
[LDB - Example of a Selection Include](javascript:call_link\('abenldb_selections_example.htm'\))
[LDB - Example of a Database Program](javascript:call_link\('abenldb_program_example.htm'\))
![Example](exa.gif "Example") [LDB - Linkage with a Program](javascript:call_link\('abenreport_abexa.htm'\))
![Example](exa.gif "Example") [LDB - Calls Using a Function Module](javascript:call_link\('abenlogical_database_abexa.htm'\))



**üìñ Source**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)

### abenldb_example.htm

> **üìñ Official SAP Documentation**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Logical%20Database%2C%20ABENLDB_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Example of a Logical Database

This example demonstrates all significant components of the imaginary logical database TEST\_LDB.

-   [Structure](#abenldb-example-1-------selections-in-the-selection-include---@ITOC@@ABENLDB_EXAMPLE_2)
-   [Database Program](#abenldb-example-3---structure-----lfa1------------lfb1--------------------------lfc1--------------------------bkpf--selections-in-the-selection-include-----select-options--slifnr---for-lfa1-lifnr------------------sbukrs---for-lfb1-bukrs------------------sgjahr---for-lfc1-gjahr------------------sbelnr---for-bkpf-belnr---database-program--------------------------------------------------------------------database-program-of-logical-database-test--ldb-------------------------------------------------------------program-sapdbtest--ldb-defining-database-test--ldb--nodes--lfa1---------lfb1---------lfc1---------bkpf-----------------------------------------------------------------initialize-selection-screen--processed-before-pbo--------------------------------------------------------------form-init-------endform-----------------------------------------------------------------pbo-of-selection-screen-------------------------------------------------------------form-pbo-------endform-----------------------------------------------------------------pai-of-selection-screen-------------------------------------------------------------form-pai-using-fname-mark----case-fname------when--slifnr-----------------when--sbukrs-----------------when--sgjahr-----------------when--sbelnr---------------endcase--endform-----------------------------------------------------------------raise-event-get-lfa1-------------------------------------------------------------form-put--lfa1----select----from-lfa1------------where-lifnr-in-slifnr INTO @lfa1.
¬†¬†¬†¬†PUT lfa1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfb1
\*-------------------------------------------------------\*
FORM put\_lfb1.
¬†¬†SELECT \* FROM lfb1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs IN @sbulrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @lfb1.
¬†¬†¬†¬†PUT lfb1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfc1
\*-------------------------------------------------------\*
FORM put\_lfc1.
¬†¬†SELECT \* FROM lfc1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO lfc1.
¬†¬†¬†¬†PUT lfc1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET bkpf
\*-------------------------------------------------------\*
FORM put\_bkpf.
¬†¬†SELECT \* FROM bkpf
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND belnr¬†¬†¬†¬†¬†¬†IN @sbelnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @bkpf.
¬†¬†¬†¬†PUT bkpf.
¬†¬†ENDSELECT.
ENDFORM.

The PROGRAM statement has the addition [DEFINING DATABASE test\_ldb](javascript:call_link\('abapreport_defining.htm'\)). This defines the link of the database program with the logical database TEST\_LDB.

The nodes of the structure are declared using the [NODES statement](javascript:call_link\('abapnodes.htm'\)). This creates the required interface work areas as table work areas. The statement [TABLES](javascript:call_link\('abaptables.htm'\)) can be used as a node in the same way for database tables. If the nodes are not database tables, they must be declared using NODES. The interface work areas are shared by the database program and a linked executable program or the function module LDB\_PROCESS and therefore become the interface used for passing data.

The selection screen can be initialized in the subroutines init and pbo.

The user input on the selection screen can be, for example, checked for authorizations in the subroutine pai. Other checks, such as plausibility or value range checks, are also possible here. If a check is negative, an error dialog can be programmed and the corresponding field can be initialized again.

The database tables are read in accordance with the selection criteria of the user and the associated GET events are raised in the subroutines put\_....

This program is only intended to demonstrate the principles of the structure of a logical database. It does not contain any methods for optimizing response times. The chronological order of the subroutine calls is determined by the structure of the logical database.



**üìñ Source**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)

### abenldb_selections_example.htm

> **üìñ Official SAP Documentation**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Selection%20Include%2C%20ABENLDB_SELECTIONS_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improve
ment:)

LDB - Example of a Selection Include

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). The generated proposal for the selection include is then as follows:

\*-----------------------------------------------------------\*
\* Include DBTEST\_LDBSEL
\* It will be automatically included into the database program
\*-----------------------------------------------------------\*
\* If the source is automatically generated,
\* perform the following steps:
\* 1. Replace ? by suitable names (at most 8 characters).
\* 2. Activate SELECT-OPTIONS and PARAMETERS (delete stars).
\* 3. Save source code.
\* 4. Edit database program.
\*
\* Hint : Syntax check is not possible within this include!
\* It will be checked during syntax check of database program.
\*-----------------------------------------------------------\*
\* SELECT-OPTIONS :¬†¬†?¬†¬†FOR LFA1-LIFNR.
\* Parameter for search pattern selection:
\* PARAMETERS p\_sp AS SEARCH PATTERN FOR TABLE LFA1.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-BUKRS.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-GJAHR.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BELNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-GJAHR.
\* Enable DYNAMIC SELECTIONS for selected nodes :
\* Enable FIELD SELECTION for selected nodes :

If the nodes LFA1 and LFB1 are defined for dynamic selections and the node LFC1 defined for field selections, the following additional program lines are generated:

SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFA1.
SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFB1.
SELECTION-SCREEN FIELD SELECTION FOR TABLE LFC1.

This automatically created selection include can be completed, for example, as follows:

\* Selection criteria:
¬†¬†SELECT-OPTIONS slifnr¬†¬†FOR lfa1-lifnr.
¬†¬†SELECT-OPTIONS sbukrs¬†¬†FOR lfb1-bukrs.
¬†¬†SELECT-OPTIONS sgjahr¬†¬†FOR flc1-gjahr.
¬†¬†SELECT-OPTIONS sbelnr¬†¬†FOR bkpf-belnr.
\* User-defined parameters:
¬†¬†PARAMETERS pstida LIKE sy-datum FOR NODE bkpf.
\* Dynamic selections for LFA1 and LFB1:
¬†¬†SELECTION-SCREEN DYNAMIC SELECTIONS FOR NODE: lfa1, lfb1.
\* Field selection for LFB1 and LFC1:
¬†¬†SELECTION-SCREEN FIELD SELECTION FOR NODE: lfb1, lfc1.

A selection is made from the available selection criteria and is given a name. The additional parameter pstida is declared and connected to the node BKPF. Dynamic selections are defined for the tablesLFA1 and LFB1. The tables LFB1 and LFC1 are defined for field selections.



**üìñ Source**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)

### abenldb_program_example.htm

> **üìñ Official SAP Documentation**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Database%20Program%2C%20ABENLDB_PROGRAM_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

LDB - Example of a Database Program

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). All nodes are database tables. Selections are defined in the selection include:

SELECT-OPTIONS SLIFNR¬†¬†FOR LFA1-LIFNR.
SELECT-OPTIONS SBUKRS¬†¬†FOR LFB1-BUKRS.
SELECT-OPTIONS SGJAHR¬†¬†FOR LFC1-GJAHR.
SELECT-OPTIONS SBELNR¬†¬†FOR BKPF-BELNR.

The generated proposal for the database program is then as follows:

Master Program SAPDBTEST\_LDB

\*----------------------------------------------------------\*
\*¬†¬†¬†¬†¬†¬†DATABASE PROGRAM OF LOGICAL DATABASE TEST\_LDB
\*----------------------------------------------------------\*
INCLUDE DBTEST\_LDBTOP.¬†¬†¬†¬† " header
INCLUDE DBTEST\_LDBXXX.¬†¬†¬†¬† " all system routines
\* INCLUDE DBTEST\_LDBF001.¬†¬†" user defined include

Include Program DBTEST\_LDBTOP

PROGRAM SAPDBTEST\_LDB DEFINING DATABASE TEST\_LDB.
TABLES: LFA1,
¬†¬†¬†¬†¬†¬†¬†¬† LFB1,
¬†¬†¬†¬†¬†¬†¬†¬† LFC1,
¬†¬†¬†¬†¬†¬†¬†¬† BKPF.
\* DATA: ...¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"user defined variables

Include Program DBTEST\_LDB001

\*----------------------------------------------------------\*
\* Call event GET LFA1
\*----------------------------------------------------------\*
FORM PUT\_LFA1.
\* SELECT \* FROM LFA1
\*¬†¬† INTO LFA1
\*¬†¬† INTO TABLE ? (choose one!)
\*¬†¬† WHERE LIFNR = ?.
¬†¬†¬†¬†PUT LFA1.
\* ENDSELECT.
ENDFORM.¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_LFA1
\*----------------------------------------------------------\*
\* Authority Check for node LFA1
\*----------------------------------------------------------\*
\* FORM AUTHORITY\_CHECK\_LFA1.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM.

Include Programs DBTEST\_LDB002 and DBTEST\_LDB003

Like DBTEST\_LDB001 for the nodes LFB1 and LFC1

Include Program DBTEST\_LDB004

\*----------------------------------------------------------\*
\* Call event GET BKPF
\*----------------------------------------------------------\*
FORM PUT\_BKPF.
\* STATICS FLAG.
\* IF FLAG = SPACE.
\*¬†¬† FLAG = 'X'.
\*\*\* Declarations for field selection for node BKPF \*\*\*
\*¬†¬† STATICS BKPF\_FIELDS TYPE RSFS\_TAB\_FIELDS.
\*¬†¬† MOVE 'BKPF' TO BKPF\_FIELDS-TABLENAME.
\*¬†¬† READ TABLE SELECT\_FIELDS WITH KEY BKPF\_FIELDS-TABLENAME
\*¬†¬†¬†¬† INTO BKPF\_FIELDS.
\* ENDIF.
\* SELECT (BKPF\_FIELDS-FIELDS) INTO CORRESPONDING FIELDS OF
\*¬†¬†¬†¬† BKPF / TABLE ? " (choose one of them)
\*¬†¬†¬†¬† FROM BKPF
\*¬†¬† WHERE BUKRS = LFB1-BUKRS
\*¬†¬†¬†¬† AND BELNR IN SBELNR
\*¬†¬†¬†¬† AND GJAHR = ?.
¬†¬†¬†¬†PUT BKPF.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_BKPF
\*----------------------------------------------------------\*
\* Authority Check for node BKPF
\*----------------------------------------------------------\*
\* FORM AUTHORITYCHECK\_BKPF.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AUTHORITY\_CHECK\_BKPF

Include Program DBTEST\_LDBFXXX

\*----------------------------------------------------------\*
\* BEFORE\_EVENT will be called before event EVENT
\* Possible values for EVENT: 'START-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM BEFORE\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'START-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "BEFORE\_EVENT
\*----------------------------------------------------------\*
\* AFTER\_EVENT will be called after event EVENT
\* Possible values for EVENT: 'END-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM AFTER\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'END-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AFTER\_EVENT
\*-----------------------------------------------------------\*
\* Initialize global data for multiple processing of
\* one logical database.
\* Set returncode:
\*¬†¬†¬†¬†¬†¬†0 -> all data are initialized, multiple processing o.k.
\*¬†¬†other -> no multiple processing allowed
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_INIT CHANGING SUBRC LIKE SY-SUBRC.
ENDFORM.¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_INIT
\*------------------------------------------------------------\*
\* LDB\_PROCESS\_CHECK\_SELECTIONS is called
\* after select-options and parameters are filled
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_CHECK\_SELECTIONS CHANGING SUBRC LIKE SY-SUBRC
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MSG LIKE SYMSG.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_CHECK\_SELECTIONS
\*----------------------------------------------------------\*
\* Initialize selection screen (processed before PBO)
\*----------------------------------------------------------\*
FORM INIT.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "INIT.
\*----------------------------------------------------------\*
\* PBO of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PBO.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PBO.
\*----------------------------------------------------------\*
\* PAI of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PAI USING FNAME MARK.
\* CASE FNAME.
\*¬†¬† WHEN 'SLIFNR¬†¬†'.
\*¬†¬† WHEN 'SBUKRS¬†¬†'.
\*¬†¬† WHEN 'SBELNR¬†¬†'.
\*¬†¬† WHEN 'SGJAHR¬†¬†'.
\*¬†¬† WHEN '\*'.
\*¬†¬† ENDCASE.
ENDFORM.¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PAI

Include Program DBTEST\_LDBSXXX

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (BEGIN OF BLOCK) !!!!!! \*
\*-----------------------------------------------------------\*
\* Data structures for search pattern selection
\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (END OF BLOCK) !!!!!!!! \*
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\*-----------------------------------------------------------\*
\* PUT\_TEST\_LDB\_SP.
\* Processed when search pattern selection is used,
\* i.e. user input into PARAMETERS p\_sp AS SEARCH PATTERN
\* STRUCTURE.
\*-----------------------------------------------------------\*
\* FORM PUT\_TEST\_LDB\_SP.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_EXAMPLE\_SP

The comment characters in front of ABAP statements that are to be used in addition to the mandatory statements can be deleted and the question marks can be replaced by appropriate expressions. The syntax check checks all include programs that match the naming conventions and also the selection include.

When the database is accessed in the subroutines put\_node, SELECT statements with conditions for the primary key fields in the WHERE clauses are generated. The performance of these statements is, however, not yet optimized. In particular, the subroutines put\_node of a subtree of the structure represent nested SELECT loops, which should generally be avoided. Instead, the data read can be buffered in internal tables, for example, and passed from here to the application program using the PUT statement. The statement PUT node, however, should always be in a subroutine whose name starts with put\_node for technical reasons.

If the selections specify [dynamic selections](javascript:call_link\('abenldb_free_selections.htm'\)) or [field selections](javascript:call_link\('abenldb_field_selections.htm'\)) for a node, corresponding statements are generated in the subroutine put\_node and the SELECT statement created automatically is modified, as shown in the example for the node BKPF.

The subroutines before\_event, after\_event, and put\_ldb\_sp are created as a comment in the database program and can be modified and activated by deleting the asterisks. before\_event is called before the event specified in the parameter event is processed. after\_event is called after the event specified in the parameter event is processed. When a search help selection is made, put\_ldb\_sp is called to process the return values instead of put\_node for the root node.



**üìñ Source**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)

### abenreport_abexa.htm

> **üìñ Official SAP Documentation**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Linkage%20with%20a%20Program%2C%20ABENREPORT_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Linkage with a Program

This example demonstrates how a logical database is linked with an executable program.

Source Code ¬† 

REPORT demo\_report.
NODES: spfli, sflight, sbook.
DATA: weight¬†¬†¬†¬†¬†¬† TYPE p LENGTH 8 DECIMALS 4,
¬†¬†¬†¬†¬†¬†total\_weight TYPE p LENGTH 8 DECIMALS 4.
INITIALIZATION.
¬†¬†carrid-sign = 'I'.
¬†¬†carrid-option = 'EQ'.
¬†¬†carrid-low = 'AA'.
¬†¬†carrid-high = 'LH'.
¬†¬†APPEND carrid TO carrid.
START-OF-SELECTION.
¬†¬†WRITE 'Luggage weight of flights'.
GET spfli FIELDS carrid connid cityfrom cityto.
¬†¬†SKIP.
¬†¬†ULINE.
¬†¬†WRITE: / 'Carrid:', spfli-carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'Connid:', spfli-connid,
¬†¬†¬†¬†¬†¬†¬†¬† / 'From:¬†¬†', spfli-cityfrom,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'To:¬†¬†¬†¬†', spfli-cityto.
¬†¬†ULINE.
GET sflight FIELDS fldate.
¬†¬†SKIP.
¬†¬†WRITE: / 'Date:', sflight-fldate.
GET sbook FIELDS luggweight.
¬†¬†weight += sbook-luggweight.
GET sflight LATE FIELDS carrid .
¬†¬†WRITE: / 'Luggage weight =', weight.
¬†¬†total\_weight += weight.
¬†¬†weight = 0.
END-OF-SELECTION.
¬†¬†ULINE.
¬†¬†WRITE: / 'Sum of luggage weights =', total\_weight.

Description ¬† 

This example shows a typical report where the [logical database](javascript:call_link\('abenlogical_data_base_glosry.htm'\) "Glossary Entry") F1S is assigned to its properties.



**üìñ Source**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)

### abenlogical_database_abexa.htm

> **üìñ Official SAP Documentation**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Calls%20Using%20a%20Function%20Module%2C%20ABENLOGICAL_DATABASE_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvem
ent:)

LDB - Calls Using a Function Module

This example demonstrates calling a logical database using the function module LDB\_PROCESS.

Source Code ¬† 

REPORT demo\_logical\_database.
DATA wa\_spfli TYPE spfli.
SELECTION-SCREEN BEGIN OF SCREEN 1100.
SELECT-OPTIONS s\_carr FOR wa\_spfli-carrid.
SELECTION-SCREEN END OF SCREEN 1100.
CLASS demo DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
ENDCLASS.
CLASS demo IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA callback¬†¬†¬†¬†TYPE TABLE OF ldbcb.
¬†¬†¬†¬†DATA: seltab¬†¬†¬†¬†TYPE TABLE OF rsparams,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†seltab\_wa LIKE LINE OF seltab,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†scarr\_wa¬†¬†LIKE LINE OF s\_carr.
¬†¬†¬†¬†CALL SELECTION-SCREEN 1100 STARTING AT 10 10.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†callback = VALUE #( ( ldbnode¬†¬†¬†¬† = 'SPFLI'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get\_late¬†¬†¬†¬†= 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SPFLI' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( ldbnode¬†¬†¬†¬† = 'SFLIGHT'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SFLIGHT' ) ).
¬†¬†¬†¬†seltab\_wa-kind = 'S'.
¬†¬†¬†¬†seltab\_wa-selname = 'CARRID'.
¬†¬†¬†¬†LOOP AT s\_carr INTO scarr\_wa.
¬†¬†¬†¬†¬†¬†MOVE-CORRESPONDING scarr\_wa TO seltab\_wa.
¬†¬†¬†¬†¬†¬†APPEND seltab\_wa TO seltab.
¬†¬†¬†¬†ENDLOOP.
¬†¬†¬†¬†CALL FUNCTION 'LDB\_PROCESS'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†ldbname¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 'F1S'
¬†¬†¬†¬†¬†¬†¬†¬†variant¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = ' '
¬†¬†¬†¬†¬†¬†TABLES
¬†¬†¬†¬†¬†¬†¬†¬†callback¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= callback
¬†¬†¬†¬†¬†¬†¬†¬†selections¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= seltab
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Exception with SY-SUBRC', sy-subrc.
¬†¬†¬†¬†ENDIF.¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†demo=>main( ).
FORM callback\_spfli USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE spfli
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†CASE evt.
¬†¬†¬†¬†WHEN 'G'.
¬†¬†¬†¬†¬†¬†WRITE: / wa-carrid, wa-connid, wa-cityfrom, wa-cityto.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†¬†¬†WHEN 'L'.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†ENDCASE.
ENDFORM.
FORM callback\_sflight USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†WRITE: / wa-fldate, wa-seatsocc, wa-seatsmax.
ENDFORM.

Description ¬† 

The program reads data using the logical database F1S. First a program-specific selection screen is defined. The data object wa\_spfli is only required here. Next, suitable variables for the interface are declared.

The internal table callback is filled in such a way that, for the two nodes SPFLI and SFLIGHT, different callback routines in the calling program are called. For the node SPFLI, the corresponding routine for GET and GET LATE is only to be called for GET in the case of SFLIGHT.

The internal table seltab is filled with values from the selection table s\_carr of the standalone selection screen 1100 for the selections of node SPFLI.

The function module LDB\_PROCESS is called with these parameters.

The subroutines callback\_spfli and callback\_sflight are used as callback routines. Since the interface parameter wa is completely typed, the individual components of the work area can be accessed. In callback\_spfli, the events GET and GET LATE are handled differently.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Statements / LDB - Statements for Logical Databases

**Files**: 6 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Examples

Included pages: 6



**üìñ Source**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)

### abenldb_examples.htm

> **üìñ Official SAP Documentation**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Examples%2C%20ABENLDB_EXAMPLES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Examples

-   [Example of a logical database](javascript:call_link\('abenldb_example.htm'\))
-   [Example of selection include](javascript:call_link\('abenldb_selections_example.htm'\))
-   [Example of a database program](javascript:call_link\('abenldb_program_example.htm'\))
-   [Logical database, linked with a program](javascript:call_link\('abenreport_abexa.htm'\))
-   [Logical database, called by function module](javascript:call_link\('abenlogical_database_abexa.htm'\))

Continue
[LDB - Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\))
[LDB - Example of a Selection Include](javascript:call_link\('abenldb_selections_example.htm'\))
[LDB - Example of a Database Program](javascript:call_link\('abenldb_program_example.htm'\))
![Example](exa.gif "Example") [LDB - Linkage with a Program](javascript:call_link\('abenreport_abexa.htm'\))
![Example](exa.gif "Example") [LDB - Calls Using a Function Module](javascript:call_link\('abenlogical_database_abexa.htm'\))



**üìñ Source**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)

### abenldb_example.htm

> **üìñ Official SAP Documentation**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Logical%20Database%2C%20ABENLDB_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Example of a Logical Database

This example demonstrates all significant components of the imaginary logical database TEST\_LDB.

-   [Structure](#abenldb-example-1-------selections-in-the-selection-include---@ITOC@@ABENLDB_EXAMPLE_2)
-   [Database Program](#abenldb-example-3---structure-----lfa1------------lfb1--------------------------lfc1--------------------------bkpf--selections-in-the-selection-include-----select-options--slifnr---for-lfa1-lifnr------------------sbukrs---for-lfb1-bukrs------------------sgjahr---for-lfc1-gjahr------------------sbelnr---for-bkpf-belnr---database-program--------------------------------------------------------------------database-program-of-logical-database-test--ldb-------------------------------------------------------------program-sapdbtest--ldb-defining-database-test--ldb--nodes--lfa1---------lfb1---------lfc1---------bkpf-----------------------------------------------------------------initialize-selection-screen--processed-before-pbo--------------------------------------------------------------form-init-------endform-----------------------------------------------------------------pbo-of-selection-screen-------------------------------------------------------------form-pbo-------endform-----------------------------------------------------------------pai-of-selection-screen-------------------------------------------------------------form-pai-using-fname-mark----case-fname------when--slifnr-----------------when--sbukrs-----------------when--sgjahr-----------------when--sbelnr---------------endcase--endform-----------------------------------------------------------------raise-event-get-lfa1-------------------------------------------------------------form-put--lfa1----select----from-lfa1------------where-lifnr-in-slifnr INTO @lfa1.
¬†¬†¬†¬†PUT lfa1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfb1
\*-------------------------------------------------------\*
FORM put\_lfb1.
¬†¬†SELECT \* FROM lfb1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs IN @sbulrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @lfb1.
¬†¬†¬†¬†PUT lfb1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfc1
\*-------------------------------------------------------\*
FORM put\_lfc1.
¬†¬†SELECT \* FROM lfc1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO lfc1.
¬†¬†¬†¬†PUT lfc1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET bkpf
\*-------------------------------------------------------\*
FORM put\_bkpf.
¬†¬†SELECT \* FROM bkpf
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND belnr¬†¬†¬†¬†¬†¬†IN @sbelnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @bkpf.
¬†¬†¬†¬†PUT bkpf.
¬†¬†ENDSELECT.
ENDFORM.

The PROGRAM statement has the addition [DEFINING DATABASE test\_ldb](javascript:call_link\('abapreport_defining.htm'\)). This defines the link of the database program with the logical database TEST\_LDB.

The nodes of the structure are declared using the [NODES statement](javascript:call_link\('abapnodes.htm'\)). This creates the required interface work areas as table work areas. The statement [TABLES](javascript:call_link\('abaptables.htm'\)) can be used as a node in the same way for database tables. If the nodes are not database tables, they must be declared using NODES. The interface work areas are shared by the database program and a linked executable program or the function module LDB\_PROCESS and therefore become the interface used for passing data.

The selection screen can be initialized in the subroutines init and pbo.

The user input on the selection screen can be, for example, checked for authorizations in the subroutine pai. Other checks, such as plausibility or value range checks, are also possible here. If a check is negative, an error dialog can be programmed and the corresponding field can be initialized again.

The database tables are read in accordance with the selection criteria of the user and the associated GET events are raised in the subroutines put\_....

This program is only intended to demonstrate the principles of the structure of a logical database. It does not contain any methods for optimizing response times. The chronological order of the subroutine calls is determined by the structure of the logical database.



**üìñ Source**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)

### abenldb_selections_example.htm

> **üìñ Official SAP Documentation**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Selection%20Include%2C%20ABENLDB_SELECTIONS_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improve
ment:)

LDB - Example of a Selection Include

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). The generated proposal for the selection include is then as follows:

\*-----------------------------------------------------------\*
\* Include DBTEST\_LDBSEL
\* It will be automatically included into the database program
\*-----------------------------------------------------------\*
\* If the source is automatically generated,
\* perform the following steps:
\* 1. Replace ? by suitable names (at most 8 characters).
\* 2. Activate SELECT-OPTIONS and PARAMETERS (delete stars).
\* 3. Save source code.
\* 4. Edit database program.
\*
\* Hint : Syntax check is not possible within this include!
\* It will be checked during syntax check of database program.
\*-----------------------------------------------------------\*
\* SELECT-OPTIONS :¬†¬†?¬†¬†FOR LFA1-LIFNR.
\* Parameter for search pattern selection:
\* PARAMETERS p\_sp AS SEARCH PATTERN FOR TABLE LFA1.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-BUKRS.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-GJAHR.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BELNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-GJAHR.
\* Enable DYNAMIC SELECTIONS for selected nodes :
\* Enable FIELD SELECTION for selected nodes :

If the nodes LFA1 and LFB1 are defined for dynamic selections and the node LFC1 defined for field selections, the following additional program lines are generated:

SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFA1.
SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFB1.
SELECTION-SCREEN FIELD SELECTION FOR TABLE LFC1.

This automatically created selection include can be completed, for example, as follows:

\* Selection criteria:
¬†¬†SELECT-OPTIONS slifnr¬†¬†FOR lfa1-lifnr.
¬†¬†SELECT-OPTIONS sbukrs¬†¬†FOR lfb1-bukrs.
¬†¬†SELECT-OPTIONS sgjahr¬†¬†FOR flc1-gjahr.
¬†¬†SELECT-OPTIONS sbelnr¬†¬†FOR bkpf-belnr.
\* User-defined parameters:
¬†¬†PARAMETERS pstida LIKE sy-datum FOR NODE bkpf.
\* Dynamic selections for LFA1 and LFB1:
¬†¬†SELECTION-SCREEN DYNAMIC SELECTIONS FOR NODE: lfa1, lfb1.
\* Field selection for LFB1 and LFC1:
¬†¬†SELECTION-SCREEN FIELD SELECTION FOR NODE: lfb1, lfc1.

A selection is made from the available selection criteria and is given a name. The additional parameter pstida is declared and connected to the node BKPF. Dynamic selections are defined for the tablesLFA1 and LFB1. The tables LFB1 and LFC1 are defined for field selections.



**üìñ Source**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)

### abenldb_program_example.htm

> **üìñ Official SAP Documentation**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Database%20Program%2C%20ABENLDB_PROGRAM_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

LDB - Example of a Database Program

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). All nodes are database tables. Selections are defined in the selection include:

SELECT-OPTIONS SLIFNR¬†¬†FOR LFA1-LIFNR.
SELECT-OPTIONS SBUKRS¬†¬†FOR LFB1-BUKRS.
SELECT-OPTIONS SGJAHR¬†¬†FOR LFC1-GJAHR.
SELECT-OPTIONS SBELNR¬†¬†FOR BKPF-BELNR.

The generated proposal for the database program is then as follows:

Master Program SAPDBTEST\_LDB

\*----------------------------------------------------------\*
\*¬†¬†¬†¬†¬†¬†DATABASE PROGRAM OF LOGICAL DATABASE TEST\_LDB
\*----------------------------------------------------------\*
INCLUDE DBTEST\_LDBTOP.¬†¬†¬†¬† " header
INCLUDE DBTEST\_LDBXXX.¬†¬†¬†¬† " all system routines
\* INCLUDE DBTEST\_LDBF001.¬†¬†" user defined include

Include Program DBTEST\_LDBTOP

PROGRAM SAPDBTEST\_LDB DEFINING DATABASE TEST\_LDB.
TABLES: LFA1,
¬†¬†¬†¬†¬†¬†¬†¬† LFB1,
¬†¬†¬†¬†¬†¬†¬†¬† LFC1,
¬†¬†¬†¬†¬†¬†¬†¬† BKPF.
\* DATA: ...¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"user defined variables

Include Program DBTEST\_LDB001

\*----------------------------------------------------------\*
\* Call event GET LFA1
\*----------------------------------------------------------\*
FORM PUT\_LFA1.
\* SELECT \* FROM LFA1
\*¬†¬† INTO LFA1
\*¬†¬† INTO TABLE ? (choose one!)
\*¬†¬† WHERE LIFNR = ?.
¬†¬†¬†¬†PUT LFA1.
\* ENDSELECT.
ENDFORM.¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_LFA1
\*----------------------------------------------------------\*
\* Authority Check for node LFA1
\*----------------------------------------------------------\*
\* FORM AUTHORITY\_CHECK\_LFA1.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM.

Include Programs DBTEST\_LDB002 and DBTEST\_LDB003

Like DBTEST\_LDB001 for the nodes LFB1 and LFC1

Include Program DBTEST\_LDB004

\*----------------------------------------------------------\*
\* Call event GET BKPF
\*----------------------------------------------------------\*
FORM PUT\_BKPF.
\* STATICS FLAG.
\* IF FLAG = SPACE.
\*¬†¬† FLAG = 'X'.
\*\*\* Declarations for field selection for node BKPF \*\*\*
\*¬†¬† STATICS BKPF\_FIELDS TYPE RSFS\_TAB\_FIELDS.
\*¬†¬† MOVE 'BKPF' TO BKPF\_FIELDS-TABLENAME.
\*¬†¬† READ TABLE SELECT\_FIELDS WITH KEY BKPF\_FIELDS-TABLENAME
\*¬†¬†¬†¬† INTO BKPF\_FIELDS.
\* ENDIF.
\* SELECT (BKPF\_FIELDS-FIELDS) INTO CORRESPONDING FIELDS OF
\*¬†¬†¬†¬† BKPF / TABLE ? " (choose one of them)
\*¬†¬†¬†¬† FROM BKPF
\*¬†¬† WHERE BUKRS = LFB1-BUKRS
\*¬†¬†¬†¬† AND BELNR IN SBELNR
\*¬†¬†¬†¬† AND GJAHR = ?.
¬†¬†¬†¬†PUT BKPF.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_BKPF
\*----------------------------------------------------------\*
\* Authority Check for node BKPF
\*----------------------------------------------------------\*
\* FORM AUTHORITYCHECK\_BKPF.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AUTHORITY\_CHECK\_BKPF

Include Program DBTEST\_LDBFXXX

\*----------------------------------------------------------\*
\* BEFORE\_EVENT will be called before event EVENT
\* Possible values for EVENT: 'START-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM BEFORE\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'START-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "BEFORE\_EVENT
\*----------------------------------------------------------\*
\* AFTER\_EVENT will be called after event EVENT
\* Possible values for EVENT: 'END-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM AFTER\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'END-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AFTER\_EVENT
\*-----------------------------------------------------------\*
\* Initialize global data for multiple processing of
\* one logical database.
\* Set returncode:
\*¬†¬†¬†¬†¬†¬†0 -> all data are initialized, multiple processing o.k.
\*¬†¬†other -> no multiple processing allowed
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_INIT CHANGING SUBRC LIKE SY-SUBRC.
ENDFORM.¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_INIT
\*------------------------------------------------------------\*
\* LDB\_PROCESS\_CHECK\_SELECTIONS is called
\* after select-options and parameters are filled
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_CHECK\_SELECTIONS CHANGING SUBRC LIKE SY-SUBRC
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MSG LIKE SYMSG.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_CHECK\_SELECTIONS
\*----------------------------------------------------------\*
\* Initialize selection screen (processed before PBO)
\*----------------------------------------------------------\*
FORM INIT.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "INIT.
\*----------------------------------------------------------\*
\* PBO of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PBO.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PBO.
\*----------------------------------------------------------\*
\* PAI of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PAI USING FNAME MARK.
\* CASE FNAME.
\*¬†¬† WHEN 'SLIFNR¬†¬†'.
\*¬†¬† WHEN 'SBUKRS¬†¬†'.
\*¬†¬† WHEN 'SBELNR¬†¬†'.
\*¬†¬† WHEN 'SGJAHR¬†¬†'.
\*¬†¬† WHEN '\*'.
\*¬†¬† ENDCASE.
ENDFORM.¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PAI

Include Program DBTEST\_LDBSXXX

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (BEGIN OF BLOCK) !!!!!! \*
\*-----------------------------------------------------------\*
\* Data structures for search pattern selection
\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (END OF BLOCK) !!!!!!!! \*
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\*-----------------------------------------------------------\*
\* PUT\_TEST\_LDB\_SP.
\* Processed when search pattern selection is used,
\* i.e. user input into PARAMETERS p\_sp AS SEARCH PATTERN
\* STRUCTURE.
\*-----------------------------------------------------------\*
\* FORM PUT\_TEST\_LDB\_SP.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_EXAMPLE\_SP

The comment characters in front of ABAP statements that are to be used in addition to the mandatory statements can be deleted and the question marks can be replaced by appropriate expressions. The syntax check checks all include programs that match the naming conventions and also the selection include.

When the database is accessed in the subroutines put\_node, SELECT statements with conditions for the primary key fields in the WHERE clauses are generated. The performance of these statements is, however, not yet optimized. In particular, the subroutines put\_node of a subtree of the structure represent nested SELECT loops, which should generally be avoided. Instead, the data read can be buffered in internal tables, for example, and passed from here to the application program using the PUT statement. The statement PUT node, however, should always be in a subroutine whose name starts with put\_node for technical reasons.

If the selections specify [dynamic selections](javascript:call_link\('abenldb_free_selections.htm'\)) or [field selections](javascript:call_link\('abenldb_field_selections.htm'\)) for a node, corresponding statements are generated in the subroutine put\_node and the SELECT statement created automatically is modified, as shown in the example for the node BKPF.

The subroutines before\_event, after\_event, and put\_ldb\_sp are created as a comment in the database program and can be modified and activated by deleting the asterisks. before\_event is called before the event specified in the parameter event is processed. after\_event is called after the event specified in the parameter event is processed. When a search help selection is made, put\_ldb\_sp is called to process the return values instead of put\_node for the root node.



**üìñ Source**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)

### abenreport_abexa.htm

> **üìñ Official SAP Documentation**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Linkage%20with%20a%20Program%2C%20ABENREPORT_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Linkage with a Program

This example demonstrates how a logical database is linked with an executable program.

Source Code ¬† 

REPORT demo\_report.
NODES: spfli, sflight, sbook.
DATA: weight¬†¬†¬†¬†¬†¬† TYPE p LENGTH 8 DECIMALS 4,
¬†¬†¬†¬†¬†¬†total\_weight TYPE p LENGTH 8 DECIMALS 4.
INITIALIZATION.
¬†¬†carrid-sign = 'I'.
¬†¬†carrid-option = 'EQ'.
¬†¬†carrid-low = 'AA'.
¬†¬†carrid-high = 'LH'.
¬†¬†APPEND carrid TO carrid.
START-OF-SELECTION.
¬†¬†WRITE 'Luggage weight of flights'.
GET spfli FIELDS carrid connid cityfrom cityto.
¬†¬†SKIP.
¬†¬†ULINE.
¬†¬†WRITE: / 'Carrid:', spfli-carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'Connid:', spfli-connid,
¬†¬†¬†¬†¬†¬†¬†¬† / 'From:¬†¬†', spfli-cityfrom,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'To:¬†¬†¬†¬†', spfli-cityto.
¬†¬†ULINE.
GET sflight FIELDS fldate.
¬†¬†SKIP.
¬†¬†WRITE: / 'Date:', sflight-fldate.
GET sbook FIELDS luggweight.
¬†¬†weight += sbook-luggweight.
GET sflight LATE FIELDS carrid .
¬†¬†WRITE: / 'Luggage weight =', weight.
¬†¬†total\_weight += weight.
¬†¬†weight = 0.
END-OF-SELECTION.
¬†¬†ULINE.
¬†¬†WRITE: / 'Sum of luggage weights =', total\_weight.

Description ¬† 

This example shows a typical report where the [logical database](javascript:call_link\('abenlogical_data_base_glosry.htm'\) "Glossary Entry") F1S is assigned to its properties.



**üìñ Source**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)

### abenlogical_database_abexa.htm

> **üìñ Official SAP Documentation**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Calls%20Using%20a%20Function%20Module%2C%20ABENLOGICAL_DATABASE_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvem
ent:)

LDB - Calls Using a Function Module

This example demonstrates calling a logical database using the function module LDB\_PROCESS.

Source Code ¬† 

REPORT demo\_logical\_database.
DATA wa\_spfli TYPE spfli.
SELECTION-SCREEN BEGIN OF SCREEN 1100.
SELECT-OPTIONS s\_carr FOR wa\_spfli-carrid.
SELECTION-SCREEN END OF SCREEN 1100.
CLASS demo DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
ENDCLASS.
CLASS demo IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA callback¬†¬†¬†¬†TYPE TABLE OF ldbcb.
¬†¬†¬†¬†DATA: seltab¬†¬†¬†¬†TYPE TABLE OF rsparams,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†seltab\_wa LIKE LINE OF seltab,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†scarr\_wa¬†¬†LIKE LINE OF s\_carr.
¬†¬†¬†¬†CALL SELECTION-SCREEN 1100 STARTING AT 10 10.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†callback = VALUE #( ( ldbnode¬†¬†¬†¬† = 'SPFLI'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get\_late¬†¬†¬†¬†= 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SPFLI' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( ldbnode¬†¬†¬†¬† = 'SFLIGHT'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SFLIGHT' ) ).
¬†¬†¬†¬†seltab\_wa-kind = 'S'.
¬†¬†¬†¬†seltab\_wa-selname = 'CARRID'.
¬†¬†¬†¬†LOOP AT s\_carr INTO scarr\_wa.
¬†¬†¬†¬†¬†¬†MOVE-CORRESPONDING scarr\_wa TO seltab\_wa.
¬†¬†¬†¬†¬†¬†APPEND seltab\_wa TO seltab.
¬†¬†¬†¬†ENDLOOP.
¬†¬†¬†¬†CALL FUNCTION 'LDB\_PROCESS'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†ldbname¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 'F1S'
¬†¬†¬†¬†¬†¬†¬†¬†variant¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = ' '
¬†¬†¬†¬†¬†¬†TABLES
¬†¬†¬†¬†¬†¬†¬†¬†callback¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= callback
¬†¬†¬†¬†¬†¬†¬†¬†selections¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= seltab
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Exception with SY-SUBRC', sy-subrc.
¬†¬†¬†¬†ENDIF.¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†demo=>main( ).
FORM callback\_spfli USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE spfli
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†CASE evt.
¬†¬†¬†¬†WHEN 'G'.
¬†¬†¬†¬†¬†¬†WRITE: / wa-carrid, wa-connid, wa-cityfrom, wa-cityto.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†¬†¬†WHEN 'L'.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†ENDCASE.
ENDFORM.
FORM callback\_sflight USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†WRITE: / wa-fldate, wa-seatsocc, wa-seatsmax.
ENDFORM.

Description ¬† 

The program reads data using the logical database F1S. First a program-specific selection screen is defined. The data object wa\_spfli is only required here. Next, suitable variables for the interface are declared.

The internal table callback is filled in such a way that, for the two nodes SPFLI and SFLIGHT, different callback routines in the calling program are called. For the node SPFLI, the corresponding routine for GET and GET LATE is only to be called for GET in the case of SFLIGHT.

The internal table seltab is filled with values from the selection table s\_carr of the standalone selection screen 1100 for the selections of node SPFLI.

The function module LDB\_PROCESS is called with these parameters.

The subroutines callback\_spfli and callback\_sflight are used as callback routines. Since the interface parameter wa is completely typed, the individual components of the work area can be accessed. In callback\_spfli, the events GET and GET LATE are handled differently.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Use

**Files**: 3 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Examples

Included pages: 6



**üìñ Source**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)

### abenldb_examples.htm

> **üìñ Official SAP Documentation**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Examples%2C%20ABENLDB_EXAMPLES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Examples

-   [Example of a logical database](javascript:call_link\('abenldb_example.htm'\))
-   [Example of selection include](javascript:call_link\('abenldb_selections_example.htm'\))
-   [Example of a database program](javascript:call_link\('abenldb_program_example.htm'\))
-   [Logical database, linked with a program](javascript:call_link\('abenreport_abexa.htm'\))
-   [Logical database, called by function module](javascript:call_link\('abenlogical_database_abexa.htm'\))

Continue
[LDB - Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\))
[LDB - Example of a Selection Include](javascript:call_link\('abenldb_selections_example.htm'\))
[LDB - Example of a Database Program](javascript:call_link\('abenldb_program_example.htm'\))
![Example](exa.gif "Example") [LDB - Linkage with a Program](javascript:call_link\('abenreport_abexa.htm'\))
![Example](exa.gif "Example") [LDB - Calls Using a Function Module](javascript:call_link\('abenlogical_database_abexa.htm'\))



**üìñ Source**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)

### abenldb_example.htm

> **üìñ Official SAP Documentation**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Logical%20Database%2C%20ABENLDB_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Example of a Logical Database

This example demonstrates all significant components of the imaginary logical database TEST\_LDB.

-   [Structure](#abenldb-example-1-------selections-in-the-selection-include---@ITOC@@ABENLDB_EXAMPLE_2)
-   [Database Program](#abenldb-example-3---structure-----lfa1------------lfb1--------------------------lfc1--------------------------bkpf--selections-in-the-selection-include-----select-options--slifnr---for-lfa1-lifnr------------------sbukrs---for-lfb1-bukrs------------------sgjahr---for-lfc1-gjahr------------------sbelnr---for-bkpf-belnr---database-program--------------------------------------------------------------------database-program-of-logical-database-test--ldb-------------------------------------------------------------program-sapdbtest--ldb-defining-database-test--ldb--nodes--lfa1---------lfb1---------lfc1---------bkpf-----------------------------------------------------------------initialize-selection-screen--processed-before-pbo--------------------------------------------------------------form-init-------endform-----------------------------------------------------------------pbo-of-selection-screen-------------------------------------------------------------form-pbo-------endform-----------------------------------------------------------------pai-of-selection-screen-------------------------------------------------------------form-pai-using-fname-mark----case-fname------when--slifnr-----------------when--sbukrs-----------------when--sgjahr-----------------when--sbelnr---------------endcase--endform-----------------------------------------------------------------raise-event-get-lfa1-------------------------------------------------------------form-put--lfa1----select----from-lfa1------------where-lifnr-in-slifnr INTO @lfa1.
¬†¬†¬†¬†PUT lfa1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfb1
\*-------------------------------------------------------\*
FORM put\_lfb1.
¬†¬†SELECT \* FROM lfb1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs IN @sbulrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @lfb1.
¬†¬†¬†¬†PUT lfb1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfc1
\*-------------------------------------------------------\*
FORM put\_lfc1.
¬†¬†SELECT \* FROM lfc1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO lfc1.
¬†¬†¬†¬†PUT lfc1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET bkpf
\*-------------------------------------------------------\*
FORM put\_bkpf.
¬†¬†SELECT \* FROM bkpf
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND belnr¬†¬†¬†¬†¬†¬†IN @sbelnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @bkpf.
¬†¬†¬†¬†PUT bkpf.
¬†¬†ENDSELECT.
ENDFORM.

The PROGRAM statement has the addition [DEFINING DATABASE test\_ldb](javascript:call_link\('abapreport_defining.htm'\)). This defines the link of the database program with the logical database TEST\_LDB.

The nodes of the structure are declared using the [NODES statement](javascript:call_link\('abapnodes.htm'\)). This creates the required interface work areas as table work areas. The statement [TABLES](javascript:call_link\('abaptables.htm'\)) can be used as a node in the same way for database tables. If the nodes are not database tables, they must be declared using NODES. The interface work areas are shared by the database program and a linked executable program or the function module LDB\_PROCESS and therefore become the interface used for passing data.

The selection screen can be initialized in the subroutines init and pbo.

The user input on the selection screen can be, for example, checked for authorizations in the subroutine pai. Other checks, such as plausibility or value range checks, are also possible here. If a check is negative, an error dialog can be programmed and the corresponding field can be initialized again.

The database tables are read in accordance with the selection criteria of the user and the associated GET events are raised in the subroutines put\_....

This program is only intended to demonstrate the principles of the structure of a logical database. It does not contain any methods for optimizing response times. The chronological order of the subroutine calls is determined by the structure of the logical database.



**üìñ Source**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)

### abenldb_selections_example.htm

> **üìñ Official SAP Documentation**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Selection%20Include%2C%20ABENLDB_SELECTIONS_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improve
ment:)

LDB - Example of a Selection Include

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). The generated proposal for the selection include is then as follows:

\*-----------------------------------------------------------\*
\* Include DBTEST\_LDBSEL
\* It will be automatically included into the database program
\*-----------------------------------------------------------\*
\* If the source is automatically generated,
\* perform the following steps:
\* 1. Replace ? by suitable names (at most 8 characters).
\* 2. Activate SELECT-OPTIONS and PARAMETERS (delete stars).
\* 3. Save source code.
\* 4. Edit database program.
\*
\* Hint : Syntax check is not possible within this include!
\* It will be checked during syntax check of database program.
\*-----------------------------------------------------------\*
\* SELECT-OPTIONS :¬†¬†?¬†¬†FOR LFA1-LIFNR.
\* Parameter for search pattern selection:
\* PARAMETERS p\_sp AS SEARCH PATTERN FOR TABLE LFA1.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-BUKRS.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-GJAHR.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BELNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-GJAHR.
\* Enable DYNAMIC SELECTIONS for selected nodes :
\* Enable FIELD SELECTION for selected nodes :

If the nodes LFA1 and LFB1 are defined for dynamic selections and the node LFC1 defined for field selections, the following additional program lines are generated:

SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFA1.
SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFB1.
SELECTION-SCREEN FIELD SELECTION FOR TABLE LFC1.

This automatically created selection include can be completed, for example, as follows:

\* Selection criteria:
¬†¬†SELECT-OPTIONS slifnr¬†¬†FOR lfa1-lifnr.
¬†¬†SELECT-OPTIONS sbukrs¬†¬†FOR lfb1-bukrs.
¬†¬†SELECT-OPTIONS sgjahr¬†¬†FOR flc1-gjahr.
¬†¬†SELECT-OPTIONS sbelnr¬†¬†FOR bkpf-belnr.
\* User-defined parameters:
¬†¬†PARAMETERS pstida LIKE sy-datum FOR NODE bkpf.
\* Dynamic selections for LFA1 and LFB1:
¬†¬†SELECTION-SCREEN DYNAMIC SELECTIONS FOR NODE: lfa1, lfb1.
\* Field selection for LFB1 and LFC1:
¬†¬†SELECTION-SCREEN FIELD SELECTION FOR NODE: lfb1, lfc1.

A selection is made from the available selection criteria and is given a name. The additional parameter pstida is declared and connected to the node BKPF. Dynamic selections are defined for the tablesLFA1 and LFB1. The tables LFB1 and LFC1 are defined for field selections.



**üìñ Source**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)

### abenldb_program_example.htm

> **üìñ Official SAP Documentation**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Database%20Program%2C%20ABENLDB_PROGRAM_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

LDB - Example of a Database Program

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). All nodes are database tables. Selections are defined in the selection include:

SELECT-OPTIONS SLIFNR¬†¬†FOR LFA1-LIFNR.
SELECT-OPTIONS SBUKRS¬†¬†FOR LFB1-BUKRS.
SELECT-OPTIONS SGJAHR¬†¬†FOR LFC1-GJAHR.
SELECT-OPTIONS SBELNR¬†¬†FOR BKPF-BELNR.

The generated proposal for the database program is then as follows:

Master Program SAPDBTEST\_LDB

\*----------------------------------------------------------\*
\*¬†¬†¬†¬†¬†¬†DATABASE PROGRAM OF LOGICAL DATABASE TEST\_LDB
\*----------------------------------------------------------\*
INCLUDE DBTEST\_LDBTOP.¬†¬†¬†¬† " header
INCLUDE DBTEST\_LDBXXX.¬†¬†¬†¬† " all system routines
\* INCLUDE DBTEST\_LDBF001.¬†¬†" user defined include

Include Program DBTEST\_LDBTOP

PROGRAM SAPDBTEST\_LDB DEFINING DATABASE TEST\_LDB.
TABLES: LFA1,
¬†¬†¬†¬†¬†¬†¬†¬† LFB1,
¬†¬†¬†¬†¬†¬†¬†¬† LFC1,
¬†¬†¬†¬†¬†¬†¬†¬† BKPF.
\* DATA: ...¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"user defined variables

Include Program DBTEST\_LDB001

\*----------------------------------------------------------\*
\* Call event GET LFA1
\*----------------------------------------------------------\*
FORM PUT\_LFA1.
\* SELECT \* FROM LFA1
\*¬†¬† INTO LFA1
\*¬†¬† INTO TABLE ? (choose one!)
\*¬†¬† WHERE LIFNR = ?.
¬†¬†¬†¬†PUT LFA1.
\* ENDSELECT.
ENDFORM.¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_LFA1
\*----------------------------------------------------------\*
\* Authority Check for node LFA1
\*----------------------------------------------------------\*
\* FORM AUTHORITY\_CHECK\_LFA1.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM.

Include Programs DBTEST\_LDB002 and DBTEST\_LDB003

Like DBTEST\_LDB001 for the nodes LFB1 and LFC1

Include Program DBTEST\_LDB004

\*----------------------------------------------------------\*
\* Call event GET BKPF
\*----------------------------------------------------------\*
FORM PUT\_BKPF.
\* STATICS FLAG.
\* IF FLAG = SPACE.
\*¬†¬† FLAG = 'X'.
\*\*\* Declarations for field selection for node BKPF \*\*\*
\*¬†¬† STATICS BKPF\_FIELDS TYPE RSFS\_TAB\_FIELDS.
\*¬†¬† MOVE 'BKPF' TO BKPF\_FIELDS-TABLENAME.
\*¬†¬† READ TABLE SELECT\_FIELDS WITH KEY BKPF\_FIELDS-TABLENAME
\*¬†¬†¬†¬† INTO BKPF\_FIELDS.
\* ENDIF.
\* SELECT (BKPF\_FIELDS-FIELDS) INTO CORRESPONDING FIELDS OF
\*¬†¬†¬†¬† BKPF / TABLE ? " (choose one of them)
\*¬†¬†¬†¬† FROM BKPF
\*¬†¬† WHERE BUKRS = LFB1-BUKRS
\*¬†¬†¬†¬† AND BELNR IN SBELNR
\*¬†¬†¬†¬† AND GJAHR = ?.
¬†¬†¬†¬†PUT BKPF.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_BKPF
\*----------------------------------------------------------\*
\* Authority Check for node BKPF
\*----------------------------------------------------------\*
\* FORM AUTHORITYCHECK\_BKPF.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AUTHORITY\_CHECK\_BKPF

Include Program DBTEST\_LDBFXXX

\*----------------------------------------------------------\*
\* BEFORE\_EVENT will be called before event EVENT
\* Possible values for EVENT: 'START-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM BEFORE\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'START-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "BEFORE\_EVENT
\*----------------------------------------------------------\*
\* AFTER\_EVENT will be called after event EVENT
\* Possible values for EVENT: 'END-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM AFTER\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'END-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AFTER\_EVENT
\*-----------------------------------------------------------\*
\* Initialize global data for multiple processing of
\* one logical database.
\* Set returncode:
\*¬†¬†¬†¬†¬†¬†0 -> all data are initialized, multiple processing o.k.
\*¬†¬†other -> no multiple processing allowed
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_INIT CHANGING SUBRC LIKE SY-SUBRC.
ENDFORM.¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_INIT
\*------------------------------------------------------------\*
\* LDB\_PROCESS\_CHECK\_SELECTIONS is called
\* after select-options and parameters are filled
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_CHECK\_SELECTIONS CHANGING SUBRC LIKE SY-SUBRC
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MSG LIKE SYMSG.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_CHECK\_SELECTIONS
\*----------------------------------------------------------\*
\* Initialize selection screen (processed before PBO)
\*----------------------------------------------------------\*
FORM INIT.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "INIT.
\*----------------------------------------------------------\*
\* PBO of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PBO.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PBO.
\*----------------------------------------------------------\*
\* PAI of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PAI USING FNAME MARK.
\* CASE FNAME.
\*¬†¬† WHEN 'SLIFNR¬†¬†'.
\*¬†¬† WHEN 'SBUKRS¬†¬†'.
\*¬†¬† WHEN 'SBELNR¬†¬†'.
\*¬†¬† WHEN 'SGJAHR¬†¬†'.
\*¬†¬† WHEN '\*'.
\*¬†¬† ENDCASE.
ENDFORM.¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PAI

Include Program DBTEST\_LDBSXXX

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (BEGIN OF BLOCK) !!!!!! \*
\*-----------------------------------------------------------\*
\* Data structures for search pattern selection
\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (END OF BLOCK) !!!!!!!! \*
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\*-----------------------------------------------------------\*
\* PUT\_TEST\_LDB\_SP.
\* Processed when search pattern selection is used,
\* i.e. user input into PARAMETERS p\_sp AS SEARCH PATTERN
\* STRUCTURE.
\*-----------------------------------------------------------\*
\* FORM PUT\_TEST\_LDB\_SP.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_EXAMPLE\_SP

The comment characters in front of ABAP statements that are to be used in addition to the mandatory statements can be deleted and the question marks can be replaced by appropriate expressions. The syntax check checks all include programs that match the naming conventions and also the selection include.

When the database is accessed in the subroutines put\_node, SELECT statements with conditions for the primary key fields in the WHERE clauses are generated. The performance of these statements is, however, not yet optimized. In particular, the subroutines put\_node of a subtree of the structure represent nested SELECT loops, which should generally be avoided. Instead, the data read can be buffered in internal tables, for example, and passed from here to the application program using the PUT statement. The statement PUT node, however, should always be in a subroutine whose name starts with put\_node for technical reasons.

If the selections specify [dynamic selections](javascript:call_link\('abenldb_free_selections.htm'\)) or [field selections](javascript:call_link\('abenldb_field_selections.htm'\)) for a node, corresponding statements are generated in the subroutine put\_node and the SELECT statement created automatically is modified, as shown in the example for the node BKPF.

The subroutines before\_event, after\_event, and put\_ldb\_sp are created as a comment in the database program and can be modified and activated by deleting the asterisks. before\_event is called before the event specified in the parameter event is processed. after\_event is called after the event specified in the parameter event is processed. When a search help selection is made, put\_ldb\_sp is called to process the return values instead of put\_node for the root node.



**üìñ Source**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)

### abenreport_abexa.htm

> **üìñ Official SAP Documentation**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Linkage%20with%20a%20Program%2C%20ABENREPORT_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Linkage with a Program

This example demonstrates how a logical database is linked with an executable program.

Source Code ¬† 

REPORT demo\_report.
NODES: spfli, sflight, sbook.
DATA: weight¬†¬†¬†¬†¬†¬† TYPE p LENGTH 8 DECIMALS 4,
¬†¬†¬†¬†¬†¬†total\_weight TYPE p LENGTH 8 DECIMALS 4.
INITIALIZATION.
¬†¬†carrid-sign = 'I'.
¬†¬†carrid-option = 'EQ'.
¬†¬†carrid-low = 'AA'.
¬†¬†carrid-high = 'LH'.
¬†¬†APPEND carrid TO carrid.
START-OF-SELECTION.
¬†¬†WRITE 'Luggage weight of flights'.
GET spfli FIELDS carrid connid cityfrom cityto.
¬†¬†SKIP.
¬†¬†ULINE.
¬†¬†WRITE: / 'Carrid:', spfli-carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'Connid:', spfli-connid,
¬†¬†¬†¬†¬†¬†¬†¬† / 'From:¬†¬†', spfli-cityfrom,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'To:¬†¬†¬†¬†', spfli-cityto.
¬†¬†ULINE.
GET sflight FIELDS fldate.
¬†¬†SKIP.
¬†¬†WRITE: / 'Date:', sflight-fldate.
GET sbook FIELDS luggweight.
¬†¬†weight += sbook-luggweight.
GET sflight LATE FIELDS carrid .
¬†¬†WRITE: / 'Luggage weight =', weight.
¬†¬†total\_weight += weight.
¬†¬†weight = 0.
END-OF-SELECTION.
¬†¬†ULINE.
¬†¬†WRITE: / 'Sum of luggage weights =', total\_weight.

Description ¬† 

This example shows a typical report where the [logical database](javascript:call_link\('abenlogical_data_base_glosry.htm'\) "Glossary Entry") F1S is assigned to its properties.



**üìñ Source**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)

### abenlogical_database_abexa.htm

> **üìñ Official SAP Documentation**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Calls%20Using%20a%20Function%20Module%2C%20ABENLOGICAL_DATABASE_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvem
ent:)

LDB - Calls Using a Function Module

This example demonstrates calling a logical database using the function module LDB\_PROCESS.

Source Code ¬† 

REPORT demo\_logical\_database.
DATA wa\_spfli TYPE spfli.
SELECTION-SCREEN BEGIN OF SCREEN 1100.
SELECT-OPTIONS s\_carr FOR wa\_spfli-carrid.
SELECTION-SCREEN END OF SCREEN 1100.
CLASS demo DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
ENDCLASS.
CLASS demo IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA callback¬†¬†¬†¬†TYPE TABLE OF ldbcb.
¬†¬†¬†¬†DATA: seltab¬†¬†¬†¬†TYPE TABLE OF rsparams,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†seltab\_wa LIKE LINE OF seltab,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†scarr\_wa¬†¬†LIKE LINE OF s\_carr.
¬†¬†¬†¬†CALL SELECTION-SCREEN 1100 STARTING AT 10 10.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†callback = VALUE #( ( ldbnode¬†¬†¬†¬† = 'SPFLI'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get\_late¬†¬†¬†¬†= 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SPFLI' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( ldbnode¬†¬†¬†¬† = 'SFLIGHT'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SFLIGHT' ) ).
¬†¬†¬†¬†seltab\_wa-kind = 'S'.
¬†¬†¬†¬†seltab\_wa-selname = 'CARRID'.
¬†¬†¬†¬†LOOP AT s\_carr INTO scarr\_wa.
¬†¬†¬†¬†¬†¬†MOVE-CORRESPONDING scarr\_wa TO seltab\_wa.
¬†¬†¬†¬†¬†¬†APPEND seltab\_wa TO seltab.
¬†¬†¬†¬†ENDLOOP.
¬†¬†¬†¬†CALL FUNCTION 'LDB\_PROCESS'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†ldbname¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 'F1S'
¬†¬†¬†¬†¬†¬†¬†¬†variant¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = ' '
¬†¬†¬†¬†¬†¬†TABLES
¬†¬†¬†¬†¬†¬†¬†¬†callback¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= callback
¬†¬†¬†¬†¬†¬†¬†¬†selections¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= seltab
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Exception with SY-SUBRC', sy-subrc.
¬†¬†¬†¬†ENDIF.¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†demo=>main( ).
FORM callback\_spfli USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE spfli
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†CASE evt.
¬†¬†¬†¬†WHEN 'G'.
¬†¬†¬†¬†¬†¬†WRITE: / wa-carrid, wa-connid, wa-cityfrom, wa-cityto.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†¬†¬†WHEN 'L'.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†ENDCASE.
ENDFORM.
FORM callback\_sflight USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†WRITE: / wa-fldate, wa-seatsocc, wa-seatsmax.
ENDFORM.

Description ¬† 

The program reads data using the logical database F1S. First a program-specific selection screen is defined. The data object wa\_spfli is only required here. Next, suitable variables for the interface are declared.

The internal table callback is filled in such a way that, for the two nodes SPFLI and SFLIGHT, different callback routines in the calling program are called. For the node SPFLI, the corresponding routine for GET and GET LATE is only to be called for GET in the case of SFLIGHT.

The internal table seltab is filled with values from the selection table s\_carr of the standalone selection screen 1100 for the selections of node SPFLI.

The function module LDB\_PROCESS is called with these parameters.

The subroutines callback\_spfli and callback\_sflight are used as callback routines. Since the interface parameter wa is completely typed, the individual components of the work area can be accessed. In callback\_spfli, the events GET and GET LATE are handled differently.


---


## ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Examples

**Files**: 6 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - Programming Language / Obsolete Language Elements / Obsolete Processing of External Data / Logical Databases (LDB, Obsolete) / LDB - Examples

Included pages: 6



**üìñ Source**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)

### abenldb_examples.htm

> **üìñ Official SAP Documentation**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Examples%2C%20ABENLDB_EXAMPLES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Examples

-   [Example of a logical database](javascript:call_link\('abenldb_example.htm'\))
-   [Example of selection include](javascript:call_link\('abenldb_selections_example.htm'\))
-   [Example of a database program](javascript:call_link\('abenldb_program_example.htm'\))
-   [Logical database, linked with a program](javascript:call_link\('abenreport_abexa.htm'\))
-   [Logical database, called by function module](javascript:call_link\('abenlogical_database_abexa.htm'\))

Continue
[LDB - Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\))
[LDB - Example of a Selection Include](javascript:call_link\('abenldb_selections_example.htm'\))
[LDB - Example of a Database Program](javascript:call_link\('abenldb_program_example.htm'\))
![Example](exa.gif "Example") [LDB - Linkage with a Program](javascript:call_link\('abenreport_abexa.htm'\))
![Example](exa.gif "Example") [LDB - Calls Using a Function Module](javascript:call_link\('abenlogical_database_abexa.htm'\))



**üìñ Source**: [abenldb_examples.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_examples.htm)

### abenldb_example.htm

> **üìñ Official SAP Documentation**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Logical%20Database%2C%20ABENLDB_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Example of a Logical Database

This example demonstrates all significant components of the imaginary logical database TEST\_LDB.

-   [Structure](#abenldb-example-1-------selections-in-the-selection-include---@ITOC@@ABENLDB_EXAMPLE_2)
-   [Database Program](#abenldb-example-3---structure-----lfa1------------lfb1--------------------------lfc1--------------------------bkpf--selections-in-the-selection-include-----select-options--slifnr---for-lfa1-lifnr------------------sbukrs---for-lfb1-bukrs------------------sgjahr---for-lfc1-gjahr------------------sbelnr---for-bkpf-belnr---database-program--------------------------------------------------------------------database-program-of-logical-database-test--ldb-------------------------------------------------------------program-sapdbtest--ldb-defining-database-test--ldb--nodes--lfa1---------lfb1---------lfc1---------bkpf-----------------------------------------------------------------initialize-selection-screen--processed-before-pbo--------------------------------------------------------------form-init-------endform-----------------------------------------------------------------pbo-of-selection-screen-------------------------------------------------------------form-pbo-------endform-----------------------------------------------------------------pai-of-selection-screen-------------------------------------------------------------form-pai-using-fname-mark----case-fname------when--slifnr-----------------when--sbukrs-----------------when--sgjahr-----------------when--sbelnr---------------endcase--endform-----------------------------------------------------------------raise-event-get-lfa1-------------------------------------------------------------form-put--lfa1----select----from-lfa1------------where-lifnr-in-slifnr INTO @lfa1.
¬†¬†¬†¬†PUT lfa1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfb1
\*-------------------------------------------------------\*
FORM put\_lfb1.
¬†¬†SELECT \* FROM lfb1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs IN @sbulrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @lfb1.
¬†¬†¬†¬†PUT lfb1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET lfc1
\*-------------------------------------------------------\*
FORM put\_lfc1.
¬†¬†SELECT \* FROM lfc1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE lifnr = @lfa1-lifnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO lfc1.
¬†¬†¬†¬†PUT lfc1.
¬†¬†ENDSELECT.
ENDFORM.
\*-------------------------------------------------------\*
\* Raise event GET bkpf
\*-------------------------------------------------------\*
FORM put\_bkpf.
¬†¬†SELECT \* FROM bkpf
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† WHERE bukrs¬†¬†¬†¬†¬†¬†=¬†¬†@lfb1-bukrs
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND belnr¬†¬†¬†¬†¬†¬†IN @sbelnr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† AND gjahr¬†¬†¬†¬†¬†¬†IN @sgjahr
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† INTO @bkpf.
¬†¬†¬†¬†PUT bkpf.
¬†¬†ENDSELECT.
ENDFORM.

The PROGRAM statement has the addition [DEFINING DATABASE test\_ldb](javascript:call_link\('abapreport_defining.htm'\)). This defines the link of the database program with the logical database TEST\_LDB.

The nodes of the structure are declared using the [NODES statement](javascript:call_link\('abapnodes.htm'\)). This creates the required interface work areas as table work areas. The statement [TABLES](javascript:call_link\('abaptables.htm'\)) can be used as a node in the same way for database tables. If the nodes are not database tables, they must be declared using NODES. The interface work areas are shared by the database program and a linked executable program or the function module LDB\_PROCESS and therefore become the interface used for passing data.

The selection screen can be initialized in the subroutines init and pbo.

The user input on the selection screen can be, for example, checked for authorizations in the subroutine pai. Other checks, such as plausibility or value range checks, are also possible here. If a check is negative, an error dialog can be programmed and the corresponding field can be initialized again.

The database tables are read in accordance with the selection criteria of the user and the associated GET events are raised in the subroutines put\_....

This program is only intended to demonstrate the principles of the structure of a logical database. It does not contain any methods for optimizing response times. The chronological order of the subroutine calls is determined by the structure of the logical database.



**üìñ Source**: [abenldb_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_example.htm)

### abenldb_selections_example.htm

> **üìñ Official SAP Documentation**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Selection%20Include%2C%20ABENLDB_SELECTIONS_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improve
ment:)

LDB - Example of a Selection Include

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). The generated proposal for the selection include is then as follows:

\*-----------------------------------------------------------\*
\* Include DBTEST\_LDBSEL
\* It will be automatically included into the database program
\*-----------------------------------------------------------\*
\* If the source is automatically generated,
\* perform the following steps:
\* 1. Replace ? by suitable names (at most 8 characters).
\* 2. Activate SELECT-OPTIONS and PARAMETERS (delete stars).
\* 3. Save source code.
\* 4. Edit database program.
\*
\* Hint : Syntax check is not possible within this include!
\* It will be checked during syntax check of database program.
\*-----------------------------------------------------------\*
\* SELECT-OPTIONS :¬†¬†?¬†¬†FOR LFA1-LIFNR.
\* Parameter for search pattern selection:
\* PARAMETERS p\_sp AS SEARCH PATTERN FOR TABLE LFA1.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFB1-BUKRS.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-LIFNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR LFC1-GJAHR.
\* SELECT-OPTIONS :
\*¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BUKRS,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-BELNR,
\*¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ?¬†¬†FOR BKPF-GJAHR.
\* Enable DYNAMIC SELECTIONS for selected nodes :
\* Enable FIELD SELECTION for selected nodes :

If the nodes LFA1 and LFB1 are defined for dynamic selections and the node LFC1 defined for field selections, the following additional program lines are generated:

SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFA1.
SELECTION-SCREEN DYNAMIC SELECTIONS FOR TABLE LFB1.
SELECTION-SCREEN FIELD SELECTION FOR TABLE LFC1.

This automatically created selection include can be completed, for example, as follows:

\* Selection criteria:
¬†¬†SELECT-OPTIONS slifnr¬†¬†FOR lfa1-lifnr.
¬†¬†SELECT-OPTIONS sbukrs¬†¬†FOR lfb1-bukrs.
¬†¬†SELECT-OPTIONS sgjahr¬†¬†FOR flc1-gjahr.
¬†¬†SELECT-OPTIONS sbelnr¬†¬†FOR bkpf-belnr.
\* User-defined parameters:
¬†¬†PARAMETERS pstida LIKE sy-datum FOR NODE bkpf.
\* Dynamic selections for LFA1 and LFB1:
¬†¬†SELECTION-SCREEN DYNAMIC SELECTIONS FOR NODE: lfa1, lfb1.
\* Field selection for LFB1 and LFC1:
¬†¬†SELECTION-SCREEN FIELD SELECTION FOR NODE: lfb1, lfc1.

A selection is made from the available selection criteria and is given a name. The additional parameter pstida is declared and connected to the node BKPF. Dynamic selections are defined for the tablesLFA1 and LFB1. The tables LFB1 and LFC1 are defined for field selections.



**üìñ Source**: [abenldb_selections_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_selections_example.htm)

### abenldb_program_example.htm

> **üìñ Official SAP Documentation**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Example%20of%20a%20Database%20Program%2C%20ABENLDB_PROGRAM_EXAMPLE%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement
:)

LDB - Example of a Database Program

A logical database TEST\_LDB has the structure shown in [Example of a Logical Database](javascript:call_link\('abenldb_example.htm'\)). All nodes are database tables. Selections are defined in the selection include:

SELECT-OPTIONS SLIFNR¬†¬†FOR LFA1-LIFNR.
SELECT-OPTIONS SBUKRS¬†¬†FOR LFB1-BUKRS.
SELECT-OPTIONS SGJAHR¬†¬†FOR LFC1-GJAHR.
SELECT-OPTIONS SBELNR¬†¬†FOR BKPF-BELNR.

The generated proposal for the database program is then as follows:

Master Program SAPDBTEST\_LDB

\*----------------------------------------------------------\*
\*¬†¬†¬†¬†¬†¬†DATABASE PROGRAM OF LOGICAL DATABASE TEST\_LDB
\*----------------------------------------------------------\*
INCLUDE DBTEST\_LDBTOP.¬†¬†¬†¬† " header
INCLUDE DBTEST\_LDBXXX.¬†¬†¬†¬† " all system routines
\* INCLUDE DBTEST\_LDBF001.¬†¬†" user defined include

Include Program DBTEST\_LDBTOP

PROGRAM SAPDBTEST\_LDB DEFINING DATABASE TEST\_LDB.
TABLES: LFA1,
¬†¬†¬†¬†¬†¬†¬†¬† LFB1,
¬†¬†¬†¬†¬†¬†¬†¬† LFC1,
¬†¬†¬†¬†¬†¬†¬†¬† BKPF.
\* DATA: ...¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"user defined variables

Include Program DBTEST\_LDB001

\*----------------------------------------------------------\*
\* Call event GET LFA1
\*----------------------------------------------------------\*
FORM PUT\_LFA1.
\* SELECT \* FROM LFA1
\*¬†¬† INTO LFA1
\*¬†¬† INTO TABLE ? (choose one!)
\*¬†¬† WHERE LIFNR = ?.
¬†¬†¬†¬†PUT LFA1.
\* ENDSELECT.
ENDFORM.¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_LFA1
\*----------------------------------------------------------\*
\* Authority Check for node LFA1
\*----------------------------------------------------------\*
\* FORM AUTHORITY\_CHECK\_LFA1.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM.

Include Programs DBTEST\_LDB002 and DBTEST\_LDB003

Like DBTEST\_LDB001 for the nodes LFB1 and LFC1

Include Program DBTEST\_LDB004

\*----------------------------------------------------------\*
\* Call event GET BKPF
\*----------------------------------------------------------\*
FORM PUT\_BKPF.
\* STATICS FLAG.
\* IF FLAG = SPACE.
\*¬†¬† FLAG = 'X'.
\*\*\* Declarations for field selection for node BKPF \*\*\*
\*¬†¬† STATICS BKPF\_FIELDS TYPE RSFS\_TAB\_FIELDS.
\*¬†¬† MOVE 'BKPF' TO BKPF\_FIELDS-TABLENAME.
\*¬†¬† READ TABLE SELECT\_FIELDS WITH KEY BKPF\_FIELDS-TABLENAME
\*¬†¬†¬†¬† INTO BKPF\_FIELDS.
\* ENDIF.
\* SELECT (BKPF\_FIELDS-FIELDS) INTO CORRESPONDING FIELDS OF
\*¬†¬†¬†¬† BKPF / TABLE ? " (choose one of them)
\*¬†¬†¬†¬† FROM BKPF
\*¬†¬† WHERE BUKRS = LFB1-BUKRS
\*¬†¬†¬†¬† AND BELNR IN SBELNR
\*¬†¬†¬†¬† AND GJAHR = ?.
¬†¬†¬†¬†PUT BKPF.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_BKPF
\*----------------------------------------------------------\*
\* Authority Check for node BKPF
\*----------------------------------------------------------\*
\* FORM AUTHORITYCHECK\_BKPF.
\*¬†¬† AUTHORITY-CHECK ...
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AUTHORITY\_CHECK\_BKPF

Include Program DBTEST\_LDBFXXX

\*----------------------------------------------------------\*
\* BEFORE\_EVENT will be called before event EVENT
\* Possible values for EVENT: 'START-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM BEFORE\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'START-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "BEFORE\_EVENT
\*----------------------------------------------------------\*
\* AFTER\_EVENT will be called after event EVENT
\* Possible values for EVENT: 'END-OF-SELECTION'
\*----------------------------------------------------------\*
\* FORM AFTER\_EVENT USING EVENT.
\*¬†¬† CASE EVENT.
\*¬†¬†¬†¬† WHEN 'END-OF-SELECTION'
\*
\*¬†¬† ENDCASE.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "AFTER\_EVENT
\*-----------------------------------------------------------\*
\* Initialize global data for multiple processing of
\* one logical database.
\* Set returncode:
\*¬†¬†¬†¬†¬†¬†0 -> all data are initialized, multiple processing o.k.
\*¬†¬†other -> no multiple processing allowed
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_INIT CHANGING SUBRC LIKE SY-SUBRC.
ENDFORM.¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_INIT
\*------------------------------------------------------------\*
\* LDB\_PROCESS\_CHECK\_SELECTIONS is called
\* after select-options and parameters are filled
\*------------------------------------------------------------\*
FORM¬†¬†LDB\_PROCESS\_CHECK\_SELECTIONS CHANGING SUBRC LIKE SY-SUBRC
¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MSG LIKE SYMSG.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†"LDB\_PROCESS\_CHECK\_SELECTIONS
\*----------------------------------------------------------\*
\* Initialize selection screen (processed before PBO)
\*----------------------------------------------------------\*
FORM INIT.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "INIT.
\*----------------------------------------------------------\*
\* PBO of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PBO.
ENDFORM.¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PBO.
\*----------------------------------------------------------\*
\* PAI of selection screen (processed always after ENTER)
\*----------------------------------------------------------\*
FORM PAI USING FNAME MARK.
\* CASE FNAME.
\*¬†¬† WHEN 'SLIFNR¬†¬†'.
\*¬†¬† WHEN 'SBUKRS¬†¬†'.
\*¬†¬† WHEN 'SBELNR¬†¬†'.
\*¬†¬† WHEN 'SGJAHR¬†¬†'.
\*¬†¬† WHEN '\*'.
\*¬†¬† ENDCASE.
ENDFORM.¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PAI

Include Program DBTEST\_LDBSXXX

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (BEGIN OF BLOCK) !!!!!! \*
\*-----------------------------------------------------------\*
\* Data structures for search pattern selection
\*
\* !!! PLEASE DO NOT CHANGE MANUALLY (END OF BLOCK) !!!!!!!! \*
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\*-----------------------------------------------------------\*
\* PUT\_TEST\_LDB\_SP.
\* Processed when search pattern selection is used,
\* i.e. user input into PARAMETERS p\_sp AS SEARCH PATTERN
\* STRUCTURE.
\*-----------------------------------------------------------\*
\* FORM PUT\_TEST\_LDB\_SP.
\* ENDFORM.¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† "PUT\_EXAMPLE\_SP

The comment characters in front of ABAP statements that are to be used in addition to the mandatory statements can be deleted and the question marks can be replaced by appropriate expressions. The syntax check checks all include programs that match the naming conventions and also the selection include.

When the database is accessed in the subroutines put\_node, SELECT statements with conditions for the primary key fields in the WHERE clauses are generated. The performance of these statements is, however, not yet optimized. In particular, the subroutines put\_node of a subtree of the structure represent nested SELECT loops, which should generally be avoided. Instead, the data read can be buffered in internal tables, for example, and passed from here to the application program using the PUT statement. The statement PUT node, however, should always be in a subroutine whose name starts with put\_node for technical reasons.

If the selections specify [dynamic selections](javascript:call_link\('abenldb_free_selections.htm'\)) or [field selections](javascript:call_link\('abenldb_field_selections.htm'\)) for a node, corresponding statements are generated in the subroutine put\_node and the SELECT statement created automatically is modified, as shown in the example for the node BKPF.

The subroutines before\_event, after\_event, and put\_ldb\_sp are created as a comment in the database program and can be modified and activated by deleting the asterisks. before\_event is called before the event specified in the parameter event is processed. after\_event is called after the event specified in the parameter event is processed. When a search help selection is made, put\_ldb\_sp is called to process the return values instead of put\_node for the root node.



**üìñ Source**: [abenldb_program_example.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenldb_program_example.htm)

### abenreport_abexa.htm

> **üìñ Official SAP Documentation**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Linkage%20with%20a%20Program%2C%20ABENREPORT_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

LDB - Linkage with a Program

This example demonstrates how a logical database is linked with an executable program.

Source Code ¬† 

REPORT demo\_report.
NODES: spfli, sflight, sbook.
DATA: weight¬†¬†¬†¬†¬†¬† TYPE p LENGTH 8 DECIMALS 4,
¬†¬†¬†¬†¬†¬†total\_weight TYPE p LENGTH 8 DECIMALS 4.
INITIALIZATION.
¬†¬†carrid-sign = 'I'.
¬†¬†carrid-option = 'EQ'.
¬†¬†carrid-low = 'AA'.
¬†¬†carrid-high = 'LH'.
¬†¬†APPEND carrid TO carrid.
START-OF-SELECTION.
¬†¬†WRITE 'Luggage weight of flights'.
GET spfli FIELDS carrid connid cityfrom cityto.
¬†¬†SKIP.
¬†¬†ULINE.
¬†¬†WRITE: / 'Carrid:', spfli-carrid,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'Connid:', spfli-connid,
¬†¬†¬†¬†¬†¬†¬†¬† / 'From:¬†¬†', spfli-cityfrom,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† 'To:¬†¬†¬†¬†', spfli-cityto.
¬†¬†ULINE.
GET sflight FIELDS fldate.
¬†¬†SKIP.
¬†¬†WRITE: / 'Date:', sflight-fldate.
GET sbook FIELDS luggweight.
¬†¬†weight += sbook-luggweight.
GET sflight LATE FIELDS carrid .
¬†¬†WRITE: / 'Luggage weight =', weight.
¬†¬†total\_weight += weight.
¬†¬†weight = 0.
END-OF-SELECTION.
¬†¬†ULINE.
¬†¬†WRITE: / 'Sum of luggage weights =', total\_weight.

Description ¬† 

This example shows a typical report where the [logical database](javascript:call_link\('abenlogical_data_base_glosry.htm'\) "Glossary Entry") F1S is assigned to its properties.



**üìñ Source**: [abenreport_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenreport_abexa.htm)

### abenlogical_database_abexa.htm

> **üìñ Official SAP Documentation**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - Programming Language](javascript:call_link\('abenabap_reference.htm'\))¬†‚Üí¬† [Obsolete Language Elements](javascript:call_link\('abenabap_obsolete.htm'\))¬†‚Üí¬† [Obsolete Processing of External Data](javascript:call_link\('abendata_storage_obsolete.htm'\))¬†‚Üí¬† [Logical Databases (LDB, Obsolete)](javascript:call_link\('abenldb.htm'\))¬†‚Üí¬† [LDB - Examples](javascript:call_link\('abenldb_examples.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20LDB%20-%20Calls%20Using%20a%20Function%20Module%2C%20ABENLOGICAL_DATABASE_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvem
ent:)

LDB - Calls Using a Function Module

This example demonstrates calling a logical database using the function module LDB\_PROCESS.

Source Code ¬† 

REPORT demo\_logical\_database.
DATA wa\_spfli TYPE spfli.
SELECTION-SCREEN BEGIN OF SCREEN 1100.
SELECT-OPTIONS s\_carr FOR wa\_spfli-carrid.
SELECTION-SCREEN END OF SCREEN 1100.
CLASS demo DEFINITION.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†CLASS-METHODS main.
ENDCLASS.
CLASS demo IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†DATA callback¬†¬†¬†¬†TYPE TABLE OF ldbcb.
¬†¬†¬†¬†DATA: seltab¬†¬†¬†¬†TYPE TABLE OF rsparams,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†seltab\_wa LIKE LINE OF seltab,
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†scarr\_wa¬†¬†LIKE LINE OF s\_carr.
¬†¬†¬†¬†CALL SELECTION-SCREEN 1100 STARTING AT 10 10.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†RETURN.
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†callback = VALUE #( ( ldbnode¬†¬†¬†¬† = 'SPFLI'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get\_late¬†¬†¬†¬†= 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SPFLI' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( ldbnode¬†¬†¬†¬† = 'SFLIGHT'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†get¬†¬†¬†¬†¬†¬†¬†¬† = 'X'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_prog¬†¬†¬†¬† = sy-repid
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb\_form¬†¬†¬†¬† = 'CALLBACK\_SFLIGHT' ) ).
¬†¬†¬†¬†seltab\_wa-kind = 'S'.
¬†¬†¬†¬†seltab\_wa-selname = 'CARRID'.
¬†¬†¬†¬†LOOP AT s\_carr INTO scarr\_wa.
¬†¬†¬†¬†¬†¬†MOVE-CORRESPONDING scarr\_wa TO seltab\_wa.
¬†¬†¬†¬†¬†¬†APPEND seltab\_wa TO seltab.
¬†¬†¬†¬†ENDLOOP.
¬†¬†¬†¬†CALL FUNCTION 'LDB\_PROCESS'
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†ldbname¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 'F1S'
¬†¬†¬†¬†¬†¬†¬†¬†variant¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = ' '
¬†¬†¬†¬†¬†¬†TABLES
¬†¬†¬†¬†¬†¬†¬†¬†callback¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= callback
¬†¬†¬†¬†¬†¬†¬†¬†selections¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= seltab
¬†¬†¬†¬†¬†¬†EXCEPTIONS
¬†¬†¬†¬†¬†¬†¬†¬†OTHERS¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 4.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†WRITE: 'Exception with SY-SUBRC', sy-subrc.
¬†¬†¬†¬†ENDIF.¬†¬†ENDMETHOD.
ENDCLASS.
START-OF-SELECTION.
¬†¬†demo=>main( ).
FORM callback\_spfli USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE spfli
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†CASE evt.
¬†¬†¬†¬†WHEN 'G'.
¬†¬†¬†¬†¬†¬†WRITE: / wa-carrid, wa-connid, wa-cityfrom, wa-cityto.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†¬†¬†WHEN 'L'.
¬†¬†¬†¬†¬†¬†ULINE.
¬†¬†ENDCASE.
ENDFORM.
FORM callback\_sflight USING name¬†¬†TYPE ldbn-ldbnode
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†wa¬†¬†¬†¬†TYPE sflight
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†evt¬†¬† TYPE c
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†check TYPE c.
¬†¬†WRITE: / wa-fldate, wa-seatsocc, wa-seatsmax.
ENDFORM.

Description ¬† 

The program reads data using the logical database F1S. First a program-specific selection screen is defined. The data object wa\_spfli is only required here. Next, suitable variables for the interface are declared.

The internal table callback is filled in such a way that, for the two nodes SPFLI and SFLIGHT, different callback routines in the calling program are called. For the node SPFLI, the corresponding routine for GET and GET LATE is only to be called for GET in the case of SFLIGHT.

The internal table seltab is filled with values from the selection table s\_carr of the standalone selection screen 1100 for the selections of node SPFLI.

The function module LDB\_PROCESS is called with these parameters.

The subroutines callback\_spfli and callback\_sflight are used as callback routines. Since the interface parameter wa is completely typed, the individual components of the work area can be accessed. In callback\_spfli, the events GET and GET LATE are handled differently.


---


## ABAP - Keyword Documentation / ABAP - RAP Business Objects / ABAP for RAP Business Objects / Other RAP-Related ABAP Language Elements and Topics / Type Mapping for RAP / ABAP SQL Statements with MAPPING FROM ENTITY

**Files**: 2 | **Difficulty**: intermediate

# ABAP - Keyword Documentation / ABAP - RAP Business Objects / ABAP for RAP Business Objects / Other RAP-Related ABAP Language Elements and Topics / RAP-Related System Classes and Functionality

Included pages: 8



**üìñ Source**: [abenlogical_database_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenlogical_database_abexa.htm)

### abaprap_system_classes.htm

> **üìñ Official SAP Documentation**: [abaprap_system_classes.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abaprap_system_classes.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - RAP Business Objects](javascript:call_link\('abenabap_rap.htm'\))¬†‚Üí¬† [ABAP for RAP Business Objects](javascript:call_link\('abenabap_for_rap_bos.htm'\))¬†‚Üí¬† [Other RAP-Related ABAP Language Elements and Topics](javascript:call_link\('abenabap_rap_other.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20RAP-Related%20System%20Classes%20and%20Functionality%2C%20ABAPRAP_SYSTEM_CLASSES%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improve
ment:)

RAP-Related System Classes and Functionality

The following topics are covered in this section:

-   [CL\_ABAP\_BEHV\_AUX](javascript:call_link\('abaprap_cl_abap_behv_aux.htm'\))
-   [CL\_ABAP\_BEHVDESCR](javascript:call_link\('abapcl_abap_behvdescr.htm'\))

Continue
[CL\_ABAP\_BEHV\_AUX](javascript:call_link\('abaprap_cl_abap_behv_aux.htm'\))
[CL\_ABAP\_BEHVDESCR](javascript:call_link\('abapcl_abap_behvdescr.htm'\))



**üìñ Source**: [abaprap_system_classes.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abaprap_system_classes.htm)

### abaprap_cl_abap_behv_aux.htm

> **üìñ Official SAP Documentation**: [abaprap_cl_abap_behv_aux.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abaprap_cl_abap_behv_aux.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - RAP Business Objects](javascript:call_link\('abenabap_rap.htm'\))¬†‚Üí¬† [ABAP for RAP Business Objects](javascript:call_link\('abenabap_for_rap_bos.htm'\))¬†‚Üí¬† [Other RAP-Related ABAP Language Elements and Topics](javascript:call_link\('abenabap_rap_other.htm'\))¬†‚Üí¬† [RAP-Related System Classes and Functionality](javascript:call_link\('abaprap_system_classes.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CL_ABAP_BEHV_AUX%2C%20ABAPRAP_CL_ABAP_BEHV_AUX%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

CL\_ABAP\_BEHV\_AUX

The class CL\_ABAP\_BEHV\_AUX contains methods for retrieving various pieces of information.

Method

Details

GET\_CURRENT\_PHASE

Information about the current [RAP transactional phase](javascript:call_link\('abentransactional_phase_glosry.htm'\) "Glossary Entry"), for example, [RAP early save phase](javascript:call_link\('abenearly_rap_save_phase_glosry.htm'\) "Glossary Entry"), [RAP late save phase](javascript:call_link\('abenlate_rap_save_phase_glosry.htm'\) "Glossary Entry"), or [RAP interaction phase](javascript:call_link\('abenrap_int_phase_glosry.htm'\) "Glossary Entry").

GET\_CURRENT\_CONTEXT

Information about the context of the current [RAP handler](javascript:call_link\('abenabp_handler_method_glosry.htm'\) "Glossary Entry") and [saver method](javascript:call_link\('abenabp_saver_method_glosry.htm'\) "Glossary Entry")

GET\_CURRENT\_HANDLER\_KIND

Information about the kind of method. For information on the values, see the domain ABP\_BEHV\_KIND.

Hint

Regarding GET\_CURRENT\_CONTEXT:

-   In the [RAP early save phase](javascript:call_link\('abenearly_rap_save_phase_glosry.htm'\) "Glossary Entry") and [RAP late save phase](javascript:call_link\('abenlate_rap_save_phase_glosry.htm'\) "Glossary Entry") it makes no sense to evaluate the components other than from\_projection.
-   The for\_permissions parameter can be used to avoid a double checking of authorization or feature control if an ABAP EML modify request is handled.
-   Example use cases for the context information:
    -   When a behavior is accessed via a [RAP interface behavior definition](javascript:call_link\('abencds_interface_bdef_glosry.htm'\) "Glossary Entry"), this access is directly mapped to a request on the base [RAP business object (BO)](javascript:call_link\('abenrap_bo_glosry.htm'\) "Glossary Entry"). A use case might be that the base BO implementation would like to have the information available that it has been called via a [RAP BO interface](javascript:call_link\('abenrap_bo_interface_glosry.htm'\) "Glossary Entry"). For example, a RAP BO interface implements specific logic (for example, some fields are dynamically set to read-only) in the base BO's behavior pool. The implementation in the base BO then requires the name of the RAP BO interface which can be retrieved using the methods of this class.
    -   Similarly, the base BO implementation might be interested in knowing whether it was invoked by a [RAP projection extension entity](javascript:call_link\('abenrap_proj_ext_entity_glosry.htm'\) "Glossary Entry").

Example

The following code snippet shows how information on the current context might be retrieved using the GET\_CURRENT\_CONTEXT method by storing the information in a variable [declared inline](javascript:call_link\('abeninline_declaration_glosry.htm'\) "Glossary Entry").

cl\_abap\_behv\_aux=>get\_current\_context( IMPORTING
¬†¬†¬†¬†¬†¬†from\_projection = FINAL(fr\_proj)
¬†¬†¬†¬†¬†¬†from\_interface¬†¬†= FINAL(fr\_int)
¬†¬†¬†¬†¬†¬†in\_local\_mode¬†¬† = FINAL(loc\_mode)
¬†¬†¬†¬†¬†¬†draft\_activate¬†¬†= FINAL(dr\_act)
¬†¬†¬†¬†¬†¬†for\_permissions = FINAL(for\_perm)
¬†¬†¬†¬†¬†¬†privileged¬†¬†¬†¬†¬†¬†= FINAL(priv) ).

Executable Examples

-   The example [Getting RAP Context Information Using CL\_ABAP\_BEHV\_AUX](javascript:call_link\('abenrap_cl_abap_behv_aux_abexa.htm'\)) demonstrates the use of methods of the class CL\_ABAP\_BEHV\_AUX by focusing on the filling of the specific parameters in multiple contexts.
-   The example [Using the Addition PRIVILEGED with an ABAP EML Statement](javascript:call_link\('abeneml_privileged_abexa.htm'\)) demonstrates the addition PRIVILEGED using an [action](javascript:call_link\('abenaction_glosry.htm'\) "Glossary Entry") and a managed RAP BO. In this example, the method get\_current\_context is used to retrieve the information whether the running handler is running in privileged mode.
-   The example [Checking RAP Transactional Phases](javascript:call_link\('abenrap_cl_abap_behv_aux_ph_abexa.htm'\)) demonstrates the methods GET\_CURRENT\_PHASE and GET\_CURRENT\_HANDLER\_KIND.

Continue
![Example](exa.gif "Example") [Getting RAP Context Information Using CL\_ABAP\_BEHV\_AUX](javascript:call_link\('abenrap_cl_abap_behv_aux_abexa.htm'\))
![Example](exa.gif "Example") [Checking RAP Transactional Phases](javascript:call_link\('abenrap_cl_abap_behv_aux_ph_abexa.htm'\))



**üìñ Source**: [abaprap_cl_abap_behv_aux.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abaprap_cl_abap_behv_aux.htm)

### abenrap_cl_abap_behv_aux_abexa.htm

> **üìñ Official SAP Documentation**: [abenrap_cl_abap_behv_aux_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenrap_cl_abap_behv_aux_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - RAP Business Objects](javascript:call_link\('abenabap_rap.htm'\))¬†‚Üí¬† [ABAP for RAP Business Objects](javascript:call_link\('abenabap_for_rap_bos.htm'\))¬†‚Üí¬† [Other RAP-Related ABAP Language Elements and Topics](javascript:call_link\('abenabap_rap_other.htm'\))¬†‚Üí¬† [RAP-Related System Classes and Functionality](javascript:call_link\('abaprap_system_classes.htm'\))¬†‚Üí¬† [CL\_ABAP\_BEHV\_AUX](javascript:call_link\('abaprap_cl_abap_behv_aux.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Getting%20RAP%20Context%20Information%20Using%20CL_ABAP_BEHV_AUX%2C%20ABENRAP_CL_ABAP_BEHV_AUX_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASugges
tion%20for%20improvement:)

Getting RAP Context Information Using CL\_ABAP\_BEHV\_AUX

This example demonstrates the use of methods of the class CL\_ABAP\_BEHV\_AUX by focusing on the filling of the specific parameters in multiple contexts.

Note: This example does not fully meet the requirements of the [RAP BO contract](javascript:call_link\('abenrap_bo_contract_glosry.htm'\) "Glossary Entry"). It is intentionally kept short and simple and focuses on specific RAP aspects. For example, some [RAP handler method](javascript:call_link\('abenabp_handler_method_glosry.htm'\) "Glossary Entry") implementations might be empty. See more information on the RAP BO contract in the [Development guide for the ABAP RESTful Application Programming Model](https://help.sap.com/docs/ABAP_Cloud/f055b8bf582d4f34b91da667bc1fcce6/3a402c5cf6a74bc1a1de080b2a7c6978?version=sap_cross_product_abap).

Used artifacts in the example

What

CDS view

BDEF

Behavior Pool (ABP)

Notes

Base [RAP business object](javascript:call_link\('abenrap_bo_glosry.htm'\) "Glossary Entry")

DEMO\_EXT\_M

DEMO\_EXT\_M

CCIMP include

The CDS data model only consists of one node constituting the root entity.
The BDEF defines a managed RAP BO. It is also defined as extensible.
Since it is a simple example serving demonstration purposes, the RAP handler methods in the ABP do not contain any meaningful implementations. Each method implementation contains calls for the methods get\_current\_context and get\_current\_handler\_kind. The return values of the method parameters are stored in a [nested structure](javascript:call_link\('abennested_structure_glosry.htm'\) "Glossary Entry") in the global class of the ABP and added to an internal table for displaying purposes.

[RAP BO interface](javascript:call_link\('abenrap_bo_interface_glosry.htm'\) "Glossary Entry")

DEMO\_INTF\_M

DEMO\_INTF\_M

¬†

The interface BDEF projects the original RAP BO.

RAP BO interface extension

¬†

DEMO\_INTF\_EXT\_M

The BDEF extension extends the RAP BO via its interface. It addresses the root node by its interface name. It adds one extension action to the RAP BO which is implemented in the extension ABP. This action simply updates the value of a specific field with a default value. Additionally, the methods in the extension ABP contains similar code snippets for method calls as mentioned above. CCIMP include

[RAP projection business object](javascript:call_link\('abenrap_projection_bo_glosry.htm'\) "Glossary Entry")

DEMO\_PROJ\_M

DEMO\_PROJ\_M

¬†

The CDS projection view is based on the CDS view of the base BO's CDS view (the projected entity) and exposes only a subset of elements.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_rap\_cl\_abap\_behv\_aux DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†¬†¬†METHODS constructor.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS:
¬†¬†¬†¬†¬†¬†initialize\_dbtabs.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_rap\_cl\_abap\_behv\_aux IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†out->begin\_section( \`Demo: cl\_abap\_behv\_aux\`
¬†¬†¬†¬†)->write\_doc( \`<b>1) Create operation directly \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`on the root entity</b>\` ).
¬†¬†¬†¬†MODIFY ENTITIES OF demo\_ext\_m
¬†¬†¬†¬†¬†¬†ENTITY Root
¬†¬†¬†¬†¬†¬†CREATE FIELDS ( key\_field field1 field2 field3 field4 )
¬†¬†¬†¬†¬†¬†WITH VALUE #( ( %cid = 'cid1'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†key\_field = 1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field1 = 'aaa'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field2 = 'bbb'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field3 = 10
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field4 = 11 )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( %cid = 'cid2'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†key\_field = 2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field1 = 'ccc'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field2 = 'ddd'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field3 = 20
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field4 = 21 ) )
¬†¬†¬†¬†¬†¬†MAPPED FINAL(m1)
¬†¬†¬†¬†¬†¬†FAILED FINAL(f1)
¬†¬†¬†¬†¬†¬†REPORTED FINAL(r1).
¬†¬†¬†¬†COMMIT ENTITIES.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†out->write\_doc( \`An issue occurred in the RAP save sequence.\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT key\_field, field1, field2, field3, field4
¬†¬†¬†¬†¬†¬†FROM¬†¬†demo\_tab\_root\_5
¬†¬†¬†¬†¬†¬†ORDER BY key\_field
¬†¬†¬†¬†¬†¬†INTO TABLE @FINAL(create\_root).
¬†¬†¬†¬†out->write( create\_root
¬†¬†¬†¬†)->write( bp\_demo\_ext\_m=>behv\_aux\_table
¬†¬†¬†¬†)->line( ).
¬†¬†¬†¬†CLEAR bp\_demo\_ext\_m=>behv\_aux\_table.
¬†¬†¬†¬†out->write\_doc( \`<b>2) Create operation on the root \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`entity via interface</b>\` ).
¬†¬†¬†¬†"Creating instances of the root entity via the interface
¬†¬†¬†¬†MODIFY ENTITIES OF demo\_intf\_m
¬†¬†¬†¬†¬†¬†ENTITY root\_interface
¬†¬†¬†¬†¬†¬†CREATE FIELDS ( key\_field field1 field2 field3 field4 )
¬†¬†¬†¬†¬†¬†WITH VALUE #( ( %cid = 'cid3'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†key\_field = 3
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field1 = 'eee'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field2 = 'fff'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field3 = 30
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field4 = 31 )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( %cid = 'cid4'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†key\_field = 4
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field1 = 'ggg'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field2 = 'hhh'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field3 = 40
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field4 = 41 ) )
¬†¬†¬†¬†¬†¬† MAPPED FINAL(map2)
¬†¬†¬†¬†¬†¬† FAILED FINAL(f2)
¬†¬†¬†¬†¬†¬† REPORTED FINAL(r2).
¬†¬†¬†¬†COMMIT ENTITIES.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†out->write\_doc( \`An issue occurred in the RAP save sequence.\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT key\_field, field1, field2, field3, field4
¬†¬†¬†¬†¬†¬†FROM¬†¬†demo\_tab\_root\_5
¬†¬†¬†¬†¬†¬†ORDER BY key\_field
¬†¬†¬†¬†¬†¬†INTO TABLE @FINAL(create\_via\_itf).
¬†¬†¬†¬†out->write( create\_via\_itf
¬†¬†¬†¬†)->write( bp\_demo\_ext\_m=>behv\_aux\_table
¬†¬†¬†¬†)->line( ).
¬†¬†¬†¬†CLEAR bp\_demo\_ext\_m=>behv\_aux\_table.
¬†¬†¬†¬†out->write\_doc( \`<b>3) Action execution via RAP BO \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`interface extension</b>\` ).
¬†¬†¬†¬†"Executing an action via RAP BO interface extension
¬†¬†¬†¬†MODIFY ENTITIES OF demo\_intf\_m
¬†¬†¬†¬†¬†¬† ENTITY root\_interface
¬†¬†¬†¬†¬†¬† EXECUTE set\_value\_ext
¬†¬†¬†¬†¬†¬† FROM VALUE #( ( key\_field = 1 )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( key\_field = 2 )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( key\_field = 3 )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( key\_field = 4 ) )
¬†¬†¬†¬†¬†¬† MAPPED FINAL(m3)
¬†¬†¬†¬†¬†¬† FAILED FINAL(f3)
¬†¬†¬†¬†¬†¬† REPORTED FINAL(r3).
¬†¬†¬†¬†COMMIT ENTITIES.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†out->write\_doc( \`An issue occurred in the RAP save sequence.\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT key\_field, field1, field2, field3, field4
¬†¬†¬†¬†¬†¬†FROM¬†¬†demo\_tab\_root\_5
¬†¬†¬†¬†¬†¬†ORDER BY key\_field
¬†¬†¬†¬†¬†¬†INTO TABLE @FINAL(action\_via\_bo\_intf).
¬†¬†¬†¬†out->write( action\_via\_bo\_intf
¬†¬†¬†¬†)->write( bp\_demo\_ext\_m=>behv\_aux\_table
¬†¬†¬†¬†)->line( ).
¬†¬†¬†¬†CLEAR bp\_demo\_ext\_m=>behv\_aux\_table.
¬†¬†¬†¬†out->write\_doc( \`<b>4) Create operation on the root \` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\`entity via a projection</b>\` ).
¬†¬†¬†¬†"Creating instances of the root entity via a projection
¬†¬†¬†¬†"Note that the projection view has only a subset of fields.
¬†¬†¬†¬†MODIFY ENTITIES OF demo\_proj\_m
¬†¬†¬†¬†¬†¬† ENTITY proj
¬†¬†¬†¬†¬†¬† CREATE FIELDS ( key\_field field1 field2 )
¬†¬†¬†¬†¬†¬† WITH VALUE #( ( %cid = 'cid5'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† key\_field = 5
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field1 = 'iii'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field2 = 'jjj' )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( %cid = 'cid6'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† key\_field = 6
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field1 = 'kkk'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field2 = 'lll' ) )
¬†¬†¬†¬†¬†¬†¬†¬†MAPPED FINAL(m4)
¬†¬†¬†¬†¬†¬†¬†¬†FAILED FINAL(f4)
¬†¬†¬†¬†¬†¬†¬†¬†REPORTED FINAL(r4).
¬†¬†¬†¬†COMMIT ENTITIES.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†out->write\_doc( \`An issue occurred in the RAP save sequence.\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†SELECT key\_field, field1, field2, field3, field4
¬†¬†¬†¬†¬†¬†FROM demo\_tab\_root\_5
¬†¬†¬†¬†¬†¬†ORDER BY key\_field INTO TABLE @FINAL(create\_via\_proj).
¬†¬†¬†¬†out->write( create\_via\_proj
¬†¬†¬†¬†)->write( bp\_demo\_ext\_m=>behv\_aux\_table ).
¬†¬†ENDMETHOD.
¬†¬†METHOD initialize\_dbtabs.
¬†¬†¬†¬†DELETE FROM demo\_tab\_root\_5.
¬†¬†ENDMETHOD.
¬†¬†METHOD constructor.
¬†¬†¬†¬†super->constructor( ).
¬†¬†¬†¬†initialize\_dbtabs( ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Access with ABAP using EML

The above source code uses [EML](javascript:call_link\('abeneml_glosry.htm'\) "Glossary Entry") to access the RAP business object, the RAP BO interface and RAP projection BO from an ABAP class and performs the following steps:

1.  Create operation directly on the root entity
    
    Instances are created directly on the root entity. The instances are saved to the database table whose entries are displayed. Additionally, the outcome of setting the parameters when calling the methods of class CL\_ABAP\_BEHV\_AUX is displayed. This is also true for the following steps.
    
2.  Create operation on the root entity via interface
    
    More instances are created on the root entity, however, with an ABAP EML MODIFY request via the RAP BO interface. Hence, the from\_interface parameter is filled after calling the get\_current\_context method.
    
3.  Action execution via RAP BO interface extension
    
    An action which is implemented in an extension ABP is called via a RAP BO interface extension. This method simply updates the value of a specific field. The output of the method calls demonstrates that also methods of the base BO's ABP are called. The context for in\_local\_mode is true in this case.
    
4.  Create operation on the root entity via a projection
    
    More instances are created on the root entity, however, with an ABAP EML MODIFY request via the RAP BO projection. Hence, the from\_projection parameter is filled after calling the get\_current\_context method.



**üìñ Source**: [abenrap_cl_abap_behv_aux_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenrap_cl_abap_behv_aux_abexa.htm)

### abenrap_cl_abap_behv_aux_ph_abexa.htm

> **üìñ Official SAP Documentation**: [abenrap_cl_abap_behv_aux_ph_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenrap_cl_abap_behv_aux_ph_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - RAP Business Objects](javascript:call_link\('abenabap_rap.htm'\))¬†‚Üí¬† [ABAP for RAP Business Objects](javascript:call_link\('abenabap_for_rap_bos.htm'\))¬†‚Üí¬† [Other RAP-Related ABAP Language Elements and Topics](javascript:call_link\('abenabap_rap_other.htm'\))¬†‚Üí¬† [RAP-Related System Classes and Functionality](javascript:call_link\('abaprap_system_classes.htm'\))¬†‚Üí¬† [CL\_ABAP\_BEHV\_AUX](javascript:call_link\('abaprap_cl_abap_behv_aux.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Checking%20RAP%20Transactional%20Phases%2C%20ABENRAP_CL_ABAP_BEHV_AUX_PH_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improveme
nt:)

Checking RAP Transactional Phases

This example demonstrates the use of the methods GET\_CURRENT\_PHASE and GET\_CURRENT\_HANDLER\_KIND of the class CL\_ABAP\_BEHV\_AUX.

Data model

The CDS data model consists of the root entity DEMO\_UMANAGED\_ROOT\_LATE\_NUM2.

Root entity:

@AccessControl.authorizationCheck: #NOT\_REQUIRED
define root view entity demo\_umanaged\_root\_late\_num2
¬†¬†as select from demo\_tab\_root\_3
¬†¬†composition \[1..\*\] of demo\_umanaged\_child\_late\_num2 as \_child
¬†¬†{
¬†¬†¬†¬†key key\_field,
¬†¬†¬†¬†¬†¬†¬†¬†field1,
¬†¬†¬†¬†¬†¬†¬†¬†field2,
¬†¬†¬†¬†¬†¬†¬†¬†field3,
¬†¬†¬†¬†¬†¬†¬†¬†field4,
¬†¬†¬†¬†¬†¬†¬†¬†\_child
¬†¬†}

Behavior definition

The [RAP behavior definition](javascript:call_link\('abencds_behavior_definition_glosry.htm'\) "Glossary Entry") DEMO\_UMANAGED\_ROOT\_LATE\_NUM2 is defined in [RAP BDL](javascript:call_link\('abencds_bdl_glosry.htm'\) "Glossary Entry") as follows:

unmanaged implementation in class
bp\_demo\_umanaged\_root\_late\_nu2 unique;
strict(2);
define behavior for demo\_umanaged\_root\_late\_num2
lock master
authorization master ( global )
late numbering
{
¬†¬†create;
¬†¬†update;
¬†¬†delete;
¬†¬†field ( readonly ) key\_field;
}

Behavior implementation

For the above RAP behavior definition, one [ABP](javascript:call_link\('abenbehavior_pool_glosry.htm'\) "Glossary Entry") is created. The global class of the behavior pool is BP\_DEMO\_UMANAGED\_ROOT\_LATE\_NU2. The actual behavior implementation takes place in local classes that are defined and implemented in the CCIMP include of the behavior pool.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_rap\_transaction\_phases DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†¬†¬†METHODS constructor.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†DATA:
¬†¬†¬†¬†¬†¬†failed\_early TYPE RESPONSE FOR
¬†¬†¬†¬†¬†¬†¬†¬†FAILED EARLY demo\_umanaged\_root\_late\_num2,
¬†¬†¬†¬†¬†¬†failed\_late¬†¬†TYPE RESPONSE FOR
¬†¬†¬†¬†¬†¬†¬†¬†FAILED LATE demo\_umanaged\_root\_late\_num2.
¬†¬†¬†¬†METHODS:
¬†¬†¬†¬†¬†¬†initialize\_dbtabs,
¬†¬†¬†¬†¬†¬†display\_dbtab\_entries,
¬†¬†¬†¬†¬†¬†display\_phases.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_rap\_transaction\_phases IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†out->begin\_section( \`Demo: RAP Transactional Phases\` ).
¬†¬†¬†¬†APPEND VALUE #( phase¬†¬†¬†¬†= cl\_abap\_behv\_aux=>get\_current\_phase( )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†meth\_log = \`No handler/saver method. Outside of\` &&
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†\` RAP transactional phases.\` )
¬†¬†¬†¬†¬†¬†TO bp\_demo\_umanaged\_root\_late\_nu2=>phases.
¬†¬†¬†¬†display\_phases( ).
¬†¬†¬†¬†out->line( ).
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
¬†¬†¬†¬†out->begin\_section( \`RAP create operation including a RAP BO \` &&
¬†¬†¬†¬†\`instance that fails in the finalize method\` ).
¬†¬†¬†¬†MODIFY ENTITY demo\_umanaged\_root\_late\_num2
¬†¬†¬†¬† CREATE FIELDS ( field1 field2 field3 field4 ) WITH VALUE #(
¬†¬†¬†¬†¬†¬†¬†¬†( %cid = 'cid1'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field1 = 'create\_1'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field2 = 'create\_2'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field3 = 55
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field4 = 55 ) )
¬†¬†¬†¬† FAILED failed\_early.
¬†¬†¬†¬†COMMIT ENTITIES
¬†¬†¬†¬†¬†¬†RESPONSE OF demo\_umanaged\_root\_late\_num2 FAILED failed\_late.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`ERROR: An issue occurred in the RAP save sequence.\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†display\_phases( ).
¬†¬†¬†¬†display\_dbtab\_entries( ).
¬†¬†¬†¬†out->line( ).
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
¬†¬†¬†¬†out->begin\_section( \`Successful RAP create operation\` ).
¬†¬†¬†¬†MODIFY ENTITY demo\_umanaged\_root\_late\_num2
¬†¬†¬†¬† CREATE FIELDS ( field1 field2 field3 field4 ) WITH VALUE #(
¬†¬†¬†¬†¬†¬†¬†¬†( %cid = 'cid2'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field1 = 'create\_3'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field2 = 'create\_4'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field3 = 50
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field4 = 55 ) )
¬†¬†¬†¬† FAILED failed\_early.
¬†¬†¬†¬†COMMIT ENTITIES
¬†¬†¬†¬†¬†¬†RESPONSE OF demo\_umanaged\_root\_late\_num2 FAILED failed\_late.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`ERROR: An issue occurred in the RAP save sequence.\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†display\_phases( ).
¬†¬†¬†¬†display\_dbtab\_entries( ).
¬†¬†¬†¬†out->line( ).
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
¬†¬†¬†¬†out->begin\_section( \`RAP create operation including a RAP BO \` &&
¬†¬†¬†¬†\`instance that fails in the check\_before\_save method\` ).
¬†¬†¬†¬†MODIFY ENTITY demo\_umanaged\_root\_late\_num2
¬†¬†¬†¬† CREATE FIELDS ( field1 field2 field3 field4 ) WITH VALUE #(
¬†¬†¬†¬†¬†¬†¬†¬†( %cid = 'cid3'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field1 = 'create\_5'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field2 = 'create\_6'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field3 = 100
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field4 = 200 ) )
¬†¬†¬†¬†¬†¬†FAILED failed\_early.
¬†¬†¬†¬†COMMIT ENTITIES
¬†¬†¬†¬†¬†¬†RESPONSE OF demo\_umanaged\_root\_late\_num2 FAILED failed\_late.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`ERROR: An issue occurred in the RAP save sequence.\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†display\_phases( ).
¬†¬†¬†¬†display\_dbtab\_entries( ).
¬†¬†¬†¬†out->line( ).
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
¬†¬†¬†¬†out->begin\_section( \`Successful RAP create operation\` ).
¬†¬†¬†¬†MODIFY ENTITY demo\_umanaged\_root\_late\_num2
¬†¬†¬†¬† CREATE FIELDS ( field1 field2 field3 field4 ) WITH VALUE #(
¬†¬†¬†¬†¬†¬†¬†¬†( %cid = 'cid4'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field1 = 'create\_7'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field2 = 'create\_8'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field3 = 100
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†field4 = 20 ) )
¬†¬†¬†¬†¬†¬†FAILED failed\_early.
¬†¬†¬†¬†COMMIT ENTITIES
¬†¬†¬†¬†¬†¬†RESPONSE OF demo\_umanaged\_root\_late\_num2 FAILED failed\_late.
¬†¬†¬†¬†IF sy-subrc <> 0.
¬†¬†¬†¬†¬†¬†out->write(
¬†¬†¬†¬†¬†¬†¬†¬†\`ERROR: An issue occurred in the RAP save sequence.\` ).
¬†¬†¬†¬†ENDIF.
¬†¬†¬†¬†display\_phases( ).
¬†¬†¬†¬†display\_dbtab\_entries( ).
¬†¬†ENDMETHOD.
¬†¬†METHOD initialize\_dbtabs.
¬†¬†¬†¬†DELETE FROM demo\_tab\_root\_3.
¬†¬†ENDMETHOD.
¬†¬†METHOD display\_dbtab\_entries.
¬†¬†¬†¬†SELECT key\_field, field1, field2, field3, field4
¬†¬†¬†¬†¬†¬† FROM demo\_tab\_root\_3 ORDER BY key\_field
¬†¬†¬†¬†¬†¬† INTO TABLE @DATA(db\_tab).
¬†¬†¬†¬†out->write( \`Database table entries after RAP operation:\`
¬†¬†¬†¬†)->write( db\_tab ).
¬†¬†ENDMETHOD.
¬†¬†METHOD display\_phases.
¬†¬†¬†¬†out->write( \`Transactional phases log table:\`
¬†¬†¬†¬†)->write( bp\_demo\_umanaged\_root\_late\_nu2=>phases ).
¬†¬†¬†¬†CLEAR bp\_demo\_umanaged\_root\_late\_nu2=>phases.
¬†¬†ENDMETHOD.
¬†¬†METHOD constructor.
¬†¬†¬†¬†super->constructor( ).
¬†¬†¬†¬†initialize\_dbtabs( ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Access with ABAP using EML

The above source code uses [EML](javascript:call_link\('abeneml_glosry.htm'\) "Glossary Entry") to access the RAP business object from an ABAP class.

The example contains four RAP create operations using an ABAP EML MODIFY statement:

-   Two RAP create operations fail. One operation intentionally fails in the [finalize](javascript:call_link\('abensaver_finalize.htm'\)) [RAP saver method](javascript:call_link\('abenabp_saver_method_glosry.htm'\) "Glossary Entry"). Another operations fails in the [check\_before\_save](javascript:call_link\('abensaver_check_before_save.htm'\)) method.
-   Two RAP create operations are successful.
-   The example is implemented in a way that in the RAP handler and saver methods a log table is filled. The log table includes, among other things, information about the current RAP transactional phase (retrieved using CL\_ABAP\_BEHV\_AUX=>GET\_CURRENT\_PHASE) and the current handler kind (retrieved using CL\_ABAP\_BEHV\_AUX=>GET\_CURRENT\_HANDLER\_KIND).
-   The log table and the database table entries as result of the RAP create operations are displayed.
-   The log table for the failed instances shows that the [RAP late save phase](javascript:call_link\('abenlate_rap_save_phase_glosry.htm'\) "Glossary Entry") is not reached, only the [RAP interaction phase](javascript:call_link\('abenrap_int_phase_glosry.htm'\) "Glossary Entry") and the [RAP early save phase](javascript:call_link\('abenearly_rap_save_phase_glosry.htm'\) "Glossary Entry"). The RAP transaction is concluded with the [RAP cleanup phase](javascript:call_link\('abenrap_cleanup_phase_glosry.htm'\) "Glossary Entry") demonstrated by the successful RAP create operations.



**üìñ Source**: [abenrap_cl_abap_behv_aux_ph_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenrap_cl_abap_behv_aux_ph_abexa.htm)

### abaprap_cl_abap_behv_aux.htm

> **üìñ Official SAP Documentation**: [abaprap_cl_abap_behv_aux.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abaprap_cl_abap_behv_aux.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - RAP Business Objects](javascript:call_link\('abenabap_rap.htm'\))¬†‚Üí¬† [ABAP for RAP Business Objects](javascript:call_link\('abenabap_for_rap_bos.htm'\))¬†‚Üí¬† [Other RAP-Related ABAP Language Elements and Topics](javascript:call_link\('abenabap_rap_other.htm'\))¬†‚Üí¬† [RAP-Related System Classes and Functionality](javascript:call_link\('abaprap_system_classes.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CL_ABAP_BEHV_AUX%2C%20ABAPRAP_CL_ABAP_BEHV_AUX%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

CL\_ABAP\_BEHV\_AUX

The class CL\_ABAP\_BEHV\_AUX contains methods for retrieving various pieces of information.

Method

Details

GET\_CURRENT\_PHASE

Information about the current [RAP transactional phase](javascript:call_link\('abentransactional_phase_glosry.htm'\) "Glossary Entry"), for example, [RAP early save phase](javascript:call_link\('abenearly_rap_save_phase_glosry.htm'\) "Glossary Entry"), [RAP late save phase](javascript:call_link\('abenlate_rap_save_phase_glosry.htm'\) "Glossary Entry"), or [RAP interaction phase](javascript:call_link\('abenrap_int_phase_glosry.htm'\) "Glossary Entry").

GET\_CURRENT\_CONTEXT

Information about the context of the current [RAP handler](javascript:call_link\('abenabp_handler_method_glosry.htm'\) "Glossary Entry") and [saver method](javascript:call_link\('abenabp_saver_method_glosry.htm'\) "Glossary Entry")

GET\_CURRENT\_HANDLER\_KIND

Information about the kind of method. For information on the values, see the domain ABP\_BEHV\_KIND.

Hint

Regarding GET\_CURRENT\_CONTEXT:

-   In the [RAP early save phase](javascript:call_link\('abenearly_rap_save_phase_glosry.htm'\) "Glossary Entry") and [RAP late save phase](javascript:call_link\('abenlate_rap_save_phase_glosry.htm'\) "Glossary Entry") it makes no sense to evaluate the components other than from\_projection.
-   The for\_permissions parameter can be used to avoid a double checking of authorization or feature control if an ABAP EML modify request is handled.
-   Example use cases for the context information:
    -   When a behavior is accessed via a [RAP interface behavior definition](javascript:call_link\('abencds_interface_bdef_glosry.htm'\) "Glossary Entry"), this access is directly mapped to a request on the base [RAP business object (BO)](javascript:call_link\('abenrap_bo_glosry.htm'\) "Glossary Entry"). A use case might be that the base BO implementation would like to have the information available that it has been called via a [RAP BO interface](javascript:call_link\('abenrap_bo_interface_glosry.htm'\) "Glossary Entry"). For example, a RAP BO interface implements specific logic (for example, some fields are dynamically set to read-only) in the base BO's behavior pool. The implementation in the base BO then requires the name of the RAP BO interface which can be retrieved using the methods of this class.
    -   Similarly, the base BO implementation might be interested in knowing whether it was invoked by a [RAP projection extension entity](javascript:call_link\('abenrap_proj_ext_entity_glosry.htm'\) "Glossary Entry").

Example

The following code snippet shows how information on the current context might be retrieved using the GET\_CURRENT\_CONTEXT method by storing the information in a variable [declared inline](javascript:call_link\('abeninline_declaration_glosry.htm'\) "Glossary Entry").

cl\_abap\_behv\_aux=>get\_current\_context( IMPORTING
¬†¬†¬†¬†¬†¬†from\_projection = FINAL(fr\_proj)
¬†¬†¬†¬†¬†¬†from\_interface¬†¬†= FINAL(fr\_int)
¬†¬†¬†¬†¬†¬†in\_local\_mode¬†¬† = FINAL(loc\_mode)
¬†¬†¬†¬†¬†¬†draft\_activate¬†¬†= FINAL(dr\_act)
¬†¬†¬†¬†¬†¬†for\_permissions = FINAL(for\_perm)
¬†¬†¬†¬†¬†¬†privileged¬†¬†¬†¬†¬†¬†= FINAL(priv) ).

Executable Examples

-   The example [Getting RAP Context Information Using CL\_ABAP\_BEHV\_AUX](javascript:call_link\('abenrap_cl_abap_behv_aux_abexa.htm'\)) demonstrates the use of methods of the class CL\_ABAP\_BEHV\_AUX by focusing on the filling of the specific parameters in multiple contexts.
-   The example [Using the Addition PRIVILEGED with an ABAP EML Statement](javascript:call_link\('abeneml_privileged_abexa.htm'\)) demonstrates the addition PRIVILEGED using an [action](javascript:call_link\('abenaction_glosry.htm'\) "Glossary Entry") and a managed RAP BO. In this example, the method get\_current\_context is used to retrieve the information whether the running handler is running in privileged mode.
-   The example [Checking RAP Transactional Phases](javascript:call_link\('abenrap_cl_abap_behv_aux_ph_abexa.htm'\)) demonstrates the methods GET\_CURRENT\_PHASE and GET\_CURRENT\_HANDLER\_KIND.

Continue
![Example](exa.gif "Example") [Getting RAP Context Information Using CL\_ABAP\_BEHV\_AUX](javascript:call_link\('abenrap_cl_abap_behv_aux_abexa.htm'\))
![Example](exa.gif "Example") [Checking RAP Transactional Phases](javascript:call_link\('abenrap_cl_abap_behv_aux_ph_abexa.htm'\))



**üìñ Source**: [abaprap_cl_abap_behv_aux.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abaprap_cl_abap_behv_aux.htm)

### abapcl_abap_behvdescr.htm

> **üìñ Official SAP Documentation**: [abapcl_abap_behvdescr.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abapcl_abap_behvdescr.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - RAP Business Objects](javascript:call_link\('abenabap_rap.htm'\))¬†‚Üí¬† [ABAP for RAP Business Objects](javascript:call_link\('abenabap_for_rap_bos.htm'\))¬†‚Üí¬† [Other RAP-Related ABAP Language Elements and Topics](javascript:call_link\('abenabap_rap_other.htm'\))¬†‚Üí¬† [RAP-Related System Classes and Functionality](javascript:call_link\('abaprap_system_classes.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CL_ABAP_BEHVDESCR%2C%20ABAPCL_ABAP_BEHVDESCR%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

CL\_ABAP\_BEHVDESCR

The class CL\_ABAP\_BEHVDESCR contains methods for [Runtime Type Creation (RTTI)](javascript:call_link\('abenrun_time_type_creation_glosry.htm'\) "Glossary Entry") and [Runtime Type Creation (RTTC)](javascript:call_link\('abenrun_time_type_creation_glosry.htm'\) "Glossary Entry") in the context of [BDEF derived types](javascript:call_link\('abenrap_derived_type_glosry.htm'\) "Glossary Entry") in RAP. This means that BDEF derived type information can be retrieved at runtime. Derived types can also be defined at runtime.

The following list shows a selection of available methods:

-   GET\_ROOT, GET\_ROOTS\_OF\_ENTITIES: Getting the root entity or entities for a given entity
-   GET\_TYPE: Getting runtime type information for entities and operations
-   CREATE\_DATA: Creating data objects typed with BDEF derived types (CRUD or action)
-   GET\_ABS\_TYPENAME: Getting the [absolute type name](javascript:call_link\('abenabsolute_typename_glosry.htm'\) "Glossary Entry") for entities and operations
-   SET\_CONTROL\_FLAG, GET\_CONTROL\_FLAG, GET\_CONTROL\_FIELDS: Filling or getting [%control](javascript:call_link\('abapderived_types_control.htm'\)) fields
-   GET\_FOREIGN\_ENTITIES: Getting [RAP foreign entities](javascript:call_link\('abenrap_foreign_entity_glosry.htm'\) "Glossary Entry") and aliases
-   GET\_CONTRACTS: Getting [API classification](javascript:call_link\('abapapi_classification.htm'\))

Further Information

For more information, see the class documentation and the [Runtime Type Services (RTTS)](javascript:call_link\('abenrtti.htm'\)) topic.

Executable Example

[Getting Type Information Using CL\_ABAP\_BEHVDESCR](javascript:call_link\('abenrap_type_info_abexa.htm'\))

Continue
![Example](exa.gif "Example") [Getting BDEF Derived Type Information Using CL\_ABAP\_BEHVDESCR](javascript:call_link\('abenrap_type_info_abexa.htm'\))



**üìñ Source**: [abapcl_abap_behvdescr.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abapcl_abap_behvdescr.htm)

### abenrap_type_info_abexa.htm

> **üìñ Official SAP Documentation**: [abenrap_type_info_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenrap_type_info_abexa.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - RAP Business Objects](javascript:call_link\('abenabap_rap.htm'\))¬†‚Üí¬† [ABAP for RAP Business Objects](javascript:call_link\('abenabap_for_rap_bos.htm'\))¬†‚Üí¬† [Other RAP-Related ABAP Language Elements and Topics](javascript:call_link\('abenabap_rap_other.htm'\))¬†‚Üí¬† [RAP-Related System Classes and Functionality](javascript:call_link\('abaprap_system_classes.htm'\))¬†‚Üí¬† [CL\_ABAP\_BEHVDESCR](javascript:call_link\('abapcl_abap_behvdescr.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20Getting%20BDEF%20Derived%20Type%20Information%20Using%20CL_ABAP_BEHVDESCR%2C%20ABENRAP_TYPE_INFO_ABEXA%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASugg
estion%20for%20improvement:)

Getting BDEF Derived Type Information Using CL\_ABAP\_BEHVDESCR

This example demonstrates various methods of the CL\_ABAP\_BEHVDESCR class.

Source Code ¬† 

\* Public class definition
CLASS cl\_demo\_rap\_behvdescr DEFINITION
¬†¬†INHERITING FROM cl\_demo\_classrun
¬†¬†PUBLIC
¬†¬†CREATE PUBLIC.
¬†¬†PUBLIC SECTION.
¬†¬†¬†¬†METHODS main REDEFINITION.
¬†¬†¬†¬†METHODS constructor.
¬†¬†PRIVATE SECTION.
¬†¬†¬†¬†METHODS initialize\_dbtabs.
ENDCLASS.
\* Public class implementation
CLASS cl\_demo\_rap\_behvdescr IMPLEMENTATION.
¬†¬†METHOD main.
¬†¬†¬†¬†out->begin\_section( \`Demonstrating Methods of Class \` &&
¬†¬†¬†¬†¬†¬†\`cl\_abap\_behvdescr\` ).
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
¬†¬†¬†¬†"Getting information on root entities
¬†¬†¬†¬†out->next\_section( \`get\_root / get\_roots\_of\_entities\` ).
¬†¬†¬†¬†DATA(ent1) = CONV abp\_entity\_name( 'DEMO\_MANAGED\_CHILD' ).
¬†¬†¬†¬†DATA(ent2) = CONV abp\_entity\_name( 'DEMO\_RAP\_EXTENSIBLE\_CHILD' ).
¬†¬†¬†¬†cl\_abap\_behvdescr=>get\_roots\_of\_entities(
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†entities¬†¬†¬†¬† = VALUE abp\_entity\_name\_tab( ( ent1 )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( ent2 ) )
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†entity\_roots = DATA(roots) ).
¬†¬†¬†¬†out->write( roots ).
¬†¬†¬†¬†DATA(root) = cl\_abap\_behvdescr=>get\_root( p\_entity = ent1 ).
¬†¬†¬†¬†out->write\_data( root ).
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
¬†¬†¬†¬†"Getting type information/absolute type name
¬†¬†¬†¬†out->next\_section( \`get\_type / get\_abs\_typename\` ).
¬†¬†¬†¬†"Creating a type description object
¬†¬†¬†¬†DATA(tdo) = cl\_abap\_behvdescr=>get\_type(
¬†¬†¬†¬†¬†¬†p\_name = 'DEMO\_MANAGED\_CHILD\_4'
¬†¬†¬†¬†¬†¬†p\_root = 'DEMO\_MANAGED\_ROOT\_4'
¬†¬†¬†¬†¬†¬†p\_kind = if\_abap\_behv=>typekind-result
¬†¬†¬†¬†¬†¬†p\_op¬†¬† = if\_abap\_behv=>op-r-read
¬†¬†¬†¬†).
¬†¬†¬†¬†out->write( tdo ).
¬†¬†¬†¬†"Getting absolute name using the created type description object
¬†¬†¬†¬†DATA(abs\_itab) = tdo->absolute\_name.
¬†¬†¬†¬†"Getting absolute name using the get\_abs\_typename method
¬†¬†¬†¬†"The p\_structure parameter is flagged. Therefore, a structured type
¬†¬†¬†¬†"is created.
¬†¬†¬†¬†DATA(abs\_struc) = cl\_abap\_behvdescr=>get\_abs\_typename(
¬†¬†¬†¬†¬†¬†p\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_MANAGED\_CHILD\_4'
¬†¬†¬†¬†¬†¬†p\_root¬†¬†¬†¬†¬†¬†= 'DEMO\_MANAGED\_ROOT\_4'
¬†¬†¬†¬†¬†¬†p\_kind¬†¬†¬†¬†¬†¬†= if\_abap\_behv=>typekind-result
¬†¬†¬†¬†¬†¬†p\_op¬†¬†¬†¬†¬†¬†¬†¬†= if\_abap\_behv=>op-m-create
¬†¬†¬†¬†¬†¬†p\_structure = 'X' ).
¬†¬†¬†¬†out->write\_data( abs\_itab ).
¬†¬†¬†¬†out->write\_data( abs\_struc ).
¬†¬†¬†¬†"Using the type description objects and absolute names to create
¬†¬†¬†¬†"anonymous data objects dynamically
¬†¬†¬†¬†DATA dref TYPE REF TO data.
¬†¬†¬†¬†CREATE DATA dref TYPE HANDLE tdo.
¬†¬†¬†¬†"Using the dynamically created internal table in an EML statement
¬†¬†¬†¬†READ ENTITY demo\_managed\_child\_4
¬†¬†¬†¬†¬†¬†ALL FIELDS WITH VALUE #( ( key\_field¬†¬†¬†¬†¬†¬† = 1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† key\_field\_child = 10 ) )
¬†¬†¬†¬†¬†¬†RESULT dref->\*.
¬†¬†¬†¬†out->write\_data( dref->\* ).
¬†¬†¬†¬†"Using absolute name
¬†¬†¬†¬†CREATE DATA dref TYPE (abs\_itab).
¬†¬†¬†¬†READ ENTITY demo\_managed\_child\_4
¬†¬†¬†¬†¬†¬†ALL FIELDS WITH VALUE #( ( key\_field¬†¬†¬†¬†¬†¬† = 2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† key\_field\_child = 20 ) )
¬†¬†¬†¬†¬†¬†RESULT dref->\*.
¬†¬†¬†¬†out->write\_data( dref->\* ).
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
¬†¬†¬†¬†"Creating data object with BDEF derived type
¬†¬†¬†¬†out->next\_section( \`create\_data\` ).
¬†¬†¬†¬†DATA(der\_type) = cl\_abap\_behvdescr=>create\_data(
¬†¬†¬†¬†¬†¬†p\_name = 'DEMO\_MANAGED\_CHILD\_4'
¬†¬†¬†¬†¬†¬†p\_root = 'DEMO\_MANAGED\_ROOT\_4'
¬†¬†¬†¬†¬†¬†p\_kind = if\_abap\_behv=>typekind-import
¬†¬†¬†¬†¬†¬†p\_op¬†¬† = if\_abap\_behv=>op-r-read
¬†¬†¬†¬†).
¬†¬†¬†¬†"Getting absolute name using RTTI
¬†¬†¬†¬†DATA(abs\_der) = cl\_abap\_typedescr=>describe\_by\_data( der\_type->\*
¬†¬†¬†¬†¬†¬†)->absolute\_name.
¬†¬†¬†¬†out->write\_data( abs\_der ).
¬†¬†¬†¬†"Using the created data object in an EML statement
¬†¬†¬†¬†DATA itab TYPE TABLE OF demo\_managed\_child\_4.
¬†¬†¬†¬†itab = VALUE #( ( key\_field = 1 key\_field\_child = 10 ) ).
¬†¬†¬†¬†der\_type->\* = CORRESPONDING #( itab ).
¬†¬†¬†¬†READ ENTITY demo\_managed\_child\_4
¬†¬†¬†¬†¬†¬†ALL FIELDS WITH der\_type->\*
¬†¬†¬†¬†¬†¬†RESULT DATA(read\_result).
¬†¬†¬†¬†out->write\_data( read\_result ).
¬†¬†¬†¬†"Type description object for a structured type
¬†¬†¬†¬†DATA(der\_s) = cl\_abap\_behvdescr=>get\_type(
¬†¬†¬†¬†¬†¬†p\_name¬†¬†¬†¬†¬†¬†= 'DEMO\_MANAGED\_CHILD\_4'
¬†¬†¬†¬†¬†¬†p\_root¬†¬†¬†¬†¬†¬†= 'DEMO\_MANAGED\_ROOT\_4'
¬†¬†¬†¬†¬†¬†p\_kind¬†¬†¬†¬†¬†¬†= if\_abap\_behv=>typekind-result
¬†¬†¬†¬†¬†¬†p\_op¬†¬†¬†¬†¬†¬†¬†¬†= if\_abap\_behv=>op-r-read
¬†¬†¬†¬†¬†¬†p\_structure = 'X'
¬†¬†¬†¬†).
¬†¬†¬†¬†"Creating an anonymous structure
¬†¬†¬†¬†DATA dref\_struc TYPE REF TO data.
¬†¬†¬†¬†CREATE DATA dref\_struc TYPE HANDLE der\_s.
¬†¬†¬†¬†"Creating an internal table based on the structure
¬†¬†¬†¬†DATA der\_itab TYPE REF TO data.
¬†¬†¬†¬†CREATE DATA der\_itab LIKE TABLE OF dref\_struc->\*.
¬†¬†¬†¬†"Using the internal table in an EML statement
¬†¬†¬†¬†READ ENTITY demo\_managed\_child\_4
¬†¬†¬†¬†¬†¬†ALL FIELDS WITH VALUE #( ( key\_field = 1 key\_field\_child = 10 )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† ( key\_field = 2 key\_field\_child = 20 ) )
¬†¬†¬†¬†¬†¬†RESULT der\_itab->\*.
¬†¬†¬†¬†"Filling the anonymous structure
¬†¬†¬†¬†READ TABLE der\_itab->\* INTO dref\_struc->\* WITH KEY
¬†¬†¬†¬†¬†¬†('KEY\_FIELD') = 2.
¬†¬†¬†¬†out->write\_data( dref\_struc->\* ).
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
¬†¬†¬†¬†"Getting/Setting %control fields
¬†¬†¬†¬†out->next\_section( \`get\_control\_fields / set\_control\_flag \`
¬†¬†¬†¬†¬†¬†&& \`get\_control\_flag\` ).
¬†¬†¬†¬†"get\_control\_fields
¬†¬†¬†¬†DATA der TYPE TABLE FOR CREATE demo\_managed\_root\_4.
¬†¬†¬†¬†der = VALUE #( ( %cid¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 'cid1'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† key\_field¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 1
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %control-key\_field = if\_abap\_behv=>mk-on
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field1¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 'aaa\_cr'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %control-field1¬†¬†¬†¬†= if\_abap\_behv=>mk-on
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field2¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 'bbb\_cr'
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %control-field2¬†¬†¬†¬†= if\_abap\_behv=>mk-off
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field3¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 2
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %control-field3¬†¬†¬†¬†= if\_abap\_behv=>mk-on
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† field4¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† = 3
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† %control-field4¬†¬†¬†¬†= if\_abap\_behv=>mk-on ) ).
¬†¬†¬†¬†DATA(ctrl) = cl\_abap\_behvdescr=>get\_control\_fields( p\_data = der ).
¬†¬†¬†¬†out->write\_data( ctrl ).
¬†¬†¬†¬†ctrl = cl\_abap\_behvdescr=>get\_control\_fields(
¬†¬†¬†¬†¬†¬†p\_data = der
¬†¬†¬†¬†¬†¬†p\_flag = cl\_abap\_behv=>flag\_null ).
¬†¬†¬†¬†out->write\_data( ctrl ).
¬†¬†¬†¬†"set\_control\_flag
¬†¬†¬†¬†cl\_abap\_behvdescr=>set\_control\_flag(
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†p\_fields = VALUE #( ( \`FIELD1\` )
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†( \`FIELD4\` ) )
¬†¬†¬†¬†¬†¬†¬†¬†p\_flag¬†¬† = cl\_abap\_behv=>flag\_null
¬†¬†¬†¬†¬†¬†CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†p\_data¬†¬† = der ).
¬†¬†¬†¬†cl\_abap\_behvdescr=>set\_control\_flag(
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†p\_fields = VALUE #( ( \`FIELD2\` ) )
¬†¬†¬†¬†¬†¬†¬†¬†p\_flag¬†¬† = cl\_abap\_behv=>flag\_changed
¬†¬†¬†¬†¬†¬†CHANGING
¬†¬†¬†¬†¬†¬†¬†¬†p\_data¬†¬† = der ).
¬†¬†¬†¬†out->write\_data( der\[ 1 \]-%control ).
¬†¬†¬†¬†"get\_control\_flag
¬†¬†¬†¬†cl\_abap\_behvdescr=>get\_control\_flag(
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†p\_fields = VALUE #( ( \`FIELD1\` ) )
¬†¬†¬†¬†¬†¬†¬†¬†p\_data¬†¬† = der
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†p\_flag¬†¬† = DATA(get\_ctrl) ).
¬†¬†¬†¬†out->write\_data( get\_ctrl ).
¬†¬†¬†¬†cl\_abap\_behvdescr=>get\_control\_flag(
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†p\_fields = VALUE #( ( \`FIELD2\` ) )
¬†¬†¬†¬†¬†¬†¬†¬†p\_data¬†¬† = der
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†p\_flag¬†¬† = get\_ctrl ).
¬†¬†¬†¬†out->write\_data( get\_ctrl ).
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
¬†¬†¬†¬†"Getting foreign entities/alias names
¬†¬†¬†¬†out->next\_section( \`get\_foreign\_entities\` ).
¬†¬†¬†¬†DATA(f\_ent) = cl\_abap\_behvdescr=>get\_foreign\_entities(
¬†¬†¬†¬†¬†¬†CONV abp\_entity\_name( 'DEMO\_UNMANAGED\_MAP\_MESSAGES' ) ).
¬†¬†¬†¬†out->write\_data( f\_ent ).
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
¬†¬†¬†¬†"Get API classifications
¬†¬†¬†¬†out->next\_section( \`get\_contracts\` ).
¬†¬†¬†¬†cl\_abap\_behvdescr=>get\_contracts(
¬†¬†¬†¬†¬†¬†EXPORTING
¬†¬†¬†¬†¬†¬†¬†¬†name¬†¬†¬†¬†¬†¬†= 'CL\_DEMO\_CLASSIFIED\_APIS'
¬†¬†¬†¬†¬†¬†¬†¬†kind¬†¬†¬†¬†¬†¬†= 'K'
¬†¬†¬†¬†¬†¬†IMPORTING
¬†¬†¬†¬†¬†¬†¬†¬†contracts = DATA(contracts) ).
¬†¬†¬†¬†out->write\_data( contracts ).
¬†¬†ENDMETHOD.
¬†¬†METHOD constructor.
¬†¬†¬†¬†super->constructor( ).
¬†¬†¬†¬†initialize\_dbtabs( ).
¬†¬†ENDMETHOD.
¬†¬†METHOD initialize\_dbtabs.
¬†¬†¬†¬†DELETE FROM demo\_tab\_child\_3.
¬†¬†¬†¬†MODIFY demo\_tab\_child\_3 FROM TABLE @( VALUE #(
¬†¬†¬†¬†¬†¬†( key\_field¬†¬†¬†¬†¬†¬† = 1
¬†¬†¬†¬†¬†¬†¬†¬†key\_field\_child = 10
¬†¬†¬†¬†¬†¬†¬†¬†field1¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= \`abc\`
¬†¬†¬†¬†¬†¬†¬†¬†field2¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= \`def\`
¬†¬†¬†¬†¬†¬†¬†¬†field3¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 100
¬†¬†¬†¬†¬†¬†¬†¬†field4¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 1000 )
¬†¬†¬†¬†¬†¬†( key\_field¬†¬†¬†¬†¬†¬† = 2
¬†¬†¬†¬†¬†¬†¬†¬†key\_field\_child = 20
¬†¬†¬†¬†¬†¬†¬†¬†field1¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= \`ghi\`
¬†¬†¬†¬†¬†¬†¬†¬†field2¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= \`jkl\`
¬†¬†¬†¬†¬†¬†¬†¬†field3¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 200
¬†¬†¬†¬†¬†¬†¬†¬†field4¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†= 2000 ) ) ).
¬†¬†ENDMETHOD.
ENDCLASS.

Description ¬† 

Access with ABAP using EML

The above source code uses [EML](javascript:call_link\('abeneml_glosry.htm'\) "Glossary Entry") to access the RAP business object from an ABAP class.

The class demonstrates various methods of the CL\_ABAP\_BEHVDESCR class, for example, for getting [BDEF derived type](javascript:call_link\('abenrap_derived_type_glosry.htm'\) "Glossary Entry") information or creating types.



**üìñ Source**: [abenrap_type_info_abexa.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abenrap_type_info_abexa.htm)

### abapcl_abap_behvdescr.htm

> **üìñ Official SAP Documentation**: [abapcl_abap_behvdescr.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abapcl_abap_behvdescr.htm)
> **üîç Direct Link**: This section contains the complete content from the official SAP ABAP documentation page.


**üìñ Source**: [abapcl_abap_behvdescr.htm](https://help.sap.com/doc/abapdocu_latest_index_htm/latest/en-US/abapcl_abap_behvdescr.htm)


¬† 

* * *

AS ABAP Release 758, ¬©Copyright 2024 SAP SE. All rights reserved.

[ABAP - Keyword Documentation](javascript:call_link\('abenabap.htm'\))¬†‚Üí¬† [ABAP - RAP Business Objects](javascript:call_link\('abenabap_rap.htm'\))¬†‚Üí¬† [ABAP for RAP Business Objects](javascript:call_link\('abenabap_for_rap_bos.htm'\))¬†‚Üí¬† [Other RAP-Related ABAP Language Elements and Topics](javascript:call_link\('abenabap_rap_other.htm'\))¬†‚Üí¬† [RAP-Related System Classes and Functionality](javascript:call_link\('abaprap_system_classes.htm'\))¬†‚Üí¬†

 [![](Mail.gif?object=Mail.gif "Feedback mail for displayed topic") Mail Feedback](mailto:f1_help@sap.com?subject=Feedback%20on%20ABAP%20Documentation&body=Document:%20CL_ABAP_BEHVDESCR%2C%20ABAPCL_ABAP_BEHVDESCR%2C%20758%0D%0A%0D%0AError:%0D%0A%0D%0A%0D%0A%0D%0ASuggestion%20for%20improvement:)

CL\_ABAP\_BEHVDESCR

The class CL\_ABAP\_BEHVDESCR contains methods for [Runtime Type Creation (RTTI)](javascript:call_link\('abenrun_time_type_creation_glosry.htm'\) "Glossary Entry") and [Runtime Type Creation (RTTC)](javascript:call_link\('abenrun_time_type_creation_glosry.htm'\) "Glossary Entry") in the context of [BDEF derived types](javascript:call_link\('abenrap_derived_type_glosry.htm'\) "Glossary Entry") in RAP. This means that BDEF derived type information can be retrieved at runtime. Derived types can also be defined at runtime.

The following list shows a selection of available methods:

-   GET\_ROOT, GET\_ROOTS\_OF\_ENTITIES: Getting the root entity or entities for a given entity
-   GET\_TYPE: Getting runtime type information for entities and operations
-   CREATE\_DATA: Creating data objects typed with BDEF derived types (CRUD or action)
-   GET\_ABS\_TYPENAME: Getting the [absolute type name](javascript:call_link\('abenabsolute_typename_glosry.htm'\) "Glossary Entry") for entities and operations
-   SET\_CONTROL\_FLAG, GET\_CONTROL\_FLAG, GET\_CONTROL\_FIELDS: Filling or getting [%control](javascript:call_link\('abapderived_types_control.htm'\)) fields
-   GET\_FOREIGN\_ENTITIES: Getting [RAP foreign entities](javascript:call_link\('abenrap_foreign_entity_glosry.htm'\) "Glossary Entry") and aliases
-   GET\_CONTRACTS: Getting [API classification](javascript:call_link\('abapapi_classification.htm'\))

Further Information

For more information, see the class documentation and the [Runtime Type Services (RTTS)](javascript:call_link\('abenrtti.htm'\)) topic.

Executable Example

[Getting Type Information Using CL\_ABAP\_BEHVDESCR](javascript:call_link\('abenrap_type_info_abexa.htm'\))

Continue
![Example](exa.gif "Example") [Getting BDEF Derived Type Information Using CL\_ABAP\_BEHVDESCR](javascript:call_link\('abenrap_type_info_abexa.htm'\))


---
